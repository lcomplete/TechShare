<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>[Java 开发实战] 5 分钟搞定 liquibase 数据库版本控制 | lcomplete 的技术分享</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分享Java、.NET、Javascript、效率、软件工程、编程语言等技术知识。">
    
    <link rel="preload" href="/TechShare/assets/css/0.styles.1b1aafba.css" as="style"><link rel="preload" href="/TechShare/assets/js/app.c381cb99.js" as="script"><link rel="preload" href="/TechShare/assets/js/3.07b3c911.js" as="script"><link rel="preload" href="/TechShare/assets/js/4.c8309a57.js" as="script"><link rel="preload" href="/TechShare/assets/js/14.13469d74.js" as="script"><link rel="preload" href="/TechShare/assets/js/13.dd34e8a8.js" as="script"><link rel="prefetch" href="/TechShare/assets/js/1.5306b2e4.js"><link rel="prefetch" href="/TechShare/assets/js/10.82d58988.js"><link rel="prefetch" href="/TechShare/assets/js/11.9875b444.js"><link rel="prefetch" href="/TechShare/assets/js/12.df885c9a.js"><link rel="prefetch" href="/TechShare/assets/js/15.be42bba3.js"><link rel="prefetch" href="/TechShare/assets/js/16.289463e6.js"><link rel="prefetch" href="/TechShare/assets/js/17.c760222b.js"><link rel="prefetch" href="/TechShare/assets/js/18.6c41d611.js"><link rel="prefetch" href="/TechShare/assets/js/19.eb738e73.js"><link rel="prefetch" href="/TechShare/assets/js/20.1efba17a.js"><link rel="prefetch" href="/TechShare/assets/js/21.c9473b43.js"><link rel="prefetch" href="/TechShare/assets/js/22.d99ff823.js"><link rel="prefetch" href="/TechShare/assets/js/23.a1a34315.js"><link rel="prefetch" href="/TechShare/assets/js/24.e1a4a053.js"><link rel="prefetch" href="/TechShare/assets/js/25.0054b61e.js"><link rel="prefetch" href="/TechShare/assets/js/26.d5d5fb24.js"><link rel="prefetch" href="/TechShare/assets/js/27.b18e4502.js"><link rel="prefetch" href="/TechShare/assets/js/28.3e7ac518.js"><link rel="prefetch" href="/TechShare/assets/js/29.cb2762d5.js"><link rel="prefetch" href="/TechShare/assets/js/30.4455d09e.js"><link rel="prefetch" href="/TechShare/assets/js/31.99146140.js"><link rel="prefetch" href="/TechShare/assets/js/32.b89ead18.js"><link rel="prefetch" href="/TechShare/assets/js/5.c3889983.js"><link rel="prefetch" href="/TechShare/assets/js/6.3bc34c63.js"><link rel="prefetch" href="/TechShare/assets/js/7.7adc823e.js"><link rel="prefetch" href="/TechShare/assets/js/8.c88c87e0.js"><link rel="prefetch" href="/TechShare/assets/js/9.5da82167.js">
    <link rel="stylesheet" href="/TechShare/assets/css/0.styles.1b1aafba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TechShare/" class="home-link router-link-active"><!----> <span class="site-name">lcomplete 的技术分享</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/lcomplete/TechShare" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/lcomplete/TechShare" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/TechShare/summary/" class="sidebar-link">目录</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TechShare/docs/java/俯瞰Java服务端开发.html" class="sidebar-link">俯瞰 Java 服务端开发</a></li><li><a href="/TechShare/docs/java/part_one_of_java_engineer_path.html" class="sidebar-link">Java 工程师能力提升路径（一）：从业余到专业</a></li><li><a href="/TechShare/docs/java/java_study_way.html" class="sidebar-link">Java 学习大法</a></li><li><a href="/TechShare/docs/java/liquibase.html" aria-current="page" class="active sidebar-link">[Java 开发实战] 5 分钟搞定 liquibase 数据库版本控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TechShare/docs/java/liquibase.html#添加依赖" class="sidebar-link">添加依赖</a></li><li class="sidebar-sub-header"><a href="/TechShare/docs/java/liquibase.html#修改-spring-配置" class="sidebar-link">修改 Spring 配置</a></li><li class="sidebar-sub-header"><a href="/TechShare/docs/java/liquibase.html#编写-liquibase-配置代码" class="sidebar-link">编写 Liquibase 配置代码</a></li><li class="sidebar-sub-header"><a href="/TechShare/docs/java/liquibase.html#完结撒花" class="sidebar-link">完结撒花</a></li></ul></li><li><a href="/TechShare/docs/java/unit_test.html" class="sidebar-link">[Java 开发实战] 高级工程师的自我修养之单元测试（一）：DAO 层测试</a></li><li><a href="/TechShare/docs/java/api_error_handling.html" class="sidebar-link">[Java 开发实战] 你还在统一返回 ApiResultBean 吗？✋ duck 不必，快来看 API 错误处理的最佳实践 ✔️</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>软件工程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TechShare/docs/engineering/devops.html" class="sidebar-link">万字长文带你彻底搞懂什么是 DevOps</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TechShare/docs/js/lit_layui.html" class="sidebar-link">使用 lit 编写 Web Components 简化 Layui 代码</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程人生</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TechShare/docs/thinking/编码的道与禅.html" class="sidebar-link">编码的道与禅</a></li><li><a href="/TechShare/docs/thinking/程序员的职业素养.html" class="sidebar-link">程序员的职业素养</a></li><li><a href="/TechShare/docs/thinking/coder_kpi.html" class="sidebar-link">研发质量与效率的绩效指标设计</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程语言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TechShare/docs/lang/使用prolog解决爱因斯坦斑马难题.html" class="sidebar-link">使用prolog解决爱因斯坦斑马难题</a></li><li><a href="/TechShare/docs/lang/一段简单的ruby爬虫代码.html" class="sidebar-link">一段简单的ruby爬虫代码</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>效率</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TechShare/docs/10x/terminal.html" class="sidebar-link">[10 倍程序员系列] ⭐51W+ 的终端命令行工具助你成为 10 倍程序员</a></li><li><a href="/TechShare/docs/tools/我的效率工具箱.html" class="sidebar-link">效率工具箱</a></li><li><a href="/TechShare/docs/tools/n8n.html" class="sidebar-link">使用开源工作流自动化工具 n8n 打造个人助理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="java-开发实战-5-分钟搞定-liquibase-数据库版本控制">[Java 开发实战] 5 分钟搞定 liquibase 数据库版本控制</h1> <p>Java 生态下的数据库版本控制工具有 Flyaway 和 Liquibase，两者具备相似的功能，但基本概念不太一样，本文不对两者进行比较，主要介绍使用 Liquibase 进行数据库版本控制。</p> <p>本文涉及的工具有 maven、mysql。</p> <h2 id="添加依赖">添加依赖</h2> <p>在 pom 文件中引入必要的依赖：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.liquibase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>liquibase-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>由于 spring-boot-starter-jdbc 中含有 spring-boot-starter、spring-boot-autoconfigure 依赖，我们只需要引入这一个依赖即可。</p> <p>spring boot 框架整合了许多第三方库，这其中包括 Liquibase，在 autoconfigure 模块中包含 Liquibase 的可选依赖和 LiquibaseAutoConfiguration 类，下面是这个类上的部分注解代码。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">SpringLiquibase</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DatabaseChange</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>
    prefix <span class="token operator">=</span> <span class="token string">&quot;spring.liquibase&quot;</span><span class="token punctuation">,</span>
    name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;enabled&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">HibernateJpaAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiquibaseAutoConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到该自动配置在 DataSourceAutoConfiguration 配置之后执行，因此必须引用 spring-boot-starter-jdbc 依赖，这是较容易被忽略的一点。</p> <h2 id="修改-spring-配置">修改 Spring 配置</h2> <p>引入以上依赖后 Liquibase 默认就启用了，我们可以在 Spring 配置文件中添加相关的配置，数据库的相关配置请读者朋友根据机器运行环境进行修改。</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.url</span> <span class="token punctuation">=</span> <span class="token attr-value">jdbc:mysql://localhost/db?createDatabaseIfNotExist=true&amp;allowMultiQueries=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span>
<span class="token attr-name">spring.datasource.username</span> <span class="token punctuation">=</span> <span class="token attr-value">root</span>
<span class="token attr-name">spring.datasource.password</span> <span class="token punctuation">=</span> <span class="token attr-value">root</span>
<span class="token attr-name">spring.datasource.driver-class-name</span> <span class="token punctuation">=</span> <span class="token attr-value">com.mysql.cj.jdbc.Driver</span>

<span class="token attr-name">spring.liquibase.change-log</span> <span class="token punctuation">=</span> <span class="token attr-value">classpath:liquibase/master.xml</span>
<span class="token attr-name">spring.liquibase.contexts</span> <span class="token punctuation">=</span> <span class="token attr-value">dev</span>
</code></pre></div><p>注意：datasource 的 url 中包含 <strong>createDatabaseIfNotExist=true</strong> 配置，这将使数据库在不存在时自动创建。</p> <p>在配置中只简单指定了 change-log 和 contexts 两个属性，更多的属性可查看 <strong>LiquibaseProperties</strong> 类，其中包含部分属性的默认值，若使用默认值，以上两个属性都不需要配置，默认的 changeLog 地址为：classpath:/db/changelog/db.changelog-master.yaml 。</p> <h2 id="编写-liquibase-配置代码">编写 Liquibase 配置代码</h2> <p>首先看下文件的组织：</p> <p><img src="data:image/png;base64,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" alt="文件结构"></p> <p>这是官方推荐的方式，使用发布版本号来组织数据库变更记录。</p> <hr> <p>master.xml 中的代码：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseChangeLog</span>
        <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.liquibase.org/xml/ns/dbchangelog<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>liquibase/changelog/db.changelog-1.0.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databaseChangeLog</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>有更新时新增 include 标签和对应的文件即可。</p> <hr> <p>db.changelog-1.0.xml 中的代码：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseChangeLog</span>
        <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.liquibase.org/xml/ns/dbchangelog<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>changeSet</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>create_type_dict<span class="token punctuation">&quot;</span></span> <span class="token attr-name">author</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lcomplete<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlFile</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>liquibase/changelog/1.0/create_type_dict.sql<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>changeSet</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databaseChangeLog</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一个变更对应一个 changeSet，在这里意味着一个变更对应一个 sql，若在一个 sql 中编写多个变更，不利于回滚，可能导致数据库进入未预期的状态。</p> <p>changeSet 中包含 author 和 id 两个必写的属性，这两个属性组成了变更的唯一标志，注意 id 并不是用来控制执行顺序的。</p> <p>changeSet 还包含一些属性，比如 Contexts ，可以控制 changeSet 是否需要在当前环境（上文演示了在 Spring 配置中如何设置）中执行，使用这个属性可以在测试环境增加一些需要额外执行的变更，比如填充数据。 更多属性可以查看：https://docs.liquibase.com/concepts/basic/changeset.html。</p> <hr> <p>create_type_dict.sql 中的代码：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> type_dict
<span class="token punctuation">(</span>
    id          <span class="token keyword">int</span> <span class="token keyword">auto_increment</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    category    <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'分类'</span><span class="token punctuation">,</span>
    type_key    <span class="token keyword">int</span>          <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'类型key'</span><span class="token punctuation">,</span>
    type_value  <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'类型值'</span><span class="token punctuation">,</span>
    is_enable   <span class="token keyword">bit</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'是否启用'</span><span class="token punctuation">,</span>
    create_time <span class="token keyword">datetime</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'创建时间'</span>
<span class="token punctuation">)</span> <span class="token keyword">collate</span> <span class="token operator">=</span> utf8mb4_general_ci<span class="token punctuation">;</span>
</code></pre></div><p>这个 sql 中包含一个示例建表语句，注意：不需要判断表是否存在，若这次变更执行过，Liquibase 会在自动创建的表 databasechangelog（默认表名、可配置） 中记录下来，下次不再执行。</p> <hr> <p>在上面的配置中，使用 sql 来创建数据表，Liquibase 还支持使用 xml、json、yaml 来定义表，在大多数场景下使用 sql 就足够了，因此这里不介绍其他的用法。</p> <h2 id="完结撒花">完结撒花</h2> <p>编写完成以上的配置代码，添加 Spring Boot 应用程序启动类运行程序即可自动更新数据库。</p> <p>是不是很简单？当然在实际的项目过程中，还需要考虑 Liquibase 配置在流水线中如何运行，Liquibase 的代码仓库如何组织等问题，这些就留给读者朋友自己思考吧（其实是笔者比较懒，先不写了）。</p> <p>关于 Liquibase 的更多概念可以查看官方文档：<a href="https://docs.liquibase.com/concepts/home.html" target="_blank" rel="noopener noreferrer">https://docs.liquibase.com/concepts/home.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。</p></div> <footer class="page-edit"><!----> <div class="git-hub-star"><span class="prefix"><span style="position:relative;top:4px;right:-4px;"><a href="https://github.com/lcomplete/TechShare" aria-label="Star lcomplete/TechShare on GitHub" data-icon="octicon-star" data-show-count="true">
      Star
    </a></span></span></div> <div class="last-updated"><span class="prefix">总字数:</span> <span class="words">1,121</span> <span class="prefix">字　</span> <span class="prefix">最后更新:</span> <span class="time">7/7/2021, 1:21:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
    ←
    <a href="/TechShare/docs/java/java_study_way.html" class="prev">
      Java 学习大法
    </a></span> <span class="next"><a href="/TechShare/docs/java/unit_test.html">
      [Java 开发实战] 高级工程师的自我修养之单元测试（一）：DAO 层测试
    </a>
    →
  </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/TechShare/assets/js/app.c381cb99.js" defer></script><script src="/TechShare/assets/js/3.07b3c911.js" defer></script><script src="/TechShare/assets/js/4.c8309a57.js" defer></script><script src="/TechShare/assets/js/14.13469d74.js" defer></script><script src="/TechShare/assets/js/13.dd34e8a8.js" defer></script>
  </body>
</html>
