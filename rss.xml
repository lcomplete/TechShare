<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title><![CDATA[lcomplete 的技术分享]]></title>
        <description><![CDATA[🌟 分享效率方法 🪄、优质文章 📑、编程知识 🎹、实用工具 🛠️ 和有趣内容 😄。💌 每周至少发送 1 篇 newsletter。]]></description>
        <link>https://tech.codelc.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Wed, 13 Apr 2022 07:31:48 GMT</lastBuildDate>
        <atom:link href="https://tech.codelc.com/rss.xml" rel="self" type="application/rss+xml"/>
        <copyright><![CDATA[lcomplete 2022]]></copyright>
        <language><![CDATA[zh-CN]]></language>
        <item>
            <title><![CDATA[014 🚮 中国互联网的三个问题]]></title>
            <link>https://tech.codelc.com/docs/letter/014.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/014.html</guid>
            <pubDate>Sat, 09 Apr 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 014 期「野生架构师」周刊，这是由 &nbsp;<a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 Newsletter，本期的主题是「中国互联网的三个问题」，虽然问题很多，但不要悲观，从问题中寻找机会吧。</p> <p><img src="https://tech.codelc.com/assets/img/1649582824711.b8da397d.png" alt="cover"></p> <h2 id="📝-本期话题-中国互联网的三个问题">📝 本期话题：中国互联网的三个问题</h2> <p>前天晚上我在浏览知乎时，发现高赞的 4 个问题中居然有 3 个是关于互联网的，高赞答案很好地总结了目前的现状，也引起了很多人的共鸣。</p> <p>分享一下这三个高赞回答：</p> <p>1、<a href="https://www.zhihu.com/question/49684783/answer/2305132342" target="_blank" rel="noopener noreferrer">中文互联网的产出在渐渐枯萎吗？<span> </span></a></p> <p>答主的观点很鲜明，即简中互联网已经成为垃圾堆。</p> <p>且不谈其他环境因素和各种小原因，值得注意的是原先被奉为 BAT 的大厂都干了些啥。</p> <ol><li>百度，这个我就不说了，相信大家是有目共睹。</li> <li>阿里，在阿里云这么重要的基础设施、未来极具确定性的产业上，居然也带头搞 SEO 污染。</li> <li>腾讯，以微信为首的封闭化，造成信息无法自由地流通。</li></ol> <p>2、<a href="https://www.zhihu.com/question/357243498/answer/2421719617" target="_blank" rel="noopener noreferrer">中国的互联网技术有多牛逼?<span> </span></a></p> <p>自从微信获得极大成功后，一些人的民族自豪感也突然急剧膨胀，经常会听到有人这样说，「你看国外 Facebook 都开始抄袭腾讯了，中国互联网起步晚，到了移动互联网时代我们终于处于世界领先水平了」。</p> <p>加之 TikTok 和移动支付的成功，难怪会有人问出这样的问题，可是高赞回答将题主狠狠打脸。</p> <p>这个回答看的挺过瘾，答主最后也列举了一些「牛逼」的地方，我也想补充一点：</p> <p>牛逼就牛逼在野蛮生长，野蛮生长的背后不知损害了多少的用户体验，在利益面前，丝毫没有所谓的克制。</p> <p>3、<a href="https://www.zhihu.com/question/517051862/answer/2353062328" target="_blank" rel="noopener noreferrer">为什么互联网大厂一边大规模裁员，又一边招聘？<span> </span></a></p> <p>这个问题我最想谈一下企业对人的忽视，你会发现这些裁掉整个部门的大厂，他们根本不会区分优秀和普通的员工，都当作一个群体看待，反正多的是人，这种人员流动也加剧了内卷的情况，程序员面试 XXX 等内容都成为了流量密码，而更大的问题是它成为流量密码已经很多年了。</p> <p>不光是裁员时忽视个体的差异，各种互联网产品也是一样，国内有几个产品的关注功能是能真正发挥作用的？</p> <blockquote><p>B 站裁员文案为“bilibili 毕业日”。同样以“毕业”描述裁员的还有京东。在职称员工，离职即毕业。跟阿里的“向社会输送人才”异曲同工。“毕业”这词被赋予了一层新的含义。这不是美化裁员，而是傲慢。指明你来公司不是上班，而是来学习的。你跟公司之间的关系是你卑我尊，而不是公平的经济补偿换技术劳力。——<a href="https://twitter.com/AsiaFinance/status/1508768691772706818" target="_blank" rel="noopener noreferrer">@亚洲金融<span> </span></a></p></blockquote> <h3 id="在问题中寻找机会">在问题中寻找机会</h3> <p>我之前有考虑做一个中文版的 <a href="https://app.daily.dev/" target="_blank" rel="noopener noreferrer">https://app.daily.dev/<span> </span></a>，仔细思考后，感觉中文互联网的优质内容好像不足以支撑做一个这样的能够盈利的网站，但现在我觉得需要重新思考这个问题了，不一定会做成这种形式，但我想只要朝着<code>改善中文互联网</code>的方向做一个产品应该不难。</p> <blockquote><p>在一个不会练武的村子里，只要你会打两拳，你就是拳术最厉害的人；在一个没有服务意识、忽视产品质量的土地上，只要你用心做服务，用最高的标准去要求自己，你就会成为这块土地上最出色的商家；在一个没有现代管理意识，不懂网络、不懂微博、不懂用户体验、不懂口碑传播的粗犷社会里，你只需要把之前花在 IT 产品上的心思的 10%拿过来用，就可以秒杀一切天朝对手。——<a href="https://meditic.com/degrading-for-success" target="_blank" rel="noopener noreferrer">降级论<span> </span></a></p></blockquote> <h2 id="📜-言论">📜 言论</h2> <blockquote><p>不要和愤世嫉俗者和悲观主义者合作，因为他们会任由坏事发生，以此证明他们的负面看法是正确的。——<a href="https://qishiya.com/?p=1342" target="_blank" rel="noopener noreferrer">Naval 如何靠实力致富<span> </span></a></p></blockquote> <h2 id="📬-读者来信">📬 读者来信</h2> <p>上期周刊发送后，不少读者朋友提供了非常有价值的反馈，有提到 <a href="https://memex.garden/" target="_blank" rel="noopener noreferrer">memex<span> </span></a> 的，有提到 <a href="https://tiddlywiki.com/" target="_blank" rel="noopener noreferrer">TiddlyWiki<span> </span></a> 的，还有一位朋友写了很多，摘取其中一段：</p> <blockquote><p>我曾听说过一句话: "在互联网上只需要 50 条浏览记录就能唯一确定一个人". 虽然这句话真假未知, 但是我觉得确实有几分道理. 于是我忽然就萌生出了一个想法: 我想记录下我浏览网页的 "足迹". 不是只像浏览器历史一样是按时间顺序线性的, 而是类似 Firefox 的树状标签页扩展一样, 各个 URL 之间依打开关系组织成树状. 我觉得记录下这些数据, 可以让我自己了解到我跳转到某个有用信息的路径(通过从某个被我收藏了的叶子节点向上回溯), 或者是我在搜索特点主题时, 看到的有用的信息与无用的信息的比(通过比较一颗 "搜索树" 之间被收藏的叶子节点与不被收藏的叶子节点之比), 又或者通过一些图论的特征来回顾当天我的状态(比如如果那天的森林里树又多又散, 说明我同时在做很多问题; 如果那天的森林里只有几条链状的树, 我就是处在"看链接就点, 从不回头看"的闲逛模式). 可惜到目前为止, 我都还没有开始动手打造这个工具。——<a href="https://github.com/Origami404" target="_blank" rel="noopener noreferrer">Origami404<span> </span></a></p></blockquote> <p>非常感谢大家的阅读和回复，最近比较忙，工具还需一段时间才能做好，可能需要大家多等一段时间了。</p> <p>另外，大家以后回信时可以不用使用「您」，不是很习惯这个叫法，哈哈。</p> <h2 id="😆-周末愉快">😆 周末愉快</h2> <p>由于我的个人原因，导致本周发送两篇周刊，而又是在周末时间，所以本周就不分享资源了，让大家可以好好地过个周末（我也偷个懒）。</p> <p>以后我会尽量定时在周五发送周刊，祝大家周末愉快。</p> <hr> <p>2022-4-10</p> <p>Util next week,</p> <p>lcomplete</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[013 🔭 重新掌控自己的信息]]></title>
            <link>https://tech.codelc.com/docs/letter/013.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/013.html</guid>
            <pubDate>Wed, 06 Apr 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 013 期「野生架构师」周刊，这是由 &nbsp;<a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 Newsletter，本期的主题是「重新掌控自己的信息」，另外分享优质的文章、资源和言论。</p> <p><img src="https://tech.codelc.com/assets/img/1649315867702.f72888ac.png" alt="cover"></p> <p>📬 由于清明假期回老家时忘记带笔记本电源，导致本期周刊延期发送，<code>本周我将发送两篇周刊</code>。</p> <h2 id="📝-本期话题-重新掌控自己的信息">📝 本期话题：重新掌控自己的信息</h2> <p>Take back control of your news feed，这是 Inoreader 的 slogan，在习惯了被算法喂养信息的时代，掌握获取信息的主动权至关重要，这期话题讨论一下如何掌控自己的信息，并对我刚开始做的一款信息产品做一个简介，欢迎读者朋友们参与讨论。</p> <h3 id="tl-dr">TL;DR</h3> <ol><li>掌控信息源只是开始，不管是通过推荐还是订阅获取信息，我们都需要主动更新信息源。</li> <li>做一个会改造发动机的赛车手，作为程序员在善用佳软的同时也要根据需要打造自己的工具。</li> <li>Stay Hungry, Stay Foolish，信息管理是一个不断优化的过程，不能满足于现状。</li> <li>我在做这样一款信息工具：它可以在本地记录我们上网浏览过的信息，包括文章、微博等形式的内容，提供类似 Everything 的快速检索方式，并以良好的信息归类方式进行呈现，辅助我们取回看过的信息。</li></ol> <h3 id="从掌控信息源开始">从掌控信息源开始</h3> <p>张一鸣曾经也是 Google Reader 的早期用户，但他一直不看好其发展，因为他认为 RSS 订阅需要用户有出色的信息管理技能，这对用户端的要求太高，注定是做不大的，他认为更好的方法是根据用户的行为和喜好通过算法来推荐内容，于是有了今日头条。</p> <p>推荐算法比主动订阅信息更容易筑造 <code>信息茧房</code>，但这并不是说主动订阅的方式就更加高人一等，实际上不管用哪种方式，只要主动地去获取新的信息，都能够避免 <code>窄化自己的信息世界</code>。</p> <p>避免推荐算法给我们做茧的一个好方法是 <code>主动搜索信息</code>，以丰富推荐的内容，<code>主动驯化</code> 推荐机器。</p> <p>主动订阅信息则要求我们丰富订阅渠道和订阅对象，订阅渠道有很多，如：RSS、推特、微博、邮件、Telegram、Slack 等等，这些都是订阅方式，掌握这些工具的用法后，剩下的就是找到需要订阅的对象，我们可以：</p> <ol><li>从热门中找，比如 <a href="https://topauthors.xyz/" target="_blank" rel="noopener noreferrer">热门的 Medium 作者<span> </span></a>、<a href="https://topmediumstories.com/" target="_blank" rel="noopener noreferrer">热门的 Medium 文章<span> </span></a>、<a href="https://app.daily.dev/" target="_blank" rel="noopener noreferrer">热门开发文章推荐<span> </span></a>。</li> <li>保持好奇心，顺腾摸瓜，当关注了一个优质博主时，看看他的友链、推荐和引用，往往就能发现更多的优质信息源。</li> <li>订阅高质量周刊，在信息过载的时代，以周的维度浏览精选信息是一个不错的方式。</li></ol> <h3 id="做一个会改造发动机的赛车手">做一个会改造发动机的赛车手</h3> <p>RSS 阅读是我喜欢的信息处理方式，我将网站订阅、推特、Telegram 频道和 newsletter 都聚合在 RSS 阅读器中查看和记录，这已经满足了我的大部分需求，然而即便如此也还是有许多想获得优化的地方，所以我时常想自己做个 RSS 阅读器。</p> <p>在我还没听说过今日头条之前，我也有一个类似的想法，于是花了两个晚上做了一个 <a href="https://github.com/lcomplete/coderinfo" target="_blank" rel="noopener noreferrer">程序猿信息盒子<span> </span></a>，它能自动聚合我常看的网站的信息，本来还计划做文章相似度匹配和关键词提取，这样就能获取到近期的热点文章，但由于种种原因而搁置了。</p> <p>市面上并没有全能的信息处理产品，这种工具也不可能存在，所以不少程序员会自己写工具去优化信息处理，比如：</p> <ul><li>作者给自己用的 Web 应用，搭配 Obsidian 使用，详情：<a href="https://catcoding.me/p/intro-to-obweb/" target="_blank" rel="noopener noreferrer">打造自己的工具<span> </span></a>——程序员的喵。</li> <li>作者为了方便阅读论文，为自己开发的划词翻译工具，使用了 DeepL 的 API，作者也公布了 API 的设计，详情：<a href="https://zu1k.com/posts/thinking/deception-tactics-in-deepl-api-design/" target="_blank" rel="noopener noreferrer">DeepL Api 设计中的欺骗战术<span> </span></a>，值得一读。</li></ul> <p>也有做成产品或开源的：</p> <ul><li>定位为信息处理粘合剂的简悦：<a href="https://simpread.pro/" target="_blank" rel="noopener noreferrer">https://simpread.pro/<span> </span></a>。</li> <li>用中文浏览国外社交媒体里的热门讨论：<a href="https://www.buzzing.cc/" target="_blank" rel="noopener noreferrer">https://www.buzzing.cc/<span> </span></a></li> <li>让 Newsletter 支持 RSS 订阅：<a href="https://kill-the-newsletter.com/" target="_blank" rel="noopener noreferrer">https://kill-the-newsletter.com/<span> </span></a>。</li></ul> <p>🔖 很多优秀的赛车手会自己改造发动机和变速器，软件工程师好比 IT 界的赛车手，必须掌控自己的车子。</p> <h3 id="stay-hungry-stay-foolish">Stay Hungry, Stay Foolish</h3> <p>市面上有优秀的产品和别人造好的轮子，似乎可以满足绝大多数需求，但我们不能因为用上了好工具而止步不前，而是要不断优化对信息的掌控，有很多可以优化的点，比如：</p> <ol><li>前面讲过，要不断去寻找优质信息源、驯化推荐机器，做到这些，我们甚至可以把抖音调教成一种好的学习方式。</li> <li>寻找优质信息源是一个费时的过程，需要不断提升其效率，与优秀的人交流是一个不错的方式。</li> <li>不同信息源的处理方式是不一样的，比如对于特大新闻我们希望第一时间收到消息，而知识类信息不需要实时性但最好有回顾机制，英文信息可能有中英对照的需求。</li> <li>相同信息源的阅读方式是不一样的，有人用 RSS 聚合信息，有人用 Slack 聚合信息，也有人用 Telegram 聚合信息，他们各有优劣。</li> <li>掌控信息是全方位多维度的，有了良好的输入源，还需要强化甄别筛选、深度阅读、笔记摘要、批判式思考等能力。</li> <li>信息输入太多，要避免信息过载，能不能让一些信息处理变得更轻松一些？</li></ol> <h3 id="我在开发的一款工具">我在开发的一款工具</h3> <p>我在做这样一款信息工具：它可以在本地记录我们上网浏览过的信息，包括文章、推特、微博等形式的内容，提供类似 Everything 的快速检索方式，并以良好的信息归类方式进行呈现，辅助我们取回看过的信息。这是最核心的功能，取回看过的信息后可能还会增加二次处理的功能，比如 <code>Save To</code> 这类。</p> <p>💡 这款工具的理念是这样的——你只管看，我帮你记，需要的时候快速调取出来，扩充第二大脑。</p> <p>我们使用网络的时间越来越长，有这样一款工具相当于间接提升了阅读的能力，让我们在信息处理、写作和交流上都能获得更大的优势。</p> <p>如果你对这款工具感兴趣的话，欢迎回复邮件与我沟通，可以谈谈你对这款工具的看法、期望的功能或者你觉得较合理的定价。</p> <p>🌈 这款工具我会做成免费使用+高级功能付费使用的方式，<code>本月回复周刊或联系我参与讨论的朋友，在工具做好后我将免费赠送一份。</code></p> <h2 id="📖-文章">📖 文章</h2> <p>1、<a href="https://wanqu.co/b/7/%E6%B9%BE%E5%8C%BA%E6%97%A5%E6%8A%A5%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E4%BD%9C%E7%9A%84/" target="_blank" rel="noopener noreferrer">湾区日报是如何运作的？<span> </span></a></p> <p>虽然湾区日报停运了，但这种分享的精神不会停止，很多人包括我，都在做着类似的事情，在资源部分我会推荐一些类似湾区日报的频道。</p> <p>2、<a href="https://xiaohanyu.me/posts/2017-02-13-about-education" target="_blank" rel="noopener noreferrer">教育对人的改变有多大？<span> </span></a></p> <p>作者的弟弟原本是一个差生，但不知道为何突然醒悟了，而后开始好好学习并考上了香港理工大学。</p> <p>作者对弟弟转变的契机并没有确切答案，不过我倒觉得转变其实并非一蹴而就的，一定是曾在心底埋下了学习的种子，才会「突然醒悟」。</p> <p>3、<a href="http://blog.jiayuanzhang.com/post/how-to-be-a-learning-machine/" target="_blank" rel="noopener noreferrer">如何成为一个学习机器<span> </span></a></p> <p>Jiayuan 的博文，这篇文章讲的是作者从《巨人的工具》这本书中所「偷取的巨人的智慧」，值得学习。</p> <p>4、<a href="https://hutusi.com/articles/notes-of-titans" target="_blank" rel="noopener noreferrer">巨人的笔记<span> </span></a></p> <p>来自「胡涂说」的博文，记录《巨人的工具》和《巨人的方法》的读书笔记，作者目前保持更新，值得关注。</p> <p>5、<a href="https://danlebrero.com/2022/03/23/but-life-had-other-plans/" target="_blank" rel="noopener noreferrer">But life had other plans ...<span> </span></a></p> <p>生活就像一盒巧克力，你永远不知道下一块是什么味道。</p> <p>6、<a href="https://jobsapp.info/basecamp/" target="_blank" rel="noopener noreferrer">Meet your new Email Marketing Manager<span> </span></a></p> <p>这是一封定向的求职信，作者直接告诉 Basecamp 为什么选择自己是对的，如果有心仪的目标公司，不妨试试这样求职。</p> <p>7、⭐ <a href="https://limboy.me/posts/idiom/" target="_blank" rel="noopener noreferrer">拼音猜成语<span> </span></a></p> <p>拼音猜成语是一个受 Wordle 启发的一个中文成语小游戏，高峰期 PV 达到上百万，游戏挺好玩，作者还将代码开源了 <a href="https://github.com/limboy/idiom" target="_blank" rel="noopener noreferrer">https://github.com/limboy/idiom<span> </span></a>。</p> <h2 id="🗂-资源">🗂 资源</h2> <p>1、<a href="https://t.me/fakeye" target="_blank" rel="noopener noreferrer">不求甚解 | Telegram 频道<span> </span></a></p> <p>推荐各种产品，有点像 Product Hunt 的推特，但是介绍的更详细，内容也更贴近国人。</p> <p>2、<a href="https://t.me/FindBlog" target="_blank" rel="noopener noreferrer">Find Blog👁 发现博客 | Telegram 频道<span> </span></a></p> <p>一个收录优秀博客的地方。</p> <p>3、<a href="https://t.me/buzzingcc" target="_blank" rel="noopener noreferrer">Buzzing | Telegram 频道<span> </span></a></p> <p>用中文浏览国外社交媒体里的热门讨论。</p> <p>4、<a href="https://t.me/codedump_notes" target="_blank" rel="noopener noreferrer">codedump 的电报频道 | Telegram 频道<span> </span></a></p> <p>一个老程序员发布个人博客、想法、推荐的地方，刚刚发现他也推荐了 <a href="https://xiaohanyu.me/posts/2017-02-13-about-education/" target="_blank" rel="noopener noreferrer">教育对人的改变有多大？<span> </span></a>。</p> <p><img src="https://tech.codelc.com/assets/img/1649311407738.1a5e6459.png" alt="codedump"></p> <p>5、<a href="https://t.me/r231470" target="_blank" rel="noopener noreferrer">电报开拓地 🌠 | Telegram 频道<span> </span></a></p> <p>此频道为网友推荐：博客、前沿、信息源、互联网相关优质内容。</p> <p>6、<a href="https://t.me/gotoshare" target="_blank" rel="noopener noreferrer">程序员资源分享频道 | Telegram 频道<span> </span></a></p> <p>左耳朵耗子创建的程序员资源分享频道，相信不用过多介绍。</p> <p>7、⭐ <a href="https://twitter.com/i/lists/1499242372076830720" target="_blank" rel="noopener noreferrer">国内开发者 | 推特列表<span> </span></a></p> <p>我在 Vue 作者尤雨溪的一条推特上分享了这个列表，<a href="https://twitter.com/lcomplete_wild/status/1509506553325391878" target="_blank" rel="noopener noreferrer">这条推文回复<span> </span></a> 为我带来大概 100 多个推特关注，这个列表更是获得超过 700 多个人的关注。</p> <p>这个列表中的成员不会放很多，挑选的是开发方面分享较多的推特用户。</p> <p><img src="https://tech.codelc.com/assets/img/1649312639942.d801d768.png" alt="developer list"></p> <h2 id="📜-言论">📜 言论</h2> <blockquote><p>灵活的人让自己适应世界，不灵活的人坚持让世界适应自己。结果，一切进步都来自不灵活的人。——— 萧伯纳</p> <p>阅读自：<a href="https://blog.esonwong.com/weekly-2022-03-14/" target="_blank" rel="noopener noreferrer">Eson Wong's Blog<span> </span></a></p></blockquote> <blockquote><p>Motivation comes and goes. If you want to do something consistently, then don't pick a level of difficulty that requires great motivation.</p> <p>Make it easy enough and simple enough that you'll do it even when you don't feel very motivated.</p> <p>——<a href="https://jamesclear.com/3-2-1/march-24-2022" target="_blank" rel="noopener noreferrer">3-2-1: Motivation, criticism, and the goal of adulthood<span> </span></a></p></blockquote> <hr> <p>2022-4-7</p> <p>lcomplete</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[012 📸 Old But Good 、UNIX 艺术、互联网历史博物馆]]></title>
            <link>https://tech.codelc.com/docs/letter/012.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/012.html</guid>
            <pubDate>Fri, 25 Mar 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 012 期「野生架构师」周刊，这是由 &nbsp;<a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 Newsletter，本期的主题是「Old But Good」，同时也带大家一同回味 UNIX 的经典艺术。</p> <p><img src="https://tech.codelc.com/assets/img/linux.f504e378.jpeg" alt="cover"></p> <h2 id="📝-本期话题-old-but-good">📝 本期话题：Old But Good</h2> <p><img src="https://tech.codelc.com/assets/img/elon_obg.5793a648.jpeg" alt="tweet by elon musk"></p> <p>本期话题由 Elon Musk 贡献 🤣，我特别喜欢这条推文，第一当下我们确实是生活在层层监控之下，第二电影《指环王》的这段剧情确实很感人，我当时看的时候也有些热泪盈眶，这段剧情的台词也非常励志，一起来感受一下。</p> <blockquote><p>山姆：这就像精彩的故事和伟大的事迹总是充满了黑暗和危险。</p> <p>有时候你不想知道结局，因为哪里会有快乐结局？发生这么多可怕的事，这世界怎么回到从前？</p> <p>但是可怕的黑暗和阴影终将消失，崭新的一天将会来临，太阳也会散发更明亮的光芒。</p> <p>这才是让人永生难忘、意义非凡的故事，纵使你太年轻不明白为什么，但是我想我明白了，我现在明白了。</p> <p>这些故事里的主角，有很多机会半途而废，但是他们并没有，他们决定勇往直前。</p> <p>因为他们抱着一种信念，什么样的信念？</p> <p>那就是——这世上一定存在着善良，值得我们奋战到底。</p></blockquote> <p>回想这段台词时，又想到了当今世界之现状，令我感触更深，但愿疫情和战争早日过去。</p> <p>不管是电影还是技术，总是在推陈出新，Newsletter 也总是分享最新的时事、文章或工具，经典内容似乎有被遗忘的趋势，于是本期周刊着重分享那些历经时间考验的经典书籍和文章等内容。</p> <h2 id="🎼-unix-艺术">🎼 UNIX 艺术</h2> <h3 id="🎶《unix-编程艺术》">🎶《UNIX 编程艺术》</h3> <p>这本书的作者是 Eric S. Raymond，简称 ESR，他有一句名言，「<code>足够多的眼睛，就可让所有问题浮现</code>」。他是 <a href="https://m.douban.com/book/subject/25881855/" target="_blank" rel="noopener noreferrer">《大教堂与集市》<span> </span></a>、<a href="https://translations.readthedocs.io/en/latest/hacker_howto.html" target="_blank" rel="noopener noreferrer">《如何成为一名黑客》<span> </span></a>的作者，也是早期的开源运动领导者之一。</p> <p>这本书着重讲解了 UNIX 的哲学、历史和设计，作为技术书籍中的瑰宝，其中的内容可谓是字字珠玑。</p> <p>UNIX 哲学是这样的：<code>一个程序只做一件事，并做好</code>。从整体上，可以概括为以下几点：</p> <ol><li>模块原则：使用简洁的接口拼接简单的部件（封装性、紧凑性、<a href="https://xie.infoq.cn/article/aa02e2aae865239b69312622e" target="_blank" rel="noopener noreferrer">正交性<span> </span></a>、<a href="https://en.wikipedia.org/wiki/Single_source_of_truth" target="_blank" rel="noopener noreferrer">真理的单点性 / SPOT 原则<span> </span></a>）。</li> <li>清晰原则：清晰胜于机巧。</li> <li>组合原则：设计时考虑拼接和组合。</li> <li>分离原则：策略同机制分离，接口同引擎分离。</li> <li>简洁原则：设计要简洁，复杂度越低越好。</li> <li>吝啬原则：除非没有办法，不要编写庞大的程序。</li> <li>透明性原则：设计要可见，以便审查和调试。</li> <li>健壮原则：健壮源于<code>透明</code>和<code>简洁</code>。</li> <li>表示原则：将数据与逻辑分离，使逻辑质朴和健壮（单元测试很依赖这一点）。</li> <li>通俗原则：避免标新立异（惯例优先）。</li> <li>缄默原则：如果程序没什么好说的，就沉默（不要分散用户的注意力，只显示最有用的信息）。</li> <li>补救原则：出现异常时，要给出足够的错误信息。</li> <li>经济原则：宁花机器一分，不花程序员一秒。</li> <li>生成原则：避免重复编码，尽量编写程序去生成程序。</li> <li>优化原则：先求运行，再求正确，最后求快。</li> <li>多样原则：多语言、开放的可扩展系统和用户定制机制。</li> <li>扩展原则：设计着眼于未来。</li></ol> <p>🎵 Unix 哲学浓缩为一条铁律，那就是 K.I.S.S 原则——Keep It Simple，Stupid！</p> <p>作为 Coder，其中很多原则我们都已经烂熟于心，有一些可能还没有领会的特别深刻，那就需要我们常读常新，比如：</p> <p>1、在生成原则上，只要我们不断思考，发现项目中重复的地方并消灭之，必然能使我们的生产力得到极大的解放。</p> <p>在前后端开发协作上，最多的工作之一就是接口联调，那我们可以运用 <code>生成原则</code> 来优化工作流程，使用 <a href="https://github.com/OpenAPITools/openapi-generator" target="_blank" rel="noopener noreferrer">OpenAPI Generator<span> </span></a> 或是其他工具来生成代码，有必要时编写自己的代码生成器。</p> <p>当下的低代码热潮，本质上也是将生成原则发挥到极致——数据即代码。</p> <p>2、在模块原则上，UNIX 上的许多微型语言体现了紧凑性，如：正则表达式、awk、Emacs Lisp 等，<code>更具表达力的语言意味着程序更短，bug 更少</code>，awk 极大地方便了文本处理；许多 LeetCode 问题，如果采用正则表达式能够极大地简化解法，甚至可以 <a href="https://coolshell.cn/articles/2704.html" target="_blank" rel="noopener noreferrer">用正则表达式来检查素数<span> </span></a> 。</p> <p>这本书还引用了不少 <a href="https://book.douban.com/subject/35006892/" target="_blank" rel="noopener noreferrer">《程序员修炼之道》<span> </span></a> 中的内容，后者是该书内容极好的补充，由 <a href="https://blog.codingnow.com/" target="_blank" rel="noopener noreferrer">云风<span> </span></a> 于 2020 年才翻译了第二版，距离第一版已过 15 年，足见这本书的历久弥新，同时第二版的翻译也优秀许多。</p> <p>相关文章：</p> <ul><li><a href="http://www.ruanyifeng.com/blog/2008/02/notes_on_the_cathedral_and_the_bazaar.html" target="_blank" rel="noopener noreferrer">《大教堂和集市》笔记 ｜ 阮一峰的网络日志<span> </span></a></li> <li><a href="https://coolshell.cn/articles/10337.html" target="_blank" rel="noopener noreferrer">数据即代码：元驱动编程 ｜ 酷壳<span> </span></a></li></ul> <h3 id="📹-推荐记录片">📹 推荐记录片</h3> <p>1、<a href="https://www.bilibili.com/video/BV1rx411E7oW" target="_blank" rel="noopener noreferrer">代码奔腾 Code Rush (2000)<span> </span></a></p> <p>这部纪录片讲的是网景公司在与微软的竞争中失败，最终将代码开源的故事。</p> <p>虽然网景失败了，但本片的片尾词，至今仍然适用，仍然可以激励着互联网上的程序员们。</p> <blockquote><p>互联网也仍然继续发展着，进入到每个人日常生活的各个角落，而程序员军团和他们的代码也并肩前行，奔腾着，直到深夜。</p></blockquote> <p>We Are Coders，今生无悔写代码。</p> <p>2、<a href="https://www.bilibili.com/video/BV1us411z7X4" target="_blank" rel="noopener noreferrer">代码 The Code (2001)<span> </span></a></p> <p>Linus、ESR 和 RMS 等对自由软件和开源运动有着卓越贡献的人「主演」的影片，也可以说是 Linux 的纪录片。</p> <p>3、<a href="https://www.bilibili.com/video/BV1iC4y187nT" target="_blank" rel="noopener noreferrer">操作系统革命 Revolution OS (2001)<span> </span></a></p> <p>「主演」仍然是 Linus、ESR 和 RMS 等人，1999 年 Red Hat 在纳斯达克上市，Linux 那几年风头无两，这些领袖人物一年拍两部纪录片也就不奇怪了 🤣，这部影片中 ESR 的「戏份」比较多，还担任了开场大使。</p> <p>《The Code》讲述的更多是 Linux 的历史，而这部影片则侧重讲建立 Linux 操作系统的斗士们是如何奋起反抗垄断的，正如本片片头，ESR 对轻蔑他的微软员工说到「I'm your nightmare」一样。</p> <h2 id="🗃-互联网历史博物馆">🗃 互联网历史博物馆</h2> <p><a href="https://web.archive.org/" target="_blank" rel="noopener noreferrer">https://web.archive.org/<span> </span></a> 是一个保存互联网档案的网站，于 1996 年创办，目前已经保存了 6690 亿个页面，它的目标是将互联网的历史档案给记录下来，在这里可以找到已经关闭的网站的历史存档，像我多年前上线过的网站也能够找到。</p> <p>这是一个非营利性组织，主要依靠创始人 <a href="https://zh.wikipedia.org/wiki/%E5%B8%83%E9%AD%AF%E6%96%AF%E7%89%B9%C2%B7%E5%8D%A1%E5%88%A9" target="_blank" rel="noopener noreferrer">布鲁斯特·卡利<span> </span></a> 雄厚的财力支撑。</p> <p>当我们打不开网站时，可以到这个<code>网站时光机</code>查找存档，它提供了一个插件 <a href="https://chrome.google.com/webstore/detail/wayback-machine/fpnmgdkabkmnadcjpehmlllkndpkmiak?utm_source=chrome-ntp-icon" target="_blank" rel="noopener noreferrer">Wayback Machine<span> </span></a>，可以存档网站或者从打不开的页面快速跳转到「时光机」。</p> <h2 id="🤣-轻松一刻">🤣 轻松一刻</h2> <blockquote><p><a href="https://coolshell.cn/articles/1941.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%A8%8B%E5%BA%8F%E5%91%98%E5%96%9C%E6%AC%A2UNIX" target="_blank" rel="noopener noreferrer">为什么程序员喜欢 UNIX?<span> </span></a></p> <p>unzip, strip, touch, finger, grep, mount, fsck, more, yes, fsck, fsck, fsck, umount, sleep</p></blockquote> <hr> <p>Util next week,</p> <p>lcomplete</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[011 🖼 Browser = OS 、文章、工具、资源、文摘、言论]]></title>
            <link>https://tech.codelc.com/docs/letter/011.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/011.html</guid>
            <pubDate>Sat, 19 Mar 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 011 期「野生架构师」周刊，这是由 &nbsp;<a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 Newsletter，本期的主题是「Browser = OS」，另外分享优质的文章、工具、资源、文摘和言论。</p> <p><img src="https://tech.codelc.com/assets/img/mighty.be95807b.jpg" alt="mighty"></p> <h2 id="💡-关于本期周刊">💡 关于本期周刊</h2> <p>在我前十期的周刊中，整体风格主要是围绕不多于 3 个话题将我想表达的给说出来，这满足了我自己的表达欲，如果能引起一些读者朋友的共鸣或产生帮助，那自然也是非常好的，但这似乎是次要的，这种周刊写法并不能很好地完成分享高质量信息的初衷。</p> <p>在我自己阅读 Newsletter 的过程中，话题性的文章除非写的特别优秀，否则很难对我产生实质性的帮助，而 <code>高级大杂烩</code> 形式的 Newsletter 往往令我收获更大，这里面最优秀的要属 <a href="https://www.ruanyifeng.com/blog/weekly/" target="_blank" rel="noopener noreferrer">阮一峰的科技周刊<span> </span></a> ，基本上每一期都能在其中发现优质有趣的信息，所以本期周刊也采用阮一峰科技周刊的形式，以表敬意。</p> <p>注：我在 <a href="/docs/letter/009.html">009 🌈 Newsletter Of Newsletters、海绵宝宝的智慧</a> 这期提到 <code>高级大杂烩</code> 形式的 Newsletter。</p> <h2 id="📝-本期话题-browser-os">📝 本期话题：Browser = OS</h2> <p>连续几期在周刊前面使用英文开头，这其实并非刻意为之，这一期我先尝试使用中文来写主题，但写出来都较冗长，所以干脆使用英文，更能简洁地表达话题含义。</p> <h3 id="浏览器跟操作系统并无本质区别">浏览器跟操作系统并无本质区别</h3> <p>浏览器跟操作系统是否有本质上的区别，这是一个有争议的话题，在 v2ex 上也曾经有一个热门的帖子讨论过，有些人说浏览器在操作系统面前只是个弟弟，怎么能和操作系统相提并论呢？诚然，如果严格从技术上去区分，这两者必然不是同一类东西，但是从使用的角度，他们有本质上的区别吗？实际上是没有的，<code>Browser 和 OS 上都能够承载 App</code>，都有其生态，OS 上的 App 比 Browser 上的 App 权限大一些、能调用的 API 多一些而已。</p> <h3 id="浏览器倒逼操作系统进化">浏览器倒逼操作系统进化</h3> <p>微软的前总裁鲍尔默在 10 多年前也表达过浏览器和操作系统并无实质差别的观点，这些年 <code>Chrome OS</code> 在国外大行其道，越来越多优秀的 Web App 涌现：Figma、Notion 等等，这些足以表明浏览器的地位越来越高，直逼操作系统。我想这也是承诺 Win10 会是最后一个版本的微软又推出 Win11 的一大原因，不光是 Win11，据说 Win12 也在开发中，<code>随着网络越来越发达，浏览器越来越强大，操作系统也需要进化</code>。</p> <p>操作系统的进化对于科技工作者来说是喜闻乐见的，所以我曾第一时间安装了 Win11，但结果令我还是略微失望，除了界面更加美观、系统设置更加统一外，带来的更多的是一系列问题，尤其是一些常用软件：飞书频繁卡顿、Logseq 卡顿，虽然这些不能全赖 Win11，但使用体验确实大打折扣，希望这些问题能够尽快得到解决，正式版能够尽快推出。</p> <h3 id="浏览器越强大-不同操作系统的差别越小">浏览器越强大，不同操作系统的差别越小</h3> <p>经过这么长时间 Win11 的使用，让我越发觉得 <code>Mac OS</code> 的优秀，不仅界面美观、操作统一，最重要的是乔老爷子提倡的<code>软硬件结合</code>做的非常优秀，我的 Macbook Pro 为 18 年的老款，内存只有 8G、CPU 也仅为 i5，但却很少发生卡顿，虽然大多数时候是轻度使用，开发时基本只开一个 IDE，不像在办公使用 PC 时经常需要打开许多 IDE，但它很好地满足了这些场景下的需求，如果升级到 M1 Max，那绝对是令人心动的体验。</p> <p>程序员应该使用 Mac OS、Windows 还是 Linux，这在 v2ex 上几乎是一个月经话题，我曾经也做过一个长回复，可惜找不到了，我的回答简单说就是：<code>都用</code>。只有都使用过，我们才能明白其中的设计内涵，<code>在使用过程中，我们会潜移默化地提升自己使用软件和设计软件的能力</code>。</p> <p>我是重度的 Windows 用户 + 偏重度的 Mac 用户 + 轻度的 Linux（桌面端）用户 + Chrome OS 用户，因为使用过这么多系统，所以我能够非常流畅地在各个操作系统之间切换，这除了软件使用能力的提升外，另一个非常重要的点就是，其中的核心软件 <code>浏览器，并没有改变</code>。</p> <p>因为 <code>浏览器的功能越来越强大，不同的操作系统能够更好地无缝切换</code>，所以现在已经不像多年前，需要在 Win、Mac 和 Linux 中做出选择，在条件允许的情况下，我觉得对于程序员来说，这些系统都应该去使用。那么操作系统上层的 <code>Browser OS</code> 更是重中之重，值得我们花时间去深入学习，以便将它充分利用。</p> <h3 id="web-app-和插件共同组成了浏览器上的软件生态">Web App 和插件共同组成了浏览器上的软件生态</h3> <p>如何用好浏览器，最重要的一点就是 <code>扩展浏览器的能力</code>，这就需要用到 <code>插件</code> 了，Vimium、沙拉查词、AdBlock 等等插件能够大幅提升我们的效率，由于都是在浏览器的环境中，这些插件不仅起到相互协同的作用，同时它们的能力又能附加到无数的 Web App 中，未来插件市场会越来越丰富，和 Web App 一同构建起 Browser OS 中的软件生态。</p> <h3 id="浏览器领域的创新">浏览器领域的创新</h3> <p>既然 <code>Browser</code> 的地位这么高，在浏览器领域有没有一些创新呢？接下来分享一些这方面的创新项目：</p> <p>1、<a href="https://vivaldi.com/" target="_blank" rel="noopener noreferrer">Vivaldi Browser<span> </span></a></p> <p>由前 Opera CEO 创办的 Vivaldi 浏览器，它将许多常用的插件（AdBlock、摘要笔记等）直接集成到了浏览器中，使其开箱即用，另外还有一些增强功能：标签分组、在侧边栏中可以将网页进行固定等。将网站 <code>pin</code> 起来的理念是：将这些网页当作 App，使其能够快速访问。<a href="https://menubarx.app/" target="_blank" rel="noopener noreferrer">MenubarX<span> </span></a> 这个 Mac 上的软件实际上也是应用了这个理念。</p> <p>2、<a href="https://www.browserless.io/" target="_blank" rel="noopener noreferrer">Browserless<span> </span></a></p> <p>模拟浏览器运行一般会用到 Selenium、Playwright 或 Puppeteer，使用这些技术都存在着环境不一致的问题，因此最好将它们放在 docker 中运行。Browserless 是一个云服务，它允许客户端连接并控制服务端 docker 中运行的无界面浏览器，也可以利用它在公司内部搭建一套这样的服务，统一自动化执行环境。</p> <p>3、<a href="https://www.mightyapp.com/" target="_blank" rel="noopener noreferrer">Mighty<span> </span></a></p> <p>你有没有抱怨过 Chrome 运行变慢，内存占用过多？Mighty 的出现就是为了解决这个问题，它使用串流技术，让你能够使用云端超强电脑中的浏览器。我们对云游戏的概念并不陌生，因为运行游戏需要较高的计算资源，而云上网有没有潜力呢？虽然许多人并不看好这个项目，但如果未来网络带宽足够便宜、云资源像水电一样计费真能实现的话，云上网未尝不可，即使云上网的模式失败，相信串流技术在未来一定会有越来越多的运用。</p> <h2 id="📖-文章">📖 文章</h2> <p>1、<a href="/docs/10x/terminal.html">⭐51W+ 的终端命令行工具助你成为 10 倍程序员</a></p> <p>英文版：<a href="https://enlear.academy/10-command-line-tools-every-developer-should-know-7f9b5e9ee07" target="_blank" rel="noopener noreferrer">10 Command Line Tools Every Developer Should Know<span> </span></a></p> <p>这是我去年花了一点点时间写的文章，交给 <code>bytefish</code> 翻译到 Medium 上，截止到目前，1 个月的时间，获得了 $150 的收益。</p> <p>2、<a href="https://catcoding.me/p/weekly-1/" target="_blank" rel="noopener noreferrer">你可以创造运气<span> </span></a></p> <p><code>程序员的喵</code> 写的第一篇周刊型文章，我在 Newsletter 中已经多次提到过他，以往写作我觉得不应该重复，不过现在我觉得也不要紧，高质量的信息就是应该重复出现。</p> <p><img src="https://tech.codelc.com/assets/img/luck.d11fdac1.png" alt="luck"></p> <p>最近也越来越体会到写作可以创造 <code>Luck Surface Area</code>，by the way，我创建了一个 Telegram 频道 <a href="https://t.me/luckinfohunter" target="_blank" rel="noopener noreferrer">Luck Info Hunter<span> </span></a>。</p> <p>3、<a href="https://github.com/nusr/hacker-laws-zh" target="_blank" rel="noopener noreferrer">黑客原则<span> </span></a></p> <p>hacker-laws-zh，💻📖 对开发人员有用的定律、理论、原则和模式，<a href="https://github.com/dwmkerr/hacker-laws" target="_blank" rel="noopener noreferrer">hacker-laws<span> </span></a> 的中文翻译。</p> <p>4、<a href="https://jakobgreenfeld.com/time-to-win" target="_blank" rel="noopener noreferrer">It's time to win<span> </span></a></p> <p>互联网、社交平台、社交状态、粉丝数、影响力、发言、表达，这不是一场在线游戏吗？</p> <p>It's time to win <a href="https://www.notboring.co/p/the-great-online-game" target="_blank" rel="noopener noreferrer">The Great Online Game<span> </span></a>.</p> <p>5、<a href="http://swombat.com/2012/5/11/salesman-developer" target="_blank" rel="noopener noreferrer">The salesman and the developer<span> </span></a></p> <p>一篇老文，讲销售员和程序员的故事，销售员和程序员一块去捕熊，销售员把熊引到屋子，对程序员说交给你了，说完后得意洋洋地又去找熊了。</p> <p>6、<a href="https://medium.com/frontend-canteen/why-%EF%B8%8F-returns-%EF%B8%8F-in-javascript-7b890e3a13b2" target="_blank" rel="noopener noreferrer">Why […‘👩‍❤️‍💋‍👨’] returns [‘👩’, ‘‍’, ‘❤’, ‘️’, ‘‍’, ‘💋’, ‘‍’, ‘👨’] in JavaScript?<span> </span></a></p> <p>帮我翻译文章的 <code>bytefish</code> 写的，很有意思的 emoji 科普。</p> <p>7、<a href="https://medium.com/personal-growth/the-most-important-skill-nobody-taught-you-9b162377ab77" target="_blank" rel="noopener noreferrer">The Most Important Skill Nobody Taught You<span> </span></a></p> <p>Medium 上最热门的一篇文章，讲的是 <code>独处的艺术</code>。</p> <h2 id="🛠-工具">🛠 工具</h2> <p>1、<a href="https://k8syaml.com/" target="_blank" rel="noopener noreferrer">Kubernetes YAML Generator<span> </span></a></p> <p>在线生成 k8s yaml 文件。</p> <p>2、<a href="https://chrome.google.com/webstore/detail/markdownload-markdown-web/pcmpcfapbekmbjjkdalcgopdkipoggdi" target="_blank" rel="noopener noreferrer">MarkDownload<span> </span></a></p> <p>将网页拷贝为 markdown 格式。</p> <p>3、<a href="https://chrome.google.com/webstore/detail/smart-toc-%E6%99%BA%E8%83%BD%E7%BD%91%E9%A1%B5%E5%A4%A7%E7%BA%B2/ppdjhggfcaenclmimmdigbcglfoklgaf" target="_blank" rel="noopener noreferrer">Smart TOC / 智能网页大纲<span> </span></a></p> <p>鄙人二次开发的浏览器插件，智能生成网页大纲，支持 Inoreader 和 Feedly。</p> <p>4、<a href="https://emojiai.com/" target="_blank" rel="noopener noreferrer">EmojiAI 😃<span> </span></a></p> <p>输入文字，自动帮你挑选 emoji ，挑不到合适的就来 <a href="https://www.emojiall.com/zh-hans" target="_blank" rel="noopener noreferrer">EMOJIALL 😊<span> </span></a> 找吧。</p> <p>5、<a href="https://poet.so/" target="_blank" rel="noopener noreferrer">Poet.so<span> </span></a></p> <p><img src="https://tech.codelc.com/assets/img/tweet.022603c4.png" alt="tweet"></p> <p>将推文转换成好看的图片。</p> <p>6、<a href="https://ray.so/" target="_blank" rel="noopener noreferrer">Ray.so<span> </span></a></p> <p>将代码转换为好看的图片，Raycast 团队出品。</p> <p>7、<a href="https://scoop.sh" target="_blank" rel="noopener noreferrer">Scoop<span> </span></a></p> <p>Windows 下的命令行安装器。</p> <p>8、<a href="https://ohmystarapp.com/" target="_blank" rel="noopener noreferrer">OhMyStar<span> </span></a></p> <p>Mac 下组织 Github Stars 的工具，类似的工具还有 <a href="https://github.com/zenghongtu/Remu" target="_blank" rel="noopener noreferrer">Remu<span> </span></a>、<a href="https://app.astralapp.com/" target="_blank" rel="noopener noreferrer">Astral<span> </span></a>。</p> <p>9、<a href="https://fig.io/" target="_blank" rel="noopener noreferrer">Fig<span> </span></a></p> <p>在终端添加 IDE 风格的智能提示，目前仅在 Mac OS 下可用，另外该团队还上线了 <a href="https://www.shell.how/" target="_blank" rel="noopener noreferrer">shell.how<span> </span></a>，这是一个解释 shell 命令如何工作的网站。</p> <h2 id="🗂-资源">🗂 资源</h2> <p>1、<a href="https://whattotweet.com/" target="_blank" rel="noopener noreferrer">What To Tweet?<span> </span></a></p> <p>从这里可以发现写推文的灵感。</p> <p>2、<a href="https://opensource.builders/" target="_blank" rel="noopener noreferrer">Open-source alternatives<span> </span></a></p> <p>在这里找到热门 App 的开源替代品，比如：</p> <ul><li>1Password：<a href="https://github.com/bitwarden/server" target="_blank" rel="noopener noreferrer">https://github.com/bitwarden/server<span> </span></a></li> <li>Zapier：<a href="https://github.com/actionsflow/actionsflow" target="_blank" rel="noopener noreferrer">https://github.com/actionsflow/actionsflow<span> </span></a></li> <li>Airtable：<a href="https://github.com/nocodb/nocodb" target="_blank" rel="noopener noreferrer">https://github.com/nocodb/nocodb<span> </span></a></li> <li>Notion：<a href="https://github.com/AppFlowy-IO/AppFlowy" target="_blank" rel="noopener noreferrer">https://github.com/AppFlowy-IO/AppFlowy<span> </span></a></li> <li>Firebase：<a href="https://github.com/supabase/supabase" target="_blank" rel="noopener noreferrer">https://github.com/supabase/supabase<span> </span></a></li></ul> <p>3、<a href="https://unsplash.com/" target="_blank" rel="noopener noreferrer">Unsplash<span> </span></a></p> <p>提供免费可供使用的图片。</p> <p>4、<a href="https://github.com/agarrharr/awesome-cli-apps" target="_blank" rel="noopener noreferrer">awesome-cli-apps<span> </span></a></p> <p>一个关于命令行 app 的收藏列表。</p> <p>5、<a href="https://www.podletter.club/" target="_blank" rel="noopener noreferrer">PodLetter<span> </span></a></p> <p>Podcast 和 Newsletter 导航网站。</p> <p>6、<a href="https://github.com/ljinkai/weekly" target="_blank" rel="noopener noreferrer">独立开发变现周刊<span> </span></a></p> <p>分享独立开发、产品变现相关内容，每周五发布。</p> <h2 id="📋-文摘">📋 文摘</h2> <p>1、<a href="https://medium.com/personal-growth/the-most-important-skill-nobody-taught-you-9b162377ab77" target="_blank" rel="noopener noreferrer">The Most Important Skill Nobody Taught You<span> </span></a></p> <p>人类的所有问题都源于人类无法独自安静地坐在房间里。——Pascal</p> <p>问题的根源在于我们从未学会独处的艺术。</p> <p>在互联网时代，这个问题已经被放大了。</p> <p>你越不喜欢独处，就越有可能不了解自己。</p> <p>我们对孤独的厌恶实际上是对无聊的厌恶，从不面对这种虚无就是从不面对自己。</p> <p>正确的做法是面对它。</p> <p>不要害怕独处，它提供了认识自己的绝佳机会。</p> <p>腾出时间，无论是每天还是每周，只是静坐一会儿，思考一下我们的想法，我们的感受，它能为我们带来鼓舞和激励。</p> <p>「了解你自己」是世界上最古老的哲学智慧，独处不能解决所有问题，但它是一个好的开始。</p> <p>2、<a href="https://www.infoq.cn/article/bPgOisT3rrmTjLAjCcf2" target="_blank" rel="noopener noreferrer">架构师应该接受低代码的 5 个理由<span> </span></a></p> <ol><li>减少技术债务</li> <li>更好的新员工体验</li> <li>简化工作流程和数据集成</li> <li>自动化更多业务流程</li> <li>加速数字化转型</li></ol> <h2 id="📜-言论">📜 言论</h2> <blockquote><p>前不久，来自美国的一项医学研究表明了这一点：视神经细胞只要受到蓝光 8 分钟刺激，就会让身体持续兴奋超过 1 小时。而且调查还发现，比起其它应用来说，刷抖音后入睡所需要的时间最久，因为刷抖音会更加刺激肾上腺素和多巴胺的释放，给人「快乐」的感觉，所以睡眠会不断延后。——<a href="http://www.geekpark.net/news/299373" target="_blank" rel="noopener noreferrer">极客简报<span> </span></a></p></blockquote> <blockquote><p>The key is not to discard The Box of Daily Experience and find a new one — it’s to warmly embrace the one that we have now — with its joys, its flaws, and everything in between. ——<a href="https://moretothat.com/travel-is-no-cure-for-the-mind/" target="_blank" rel="noopener noreferrer">Travel Is No Cure for the Mind<span> </span></a></p></blockquote> <hr> <p>Util next week,</p> <p>lcomplete</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[010 🚀 Hacking The Mind / 拆掉思维里的墙、放飞想象、打破规则]]></title>
            <link>https://tech.codelc.com/docs/letter/010.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/010.html</guid>
            <pubDate>Fri, 11 Mar 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 010 期「野生架构师」周刊，这是由 &nbsp;<a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 newsletter，本期的主题是 Hacking The Mind ，不光要拆掉思维里的墙，还要放飞想象、打破规则。</p> <p><img src="https://tech.codelc.com/assets/img/hackingthemind.bc28d28a.jpeg" alt="hackingthemind"></p> <h2 id="🎓-hacking-the-mind-拆掉思维里的墙">🎓 Hacking The Mind / 拆掉思维里的墙</h2> <p>上一期我推荐了 GeekPlux 的 Newsletter，他在 <a href="https://geekplux.com/newsletters/5" target="_blank" rel="noopener noreferrer">如何成为某一领域的世界顶尖<span> </span></a> 中提到广度比深度更加重要，我简单概括其中的两个论点：</p> <ol><li>扩展深度会到达边际效应收窄的阶段；</li> <li>扩展广度更难，在当今社会，组合运用多种知识更有优势。</li></ol> <p>第一个论点我在多年前的一次公开演讲上说过几乎一样的话，曾经自学计算机科学想往科研方向发展，到最后放弃走这条路，我对 <code>边际递减效应</code> 深有感触，放弃科研目标后，我则尝试扩展自己的广度，因此在阅读这篇文章时，首先我产生了强烈的共鸣，基本上我是认同这两个观点的，那一瞬间我也有些沾沾自喜——多年前就有了这个感悟，然后我便开始反思自己的喜悦情绪，还好，我也知道另外一个道理——当年纪越大，在学习时，我们很容易吸收并加强与自身相似的观点，而排斥不一样的看法。</p> <p>于是我带着辩证的思维去看这个观点，广度是否比深度更重要，我认为是难以定论的，它们各自的重要性对于科学家和商人来说是不一样的。带着这样的方式去思考，我们可以提取其中有用的知识，而不会使自己的思维越加固化，学习是为了让我们的思维得到延展，而不是筑起高高的围墙。</p> <p>举两个开发人员在技术领域给思维筑墙的例子：</p> <ul><li>偏爱某种编程语言，工作中需要用到其他语言时十分排斥，甚至认为这会影响个人的职业发展。</li> <li>认为软件测试是测试人员的工作，对测试相关的技术栈一无所知。</li></ul> <blockquote><p>别自己墙了自己，人最可悲的就是自己限制自己。</p> <p>开放，让自己有更多的可能性，能到更高的层次，做更有价值的事，成为更强更好的人……当然，如果你觉得你只想做一个平凡人，也和本文并不冲突……另外你也不要觉得这篇文章是让你要成为一个精英，但你一定要去摸高……这篇文章是告诉你一种面对人生的思考方式，在这种思考方式下，你会有更多的可能性，更大的场景……而不是直接把自己归到“平常人”，把自己“墙”了！</p> <p>—— 左耳朵耗子：<a href="https://coolshell.cn/articles/20276.html" target="_blank" rel="noopener noreferrer">别让自己“墙”了自己<span> </span></a></p></blockquote> <h2 id="💥-hacking-the-mind-放飞想象">💥 Hacking The Mind / 放飞想象</h2> <p>拆掉思维里的墙以后我们来放飞下想象，看看技术领域一些新奇好玩、令人意想不到的技术。</p> <h3 id="menubarx">MenubarX</h3> <p><img src="https://tech.codelc.com/assets/img/menubarx.ee17cb75.jpeg" alt="MenubarX"></p> <p><a href="https://menubarx.app/" target="_blank" rel="noopener noreferrer">MenubarX<span> </span></a> 是一个强大的 Mac 菜单栏浏览器，可以把网站添加到菜单上，像 App 一样即开即用。</p> <h3 id="在-css-中连接数据库">在 CSS 中连接数据库</h3> <p>原文：<a href="https://www.leemeichin.com/posts/yes-i-can-connect-to-a-db-in-css.html" target="_blank" rel="noopener noreferrer">Yes, I can connect to a DB in CSS<span> </span></a></p> <p>原文较长，简单介绍一下是如何实现的：</p> <ol><li>利用 <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Houdini" target="_blank" rel="noopener noreferrer">CSS Houdini<span> </span></a> API 中的 <code>CSS Paint Worklet</code> 特性，它允许 CSS 在元素上进行绘制。</li> <li>利用 <a href="https://github.com/sql-js/sql.js" target="_blank" rel="noopener noreferrer">sql.js<span> </span></a> ，它是浏览器上的 <code>SQLite</code> 。</li> <li>使用 Houdini API 自定义 CSS 属性 <code>--sql-query</code> ，根据属性查询 SQLite 数据库并进行绘制。</li></ol> <h3 id="中文推友自拍转推机器人">中文推友自拍转推机器人</h3> <p><a href="https://github.com/atkio/selfiebot" target="_blank" rel="noopener noreferrer">https://github.com/atkio/selfiebot<span> </span></a> ，这是一个用 C# 写的 <a href="https://twitter.com/ratkio" target="_blank" rel="noopener noreferrer">中文推友自拍转推机器人<span> </span></a> 。</p> <h3 id="react-头盔-react-helmet">React 头盔（react-helmet）</h3> <p><img src="https://tech.codelc.com/assets/img/react-helmet.b78126fb.jpeg" alt="React-helmet"></p> <p><a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener noreferrer">react-helmet<span> </span></a> 是一个为 React 设计的 HTML head 管理器，使用起来是 <code>dead simple（真特么的简单）</code> 。</p> <h2 id="🚀-hacking-the-mind-打破规则">🚀 Hacking The Mind / 打破规则</h2> <p>黑客是计算机革命的英雄，让我们来复习一下黑客伦理：</p> <ol><li>对计算机的访问（以及可能帮助你认识我们这个世界的事物）应该是不受限制的、完全的，任何人都有动手尝试的权利。</li> <li>所有的信息应该可以自由获取。</li> <li>不迷信权威。</li> <li>评判黑客的标准应该是他们的技术，而不是那些没有实际用途的指标，比如学位、年龄、种族或职位。</li> <li>你可以在计算机上创造出美与智慧。</li> <li>计算机可以让你的生活更美好。</li></ol> <p>《黑客与画家》出版至今已经 18 年，18 年前 Paul Graham 写到：<code>人类社会还没有充分理解程序员对社会的影响以及程序员带来的美和智慧</code> ，我想现如今已经发生了许多变化，程序员群体越来越庞大，人们也习惯了计算机世界，现今社会在疫情的阴霾下，能够让我们远程工作的计算机让许多人的生活还能维持下去。</p> <p>无数的人在计算机上创造美妙的产品，施展他们的智慧，黑客与骇客的区别逐渐被大众认识，黑客的精神正在更广泛地被传播。</p> <p><code>ANYTHING IS HACKABLE</code> ，一个会打破规则的人一定不会是一个思维僵化的人，向黑客精神致敬。</p> <hr> <p>Util next week,</p> <p>lcomplete</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[009 🌈 Newsletter Of Newsletters、海绵宝宝的智慧]]></title>
            <link>https://tech.codelc.com/docs/letter/009.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/009.html</guid>
            <pubDate>Fri, 04 Mar 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 009 期「野生架构师」周刊，这是由 &nbsp;<a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 newsletter，本周聊聊 Newsletter 和反常识思维。</p> <p><img src="https://tech.codelc.com/assets/img/hmbb.243e6e49.jpeg" alt="SpongeBob"></p> <h2 id="newsletter-of-newsletters">Newsletter Of Newsletters</h2> <p>其实上周就想写一个关于 Newsletter 的主题，因为开始写 Newsletter 自然会关注这个领域的一些内容，也会想表达一些关于它的想法。上周放弃写的原因则是在想写这个是不是没多大「含金量」，而这周我又有了一些新的看法。</p> <p>工欲善其事，必先利其器，当我们在准备做一件事的时候，最好先把工具准备好，但是要小心不要掉进「玩工具」的陷阱中，工具是层出不穷的，一定会有越来越好用的工具出现，当我们用上新的工具的时候往往会有一种错觉——感觉自己的能力飞跃了。</p> <p>这样的例子有很多：</p> <ul><li>学习编程：痴迷于 IDE、插件、收集各类的工具类库。</li> <li>学习知识管理：痴迷于研究各种工具，从 Evernote、OneNote、语雀、Flomo、WorkFlowy、Notion、Roam Research、Obsidian、Logseq 研究到 Notepad。</li> <li>学习写作：Typora、iA writer、Ulysses 等等研究个遍。</li></ul> <p>学习这些工具是有益的，但不要一直停留在这个阶段，要清楚地认识到这是一个 <code>学徒阶段</code> ，更不要有工具优越感。</p> <p>🔖 <strong>不要停留在学徒阶段，但是要永远保持一个学徒的心态。</strong></p> <p>对于写 Newsletter 来说，我就是一个学徒，第一要勇于承认这一点，第二跟我一样的学徒还有很多，而我关于 Newsletter 的一些想法可能对他们是有帮助的，就像许多优秀的编程入门文章也是正在学习编程的人所写的一样。</p> <p><code>Newsletter Of Newsletters</code> 这个词我借鉴了 <code>Fund Of Funds</code>（投资基金的基金），对于刚接触投资的人来说，FOF 会是一个不错的选择，对于刚接触 Newsletter 的人来说，我想这样的一份「NON」也是一个不错的入门指引。</p> <h3 id="写-newsletter-不像看起来那么简单">写 Newsletter 不像看起来那么简单</h3> <p>许多刚接触 Newsletter 这种形式的读者，往往会有个疑问——为什么每篇文章都没有主题。Newsletter 可以翻译为新闻简报，它并不是关于某一主题的具体文章，而是包含多个主题及简要介绍的聚合类信息。有人将它比作 <code>大杂烩</code> ，而优秀的 Newsletter 应该是高级大杂烩，我愿称之为 <code>佛跳墙</code> 😎。</p> <p>Newsletter 具体的形式可以有很多种，大多是包含多个主题并对每个主题进行简单介绍，初次接触的人可能会认为写这个很简单嘛，尤其是对于需要接触大量信息的媒体和 IT 工作者来说，好像人人都能写好似的，我见过最离谱的一个 Newsletter 是 revue 上的，作者只在里面放几个链接，由 revue 负责渲染出链接的摘要，我想说这不是 Newsletter ，这只是一个网址收藏夹。</p> <p>写 Newsletter 并不像看起来那么简单，当我只有零星几个读者的时候，我写的很随心所欲，当我的订阅者达到 50 个的时候，我就开始认真考虑自己写的是否会辜负这份订阅和期待，当我看到更多的 Newsletter 的时候，我在想我写的内容是否太少了，读者能在这里发现好东西吗？希望能够令读者朋友跟我一起进步、一起发现好的事物，每周分享的信息量不能太少，但也不能太多，即要发散，又要收敛，作为学徒，我也还在摸索当中。</p> <h3 id="newsletter-的价值">Newsletter 的价值</h3> <p>Newsletter 并非是新鲜事物，但我感觉它正在变的越来越流行，我前不久才加入这场游戏，也感觉到越来越多的人开始进入，在信息井喷的情况下，每周接收一份由「靠谱人士」精选过的「高级大杂烩」确实能解决信息噪音过高的问题。</p> <p>Newsletter 越流行，那么它的商业价值也是显而易见的，但是关于这一点我没有过多思考，因为我主要是基于 「Learn In Public」的出发点来写作的，付费订阅制从来不是我会去考虑的事情，我也不订阅任何需要付费的 Newsletter ，原因很简单，当需要付费才能查看的时候，信息是无法自由地传播的，我宁愿看到帮助大的文章时打赏下作者。Newsletter 中插广告比起付费订阅，我更支持前者，付费订阅制更适合小圈子。</p> <p>🧩 简而言之：Newsletter 促进 <strong>高质量</strong> 信息的 <strong>高效</strong> 传播，写的好也能赚钱，写的不好对自己也是种锻炼。</p> <h2 id="海绵宝宝的智慧">海绵宝宝的智慧</h2> <blockquote><p>我准备好了。</p></blockquote> <p>🧽 这是海绵宝宝的口头禅。</p> <p>这个部分，我想聊聊反常识思维。</p> <p>万事开头难，这是许多人用来安慰他人或自己的话，安慰有时候是一种鼓励，有时候也是一种毒药，它可能让你觉得目前的处境是理所应当的，尼采说过：对一个人最好的安慰就是不要安慰。</p> <p>刚开始工作一定会很困难吗？刚开始创业一定会很难吗？这是不一定的，不要觉得万事开头难而心安理得，正确的做法是不断地寻找方法，还有就是像海绵宝宝一样，时刻都准备好了。</p> <blockquote><p>Connecting the dots.</p></blockquote> <p>乔布斯在斯坦福的著名演讲上讲过这句话，即串联生活的点滴，过去的经历能否帮助现在的你处于一种准备好了的状态呢？</p> <h2 id="本期主题的相关优质资源">本期主题的相关优质资源</h2> <p>特别推荐的 Newsletter ：</p> <ul><li><a href="https://geekplux.zhubai.love/" target="_blank" rel="noopener noreferrer">Geek Plux Lab<span> </span></a></li> <li><a href="https://catcoding.me/" target="_blank" rel="noopener noreferrer">程序员的喵<span> </span></a></li></ul> <p>反常识思维：</p> <ul><li><a href="https://meditic.com/degrading-for-success" target="_blank" rel="noopener noreferrer">降级论<span> </span></a></li></ul> <h2 id="one-more-thing">One More Thing</h2> <blockquote><p>Talk is cheap, show me the code.</p></blockquote> <p>这是 Linus 的名言，这里的 code 我想换成 <code>product</code> ，作为开发者，我们毕竟不是作家，所以不光要 <code>talk</code> ，更要有自己的 <code>product</code> ，<code>talk</code> + <code>product</code> 也许等于 <code>freedom</code> 。</p> <p>🌈 本周做了一个小工具：<a href="https://github.com/lcomplete/smart-toc" target="_blank" rel="noopener noreferrer">smart-toc<span> </span></a></p> <p><img src="https://tech.codelc.com/assets/img/twitter.a4557dc8.png" alt="smart-toc tweet"></p> <hr> <p>Util next week,</p> <p>lcomplete</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[008 📚 Notion vs Obsidian、程序设计 vs 软件工程]]></title>
            <link>https://tech.codelc.com/docs/letter/008.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/008.html</guid>
            <pubDate>Fri, 25 Feb 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 008 期「野生架构师」周刊，这是由 &nbsp;<a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 newsletter，本周的主题是相似工具和事物间的对比，通过搞清楚差异可以让我们更好地运用它们。</p> <p><img src="https://tech.codelc.com/assets/img/cover.cd982c56.jpeg" alt="cover"></p> <h2 id="notion-vs-obsidian">Notion vs Obsidian</h2> <p>以防有不了解 Notion 的读者朋友，我们先看看其 wiki 介绍：</p> <blockquote><p>Notion 是一款提供笔记、任务、数据库、看板、维基、日历和提醒等组件的应用程序。用户可以将这些 <strong>组件连接起来，来创建自己的系统</strong> ，用于知识管理、笔记记录、数据管理、项目管理等。这些组件和系统可以单独使用，也可以与他人进行 <strong>跨平台协作</strong>。</p></blockquote> <p>Notion 很强大，是一个 All In One 的笔记工具，除了 wiki 里提到的功能，用它还可以玩出很多花样，比如：</p> <ul><li>搭建内容管理系统：<a href="https://www.appsmith.com/blog/using-the-notion-api-to-build-a-content-management-system" target="_blank" rel="noopener noreferrer">Using the Notion API to Build a Content Management System<span> </span></a> ；</li> <li>用 Notion 谈恋爱：<a href="https://sspai.com/post/65098" target="_blank" rel="noopener noreferrer">七夕特供 | 如何用 Notion 谈恋爱<span> </span></a> ；</li> <li>用 Notion 组织推文：<a href="https://www.queue.so/" target="_blank" rel="noopener noreferrer">Twitter Scheduling Tool for Notion<span> </span></a> 。</li></ul> <p>为什么 Notion 这么强大，本质上在于它给我们提供了一个易用的 <code>数据库</code> ，数据库可以用表格、看板、列表、日历、画廊和时间线的方式来组织或展示。当我们在 Notion 中新建内容时，首先要考虑它的组织方式，如果你有很好的内容组织能力，就越能将其使用的得心应手，甚至制作模板进行售卖，或者分享使用心得，比如这位作者则分享了他是如何使用 Notion 来学习编程的：<a href="https://blog.damiandemasi.com/using-notion-to-organise-programming-topics" target="_blank" rel="noopener noreferrer">Using Notion to organise programming topics<span> </span></a> 。</p> <p>在 Notion 中记笔记的路径是 <code>从数据库到文档</code> ，而 Obsidian 在记笔记的路径上则与其相反，使用它我们不需要先考虑数据结构，而是直接记录笔记，然后再通过笔记的元数据来得到数据库，这就形成了 <code>从文档到数据库</code> 。二者都具备文档和数据库的闭环，但他们的使用思想却截然不同，这就是为什么我要拿 Notion 和 Obsidian 进行比较，通过这一点我们可以很清楚地看出两者的优劣，更能搞清楚哪种情况下用哪种工具。</p> <h3 id="obsidian-卡片盒笔记法">Obsidian + 卡片盒笔记法</h3> <p>Obsidian 是借鉴卡片盒笔记法进行设计的，而卡片盒笔记有三个重要特点：</p> <ul><li>原子化：每条笔记包含且只包含一条知识，每个笔记都具有一个唯一标志，在 Obsidian 中这个标志是文件名。</li> <li>个性化：每个笔记尽管可能包含收集、整理、标注、概括阶段的内容，但也一定要用自己的语言去描述这个知识点，只有经过自己的描述，才真正融入自己的思想。</li> <li>连接性：笔记之间通过唯一标志可以互相连接，从而形成个人的思想之网。</li></ul> <p>思想之网局部图（示例）：</p> <p><img src="https://tech.codelc.com/assets/img/web_detail.596c63bc.png" alt=""></p> <p>更详细的介绍可以查看：<a href="https://zettelkasten.de/introduction/zh/" target="_blank" rel="noopener noreferrer">卢曼卡片盒笔记法介绍 (Introduction to the Zettelkasten Method)<span> </span></a></p> <p>如果上面的概念一时难以吸收的话，可以将卡片盒笔记类比成 <code>个人的维基百科</code> ，它们之间有许多相似之处，只不过卡片盒中的每个百科主题都是更小的知识点，用好卡片盒笔记法就是在脑子里装进一个自己的维基百科，现在你明白为什么 Obsidian 的口号是帮你构建第二大脑了吗？</p> <p>借助 Dataview 插件，可以从数据视图来查阅笔记，<strong>把整个笔记本当作一个数据库来使用</strong> ，可根据需求来定制数据，比如写这篇 newsletter 时我可以查询笔记数据库中最近一周创建的笔记来决定写哪些内容。</p> <p><img src="https://tech.codelc.com/assets/img/dataview.632a2a87.png" alt="dataview"></p> <p>Dataview 使用类似 SQL 的 DSL 语法，对于非程序员来说上手会稍难，感兴趣的可以查看：<a href="https://medium.com/pm%E7%9A%84%E7%94%9F%E7%94%A2%E5%8A%9B%E5%B7%A5%E5%85%B7%E7%AE%B1/obsidian-%E4%BD%BF%E7%94%A8%E6%95%99%E5%AD%B8-%E6%8F%92%E4%BB%B6%E7%AF%87-02-%E5%A6%82%E4%BD%95%E5%9C%A8-obsidian-%E4%B8%AD%E8%87%AA%E5%8B%95-%E5%BD%99%E6%95%B4%E7%AD%86%E8%A8%98-8d90b5e44f6a" target="_blank" rel="noopener noreferrer">如何在 Obsidian 中自動彙整筆記？使用 Dataview 查詢與呈現符合條件的筆記<span> </span></a> 。</p> <p>Notion 和 Obsidian 都是现在非常受欢迎的笔记系统，值得我们去学习，当然学习后更重要的是持续使用它们。</p> <h2 id="程序设计-vs-软件工程">程序设计 vs 软件工程</h2> <p><a href="https://blog.vgod.tw/" target="_blank" rel="noopener noreferrer">vgod<span> </span></a> 是台湾人，在 MIT 读的计算机专业，自从他读完博士以后就很少写博客了，即便如此，我还是经常分享他写过的 <code>「追求神乎其技的程式設計之道」</code> 系列文章，这系列文章启发了很多台湾的软件工程师，因为网络的关系也被我发现了，其中的许多观点我都非常喜欢。</p> <p>比如：</p> <blockquote><p>很多人都聽說過，同樣是寫程式，一個頂尖程式設計師和一個普通程式設計師之間的生產力可以有 <strong>十倍甚至百倍的差距</strong> 。這是其他行業很少見到的現象，於是不禁令人納悶，為什麼會這樣呢？</p> <p>...</p> <p>我後來發現，程式設計師和其他行業有個很大的不同點：一般行業只能在現有的工具上磨練自身的技術，但 <code>程式設計師除了磨練技術外，還可以獨自創造、修改自己使用的工具；換句話說，程式設計師的能力就是在電腦上創作出更好的軟體，不但能便利他人，也同時能增進自身使用電腦的工作效率</code> 。舉例來說，理髮師能磨練使用剪刀和設計髮型的技術，但理髮師並不知道怎麼發明及製造新的剪刀讓自己更有效率的剪頭髮；電機、化工、土木工程師要設計 IC、化學製程、建築結構，但他們得依賴電腦軟體才能設計，並且靠許多大型機器和工具才能生產，即使想提昇自身的工作效率，也不是自己一個人想做就能辦到的。但軟體工程師就不同了，我們只靠一台電腦就能工作，我們的工具是軟體，我們的產出也是軟體，我們的所依賴的一切都是軟體，只要自己願意投入心力，隨時可以修改每天使用的工具和系統讓自己更有效率的工作。
這一點可以說是程式設計師的先天優勢，也是頂尖的程式設計師和普通程式設計師的生產力差距的關鍵。</p></blockquote> <p>再比如：</p> <blockquote><p><strong>Eat Our Own Dog Food</strong></p> <p>我發現厲害的程式設計師常有種共同特質：寫工具給自己用，解決自己日常工作碰到的問題或改善自己的工作效率。英文有句話叫 eat one’s own dog food，字面上意思是說一家公司應該要吃自己做出來的狗食，實際上是引申為一家公司應該要在內部用自己的產品解決自身的問題，才能發現真正的問題，並且說服人這東西真的很實用。Google 是奉行「吃狗食」原則的典型公司，Google 內部有一個獨立的搜尋引擎搜尋公司內部網路的資料，新技術也都能在上面先行測試；Google 內有獨立的 gmail、google docs，都在對外公開前先讓內部的人實際用上好一陣子；Google 甚至做了自己的 Linux distribution 給工程師用、自己的 compiler、自己的瀏覽器…。</p> <p>...</p> <p>出於「懶惰」的美德，頂尖的程式設計師工作時想的不只有產出最終產品就好，而是如何花最少力氣最少時間把產品做到最好。但這件事說來容易做來難，能不能實行往往跟程式設計師工作的系統環境有很大關係。</p></blockquote> <p>最近，我发现 vgod 又开始写博客了，这次他写的是 <code>「軟體工程師的修煉與成長」</code> 系列 ，我想必须分享给你。</p> <ul><li><a href="https://vgod.medium.com/%E8%BF%BD%E6%B1%82%E7%A5%9E%E4%B9%8E%E5%85%B6%E6%8A%80%E7%9A%84%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88%E4%B9%8B%E9%81%93-2022%E9%87%8D%E7%B7%A8%E7%89%88-7cccc3c68f1e" target="_blank" rel="noopener noreferrer">追求神乎其技的程式設計之道 — 2022 重編版<span> </span></a></li> <li><a href="https://vgod.medium.com/%E8%BB%9F%E9%AB%94%E5%B7%A5%E7%A8%8B%E5%B8%AB%E7%9A%84%E4%BF%AE%E7%85%89%E8%88%87%E6%88%90%E9%95%B7-1-7b906f837d74" target="_blank" rel="noopener noreferrer">軟體工程師的修煉與成長 (1)<span> </span></a></li></ul> <p>我是从台湾媒体 <a href="https://blog.starrocket.io/star-rocket-newsletter/" target="_blank" rel="noopener noreferrer">Star Rocket 的 newsletter<span> </span></a> 中得知 vgod 开始在 medium 上写作的，所以也分享给你。</p> <p>程序设计和软件工程最大的不同，我想是在于协作方面，在程序设计上我们可以有自己孜孜不倦的追求，而在开发商业化软件的时候我们又需要在各方面进行妥协，软件开发便是这样一门平衡的艺术。</p> <p>希望阅读我的 newsletter 的朋友可以在 vgod 那里汲取到更多的养分。</p> <p>Until next week,</p> <p>lcomplete</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[007 🍀 十年后重新使用 RSS 给我带来的巨变]]></title>
            <link>https://tech.codelc.com/docs/letter/007.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/007.html</guid>
            <pubDate>Wed, 16 Feb 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 007 期「野生架构师」周刊，这是由 &nbsp;<a href="https://github.com/lcomplete/TechShare" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 newsletter，它分享简短实用的效率方法、优质文章、编程知识、实用工具等，感谢你的阅读！</p> <p><img src="https://tech.codelc.com/assets/img/hunter.d434edc3.jpeg" alt="hunter"></p> <p>去年底，脑海里一直有个念头——重拾以前的优秀习惯，于是时隔十年再次打开 Feedly 这个 RSS 阅读器来寻找值得关注的信息源。</p> <p>在这个过程中，有两件事对我影响较大：</p> <ul><li>开始写 newsletter 。</li> <li>发现现阶段对我来说许多优质的信息都是英文的。</li></ul> <h2 id="开始写-newsletter">开始写 newsletter</h2> <p>去年底，我在写年终总结时，定了个计划，要持续给公司的工程师们分享优质的讯息，而之前这些分享都是零散和不成系统的，看到 happy xiao 的博客和 newsletter 后，我便决定也开始写 newsletter，这样不仅可以系统地分享，也可以跟更多的人建立联系。</p> <p>写 newsletter 必然需要大量的阅读，于是近期我阅读了许多优秀的文章，这些海量的信息竟然奇妙地产生了联系。</p> <h2 id="重新学习英语所产生的奇妙体验">重新学习英语所产生的奇妙体验</h2> <p>日常工作中，我的英语已经够用，但要阅读海量的英文文章，这显然就不够用了，于是我决定重新学习英语。</p> <p>为了更好地阅读英文文章，我注册了 medium 平台，看到 bytefish 写的 <a href="https://medium.com/%E5%86%99%E4%BD%9C%E4%B9%8B%E8%B7%AF/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A6%82%E4%BD%95%E5%9C%A8medium-com%E4%B8%8A%E9%80%9A%E8%BF%87%E5%86%99%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2%E8%B5%9A%E9%92%B1-6d47d82b03dd" target="_blank" rel="noopener noreferrer">程序员如何通过在 Medium.com 上写技术博客赚钱？<span> </span></a>，接着我又看到阮一峰在 <a href="http://www.ruanyifeng.com/blog/2022/02/weekly-issue-194.html" target="_blank" rel="noopener noreferrer">194 期<span> </span></a> 周刊也推荐了这篇文章，即使我不主动注册 medium，也很有可能因为看了阮一峰的科技周刊而去使用它。</p> <p><strong>因为这些信息是我主动捕食，而不是别人喂养的。</strong></p> <p>最近一周我逛 v2ex 的时间不超过 10 分钟，但却偶然在一个讨论公众号的帖子里发现了 <a href="https://catcoding.me/" target="_blank" rel="noopener noreferrer">程序员的喵<span> </span></a> 的博客，这位微软的工程师写了许多优秀的文章，而且竟然也写到了程序员英语的重要性和在 medium 上写文章赚钱的事情，于是我订阅了他的博客。</p> <p>就在昨天，我在 Feedly 上查看 Hacker News 的热点，看到 Jakob 博士的热文 <a href="https://jakobgreenfeld.com/stay-in-touch" target="_blank" rel="noopener noreferrer">The simple system I’m using to stay in touch with hundreds of people<span> </span></a>，文章对我启发很大，于是我立即行动写了第 <a href="/docs/letter/006.html">#006</a> 篇 newsletter，写完后我在 twitter 关注了 Jakob，并跟他有了下面的互动。</p> <p><img src="https://tech.codelc.com/assets/img/jakob.a39bd845.png" alt="jakob"></p> <p>接着奇妙的事情发生了，晚上我去洗澡的时候打开了播客（依旧是重拾丢失已久的习惯），随手点开 happy xiao 的 <a href="https://happyxiao.com/yrgs036/" target="_blank" rel="noopener noreferrer">036 Nathan Latka 的彪悍人生，以及我们可以学到的 6 件事<span> </span></a> 这期播客，他讲的竟然是 Jakob 写的一篇文章 <a href="https://jakobgreenfeld.com/latka" target="_blank" rel="noopener noreferrer">6 Lessons I Learned from Nathan Latka<span> </span></a> 。</p> <p>今天早上我看到 Jakob 的一条推文：</p> <p><a href="https://twitter.com/jakobgreenfeld/status/1493978581361254402" target="_blank" rel="noopener noreferrer">Jakob Greenfeld on Twitter<span> </span></a></p> <blockquote><p>“An important part of my strategy this year is to increase my luck surface area.</p> <p>Ideas I’m testing:</p> <p>• More podcast appearances, projects, and threads to a larger number of people aware of my existence.</p> <p>• Regular tweets and podcasts to make sure my name stays top of mind.”</p></blockquote> <p>这篇推文讲的是他今年的战略是要持续扩大<code>运气表面积</code>。</p> <p>接着奇妙的事情又发生了，晚上我通过 RSS 阅读到前面提到的<code>程序员的喵</code>写的第一篇 newsletter <a href="https://catcoding.me/p/weekly-1/" target="_blank" rel="noopener noreferrer">你可以创造运气<span> </span></a>，他引用了 <a href="https://www.swyx.io/create-luck/" target="_blank" rel="noopener noreferrer">How To Create Luck<span> </span></a> 这篇文章，文中提到了 <code>Luck Surface Area</code>，这曾经是一篇热门文章，Jakob 是否也看到过它呢？</p> <p>还有许多新奇的发现，就不一一讲了，这些信息对我来说，串联的如此奇妙，对于旁观者来看也许有点像是流水账，但如果阅读这封 newsletter 的你一个个点开文章里的链接去看，我相信你也能有所收获。</p> <h2 id="good-luck">Good Luck</h2> <p>做个信息猎手，扩大运气表面积。</p> <p>Be a information hunter, increase luck surface area.</p> <p>Good luck, bye bye.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[006 📒 与人保持联系的系统、用低代码应用设计产品原型、万能锤]]></title>
            <link>https://tech.codelc.com/docs/letter/006.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/006.html</guid>
            <pubDate>Tue, 15 Feb 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 006 期「野生架构师」周刊，这是由 &nbsp;<a href="https://github.com/lcomplete/TechShare" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 newsletter，它分享简短实用的效率方法、优质文章、编程知识、实用工具等，感谢你的阅读！</p> <h2 id="与人保持联系的系统">与人保持联系的系统</h2> <p>很多时候我们都在用各种效率工具去管理知识，但是有多少人想过管理联系人并和他们保持联系呢？</p> <p><a href="https://jakobgreenfeld.com/stay-in-touch" target="_blank" rel="noopener noreferrer">The simple system I’m using to stay in touch with hundreds of people<span> </span></a></p> <blockquote><p>Staying in touch with people is one of these asymmetric habits that require little effort, time and resources but has an unlimited upside.</p></blockquote> <p>与人保持联系是一个<strong>回报远大于付出</strong>的习惯之一，它只需要花很少的努力、时间和资源，但却有无限的好处。</p> <p>这篇文章讲的是作者如何使用 <a href="https://airtable.com/" target="_blank" rel="noopener noreferrer">Airtable<span> </span></a> 管理联系人，并设置自动化任务来每天提醒他该与谁进行联系，值得一读。</p> <p>我认为该文的重点并非是自动化部分，而是与人保持联系的习惯，想想我们有多少曾经亲密的好友已经许久不联系了，回想起来你是否觉得可惜呢？</p> <p>文中提到一个与人联系的系统——将联系人分为 <code>A、B、C、D</code> 这 4 类。</p> <ul><li>A 类联系人每 3 周联系一次；</li> <li>B 类每 2 个月联系一次；</li> <li>C 类每 6 个月联系一次；</li> <li>D 类每年联系一次。</li></ul> <p>可以按照自己的喜好去设置时间间隔，比如亲人每 2 周联系一次。对于不需要与上百人保持联系的普通人，并不需要使用 Airtable 这样复杂的自动化设置，也许一个简单的 To Do 重复提醒即可满足需求。</p> <h2 id="用低代码应用设计产品原型">用低代码应用设计产品原型</h2> <p>在产品原型设计领域 Axure 无人能出其右，这也是产品经理的必备技能，但是对于非产品经理人士，有时候想快速设计原型来表达产品概念，用 Axure 学习成本较高。</p> <p>这个时候可以有几个其他选项：</p> <ul><li>使用 <a href="https://balsamiq.cloud/" target="_blank" rel="noopener noreferrer">balsamiq.cloud<span> </span></a> 制作原型草图，它非常容易上手使用；</li> <li>使用 Excel 设计原型，可以将它当作一个画板来使用；</li> <li>使用低代码应用来进行快速原型设计，这样做有许多好处：可快速进行表单设计、最终原型是可操作的、花费极少的时间就能获得专业的原型效果。</li></ul> <p><img src="https://tech.codelc.com/assets/img/yida.660c75b6.png" alt="yida"></p> <h2 id="万能锤">万能锤</h2> <p>先从一个故事开始。</p> <blockquote><p>有个人去工具店买锤子。</p> <p>店主说，No，我们已经不卖锤子了，锤子有很多种，大锤、拔钉锤、圆头锤等等，如果你买了一个之后又发现还需要另一个怎么办？多数人只想要一把锤子，所以我们推出了 <code>万能锤</code> ，可以当各种锤子使用。</p> <p>买者想想也是，那就买一把万能锤吧。</p> <p>店主说，No，万能锤已经被淘汰了，你想，万能锤虽然可以当各种锤子用，但它做什么活都没有专门用途的锤子好使，所以，我们开始卖<code>锤子制作器</code>，这样你可以随时制造最合适的锤子。</p> <p>买者说，但我并不想买个制作器……</p> <p>店主说，没错，所以它已经被淘汰了，我们研究发现，不是所有的用户都愿意自己制作锤子，所以我们推出了<code>锤子定制服务</code>，你只要提出锤子需求，我们就可以造出你想要的锤子。</p></blockquote> <p>这个故事可以衍生到许多场景，比如「笔记万能锤」、「管理万能锤」等等，这就像软件世界的一句名言一样——没有银弹。</p> <h3 id="笔记万能锤">笔记万能锤</h3> <p>有人问我记笔记用什么工具，我说，<code>Notion + WorkFlowy + Obsidian</code>等，他说这些工具不是冲突的吗？其实不然，Notion 被称作是笔记界的瑞士军刀，就像「<code>万能锤</code>」，但是它在记大纲笔记上比不上 WorkFlowy，在速度上更比不上本地使用的 Obsidian，充分利用不同工具的优势才能最大化提升生产力，一点点的工具学习成本是值得的。</p> <p>Notion 在很多方面比不上其他应用，那为什么还要使用它呢，主要在于 Notion 不光是一个「万能锤」，其实它还是一个「<code>锤子制作器</code>」，它不仅是一个笔记工具，也是一套笔记系统，使用它可以灵活地制定笔记方式。</p> <p>它能制作什么样的锤子呢，比如：</p> <p><img src="https://tech.codelc.com/assets/img/notion.76016bca.png" alt="notion"></p> <p>这是通过 <a href="https://www.notion.so/aNotioneer-be59e14d857a4d658db394a0441a3b88" target="_blank" rel="noopener noreferrer">aNotioneer<span> </span></a> 制作的模板而快速创建的，他提供模板则是一种「<code>锤子定制服务</code>」。</p> <p>不是任何人都有能力使用「锤子制作器」来制作锤子，所以基于 Notion 的「锤子定制服务」其实已经形成了一个市场，一个 20 岁的小伙说它通过「定制锤子」在一个月的时间赚了 12000 美金（当然这不一定是真话）。</p> <p><a href="https://twitter.com/heyeaslo/status/1491782728928280583" target="_blank" rel="noopener noreferrer">Easlo (Jason Chin) on Twitter: "I made $12,000 online last month. I’m just 20, here’s how I did it:"<span> </span></a></p> <p>关于万能锤的故事对你有什么启发吗？</p> <p>如果你觉得这是个不错的故事，不妨分享给你的朋友看看，同时与他们保持联系。</p> <p>bye.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[005 ⚙️ IFTTT 和 Zapier 使用对比、最好的效率系统、投入产出比最高的 3 件事]]></title>
            <link>https://tech.codelc.com/docs/letter/005.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/005.html</guid>
            <pubDate>Sat, 12 Feb 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 005 期<a href="https://www.getrevue.co/profile/lcomplete" target="_blank" rel="noopener noreferrer">「野生架构师」周刊<span> </span></a>，这是由 <a href="https://github.com/lcomplete" target="_blank" rel="noopener noreferrer">lcomplete<span> </span></a> 每周发送的 newsletter，它分享简短实用的效率方法、优质文章、编程知识、实用工具等，感谢你的阅读！</p> <h2 id="ifttt-和-zapier-使用对比">IFTTT 和 Zapier 使用对比</h2> <p>先介绍一下什么是 IFTTT，这是一个老牌的自动化工作流平台，可以集成不同的应用程序，当 A 应用程序触发某事件时，可将信息传送给 B 程序进行处理，IFTTT 得名为其口号「if this then that」。</p> <p>Zapier 又是什么呢？可以简单地理解为增强的 IFTTT，它比后者的功能更加强大。</p> <p>那么本次带来两者的使用对比，当然 Zapier 完胜。
首先 Zapier 在执行效率上远超 IFTTT，来看这个简单的场景，将加入 <code>Pocket</code> 的书签自动同步到 <code>Raindrop</code>，使用 IFTTT 时平台执行一次需间隔 1 小时，而使用 Zapier 时 2 分钟左右就完成了同步。</p> <p><a href="https://raindrop.io/lcomplete/to-read-23073692" target="_blank" rel="noopener noreferrer">To Read / lcomplete<span> </span></a>，从我的 pocket 中自动同步到这里的共享书签，可从中发现优质文章。</p> <p>Zapier 还提供数据传输等功能，尝试将我的推特一次性导入至 <code>notion</code> 数据库，使用便捷。</p> <p>另外设置了两个工作流：将我发布和喜欢的推特保存至 notion，形成我的 <code>Web Database</code>，这样做的好处是显而易见的，比如写作这篇 newsletter 时只需要打开 notion 查找资料即可。</p> <p><img src="https://tech.codelc.com/assets/img/notionweb.42482b1c.jpeg" alt="notion"></p> <p><img src="https://tech.codelc.com/assets/img/zaps.5f818ef6.png" alt="zaps"></p> <p>另外对于免费用户而言，Zapier 也没有 IFTTT 的 5 个工作流的限制，取而代之的是每月 1000 个任务执行次数的限制。</p> <p>如果超出了免费的使用限制，Zapier 的每月费用较高，这时也可以使用开源的 <code>n8n</code> 来搭建自动化工作流系统，将其部署在自己的服务器上，费用会更低，不过使用体验上会逊于 Zapier，对于不懂编程的普通用户也不易部署和上手使用。</p> <p>关于 n8n 的使用方法，可以查看我之前写的这篇文章。</p> <p><a href="https://juejin.cn/post/6964671068678127652" target="_blank" rel="noopener noreferrer">使用开源工作流自动化工具 n8n 打造个人助理 - 掘金<span> </span></a></p> <p>关于 IFTTT 和 Zapier 的使用对比，我也率先分享在了 twitter 上，如果你想及时地获取我分享的一些有趣好玩的东西，可以关注我的 twitter。</p> <p><a href="https://twitter.com/lcomplete_wild" target="_blank" rel="noopener noreferrer">lcomplete (@lcomplete_wild) | Twitter<span> </span></a></p> <h2 id="最好的效率系统">最好的效率系统</h2> <p>各种效率工具不能帮你打造最好的效率系统，最好的效率系统是，<strong>让事情成为你长期想做的事情、感到兴奋的事情、无时无刻都想做的事情、或不得不做的事情</strong>。</p> <blockquote><p>“Every productivity system stops working eventually and there’s nothing you can do about it… Most productivity tricks develop aversion around them. All of them lose salience. The only way to avoid encountering problems with productivity is to make the stuff you want to be doing in the long-term to be the most exciting stuff you can do at any moment in time, which is perhaps possible if you, e.g. work at a startup, but is untenable in almost every situation” – <a href="https://guzey.com/productivity/" target="_blank" rel="noopener noreferrer">Alexey Guzey<span> </span></a></p></blockquote> <p>其实这背后隐含着我们熟悉的一句话，叫做 <code>deadline</code> 是最高生产力，当我们把事情转化成自己有激情去做，甚至不得不去做的事情的时候，这是对抗拖延症最有效的方法，是任何效率工具都无法比拟的。</p> <h3 id="那么如何把事情变成长期想做的、有激情的事情呢">那么如何把事情变成长期想做的、有激情的事情呢？</h3> <p>可以试着把事情的边界扩大，举个例子，比如看一本书，如果边界只是看完它，那很难让你有特别强烈的激情，如果把边界扩大为看完这本书后继续阅读写作，成为一个有知识的人，再从跟他人的交流分享中获得满足感，再进一步产生影响力，让更多的人受到你的良性影响，甚至让这个世界变的更美好一些。这个格局和边界瞬间就不一样了，我们对待这件事情的激情也能提升，使得看书这件事情成为我们当下想做的事情。</p> <h2 id="投入产出比最高的-3-件事">投入产出比最高的 3 件事</h2> <p>这个部分受到 Aadit Sheth 的 twitter 的启发。从中挑选了几个我认为 ROI 非常高的事情。</p> <p><a href="https://twitter.com/aaditsh/status/1490374744667041793" target="_blank" rel="noopener noreferrer">Aadit Sheth on Twitter: "10 things that I've seen have the highest ROI:"<span> </span></a></p> <h3 id="_1、将两个人联系在一起">1、将两个人联系在一起</h3> <p>将两个志同道合的人联系在一起，如果他们真的合适（在商业、友谊或爱情方面），他们会永远的记住你。</p> <h3 id="_2、在互联网上写东西-当众学习">2、在互联网上写东西（当众学习）</h3> <p>Aadit Sheth 说，将你的想法发布在网上有利于找到志同道合的朋友。但我认为更重要的是，当众学习是很好的一个学习方法。</p> <blockquote><p>当众学习（<code>Learn In Public</code>）就像是费曼学习法的加强版，能在公共场合传授我们所学，这是更高的标准。</p></blockquote> <p>上面这段话来自下面这篇文章，作者是微软的一位工程师。</p> <p><a href="https://catcoding.me/2022/01/10/share-3-articles.html" target="_blank" rel="noopener noreferrer">深刻启发我的 3 篇文章 | 程序员的喵<span> </span></a></p> <h3 id="_3、立即行动">3、立即行动</h3> <p>有想法或灵感时要立即行动，随着时间的推移，灵感会迅速减少。立即行动能够有效地对抗拖延症，并且能够对自身产生长远的激励。</p> <p>005 这篇 newsletter，其实我在前几天晚上就想写了，由于一些事情而搁置了，一些写作灵感也迅速地消失不见，因为这件事也更深刻地体会到立即行动的重要，于是我的 newsletter 也不再限于一周发布 1 篇，有想法时立即行动！</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[004 🧛‍♂ 备受程序员喜爱的暗黑主题、程序员的英语有多重要、Newsletter 资源分享]]></title>
            <link>https://tech.codelc.com/docs/letter/004.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/004.html</guid>
            <pubDate>Tue, 08 Feb 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 004 期 tech letter，这是由 lcomplete&nbsp;每周发送的 newsletter，它分享简短实用的效率方法、技术文章、实用工具等，感谢你的阅读！</p> <h2 id="本期摘要"><strong>本期摘要</strong></h2> <ul><li>备受程序员喜爱的暗黑主题</li> <li>程序员的英语有多重要？</li> <li>Newsletter 资源分享</li></ul> <h2 id="备受程序员喜爱的暗黑主题">备受程序员喜爱的暗黑主题</h2> <p>许多程序员的 IDE 都喜欢设置为暗黑主题模式，这个取名为「<a href="https://draculatheme.com/" target="_blank" rel="noopener noreferrer">德古拉(Dracula)<span> </span></a>」的开源主题项目一定很适合他们。这套开源主题可以在三大操作系统中使用，并且目前支持超过 <code>240</code> 个应用程序。</p> <p>程序员对 Dracula 这个单词应该并不陌生，在各个 IDE 的主题选项中基本上都存在，原来翻译过来是德古拉，那就难怪了，我们知道「吸血鬼」🧛‍♂都是喜欢黑色的（笑）。</p> <h2 id="程序员的英语有多重要">程序员的英语有多重要？</h2> <p>经常逛掘金的朋友，可能已经看到过这篇文章 <a href="https://juejin.cn/post/7056431876688314399" target="_blank" rel="noopener noreferrer">《2022，前端的天🌦️要怎么变？》<span> </span></a>，这篇文章翻译到 <code>medium</code> 平台 <a href="https://medium.com/frontend-canteen/my-5-predictions-for-frontend-trends-in-2022-4cabd3cc66e4" target="_blank" rel="noopener noreferrer">《My 5 Predictions for Frontend Trends in 2022》<span> </span></a> 并设置为 <code>会员阅读</code> 后作者获得了超过 <code>50 美金</code> 的收益，并且还在持续增加。这篇文章并非原作者翻译，译者出于对版权的尊重，与原作者取得合作关系后才进行翻译发表，文章的收益采用 55 分成。</p> <p>这并不是一篇很难翻译的文章，通过这个例子至少可以看出两点：</p> <ol><li>国内的优质技术文章也是可以输出到国外的。</li> <li>在程序员这个大群体中，会英语是具备非常大的优势。</li></ol> <p>以往绝大多数时候都是国外的技术和产品创新输入到国内，国内的许多产品都是在跟风模仿，随着移动互联网的兴起，我们终于站在了同一起跑线，国内也有部分产品开始被国外模仿，比如微信在爆火的时候，国外的很多产品开始模仿它，这其中包括对 <code>微信公众号</code> 的模仿，<code>Substack</code> 创始人明确表示受到了公众号的启发，微信公众号虽然是启发者，但是在让创作者赚钱这方面，却没有国外的平台 <code>Substack</code>、<code>Medium</code> 等做的好，内容生态不够开放是一方面，付费习惯和消费水平还没有跟上也是一方面。在国内做内容付费和知识变现虽然早已不是新鲜事物，但一直缺乏这类创作者平台，在这方面的创新确实还是远远落后的，顺带一提，最近可以发文章赚以太币的 <a href="https://mirror.xyz/" target="_blank" rel="noopener noreferrer">https://mirror.xyz/<span> </span></a> 获得了 6000 万美金的投资。通过这些，又不难发现会英语的另一个优势，可以帮助我们发现和了解国外创新的产品。</p> <p>利用 <code>Medium</code>、<code>Substack</code> 等平台，通过英语加技术来赚钱是一个非常好的副业。</p> <p><a href="https://medium.com/%E5%86%99%E4%BD%9C%E4%B9%8B%E8%B7%AF/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%A6%82%E4%BD%95%E5%9C%A8medium-com%E4%B8%8A%E9%80%9A%E8%BF%87%E5%86%99%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2%E8%B5%9A%E9%92%B1-6d47d82b03dd" target="_blank" rel="noopener noreferrer">程序员如何通过在Medium.com上写技术博客赚钱？<span> </span></a></p> <p>但这并非许多程序员的兴趣所在，英语在其他许多方面对程序员也至关重要。</p> <p>一些浅显的，比如提升写代码、阅读英语文章的水平这类就不讲了，就拿我自己来举例子吧。在几乎停止学习的几年时间里，我的英语似乎够用，看看英文的技术文章、在StackOverflow 上 copy 点代码都不成问题。</p> <p>这么点英语水平，主要是通过以前的一点积累：</p> <ul><li>写代码给变量命名，早期用有道词典记录生词，之前大概记录了 5000 多个单词。</li> <li>自学赖世雄的《美语从头学》，这系列的书比较适合英语初学者，当时没有学完，大概学了一半多。</li> <li>看美剧、电影，主要是《老友记》看了两遍多。</li> <li>大概13、14年开始，遇到技术问题，基本上使用英文搜索，通过这个途径看了一些英文文章。</li></ul> <p>那么今年也是由于立了要每周写 newsletter 的 flag，开始重拾以前大量阅读的习惯，在这个过程中，以下两点让我发现英语成为了一个很大的瓶颈。</p> <ol><li>发掘的许多优质文章都是英文的，阅读这些文章时，虽然可以依靠翻译基本读懂，但阅读效率大打折扣。</li> <li>阅读英文时，无法很有效地像阅读中文时一样通过快速扫读发现有价值的信息。</li></ol> <p>2022 年，再立个 flag 吧——重新系统地学习英语。</p> <h2 id="newsletter-资源分享">Newsletter 资源分享</h2> <p>上面写多了，这里就不啰嗦了，分享两篇好的资源。</p> <p><a href="https://sspai.com/post/65892" target="_blank" rel="noopener noreferrer">关于 Newsletter，我想和你分享这些<span> </span></a></p> <p><a href="https://www.notion.so/kfang/Newsletter-68ee46c0a4574f659fb8a873ead438c6" target="_blank" rel="noopener noreferrer">notion - 中文 Newsletter 导航<span> </span></a></p> <h2 id="我的一周">我的一周</h2> <ul><li>从 flomo 切换到了 <a href="https://workflowy.com/" target="_blank" rel="noopener noreferrer">WorkFlowy<span> </span></a> <ul><li>它主要是用来编写列表和大纲的，飞书的思维笔记借鉴的就是这个老牌产品。由于最近写东西比较多，需要列大纲，先后使用了 flomo、Kinopio 来记录临时的想法，发现都不够顺手，最后使用了 WorkFlowy 这个产品，<code>它的优势是所有的笔记其实都在一个大的嵌套的列表中，非常方便查阅和记录</code>，而且在里面记录的所有东西实际上是可以用一个 txt 格式的纯文本来表示的，非常方便保存和备份。</li></ul></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[003 🐂 新一代 kubernetes、反脆弱]]></title>
            <link>https://tech.codelc.com/docs/letter/003.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/003.html</guid>
            <pubDate>Sun, 06 Feb 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 003 期 tech letter，这是由 lcomplete&nbsp;每周发送的 newsletter，它分享简短实用的效率方法、技术文章、实用工具等，文章主要有三块内容：摘要分享、我的一周（对大家能有所帮助或启发的内容）和本周引用（经典名句），感谢你的阅读！</p> <h2 id="本期摘要"><strong>本期摘要</strong></h2> <ul><li>wasmCloud，新一代 kubernetes？</li> <li>《反脆弱：从不确定性中获益》</li></ul> <h2 id="wasmcloud-新一代-kubernetes">wasmCloud，新一代 kubernetes？</h2> <p>WebAssembly/wasm 是一个低层级的编程语言，可以让开发者运用自己熟悉的编程语言进行编译，再借由虚拟机引擎在浏览器内执行，Google 的 <a href="https://github.com/GoogleChromeLabs/squoosh" target="_blank" rel="noopener noreferrer">https://github.com/GoogleChromeLabs/squoosh<span> </span></a> 项目很大程度上就是在展示 wasm 的厉害之处（它所展示的图片压缩技术是在浏览器本地执行的）。</p> <p>wasm 可以由多种编程语言编译而成二进制格式，能够充分发挥硬件能力以达到近乎原生的执行效率，同时它是运行在可移植的沙箱环境中，从 <code>可移植性</code>和 <code>沙箱</code> 两个要素来看，我们不难发现其与 <code>docker</code> 有一定的相似之处，先知先觉的技术布道师其实早已洞穿一切，不光是有相似之处，使用 wasm 还有着性能方面的优势，过去我们总担心程序运行在虚拟机里性能会受影响，虽说以虚拟机为主的容器运行时早已成为主流，但之前的担心并无道理，在技术的不断创新下，wasmCloud 的出现可以说是为了解决现有容器的一系列问题。</p> <p>原本我们认为 WebAssembly 是属于前端领域的技术，现在它也走到了后端，前后端的技术又一次产生了交集。</p> <p>wasmCloud 目前被广泛看好，一些云计算厂商已经将其应用在 <code>Serverless</code> 无服务器函数领域，未来会不会在云原生架构上占有一席之地，让我们拭目以待。</p> <h2 id="《反脆弱-从不确定性中获益》">《反脆弱：从不确定性中获益》</h2> <p>《原则》一书中提到作者（Paypal 创始人）在面试的时候总会问面试者一个问题：你在什么问题上与其他人有着不同的看法？只有面试者回答的不错时才能应聘上。《反脆弱》这本书的书名其实也是个很好的回答，我们谈到脆弱时会想到它的反义词坚强，但脆弱有时候是不可避免的，比如黑天鹅事件，比如玻璃杯从桌上掉下，如何通过反脆弱在不确定性中获益是值得思考的，在面临随机的危机事件中，如何去面对，想更系统的了解的话，不防看看这本书。</p> <h2 id="我的一周">我的一周</h2> <p>过年期间没有保持每天阅读，但也阅读到一些价值较大的信息，这里推荐大家订阅 <code>湾区日报</code>。</p> <h2 id="本周引用">本周引用</h2> <p>为什么你需要习惯而不是激情？</p> <blockquote><p><em>如果你有一个习惯模式，你头脑中更理智的部分可以专注于你的工作，你可以得到想法并做这些事情，其余的部分在后台就会自己解决。</em></p> <p>—— 大卫林奇</p></blockquote> <p>（完）</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[002 🕷 Web 3.0、关于好品味的商业模式]]></title>
            <link>https://tech.codelc.com/docs/letter/002.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/002.html</guid>
            <pubDate>Wed, 26 Jan 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 002 期 tech letter，这是由 lcomplete&nbsp;每周发送的 newsletter，它分享简短实用的效率方法、技术文章、实用工具等，文章主要有三块内容：摘要分享、我的一周（对大家能有所帮助或启发的内容）和本周引用（经典名句），感谢你的阅读！</p> <h2 id="本期摘要"><strong>本期摘要</strong></h2> <p>原本用 flomo 记录了本周准备写的东西，但在写的时候却改变了想法，下面这些可能要留到后面几期了。</p> <p><img src="https://tech.codelc.com/assets/img/flomo.5ce536b0.png" alt="flomo"></p> <p>这一期我们来聊聊 Web 3.0 和信息大爆炸背景下关于内容推荐的商业模式。</p> <ul><li>我眼中的 Web 3.0</li> <li>内容推荐者是新的内容创造者，具有好的品味是能赚钱的？</li></ul> <h2 id="我眼中的-web-3-0">我眼中的 Web 3.0</h2> <p>Web 1.0 是网站主单方面输出信息，Web 2.0 是由用户介入到信息创造，相当于是电商领域由 B2C 到 C2C 的转变，那什么是 Web 3.0 ？关于这点，有些众说纷纭了，有人说它跟人工智能有关，有人跟说它跟区块链有关，也有人说它跟 2.0 一样是一个很好的营销手法，虽然说现在没有一个准确的定义，但是我相信它跟 2.0 一样，迟早会形成一种质变，最后使得人们逐渐习惯它。</p> <p>关于这些争论中，我最喜欢的一个 Web 3.0 的含义是 <code>将互联网转化为数据库</code>。</p> <p>在 Airtable 中我们已经看到了将表格转换为数据库的威力，在 Notion 中我们看到了将文档转换为数据库的能力，如果将整个互联网转化为数据库，那是何等的壮观。</p> <p>我们以前听到过互联网就是一个超大的数据库的比喻，但是互联网上的数据不是标准化的，也没有一套使用标准，信息的检索、使用、互联都是受限的，如果这些限制被打破呢？其实许多限制已经被打破，开放 API 和开放数据格式几乎是所有互联网独角兽产品的标准配置，我们可以轻松地连接两个产品，让它们的数据互通，这是 Web 3.0 的一部分，它还在发展中，我相信未来会发明出更多的标准协议让这些互联互通更加普遍。</p> <p><a href="https://zh.wikipedia.org/wiki/Web3" target="_blank" rel="noopener noreferrer">Web3 - 维基百科，自由的百科全书<span> </span></a></p> <h2 id="内容推荐者是新的内容创造者-具有好的品味是能赚钱的">内容推荐者是新的内容创造者，具有好的品味是能赚钱的？</h2> <p>不用等到 Web 3.0 时代，我们早已处在一个信息大爆炸的时代，在 Web 3.0 时代爆炸会加速吗？刚才提及的将互联网转化为数据库，其实是对这部分的一个铺垫。</p> <p>数据库对于我们后端开发来说再熟悉不过了，如何优化数据库的查询性能，第一个想到的大概率会是加索引，如果互联网本身是个超大型的分布式数据库，那给它建索引的价值是非常巨大的，这方面最成功的自然是 Google 了，那对于个人或者小团体来说，能不能维护一份内容索引来赚钱呢？答案是肯定的，这种商业模式也是被经过验证的，比如说少数派、各类做知识付费加广告赞助的「技术大牛」，其实他们的很多文章都是内容推荐类的，国外一般称这群人为 <code>Curators(图书馆馆长、内容推荐者)</code> ，也就是说全世界都有通过内容推荐来赚钱的人。</p> <p>通过内容推荐来赚钱是一个不错的商业模式，但也是有前提的：</p> <p><strong>首先，必须足够深入并精通某一领域。</strong></p> <p>作为个人来说，精力有限，能精通一两个领域已经非常厉害，所以个人做内容推荐基本上是在某一垂直领域，作为程序员，我们接触的这类推荐者非常多，因为程序员已经发展为一个非常庞大的群体。</p> <p>掘金上充斥着许多 GitHub 项目推荐、IDE 插件推荐类的文章，这类文章也比较容易成为热门，我自己也写过一篇，只花了一点点写作的时间，却获得了不错的阅读量，其实在我自己看来这是一篇水文。</p> <p><a href="https://juejin.cn/post/6966606708848197645" target="_blank" rel="noopener noreferrer">[10 倍程序员系列] ⭐51W+ 的终端命令行工具助你成为 10 倍程序员 - 掘金<span> </span></a></p> <p>说它是一篇「水文」，只是由于我写作这篇文章的难度低，那些工具都是我平常使用或收集的，我只需要罗列并做一个简单的介绍就可以了， 但是对于那些喜欢使用命令行的人来说却很可能具有价值。一篇文章写作的难度跟它的价值并非成比例关系，如果作者熟悉某一领域，内容推荐的质量也较高。</p> <p><strong>其次，必须有足够好的「品味」。</strong></p> <p>掘金上的内容推荐类的文章一开始我是比较反感，因为上面推荐的大多数东西要么我已经知道了，要么就是价值不大的，要做好内容索引我们也需要有一个好的「品味」，并且持续不断地发现和过滤出真正有价值的信息。这样才大抵算的上是内容创造。</p> <p>想通了这些后，我不再反感掘金上内容推荐类的文章，只是那些不太符合我的「口味」罢了。</p> <p>这一小节所使用标题的原文：</p> <p><a href="https://gabygoldberg.medium.com/curators-are-the-new-creators-the-business-model-of-good-taste-5852727d4b54" target="_blank" rel="noopener noreferrer">Curators Are the New Creators<span> </span></a></p> <h2 id="我的一周">我的一周</h2> <ul><li><p>完成了《架构组2021年度工作汇报》</p> <p>我的 ppt 被评价为是比较专业的，但实际上在 ppt 的外观上我并没有花什么时间，这其中用到以下几个工具帮助我快速制作 ppt。</p> <ul><li>PPT 设计灵感，用于自动设计。</li> <li>Kinopio，绘制规划。</li> <li>ScreenToGif，用于录制 Gif 进行展示。</li> <li>Awesome Screenshot 插件，截取浏览器使用视频用于展示。</li> <li>Excel 数据分析图，制作图表。</li></ul> <p>列完后发现似乎没有必要单独再写一期如何高效制作 PPT 了。</p></li></ul> <h2 id="本周引用">本周引用</h2> <blockquote><p>The future is already here — it’s just not very evenly distributed.<br>
译：未来已来，只是还没有平均分布。</p></blockquote> <p>—— [William Gibson]</p> <blockquote></blockquote> <p>（完）</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[001 🐣 低代码、我的信息管理]]></title>
            <link>https://tech.codelc.com/docs/letter/001.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/letter/001.html</guid>
            <pubDate>Fri, 21 Jan 2022 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>欢迎打开第 001 期 tech letter，这是由 lcomplete&nbsp;每周发送的 newsletter，它分享简短实用的效率方法、技术文章、实用工具等，文章主要有三块内容：摘要分享、我的一周（对大家能有所帮助或启发的内容）和本周引用（经典名句），感谢你的阅读！</p> <h2 id="本期摘要"><strong>本期摘要</strong></h2> <p>这一期分享的内容包括低代码优质文章和资源、信息管理方式分享：</p> <ul><li>低代码优质文章和资源</li> <li>我的信息管理</li></ul> <h2 id="低代码优质文章和资源">低代码优质文章和资源</h2> <p>随着技术组件化的发展，低代码达到了一个空前火热的程度，各个大厂包括 Google、微软、Amazon、阿里、腾讯均有布局，平台级的低代码平台不是小公司可以做的，但是我们也可以利用不断推陈出新的组件来打造具备实用性的内部低代码平台。</p> <p>首推好文：</p> <p><a href="https://www.infoq.cn/article/gh6hucbsj32qucudatos" target="_blank" rel="noopener noreferrer">万字长文讲透低代码-InfoQ<span> </span></a></p> <p>通过这篇文章可以了解到低代码存在 <code>模型驱动</code> 和 <code>表单驱动</code> 两种，低代码平台也存在 <code>应用开发平台</code> 和 <code>应用搭建平台</code> 两类。</p> <p>业内许多人士对低代码持怀疑态度，比如下面这篇文章就发出质疑之声：</p> <p><a href="https://www.infoq.cn/article/q2mFOAtreDZETqMplw0M" target="_blank" rel="noopener noreferrer">为什么我说低代码是"行业毒瘤"？-InfoQ<span> </span></a></p> <p>其实是对低代码理解的还不够透彻，我认为低代码开发平台可以类比游戏引擎，研发游戏有许多共通的东西，研发后台系统显然也是有的，不存在满足所有系统开发的低代码平台，但不意味着低代码是伪需求。</p> <p>低代码还存在一类公有云数据服务的分类，以 Airtable 为首，可以查看这篇文章进行了解：</p> <p><a href="https://www.fydc.net/27224.html" target="_blank" rel="noopener noreferrer">110亿美金独角兽Airtable，在国内的模仿者能走多远_科技频道_附有多彩<span> </span></a></p> <p>低代码相关开源项目：</p> <ul><li><a href="https://github.com/appsmithorg/appsmith" target="_blank" rel="noopener noreferrer">https://github.com/appsmithorg/appsmith<span> </span></a></li> <li><a href="https://github.com/Budibase/budibase" target="_blank" rel="noopener noreferrer">https://github.com/Budibase/budibase<span> </span></a></li> <li><a href="https://github.com/nocodb/nocodb" target="_blank" rel="noopener noreferrer">https://github.com/nocodb/nocodb<span> </span></a></li> <li><a href="https://github.com/alibaba/formily" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/formily<span> </span></a></li> <li><a href="https://github.com/PostgREST/postgrest" target="_blank" rel="noopener noreferrer">https://github.com/PostgREST/postgrest<span> </span></a></li></ul> <p>还有许多的开源项目，上面这些涉及到云数据服务、界面可视化设计、自动 API、表单驱动等低代码领域。</p> <h2 id="我的信息管理">我的信息管理</h2> <p>Feedly 是我多年前（可能有10年以上了）一直在使用的 RSS 订阅服务，随着优质博主逐渐将文章迁移到公众号后就几乎不使用了，也许是最近越发觉得需要重拾以前的好习惯，于时又用了起来，面对海量的信息，在信息管理上也稍作了一些研究。</p> <p>先推荐一篇信息管理的好文章：</p> <p><a href="https://sspai.com/post/70397" target="_blank" rel="noopener noreferrer">我的信息管理方案 - 少数派<span> </span></a></p> <p>作者的信息管理方式非常复杂，适合需要经常写作的高端人士，也许我们用不上，但了解一下说不定在以后用的上。</p> <p>我的信息管理方式相对简单，主要用到了以下工具。</p> <p>记录类：</p> <ul><li>Notion，这里记录的全部是我自己写作的东西。</li> <li>语雀，主要用到了图表功能，来弥补 Notion 在这块的不足，另外语雀上有公共的知识库，可以探索、关注和学习。</li> <li>Flomo，目前用来记录临时和片段性的内容。</li> <li>微软 To Do，用来记录代办事项，分为生活和工作两部分，会开启按时提醒。</li> <li>OneNote，以前主要使用的记录工具，会剪藏值得收藏的网页，现在很少使用，主要是用来查阅以前记录的内容。</li></ul> <p>阅读类：</p> <ul><li>Feedly，配合 RSSHub 查看订阅内容。</li> <li>简悦，将网页加入稍后读，设置了工作流，会将内容自动保存为离线 html 和 markdown。</li> <li>Obsidian，这是一个能很好地支持双向链接功能的笔记工具，但目前我主要是用来查看通过简悦加入稍后读的文章，我会在 Win11 中新建一个桌面单独放置 Obsidian，这样随时可以切换到这个桌面中快速查找本地内容。</li></ul> <p><img src="https://tech.codelc.com/assets/img/obsidian.aa5c0975.png" alt="obsidian.png"></p> <h2 id="我的一周">我的一周</h2> <ul><li><p>终于完成了《大数据开发初探》的培训</p> <p><a href="https://github.com/lcomplete/TechShare/blob/master/docs/ppt/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BC%80%E5%8F%91%E5%88%9D%E6%8E%A2.pptx" target="_blank" rel="noopener noreferrer">大数据开发初探.pptx<span> </span></a></p></li> <li><p>决定开始写 newsletter</p></li></ul> <h2 id="本周引用">本周引用</h2> <blockquote><p>面对自身缺点，你有4种选择：</p> <ol><li>你可以否认缺点（这是大多数人的做法）。</li> <li>你可以承认缺点并应对缺点，努力把缺点转化为优势（能不能成功取决于你的自我改变能力）。</li> <li>你可以承认缺点并找到绕过缺点的方法。</li> <li>或者，你可以改变你的目标。 ——《原则》</li></ol></blockquote> <p>（完）</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[🎄 [React] 使用 remotion 制作视频，让圣诞快乐 PSD 动起来]]></title>
            <link>https://tech.codelc.com/docs/js/remotion.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/js/remotion.html</guid>
            <pubDate>Sun, 19 Dec 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h2 id="psd-自动生成动画视频">PSD 自动生成动画视频</h2> <p>话不多说，先看效果。</p> <p>效果 1：</p> <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e895654e94824a2a9302a0e8389ae2c0~tplv-k3u1fbpfcp-watermark.image?" alt="merryc-s.gif"></p> <p>效果 2：</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f9f96a190604d5783f0380713319825~tplv-k3u1fbpfcp-watermark.image?" alt="merryc1-s.gif"></p> <p>说明：以上为视频预览，其中的动画效果使用了 <a href="https://github.com/animate-css/animate.css" target="_blank" rel="noopener noreferrer">animate.css<span> </span></a> 进行随机生成。</p> <p>虽然本文代码所实现的视频动画效果非常简单，主要是介绍如何根据一张有层次的 PSD 文件自动生成视频，但这些代码的基石 <a href="https://github.com/remotion-dev/remotion" target="_blank" rel="noopener noreferrer">remotion<span> </span></a> 项目可不限于此，使用它可以实现非常复杂的视频。</p> <h2 id="remotion">remotion</h2> <p>上面的效果是采用 <a href="https://github.com/remotion-dev/remotion" target="_blank" rel="noopener noreferrer">remotion<span> </span></a> 进行实现的，这是一个可以让你使用 React 以编程的方式创建视频的开源项目。<a href="https://github.com/remotion-dev/trailer" target="_blank" rel="noopener noreferrer">remotion 宣传片<span> </span></a> 就是使用 remotion 进行制作的，这是一个相当复杂的视频，通过这个宣传片，足见 remotion 的强大。</p> <h3 id="remotion-核心概念">remotion 核心概念</h3> <p>remotion 背后的核心概念是，只要提供一个当前帧 <code>currentFrame</code> 和空白的 <code>canvas</code>，就可以使用 React 自由的渲染任何元素。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useCurrentFrame <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"remotion"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">MyVideo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> frame <span class="token operator">=</span> <span class="token function">useCurrentFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> justifyContent<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span> alignItems<span class="token operator">:</span> <span class="token string">"center"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      The current frame <span class="token keyword">is</span> <span class="token punctuation">{</span>frame<span class="token punctuation">}</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>一个视频可以表达为一个随着时间变动的图像函数，根据每一帧改变内容，最终就能产生动画效果。</p> <p>一个 remotion 视频还有几个核心的属性：<code>width</code>、<code>height</code>、<code>durationInFrames(视频总帧数)</code>、<code>fps</code>。这些属性可以通过 <code>useVideoConfig</code> hook 得到。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useVideoConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"remotion"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">MyVideo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> fps<span class="token punctuation">,</span> durationInFrames<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useVideoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> flex<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> justifyContent<span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span> alignItems<span class="token operator">:</span> <span class="token string">"center"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      This video <span class="token keyword">is</span> <span class="token punctuation">{</span>durationInFrames <span class="token operator">/</span> fps<span class="token punctuation">}</span> seconds long<span class="token punctuation">.</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>也就是说，定义好视频的<code>宽度、高度、总帧数和帧率(fps)</code>，remotion 会在运行时向我们提供 <code>currentFrame</code>，根据当前帧数和视频属性渲染当前状态下的图像即可。</p> <h3 id="封装-animate-css-动画">封装 animate.css 动画</h3> <p>跟我们在使用 <code>animate.css</code> 时只需要指定一个动画样式不同，现在渲染图像需要根据三个核心参数 <code>durationInFrames(总帧数)</code>、<code>currentFrame(当前帧)</code>、<code>fps(帧率)</code> 来计算出当前动画位置。如果每次都编码进行计算岂不是很繁琐，因此我们封装一个 <code>Animate 组件</code> 以进行重复利用。</p> <p>计算逻辑：</p> <div class="language- extra-class"><pre class="language-text"><code>const frame = useCurrentFrame();
const { durationInFrames, fps } = useVideoConfig();
const duration = durationInFrames / fps; // 动画总时长
const delay = (frame / fps) &lt; duration ? (frame / fps) : duration - 0.00001; //动画播放到哪儿了
</code></pre></div><p>可以看出计算逻辑并不复杂，得出动画播放位置，设置在动画元素的 <code>style</code> 属性上即可。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
	<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value css language-css"><span class="token punctuation">{</span><span class="token punctuation">{</span></span></span></span>
		<span class="token attr-name"><span class="token namespace">animationPlayState:</span></span> <span class="token attr-name">'paused',</span>
		<span class="token attr-name"><span class="token namespace">animationName:</span></span> <span class="token attr-name">animate,</span>
		<span class="token attr-name"><span class="token namespace">animationDelay:</span></span> <span class="token attr-name">`-${delay}s`,</span>
		<span class="token attr-name"><span class="token namespace">animationDuration:</span></span> <span class="token attr-name">`${duration}s`,</span>
	<span class="token attr-name">}}</span>
<span class="token punctuation">&gt;</span></span>
	{children}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>完整代码：<a href="https://github.com/ahgsql/remotion-animation" target="_blank" rel="noopener noreferrer">remotion-animation<span> </span></a>。</p> <p>掌握 animate.css 动画的封装就已经完成了一半，接下来我们使用 Java 来解析 psd，并在返回的 psd 元素上设置随机动画效果。</p> <h2 id="使用-java-解析-psd">使用 Java 解析 PSD</h2> <p>解析 PSD 的方法有很多，由于作者刚好顺手用 Java 写了 PSD 的解析，所以这里就采用 Java 来介绍，更推荐大家使用 <a href="https://github.com/meltingice/psd.js" target="_blank" rel="noopener noreferrer">psd.js<span> </span></a>，这样仅通过前端编码就能实现本文的效果。</p> <p>解析 PSD 使用了 <a href="https://github.com/inevo/java-psd-library" target="_blank" rel="noopener noreferrer">java-psd-library<span> </span></a> 开源项目，处理 PSD 的部分代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 保存 PSD 中的图片元素，并返回 PSD 动画配置</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">PsdAnimateConfig</span> <span class="token function">processPsd</span><span class="token punctuation">(</span><span class="token class-name">File</span> inputFile<span class="token punctuation">,</span> <span class="token class-name">File</span> outputDir<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Psd</span> psdFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Psd</span><span class="token punctuation">(</span>inputFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    outputDir<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">PsdAnimateConfig</span> animateConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PsdAnimateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    animateConfig<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>psdFile<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    animateConfig<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span>psdFile<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    animateConfig<span class="token punctuation">.</span><span class="token function">setLayers</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> total <span class="token operator">=</span> psdFile<span class="token punctuation">.</span><span class="token function">getLayersCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> total<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Layer</span> layer <span class="token operator">=</span> psdFile<span class="token punctuation">.</span><span class="token function">getLayer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">writeLayer</span><span class="token punctuation">(</span>layer<span class="token punctuation">,</span> outputDir<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> animateConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 随机选择一个动画（这里把所有支持的动画放到了 txt文件）</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> animates <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">readLines</span><span class="token punctuation">(</span><span class="token class-name">ResourceUtils</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token string">"classpath:animate.txt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">defaultCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Out"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> animate <span class="token operator">=</span> animates<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>animates<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AnimateLayer</span> layer <span class="token operator">:</span> animateConfig<span class="token punctuation">.</span><span class="token function">getLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            layer<span class="token punctuation">.</span><span class="token function">setAnimate</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            layer<span class="token punctuation">.</span><span class="token function">setFromMillisecond</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置动画开始时间</span>
            layer<span class="token punctuation">.</span><span class="token function">setDurationMillisecond</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置动画持续时间</span>
            i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> animateConfig<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 保存 PSD 图片元素，并将图片元素加入动画配置</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeLayer</span><span class="token punctuation">(</span><span class="token class-name">Layer</span> layer<span class="token punctuation">,</span> <span class="token class-name">File</span> baseDir<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">PsdAnimateConfig</span> animateConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">LayerType</span><span class="token punctuation">.</span>FOLDER<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> layer<span class="token punctuation">.</span><span class="token function">getLayersCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Layer</span> subLayer <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">getLayer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">writeLayer</span><span class="token punctuation">(</span>subLayer<span class="token punctuation">,</span> baseDir<span class="token punctuation">,</span> index<span class="token operator">++</span><span class="token punctuation">,</span> animateConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">LayerType</span><span class="token punctuation">.</span>NORMAL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> path <span class="token operator">=</span> layer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> outFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> path <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>outFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ImageIO</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">,</span> outFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">AnimateLayer</span> animateLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnimateLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            animateLayer<span class="token punctuation">.</span><span class="token function">setX</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            animateLayer<span class="token punctuation">.</span><span class="token function">setY</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            animateLayer<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            animateLayer<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            animateLayer<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">".png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            animateLayer<span class="token punctuation">.</span><span class="token function">setIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

            animateConfig<span class="token punctuation">.</span><span class="token function">getLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>animateLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码比较简单，这里就不做讲解了，接下来我们看前端如何根据返回的配置来编写动画。</p> <h2 id="从-psd-配置中创建动画视频">从 PSD 配置中创建动画视频</h2> <p>在 remotion 组件中可以从接口获取到数据后再继续渲染，我们从 Java 服务端接口中获取配置，根据配置一步步渲染组件。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token string">"animate.css"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  continueRender<span class="token punctuation">,</span>
  delayRender<span class="token punctuation">,</span>
  Sequence<span class="token punctuation">,</span>
  useCurrentFrame<span class="token punctuation">,</span>
  useVideoConfig<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"remotion"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Animation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"remotion-animation"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">PsdVideo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> setData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>handle<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">delayRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:8080/psd/animateConfig"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setData</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">continueRender</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> videoConfig <span class="token operator">=</span> <span class="token function">useVideoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> frame <span class="token operator">=</span> <span class="token function">useCurrentFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">加载中</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getDiv</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>layer<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
          position<span class="token operator">:</span> <span class="token string">"absolute"</span><span class="token punctuation">,</span>
          width<span class="token operator">:</span> layer<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
          height<span class="token operator">:</span> layer<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
          top<span class="token operator">:</span> layer<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
          left<span class="token operator">:</span> layer<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
          <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">"http://127.0.0.1:8080/psd/image?name="</span> <span class="token operator">+</span> layer<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>
          <span class="token attr-name">width</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>layer<span class="token punctuation">.</span>width<span class="token punctuation">}</span></span>
          <span class="token attr-name">height</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>layer<span class="token punctuation">.</span>height<span class="token punctuation">}</span></span>
        <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getAnimate</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>layer<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> duration <span class="token operator">=</span> layer<span class="token punctuation">.</span>durationMillisecond <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>layer<span class="token punctuation">.</span>animate <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Animation</span></span> <span class="token attr-name">duration</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>duration<span class="token punctuation">}</span></span> <span class="token attr-name">animateName</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>layer<span class="token punctuation">.</span>animate<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span><span class="token function">getDiv</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Animation</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token operator">!</span>layer<span class="token punctuation">.</span>animate <span class="token operator">&amp;&amp;</span> <span class="token function">getDiv</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
      <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> data<span class="token punctuation">.</span>width<span class="token punctuation">,</span> height<span class="token operator">:</span> data<span class="token punctuation">.</span>height<span class="token punctuation">,</span> position<span class="token operator">:</span> <span class="token string">"relative"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span>layers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> needPlay <span class="token operator">=</span> layer<span class="token punctuation">.</span>durationMillisecond<span class="token punctuation">;</span> <span class="token comment">// 设置了时间的是需要播放的</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token punctuation">{</span>needPlay <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Sequence</span></span>
                <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">parseInt</span><span class="token punctuation">(</span>
                  <span class="token punctuation">(</span>videoConfig<span class="token punctuation">.</span>fps <span class="token operator">*</span> layer<span class="token punctuation">.</span>fromMillisecond<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span>
                <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
                <span class="token attr-name">durationInFrames</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">Infinity</span><span class="token punctuation">}</span></span>
              <span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token punctuation">{</span><span class="token function">getAnimate</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Sequence</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
            </span><span class="token punctuation">{</span><span class="token operator">!</span>needPlay <span class="token operator">&amp;&amp;</span> <span class="token function">getAnimate</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="总结">总结</h2> <p>本文代码所实现的视频效果比较简单，但提到了生成动画的核心概念、从服务端获取数据从而动态生成视频等，读者朋友如果感兴趣的话可以试着去创建更复杂的动画并导出成视频哦。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[编程界的 51 条名言佳句]]></title>
            <link>https://tech.codelc.com/docs/thinking/quotes.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/thinking/quotes.html</guid>
            <pubDate>Thu, 16 Dec 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <ol><li><p>Beautiful is better than ugly.</p></li> <li><p>Explicit is better than implicit.</p></li> <li><p>Simple is better than complex.</p></li> <li><p>Complex is better than complicated.</p></li> <li><p>Flat is better than nested.</p></li> <li><p>Sparse is better than dense.</p></li> <li><p>Readability counts.</p></li> <li><p>除非明确地使其沉默，错误永远不应该默默地溜走。</p></li> <li><p>面对不明确的定义，拒绝猜测的诱惑。</p></li> <li><p>做比不做好，但立马去做有时还不如不做。</p></li> <li><p>如果实现很难说明，那它是个坏想法。</p></li> <li><p>如果实现容易解释，那它有可能是个好想法。</p></li> <li><p>命名空间是个绝妙的想法，让我们多多地使用它们吧！</p></li> <li><p>世界上只有两类编程语言：人们都抱怨的语言和从来没有人使用的语言。</p></li> <li><p>简单是可靠的前提条件。</p></li> <li><p>用代码行数来衡量编程的进度，就如同用航空器零件的重量来衡量航空飞机的制造进度一样。</p></li> <li><p>好的程序员这样一类人，这类人在横穿一条单行道前都要先看一下路两边。</p></li> <li><p>修复 bug 很容易，但是定位 bug 却很困难。</p></li> <li><p>足够多的眼睛，就可让所有问题浮现。</p></li> <li><p>好的代码自己本身就是最好的文档。当你打算加注释的时候，问问自己‘我如何才能把我的代码改善到不需增加注释？’重构自己的代码，然后使文档让其更清楚。</p></li> <li><p>在每个编写精良的大程序里面都是一个编写精良的小程序。</p></li> <li><p>Rethinking Best Practices.</p></li> <li><p>开始的 90% 的代码用了 90% 的开发时间，而剩下的最后的 10% 的代码会需要另外 90% 的开发时间。</p></li> <li><p>世界上有两个设计软件的方法，一种方法是设计的尽量简单，以至于明显的没有什么缺陷，另外一种方式是使他尽量的复杂，以至于其缺陷不那么明显。</p></li> <li><p>Don’t Repeat Yourself (DRY)</p></li> <li><p>Keep It Simple, Stupid (KISS)</p></li> <li><p>Program to an interface, not an implementation</p></li> <li><p>You Ain’t Gonna Need It (YAGNI)</p></li> <li><p>Law of Demeter – 迪米特法则</p></li> <li><p>面向对象的 S.O.L.I.D 原则</p></li> <li><p>Single Responsibility Principle (SRP) – 职责单一原则：一个类，只做一件事，并把这件事做好，其只有一个引起它变化的原因。</p></li> <li><p>Open/Closed Principle (OCP) – 开闭原则：模块是可扩展的，而不可修改的。也就是说，对扩展是开放的，而对修改是封闭的。</p></li> <li><p>愚者困惑，智者提问。</p></li> <li><p>代码胜于雄辩。——林纳斯•托瓦兹</p></li> <li><p>每名程序员都是作家。</p></li> <li><p>我拒绝做计算机能够胜任的事情。</p></li> <li><p>拙劣的程序员担心代码。好的程序员担心数据结构及它们的关系。——林纳斯•托瓦兹</p></li> <li><p>程序有问题时不要担心。如果所有东西都没问题，你就失业了。</p></li> <li><p>注释代码很像清洁你的厕所——你不想干，但如果你做了，这绝对会给你和你的客人带来更愉悦的体验。</p></li> <li><p>Knowledge is power. – Francis Bacon</p></li> <li><p>Make it work, make it right, make it fast. – Kent Beck</p></li> <li><p>任何一个傻瓜都会写能够让机器理解的代码，只有好的程序员才能写出人类可以理解的代码。——Martin Fowler</p></li> <li><p>这不是一个 bug，这只是一个未列出来的特性。——匿名</p></li> <li><p>作为一个程序员，郁闷的事情是，面对一个代码块，却不敢去修改。更糟糕的是，这个代码块还是自己写的。—— Peyton Jones</p></li> <li><p>优秀的判断力来自经验，但经验来自于错误的判断。——Fred Brooks</p></li> <li><p>软件工程的目标是控制复杂度，而不是增加复杂性。——Dr. Pamela Zave</p></li> <li><p>计算机科学中的所有问题都可以通过另一种间接的方式来解决"。-- David Wheeler；但通常会产生另一个问题 -- David Wheeler</p></li> <li><p>简单是可靠性的先决条件。-- Edsger Dijkstra</p></li> <li><p>如果我们希望计算代码行，则不应将它们视为‘产生的行’，而是看作‘花费的行’。-- Edsger Dijkstra</p></li> <li><p>不要重复自己。每一项知识必须有一个单一的，明确的，权威的系统中的表示形式。 — Andy Hunt and Dave Thomas</p></li> <li><p>代码永远不会说谎；代码注释有时会。 - Ron Jeffries</p></li></ol>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[10 倍程序员] ⭐ 脚本的魅力，内含 js 写爬虫、python 骚操作等实用代码]]></title>
            <link>https://tech.codelc.com/docs/10x/script.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/10x/script.html</guid>
            <pubDate>Mon, 06 Dec 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h2 id="零、内容简介">零、内容简介</h2> <p>将脚本用好能给工作带来事半功倍的效果，本文的内容主要涉及三个脚本工具：<code>js</code>、<code>awk</code>、<code>python</code>， 主题如下：</p> <ul><li>使用 <code>js</code> 在浏览器控制台写爬虫。</li> <li>使用 <code>shell</code> 统计数据。</li> <li>使用 <code>python</code> 进行 <code>redis</code>、<code>rabbitmq</code> 运维。</li> <li>使用 <code>python</code> 生成 <code>mysql 数据字典</code>。</li></ul> <p>话不多说，直接进入主题。</p> <h2 id="一、使用-js-在浏览器控制台写爬虫">一、使用 js 在浏览器控制台写爬虫</h2> <h3 id="_1-1-抓取数据">1.1 抓取数据</h3> <p>使用 js 在浏览器控制台写爬虫的优势是不需要模拟浏览器请求、登录信息、基本不会被反爬虫技术禁止访问等，劣势是数据不易保存，如果爬虫是一次性的，且抓取的数据不多，使用 js 可以在几分钟就写好爬虫，至于获取的数据可以采取复制为 json 的方式导出，json 数据可以再进一步转换为易于阅读的 excel 等数据，读完这个章节你将掌握如何把复杂 json 转换为 excel 平面数据。</p> <p>下面以获取某网站 gitlab 合并请求数据为例讲解整个数据抓取流程。</p> <p>需求是获取所有 gitlab 项目的合并请求数据，项目 id 列表事先已经知道，代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 项目id</span>

<span class="token keyword">var</span> mrs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 数据结果</span>

<span class="token keyword">function</span> <span class="token function">mr</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&lt;</span> ids<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span>
      <span class="token string">"https://xxx.com/gitlab/projects/"</span> <span class="token operator">+</span>
        ids<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">+</span>
        <span class="token string">"/getMergeRequests?order_by=updated_at&amp;page=1&amp;per_page=100&amp;state=all"</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">"same-origin"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">"success"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          mrs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>r<span class="token punctuation">.</span>result<span class="token punctuation">.</span>merge_requests<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ids<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">" failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">mr</span><span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 为了让请求串行执行，所以这里采用回调递归调用</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">mr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开始抓取</span>
</code></pre></div><p>短短几行代码就完成了数据的抓取，整个编码过程只需要 <code>5</code> 分钟左右。</p> <p>抓取之后，数据都存储在 mrs 变量中，直接在控制台输入 <code>mrs</code> ，右键选择拷贝 json 数据，新建一个 <code>mrs.json</code> 文件将其保存起来即可。</p> <h3 id="_1-2-转换数据">1.2 转换数据</h3> <p>接下来将 json 数据转换为 excel。</p> <p>方案 1，使用 <code>pandas</code>：</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> pandas
pandas<span class="token punctuation">.</span>read_json<span class="token punctuation">(</span><span class="token string">"mrs.json"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">"mrs.xlsx"</span><span class="token punctuation">)</span>
</code></pre></div><p>如果数据结构是下面这类简单 json 使用这两行脚本即可。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"标题"</span><span class="token punctuation">,</span>
    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"内容"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>若数据结构较复杂，列表对象中含有子对象，例如：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"标题"</span><span class="token punctuation">,</span>
    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"内容"</span><span class="token punctuation">,</span>
    <span class="token property">"detail"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"createBy"</span><span class="token operator">:</span> <span class="token string">"张三"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>此时需要编码展开子对象，我们这里使用方案 2。</p> <p>方案 2，使用 excel 导入 + <code>Power Query M 公式语言</code>转换数据。</p> <ol><li><p>首先导入 JSON 数据。</p> <p><img src="https://tech.codelc.com/assets/img/mrs_excel.1c0b718c.png" alt="excel导入"></p></li> <li><p>在 Power Query 的高级编辑器中，修改 <code>Power Query M 公式语言</code> 脚本展开 json 数据。</p></li></ol> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">let</span> responseJson <span class="token operator">=</span> Json<span class="token punctuation">.</span><span class="token function">Document</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Contents</span><span class="token punctuation">(</span><span class="token string">"D:\mrs.json"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
headers <span class="token operator">=</span>
 <span class="token keyword">let</span>
 allHeaders <span class="token operator">=</span> List<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span><span class="token function">Transform</span><span class="token punctuation">(</span>responseJson<span class="token punctuation">,</span> Record<span class="token punctuation">.</span>FieldNames<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 uniqueHeaders <span class="token operator">=</span> List<span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span>allHeaders<span class="token punctuation">)</span>
 <span class="token keyword">in</span>
 uniqueHeaders<span class="token punctuation">,</span>
 testTable <span class="token operator">=</span> Table<span class="token punctuation">.</span><span class="token function">FromRecords</span><span class="token punctuation">(</span>responseJson<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> MissingField<span class="token punctuation">.</span>UseNull<span class="token punctuation">)</span>
 <span class="token keyword">in</span>
 testTable
</code></pre></div><p>这样就完成了数据的转换，后续再生成数据图表或导入数据库都非常方便。</p> <p>这部分内容的重点在于要灵活使用各种工具以快速得到想要的结果。</p> <h2 id="二、使用-shell-统计数据">二、使用 shell 统计数据</h2> <p>需求：在上百个 Java 代码仓库中统计单元测试方法的数量。</p> <p>我们以这个例子来看看 <code>awk</code> 的用法。</p> <p>说明：这个统计方法只是简单查看单元测试方法数量，不涉及单元测试覆盖率等。</p> <p>步骤如下：</p> <ol><li><p>首先本地含有所有的代码仓库，cd 到代码仓库根目录。</p></li> <li><p>使用以下命令统计每个仓库的单元测试方法数量。</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">find</span> <span class="token builtin class-name">.</span> -name <span class="token string">'*Test.java'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">grep</span> -i <span class="token string">'@Test[^a-z]'</span> <span class="token operator">|</span> <span class="token function">awk</span> -F / <span class="token string">'{count[$3]++;} END {for(i in count) {print i,count[i]}}'</span> <span class="token operator">|</span> clip.exe
</code></pre></div><p>注意：该命令运行在 <code>WSL</code>，所以可以在管道命令中包含 windows 命令。</p> <p>命令说明：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">find</span> <span class="token builtin class-name">.</span> -name <span class="token string">'*Test.java'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">grep</span> -i <span class="token string">'@Test[^a-z]'</span>
</code></pre></div><p>找到所有 Test.java 结尾的文件，在文件中查找仅包含 @Test 的行，这一步的输出结果如下：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>./project/repository1/module/src/.../xxx.java: @Test
./project/repository2/module/src/.../xxx.java: @Test
./project/repository3/module/src/.../xxx.java: @Test
...
</code></pre></div><p>根据这个数据模式，再使用 awk 编写脚本进行数据分析。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">awk</span> -F / <span class="token string">'{count[$3]++;} END {for(i in count) {print i,count[i]}}'</span>
</code></pre></div><p>awk 脚本中指定 / 为分隔符，第三位为仓库名称，使用仓库名称进行分组，最后输出仓库名称和分组数量。</p> <p>输出结果：</p> <div class="language-txt extra-class"><pre class="language-txt"><code>repository1 5
repository2 10
repository3 7
...
</code></pre></div><p>最后我们利用管道 <code>| clip.exe</code> 将其拷贝到剪切板，再导入 excel 即可。</p> <h2 id="三、使用-python-进行-redis、rabbitmq-运维">三、使用 python 进行 redis、rabbitmq 运维</h2> <h3 id="_3-1-扫描-redis">3.1 扫描 redis</h3> <p>当 redis 内存过期速度赶不上内存增长，会导致 redis 内存占用越来越大，我们可以调整 redis 清理频率，也可以手动扫描 redis 来触发内存清理。</p> <p>使用 python 执行以下代码即可，真是 <code>人生苦短，我用 python</code>。</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> redis
r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span><span class="token punctuation">)</span>
t <span class="token operator">=</span> r<span class="token punctuation">.</span>scan<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> r<span class="token punctuation">.</span>scan<span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-2-rabbitmq-消息队列转发">3.2 rabbitmq 消息队列转发</h3> <p>rabbitmq 上有消息队列转发的插件，但如果是云服务，通常无法使用该插件，此时用 python 写点转发脚本也是易事。</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> pika

connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'ip'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5672</span><span class="token punctuation">,</span> virtual_host<span class="token operator">=</span><span class="token string">'/'</span><span class="token punctuation">,</span> credentials<span class="token operator">=</span>pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">'account'</span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">backcall</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 转发</span>
    channel<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'exchange'</span><span class="token punctuation">,</span> routing_key<span class="token operator">=</span><span class="token string">'routing_key'</span><span class="token punctuation">,</span> body<span class="token operator">=</span>body<span class="token punctuation">)</span>

channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span><span class="token string">'原队列'</span><span class="token punctuation">,</span>backcall<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

channel<span class="token punctuation">.</span>start_consuming<span class="token punctuation">(</span><span class="token punctuation">)</span>
connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="四、使用-python-生成-mysql-数据字典">四、使用 python 生成 mysql 数据字典</h2> <p>生成数据字典的工具有很多，但往往生成的数据字典不易修改，试试用 python 生成 markdown 格式的数据字典如何？</p> <div class="language-py extra-class"><pre class="language-py"><code><span class="token keyword">import</span> mysql<span class="token punctuation">.</span>connector
<span class="token keyword">import</span> importlib
<span class="token keyword">import</span> sys


<span class="token keyword">def</span> <span class="token function">generate</span><span class="token punctuation">(</span>database_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    生成数据库字典表
    """</span>
    importlib<span class="token punctuation">.</span><span class="token builtin">reload</span><span class="token punctuation">(</span>sys<span class="token punctuation">)</span>

    <span class="token comment"># 使用前修改配置</span>
    conn <span class="token operator">=</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
        host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
        port<span class="token operator">=</span><span class="token string">'3306'</span><span class="token punctuation">,</span>
        user<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
        password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
        use_pure<span class="token operator">=</span><span class="token boolean">True</span>
    <span class="token punctuation">)</span>

    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
        <span class="token string">"SELECT TABLE_NAME, TABLE_COMMENT FROM information_schema.TABLES WHERE table_type='BASE TABLE' AND TABLE_SCHEMA='%s'"</span> <span class="token operator">%</span> database_name
    <span class="token punctuation">)</span>

    tables <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

    markdown_table_header <span class="token operator">=</span> <span class="token triple-quoted-string string">"""\n\n\n### %s (%s) \n| 序号 | 字段名称 | 数据类型 | 是否为空 | 字段说明 |\n| :--: |----| ---- | ---- | ---- |\n"""</span>
    markdown_table_row <span class="token operator">=</span> <span class="token triple-quoted-string string">"""| %s | %s | %s | %s | %s |"""</span>

    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'dict/'</span><span class="token operator">+</span>database_name <span class="token operator">+</span> <span class="token string">'.md'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> table <span class="token keyword">in</span> tables<span class="token punctuation">:</span>

        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
            <span class="token string">"SELECT ORDINAL_POSITION, COLUMN_NAME, COLUMN_TYPE, IS_NULLABLE, COLUMN_COMMENT "</span>
            <span class="token string">"FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='%s' AND TABLE_NAME='%s'"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
                database_name<span class="token punctuation">,</span> table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        tmp_table <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        p <span class="token operator">=</span> markdown_table_header <span class="token operator">%</span> <span class="token punctuation">(</span>table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> remove_newline<span class="token punctuation">(</span>table<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> col <span class="token keyword">in</span> tmp_table<span class="token punctuation">:</span>
            colf <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>col<span class="token punctuation">)</span>
            colf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>col<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># mysql 高级版本需要解码，代码有点丑，临时性的，能用就行</span>
            colf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>col<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
            p <span class="token operator">+=</span> <span class="token punctuation">(</span>remove_newline<span class="token punctuation">(</span>markdown_table_row <span class="token operator">%</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>colf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">remove_newline</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    去除文本中的换行符号
    """</span>
    <span class="token keyword">return</span> text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    conn <span class="token operator">=</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
        host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
        port<span class="token operator">=</span><span class="token string">'3306'</span><span class="token punctuation">,</span>
        user<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
        password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
        use_pure<span class="token operator">=</span><span class="token boolean">True</span>
    <span class="token punctuation">)</span>

    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SHOW DATABASES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    dbs <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> db <span class="token keyword">in</span> dbs<span class="token punctuation">:</span>
        generate<span class="token punctuation">(</span>db<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="五、后记">五、后记</h2> <p>本篇文章内容比较杂，这些脚本不能说非常优美，但写起来确实是非常的高效，能够快速地完成需求，当我们把这些工具掌握的同时，偶尔发挥下想象力，必然能够体会到编程的乐趣和代码的魅力。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[MySQL 数据库开发规范]]></title>
            <link>https://tech.codelc.com/docs/db/mysql_standard.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/db/mysql_standard.html</guid>
            <pubDate>Tue, 21 Sep 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h2 id="一、前言">一、前言</h2> <h3 id="_1-目的">1. 目的</h3> <p>本文档旨在为使用 MySQL 数据库的应用和系统提供统一规范参考，标准化 MySQL 数据库的开发使用及SQL优化流程，提高业务开发系统的规范性和代码的可读性，减轻维护工作量，提高工作效率。</p> <p>本文档的规范内容除命名约定外，许多理念也适用于其他关系型数据库。</p> <h3 id="_2-适用范围">2. 适用范围</h3> <ul><li>MySQL 数据库开发设计人员</li> <li>数据库管理人员</li> <li>运维人员</li> <li>数据分析人员</li> <li>研发人员</li> <li>架构师</li></ul> <h3 id="_3-规范说明">3. 规范说明</h3> <p>以下所有规范会按照【强制】、【建议】两个级别进行标注，遵守优先级从高到低，未标注的默认为【建议】级别。</p> <h2 id="二、数据库设计规范">二、数据库设计规范</h2> <p>用于规范数据库对象的设计，如数据库（DATABASE）、表（TABLE）、索引（INDEX） 等的设计约定。</p> <h3 id="_1-原则">1. 原则</h3> <ol><li>【强制】命名建议使用具有意义的英文词汇，词汇中间以下划线分隔。</li> <li>【强制】命名只能使用英文字母、数字、下划线。</li> <li>【强制】避免用 MySQL 的保留字如：group，order 等作为单个字段名。</li> <li>【强制】所有数据库对象使用小写字母。</li></ol> <h3 id="_2-数据库设计">2. 数据库设计</h3> <ol><li>【强制】遵守以上全部一般命名规则。</li> <li>【强制】使用单数。</li> <li>【建议】库的名称格式：业务系统名称_子系统名。建议按照业务、产品线或者其它指标进行区分，一般不要超过 20 个字符。如：临时库（tmp_crm）、测试库（test_crm）、产品中心主数据库（product_main）、产品中心应用打包（product_apk）。</li> <li>【强制】一般分库名称命名格式是<code>库通配名_编号</code>，编号从 0 开始递增，比如 <code>northwind_001</code>，以时间进行分库的名称格式是<code>库通配名_时间</code>。</li> <li>【强制】创建数据库时必须显式指定字符集，并且字符集只能是 utf8 或者 utf8mb4（优先使用）。创建数据库 SQL 举例：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>create database db_name default character set utf8mb4;
</code></pre></div><h3 id="_3-表设计">3. 表设计</h3> <ol><li>【强制】遵守以上全部一般命名规则。</li> <li>【强制】使用单数。</li> <li>【强制】相关模块的表名与表名之间尽量体现 join 的关系，如 <code>user</code> 表和 <code>user_login</code> 表。</li> <li>【强制】创建表时必须显式指定字符集为 utf8 或 utf8mb4。</li> <li>【强制】创建表时必须显式指定表存储引擎类型，如无特殊需求，一律为 InnoDB。当需要使用除 InnoDB/MyISAM/Memory 以外的存储引擎时，必须通过 DBA 审核才能在生产环境中使用。因为 InnoDB 表支持事务、行锁、宕机恢复、MVCC 等关系型数据库重要特性，为业界使用最多的 MySQL 存储引擎。而这是其它大多数存储引擎不具备的，因此首推 InnoDB。</li> <li>【强制】建表必须有 comment。</li> <li>【强制】关于主键：命名为 <code>id</code>，类型为 int 或 bigint，且为 <code>auto_increment</code>；</li> <li>【建议】核心表（如用户表，金钱相关的表）必须有行数据的创建时间字段 <code>create_time</code> 和最后更新时间字段 <code>update_time</code>，便于排查问题，后台系统所维护得表还需要有 <code>create_account</code> 和 <code>update_account</code> 字段，account 为管理账号，与 smart-sso 中的 account 命名保持一致。</li> <li>【建议】表中所有字段尽量使用 <code>NOT NULL</code> 属性，除非 <code>NULL</code> 含有明确含义，因为使用 <code>NULL</code> 值会存在每一行都会占用额外存储空间、数据迁移容易出错、聚合函数计算结果偏差等问题。</li> <li>【建议】尽量不要定义 <code>DEFAULT</code> 值，因为业务逻辑下放到了数据库层面，这是一种隐式行为，不利于开发和维护。</li> <li>【建议】建议对表里的 <code>blob</code>、<code>text</code> 等大字段，垂直拆分到其它表里，仅在需要读这些对象的时候才去 select。</li> <li>【建议】反范式设计：当数据不怎么变化时，把经常需要 join 查询的字段，在其它表里冗余一份。如 <code>username</code> 属性在 <code>user_account</code>，<code>user_login_log</code> 等表里冗余一份，减少 join 查询。</li> <li>【强制】中间表用于保留中间结果集，名称必须以 <code>tmp_</code> 开头。备份表用于备份或抓取源表快照，名称必须以 <code>bak_</code> 开头。中间表和备份表定期清理。</li> <li>【强制】对于超过 100W 行的大表进行 <code>alter table</code>，必须经过 DBA 审核，并在业务低峰期执行。因为 <code>alter table</code> 会产生表锁，期间阻塞对于该表的所有写入，对于业务可能会产生极大影响。</li> <li>【强制】日志类型的表，应该从主数据库中分离出来，放入专门的数据库，并且做好数据清理或归档方案。</li></ol> <h3 id="_4-字段设计">4. 字段设计</h3> <ol><li><p>【强制】字段命名需要表示其实际含义的英文单词或简写；</p></li> <li><p>【建议】建议各表之间相同意义的字段应同名；</p></li> <li><p>【强制】字段需添加注释，枚举型需指明主要值的含义，如“0 - 离线，1 - 在线”；</p></li> <li><p>【强制】布尔值列命名为 <code>is_描述</code> 。如 member 表上表示为 enabled 的会员的列命名为 is_enabled；</p></li> <li><p>【建议】字段名不建议超过 30 个字符，字段个数不建议大于 60。</p></li> <li><p>【强制】避免使用保留字，如 order、from、desc 等，请参考官方保留字。</p></li> <li><p>【强制】小数类型为 decimal，禁止使用 float 和 double。</p> <p>说明：在存储的时候，float 和 double 都存在精度损失的问题，很可能在比较值的时候，得到不正确的结果。如果存储的数据范围超过 decimal 的范围，建议将数据拆成整数和小数并分开存储。</p></li> <li><p>【强制】如果存储的字符串长度几乎相等，使用 char 定长字符串类型。</p></li> <li><p>【强制】varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索引效率。</p></li> <li><p>【推荐】表的命名最好是加上“业务名称_表的作用”。</p> <p>正例：alipay_task / force_project / trade_config</p></li> <li><p>【推荐】库名与应用名称尽量一致。</p></li> <li><p>【推荐】如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释。</p></li> <li><p>【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致。冗余字段应遵循：</p> <p>1）不是频繁修改的字段。</p> <p>2）不是varchar超长字段，更不能是text字段。</p> <p>正例：商品类目名称使用频率高，字段长度短，名称基本一成不变，可在相关联的表中冗余存储类目名称，避免关联查询。</p></li> <li><p>【推荐】单表行数超过500万行或者单表容量超过2GB，才推荐进行分库分表。</p> <p>说明：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。</p></li> <li><p>【参考】合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检索速度。</p> <p>正例：如下表，其中无符号值可以避免误存负数，且扩大了表示范围。</p> <table><thead><tr><th><strong>对象</strong></th> <th><strong>年龄区间</strong></th> <th><strong>类型</strong></th> <th><strong>字节</strong></th></tr></thead> <tbody><tr><td>人</td> <td>150岁之内</td> <td>unsigned tinyint</td> <td>1</td></tr> <tr><td>龟</td> <td>数百岁</td> <td>unsigned smallint</td> <td>2</td></tr> <tr><td>恐龙化石</td> <td>数千万岁</td> <td>unsigned int</td> <td>4</td></tr> <tr><td>太阳</td> <td>约50亿年</td> <td>unsigned bigint</td> <td>8</td></tr></tbody></table></li></ol> <h3 id="_5-索引设计">5. 索引设计</h3> <ol><li>【强制】主键索引：pk_[表名称或简写]_[字段名或简写]。</li> <li>【强制】唯一索引：uk_[表名称或简写]_[字段名或简写]。</li> <li>【强制】普通索引：idx_[表名称或简写]_[字段名或简写]。</li> <li>多单词组成的 column_name，取尽可能有代表意义的缩写。</li> <li>【强制】选择区分度大的列建立索引，不在低基数列上建立索引，例如：“性别”，“是否是 XXX”。</li> <li>单张表的索引数量控制在 5 个以内，避免冗余索引。</li> <li>索引中的字段数建议不超过 5 个。</li> <li>唯一索引建议由 3 个或更少的字段组成。</li> <li>尽量不要在频繁更新的列上创建索引。</li> <li>对于确定需要组成组合索引的多个字段，建议将选择性高的字段靠前放。</li> <li>最左前缀原则，使用联合索引时，从左向右匹配，比如索引 idx_c1_c2_c3 (c1,c2,c3，)相当于创建了 (c1)、(c1,c2)、(c1,c2,c3) 三个索引，where 条件包含上面三种情况的字段比较则可以用到索引，但像 where c1=a and c3=c 只能用到 c1 列的索引，像 c2=b and c3=c 等情况就完全用不到这个索引。</li> <li>很长的 VARCHAR 字段建立索引时，指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。 idx_table_name (name(10))</li> <li>定期删除一些长时间未使用过的索引。</li> <li>ORDER BY，GROUP BY，DISTINCT 的字段需要添加在索引的后面，形成覆盖索引。</li> <li>新的 select,update,delete 上线，都要先 explain，确保索引的正确性。</li> <li>不建议在 where 条件索引列上使用函数，会导致索引失效，如 lower(email)。</li> <li>使用 like 模糊匹配，% 不要放首位，会导致索引失效。</li></ol> <h3 id="_6-权限设计">6. 权限设计</h3> <p>生产环境需要调整 root 用户为强密码，且不对外开放。</p> <p>线上所需用户建议按照用户或者业务场景划分，根据实际情况对每个用户授予相应权限，例如：</p> <table><thead><tr><th><strong>序号</strong></th> <th><strong>用户名</strong></th> <th><strong>涵义</strong></th> <th><strong>用途</strong></th></tr></thead> <tbody><tr><td>1</td> <td>root</td> <td>超级用户</td> <td>全局管理，禁止对外开放</td></tr> <tr><td>2</td> <td>dba</td> <td>数据库管理员</td> <td>数据库 DBA</td></tr> <tr><td>3</td> <td>app</td> <td>应用开发</td> <td>应用开发</td></tr> <tr><td>4</td> <td>developer</td> <td>开发者</td> <td>开发环境使用</td></tr> <tr><td>5</td> <td>tempuser</td> <td>临时统计</td> <td>线上业务临时统计，只读用户</td></tr> <tr><td>6</td> <td>other</td> <td>其他用户</td> <td>第三方人员访问</td></tr></tbody></table> <h2 id="三、数据模型设计">三、数据模型设计</h2> <p>数据库模型设计是指对于一个给定的应用环境，构造合理的数据库模式，建立数据库及其应用系统，有效存储数据，满足用户信息要求和处理要求。数据库设计在开发过程中处于一个非常重要的地位。一个高效的数据库模型是非常重要和必要的。</p> <h3 id="_1-完整性">1. 完整性</h3> <p>数据库完整性是指数据库中数据的正确性和相容性，数据库完整性是由完整性约束来保证的，数据库完整性对于数据库应用系统非常关键，其作用主要体现在以下几个方面：</p> <ul><li>利用完整性控制机制来实现业务规则，易于定义，容易理解，而且可以降低应用程序的复杂性，提高应用程序的运行效率。</li> <li>合理的数据库完整性设计，能够同时兼顾数据库的完整性和系统的效能。在应用软件的功能测试中，完善的数据库完整性有助于尽早发现应用软件的错误。</li> <li>为了在数据库和应用程序代码之间提供另一层抽象，可以为应用程序建立专门的视图而不必非要应用程序直接访问数据表。这样做还等于在处理数据库变更时给你提供了更多的自由。</li></ul> <h3 id="_2-性能">2. 性能</h3> <p>性能是衡量一个系统的关键因素，在设计阶段就在性能方面就应该多关注，尽量减少后期的烦恼。在数据库设计阶段，性能上的考虑时需要注意：不能以范式作为唯一标准或者指导，在设计过程中，需要从实际需求出发，以性能提升为根本目标来展开设计工作，一些时候为了提升性能，甚至会做反范式设计。</p> <p>另外还有一些设计上的方法和技巧：</p> <ul><li>设置合理的字段类型和长度。字段类型在满足需求后应尽量短，比如，能用int就尽量不要用 bigint。另外不同数据库在 varchar 和 text 类型在长度和性能上也是不同的，选择时要谨慎。</li> <li>选择高效的主键和索引。由于对表记录的读取都是直接或者间接地通过主键或索引来获取，因此应该该根据具体应用特性来设计合理的主键或索引。同时索引长度的也应该关注，尽量减少索引长度。</li> <li>适度冗余。适度的冗余可以避免关联查询，减少 join 查询。</li></ul> <h3 id="_3-扩展性">3. 扩展性</h3> <p>在大规模系统中，除了性能，可扩展性也是设计的关键点，而数据库表扩展性主要包含</p> <p>表逻辑结构、功能字段的增加、分表等。在扩展性上要把握的原则如下：</p> <ul><li>一表一实体。如果不同实体之间有关联时，可增加一个单独的表，不会影响以前的功能。</li></ul> <h2 id="四、sql-开发规范">四、SQL 开发规范</h2> <h3 id="_1-sql-语句">1. SQL 语句</h3> <ol><li><p>【强制】不要使用count(列名)或count(常量)来替代count( <em>)，count(</em> )是SQL92定义的标准统计行数的语法，跟数据库无关，跟NULL和非NULL无关。</p> <p>说明：count(*)会统计值为NULL的行，而count(列名)不会统计此列为NULL值的行。</p></li> <li><p>【强制】count(distinct col) 计算该列除NULL之外的不重复行数，注意 count(distinct col1, col2) 如果其中一列全为NULL，那么即使另一列有不同的值，也返回为0。</p></li> <li><p>【强制】当某一列的值全是NULL时，count(col)的返回结果为0，但sum(col)的返回结果为NULL，因此使用sum()时需注意NPE问题。</p> <p>正例：可以使用如下方式来避免sum的NPE问题：</p> <p><code>SELECT IF(ISNULL(SUM(g)),0,SUM(g)) FROM table;</code></p></li> <li><p>【强制】使用<code>ISNULL()</code>来判断是否为NULL值。 说明：NULL与任何值的直接比较都为NULL。</p> <p>1） <code>NULL&lt;&gt;NULL</code>的返回结果是NULL，而不是<code>false</code>。</p> <p>2） <code>NULL=NULL</code>的返回结果是NULL，而不是<code>true</code>。</p> <p>3） <code>NULL&lt;&gt;1</code>的返回结果是NULL，而不是<code>true</code>。</p></li> <li><p>【强制】 在代码中写分页查询逻辑时，若count为0应直接返回，避免执行后面的分页语句。</p></li> <li><p>【强制】不得使用外键与级联，一切外键概念必须在应用层解决。</p> <p>说明：以学生和成绩的关系为例，学生表中的student_id是主键，那么成绩表中的student_id则为外键。如果更新学生表中的student_id，同时触发成绩表中的student_id更新，即为级联更新。外键与级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度。</p></li> <li><p>【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</p></li> <li><p>【强制】数据订正（特别是删除、修改记录操作）时，要先select，避免出现误删除，确认无误才能执行更新语句。</p></li> <li><p>【推荐】in操作能避免则避免，若实在避免不了，需要仔细评估in后边的集合元素数量，控制在1000个之内。</p></li> <li><p>【参考】如果有全球化需要，所有的字符存储与表示，均以utf-8编码，注意字符统计函数的区别。</p> <p>说明：</p> <p><code>SELECT LENGTH("轻松工作")</code> 返回为12</p> <p><code>SELECT CHARACTER_LENGTH("轻松工作")</code> 返回为4</p> <p>如果需要存储表情，那么选择utf8mb4来进行存储，注意它与utf-8编码的区别。</p></li> <li><p>【参考】 TRUNCATE TABLE 比 DELETE 速度快，且使用的系统和事务日志资源少，但TRUNCATE无事务且不触发trigger，有可能造成事故，故不建议在开发代码中使用此语句。</p> <p>说明：TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同。</p></li> <li><p>【建议】查询列表时若不含有分页和条件参数，建议增加 limit 参数，限制结果集数量，避免出现 OOM。</p></li> <li><p>【强制】分页查询时若页数量参数可由客户端提供，必须限制 <code>pageSize</code> 最大值。</p></li></ol> <h3 id="_2-dml-语句">2. DML 语句</h3> <ol><li>【强制】select 语句必须指定具体字段名称，禁止写成 <code>*</code>。因为 <code>select *</code> 会将不该读的数据也从 MySQL 里读出来，造成 I/O 压力。</li> <li>【强制】insert 语句指定具体字段名称，不要写成 <code>insert into t1 values(…)</code>，道理同上。</li> <li>【建议】<code>insert into … values(xx),(xx),(xx)…</code>，这里 xx 的值不要超过 5000 个。值过多虽然上线很快，但会引起主从同步延迟。</li> <li>【建议】select 语句不要使用 <code>union</code>，推荐使用 <code>union all</code>，并且 <code>union</code> 子句个数限制在 5 个以内。因为 <code>union all</code> 不需要去重，节省数据库资源，提高性能。</li> <li>【建议】in 值列表限制在 500 以内。例如 <code>select … where user_id in(…500 个以内…)</code>，这么做是为了减少底层扫描，减轻数据库压力从而加速查询。</li> <li>【建议】事务里批量更新数据需要控制数量，进行必要的 sleep，做到少量多次。</li> <li>【强制】事务涉及的表必须全部是 InnoDB 表。否则一旦失败不会全部回滚，且易造成主从库同步终端。</li> <li>【强制】写入和事务发往主库，只读 SQL 发往从库。</li> <li>【强制】除静态表或小表（100 行以内），dml 语句必须有 where 条件，且使用索引查找。</li> <li>【建议】生产环境避免使用 <code>hint</code>，如 <code>sql_no_cache</code>，<code>force index</code>，<code>ignore key</code>，<code>straight join</code> 等。因为 <code>hint</code> 是用来强制 sql 按照某个执行计划来执行，但随着数据量变化我们无法保证自己当初的预判是正确的，临时性的优化可以使用 <code>hint</code>，后期需要将语句优化成合适状态。</li> <li>【强制】where 条件里等号左右字段类型必须一致，否则会引起类型转化，且可能导致索引失效。</li> <li>【建议】<code>select|update|delete|replace</code> 要有 where 子句，且 where 子句的条件必需使用索引查找。</li> <li>【强制】生产数据库中强烈不推荐大表上发生全表扫描，但对于 100 行以下的静态表可以全表扫描。查询数据量不要超过表行数的 25%，否则不会利用索引。</li> <li>【强制】where 子句中禁止只使用全模糊的 like 条件进行查找，必须有其它等值或范围查询条件，否则无法利用索引。</li> <li>【建议】索引列不要使用函数或表达式，否则无法利用索引。如 <code>where length(name) = 'admin'</code> 或 <code>where user_id + 2 = 10023</code>。</li> <li>【建议】分页查询，当 <code>limit</code> 起点较高时，可先用过滤条件进行过滤。如 <code>select a, b, c from t1 limit 10000, 20;</code> 优化为: <code>select a, b, c from t1 where id &gt; 10000 limit 20;</code>。</li></ol> <h3 id="_3-多表连接">3. 多表连接</h3> <ol><li>【强制】禁止跨 DB 的 join 语句。因为这样可以减少模块间耦合，为数据库拆分奠定坚实基础。</li> <li>【建议】不要在业务的更新类 SQL 语句中使用 join，比如 <code>update t1 join t2 …</code>。</li> <li>【建议】不建议使用子查询，建议将子查询 SQL 拆开结合程序多次查询，或使用 join 来代替子查询。</li> <li>【建议】线上环境，多表 join 不要超过 3 个表。</li> <li>【建议】多表连接查询推荐使用别名，且 select 列表中要用别名引用字段，数据库.表格式，如 <code>select a from db1.table1 alias1 where …</code>。</li> <li>【建议】在多表 join 中，尽量选取结果集较小的表作为驱动表，来 join 其它表。</li></ol> <h3 id="_4-事务">4. 事务</h3> <ol><li>【建议】事务中 <code>insert|update|delete|replace</code> 语句操作的行数控制在 2000 以内，以及 where 子句中 in 列表的传参个数控制在 500 以内。</li> <li>【建议】批量操作数据时，需要控制事务处理间隔时间，进行必要的 sleep，一般建议值 5-10 秒。</li> <li>【建议】对于有 <code>auto_increment</code> 属性字段的表的插入操作，并发需要控制在 200 以内。</li> <li>【强制】程序设计必须考虑“数据库事务隔离级别”带来的影响，包括脏读、不可重复读和幻读。线上建议事务隔离级别为 <code>repeatable-read</code>。</li> <li>【建议】事务里包含 SQL 不超过 5 个（支付业务除外）。因为过长的事务会导致锁数据较久，MySQL 内部缓存、连接消耗过多等雪崩问题。</li> <li>【建议】事务里更新语句尽量基于主键或 <code>unique key</code>，如 <code>update … where id = XX;</code>，否则会产生间隙锁，内部扩大锁定范围，导致系统性能下降，产生死锁。</li> <li>【建议】尽量把一些典型外部调用移出事务，如调用 Web Service，访问文件存储等，从而避免事务过长。</li> <li>【建议】对于 MySQL 主从延迟严格敏感的 select 语句，请开启事务强制访问主库。</li></ol> <h3 id="_5-dao-层注意事项">5. DAO 层注意事项</h3> <ol><li><p>【强制】在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。</p> <p>说明：1）增加查询分析器解析成本。2）增减字段容易与resultMap配置不一致。</p></li> <li><p>【强制】POJO类的布尔属性不能加is，而数据库字段必须加is_，要求在resultMap中进行字段与属性之间的映射。</p></li> <li><p>【强制】<code>开发客户端接口</code>时不要用 DO 类当返回参数，即使所有类属性名与数据库字段一一对应，也需要定义；反过来，每一个表也必然有一个与之对应。</p> <p>说明：配置映射关系，使字段与DO类解耦，方便维护。</p></li> <li><p>【强制】sql.xml配置参数使用：#{}，#param# 不要使用${} 此种方式容易出现SQL注入。</p></li> <li><p>【强制】iBATIS自带的queryForList(String statementName,int start,int size)不推荐使用。</p> <p>说明：其实现方式是在数据库取到statementName对应的SQL语句的所有记录，再通过subList取start,size的子集合。</p></li> <li><p>【强制】不允许直接拿HashMap与Hashtable作为查询结果集的输出。</p> <p>说明：resultClass=”Hashtable”，会置入字段名和属性值，但是值的类型不可控。</p></li> <li><p>【强制】更新数据表记录时，必须同时更新记录对应的 create_time 字段值为当前时间。</p></li> <li><p>【推荐】不要写一个大而全的数据更新接口。传入为POJO类，不管是不是自己的目标更新字段，都进行update table set c1=value1,c2=value2,c3=value3; 这是不对的。执行SQL时，不要更新无改动的字段，一是易出错；二是效率低；三是增加binlog存储。</p></li> <li><p>【参考】<code>@Transactional</code>事务不要滥用。事务会影响数据库的QPS，另外使用事务的地方需要考虑各方面的回滚方案，包括缓存回滚、搜索引擎回滚、消息补偿、统计修正等。</p></li> <li><p>【参考】<code>&lt;isEqual&gt;</code>中的compareValue是与属性值对比的常量，一般是数字，表示相等时带上此条件；<code>&lt;isNotEmpty&gt;</code>表示不为空且不为null时执行；<code>&lt;isNotNull&gt;</code>表示不为null值时执行。</p></li></ol> <h2 id="五、流程规范">五、流程规范</h2> <ol><li>【强制】数据库的 scheme 变动，需要进行版本控制，对每个数据库建立专门的 liquibase 或 flyway 项目进行 SQL 版本管理。</li> <li>【强制】在一个迭代中，开发阶段的第一个步骤为数据库设计，需要首先提交数据库版本控制代码的合并请求，合并通过后再进行接下来的功能开发。</li></ol>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[Java] 你还在统一返回 ApiResultBean 吗？✋ duck 不必，快来看 API 错误处理的最佳实践 ✔️]]></title>
            <link>https://tech.codelc.com/docs/java/api_error_handling.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/java/api_error_handling.html</guid>
            <pubDate>Thu, 08 Jul 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h2 id="为什么写这篇文章">为什么写这篇文章？</h2> <p>相信不少 Java 开发都在项目中使用过类似 <code>ApiResult</code> 这样的对象来包装 Api 返回类型，这相比什么都不包装有一定的好处，但这真的就是最好的做法吗？</p> <p>关于封装 ResultBean 对象，晓风轻在他的 <a href="https://xwjie.github.io/rule/controller.html" target="_blank" rel="noopener noreferrer">程序员你为什么这么累<span> </span></a> 系列文章中有过不错的分享，但统一封装 ResultBean 实际上也是一种重复工作，秉承 <code>DRY</code> 的理念，还有必要对其继续优化。</p> <p>统一返回 ApiResult 还不是最佳实践，必须不断思考优化，就像 React 所提倡的 <code>Rethinking Best Practices</code> 。</p> <h2 id="apiresult-现状">ApiResult 现状</h2> <p>我们先看一个常见的 ApiResult 对象，代码如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>好处：客户端可以使用统一的处理方式。</p> <p>存在的问题：</p> <ol><li>在统一返回 ApiResult 的情况下，即使是正常返回，也会带上 code、message 属性，<code>多数情况</code> 下属于 <code>冗余</code> 。</li> <li><code>Controller</code> 层代码存在重复，返回对象重复定义、包装调用编写重复，<code>代码整洁度下降</code> 。</li> <li>统一返回 200 状态码不利于 <code>请求监控</code> 。</li> <li>ApiResult 同时承担了Api结果和错误结果的职责，不符合 <code>单一职责</code> 原则。</li></ol> <p>像下面这样一段获取列表数据的代码，若不涉及业务预期内的请求验证，是没必要包装一层 ApiResult 的，什么是业务预期内的验证呢，举个例子，比如非会员无法获取列表，业务上需要提醒用户购买会员，这属于合法请求，此时仍然可以使用 ApiResult 携带 code 明确返回给客户端。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ApiResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Data</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ApiResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ApiResult 要根据业务场景使用，不需要每个场景都使用它。</p> <p>当 API 越来越多时，统一返回 ApiResult 的问题会被放大，如何解决这些问题呢？请接着看。</p> <h2 id="使用-http-状态码">使用 HTTP 状态码</h2> <p>有许多项目采用的方式是，在 API 调用成功时使用正常的数据模型，而在出现错误时，返回相应的 <code>HTTP 错误码</code> 和描述信息。我们看一段 <code>jhipster</code> 中的代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/authors/{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthorDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthorDTO</span><span class="token punctuation">&gt;</span></span> authorDTO <span class="token operator">=</span> authorService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResponseUtil</span><span class="token punctuation">.</span><span class="token function">wrapOrNotFound</span><span class="token punctuation">(</span>authorDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>主要 HTTP 状态码的含义：</p> <ul><li>1XX – Informational</li> <li>2XX – Success</li> <li>3XX – Redirection</li> <li>4XX – Client Error</li> <li>5XX – Server Error</li></ul> <p>采用 HTTP 状态码就不再需要统一返回 ApiResult ，但问题也随之而来，那就是 ApiResult 中定义的 <code>error code</code> 很难跟 HTTP 错误码一一对应，光有 HTTP 错误码和描述信息是不够的，还需要定义专门的错误模型。</p> <h2 id="api-错误模型">API 错误模型</h2> <p>如何定义一个好的 API 错误模型，这需要根据 <code>业务的复杂程度</code> 来定，我们先来看看几个 <code>Big Company</code> 都是怎么做的。</p> <p>先看 <code>twitter</code> 的，其中省略了无关的 HTTP 输出信息。</p> <div class="language-json extra-class"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">400</span> Bad Request

<span class="token punctuation">{</span><span class="token property">"errors"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">"code"</span><span class="token operator">:</span><span class="token number">215</span><span class="token punctuation">,</span><span class="token property">"message"</span><span class="token operator">:</span><span class="token string">"Bad Authentication data."</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre></div><p>使用了错误码，并且错误模型是一个数组，意味着可能会返回多个错误。</p> <p>再来看 <code>Facebook</code> 的 Graph API。</p> <div class="language-json extra-class"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span>

<span class="token punctuation">{</span>
  <span class="token property">"error"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Syntax error \"Field picture specified more than once. This is only possible before version 2.1\" at character 23: id,name,picture,picture"</span><span class="token punctuation">,</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"OAuthException"</span><span class="token punctuation">,</span>
    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">,</span>
    <span class="token property">"fbtrace_id"</span><span class="token operator">:</span> <span class="token string">"xxxxxxxxxxx"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意，其返回的是统一的 200 状态码，错误模型中还包含 <code>异常类型</code> 和 <code>trace_id</code>，这两个属性有助于排查错误。</p> <p>最后看看巨头微软 <code>Bing</code> 的错误模型。</p> <div class="language-json extra-class"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span>

<span class="token punctuation">{</span>
  <span class="token property">"SearchResponse"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2.2"</span><span class="token punctuation">,</span>
    <span class="token property">"Query"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"SearchTerms"</span><span class="token operator">:</span> <span class="token string">"api error codes"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"Errors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"Code"</span><span class="token operator">:</span> <span class="token number">1001</span><span class="token punctuation">,</span>
        <span class="token property">"Message"</span><span class="token operator">:</span> <span class="token string">"Required parameter is missing."</span><span class="token punctuation">,</span>
        <span class="token property">"Parameter"</span><span class="token operator">:</span> <span class="token string">"SearchRequest.AppId"</span><span class="token punctuation">,</span>
        <span class="token property">"HelpUrl"</span><span class="token operator">:</span> <span class="token string">"http\u003a\u002f\u002fmsdn.microsoft.com\u002fen-us\u002flibrary\u002fdd251042.aspx"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其返回的也是 200 状态码，但可以看到它使用了类似 ApiResult 的包装方式，并且还包含了 <code>输入信息</code>、<code>输入参数</code> 和 <code>帮助链接</code> ，原来这就是 <code>大佬</code> 的做事方式吗？</p> <p>果然 API 错误模型的设计，根据业务复杂程序的不同，实现起来也不太一样，这三个中，我们参考 <code>twitter 的 API 设计</code> 来看看在 <code>Spring</code> 项目中实现起来有哪些需要注意的，毕竟绝大多数项目的复杂度都达不到 FB 和 Bing 的程度。</p> <h2 id="spring-api-错误模型实战">Spring API 错误模型实战</h2> <p>错误模型的定义是非常简单的，代码如下。</p> <p>ErrorResponse.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorResponse</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ErrorDetail</span> error<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ErrorDetail.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorDetail</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> type<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>错误详情中增加了一个 <code>type</code> 属性，可以帮助更好地定位到异常。</p> <p>在 <code>Controller</code> 层编写时至需要返回正常的数据模型，如 <code>List、VO、DTO</code> 之类。</p> <p>异常使用 <code>AOP</code> 的方式来处理。</p> <p>编写一个 <code>ControllerAdvice</code> 类。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomExceptionHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">serverErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">ApiCode</span><span class="token punctuation">.</span>SYSTEM_EXCEPTION<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">serverErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">ApiCode</span> apiCode<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> apiCode<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//服务端异常需要记录日志</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//服务端异常使用api code中的message，避免敏感异常信息发送到客户端</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">errorResponse</span><span class="token punctuation">(</span>apiCode<span class="token punctuation">,</span> <span class="token class-name">ErrorMessageType</span><span class="token punctuation">.</span>API_CODE<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>INTERNAL_SERVER_ERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">requestErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">ApiCode</span> apiCode<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> apiCode<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//客户端请求错误只记录debug日志</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//客户端异常使用异常中的message</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token function">errorResponse</span><span class="token punctuation">(</span>apiCode<span class="token punctuation">,</span> <span class="token class-name">ErrorMessageType</span><span class="token punctuation">.</span>EXCEPTION<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>BAD_REQUEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">ErrorResponse</span> <span class="token function">errorResponse</span><span class="token punctuation">(</span><span class="token class-name">ApiCode</span> code<span class="token punctuation">,</span> <span class="token class-name">ErrorMessageType</span> messageType<span class="token punctuation">,</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ErrorDetail</span> errorDetail <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ErrorDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorDetail<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>messageType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ErrorMessageType</span><span class="token punctuation">.</span>API_CODE<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            errorDetail<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            errorDetail<span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        errorDetail<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span>exception<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ErrorResponse</span> errorResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ErrorResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errorResponse<span class="token punctuation">.</span><span class="token function">setError</span><span class="token punctuation">(</span>errorDetail<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> errorResponse<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">RequestVerifyException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">requestVerifyExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">RequestVerifyException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">requestErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">ApiCode</span><span class="token punctuation">.</span>PARAMETER_EXCEPTION<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>上面的代码只放了两个 <code>ExceptionHandler</code> ，一个是针对 <code>请求验证错误</code> ，一个是针对 <code>未知服务器错误</code> ，分别对应的是 <code>400</code> 和 <code>500</code> 的 HTTP 状态码。需要对其他异常做专门处理，也仍然是使用以上的公共 <code>errorResponse</code> 方法，就看异常被定义为 <code>请求异常</code> 还是 <code>服务端异常</code> 。</p> <p>至此，API 就能返回 <code>"漂亮"</code> 的错误模型了。</p> <h2 id="结束了吗">结束了吗？</h2> <p>先别走，还没结束呢，如果正常和错误情况下返回的数据模型不一样，那接口文档该如何定义呢？如果使用了 swagger ，那么我们需要添加针对 400 和 500 状态码的 <code>全局输出模型</code>。</p> <p>在最新版本的 <code>springfox</code> 中要实现起来还是有点费劲的，来看部分代码。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token class-name">TypeResolver</span> typeResolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//附加错误模型</span>
    <span class="token class-name">Docket</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span>swaggerProperties<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span>swaggerProperties<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">additionalModels</span><span class="token punctuation">(</span>typeResolver<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">ErrorResponse</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//添加400错误码输出模型</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Response</span><span class="token punctuation">&gt;</span></span> responseMessages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResponseBuilder</span> responseBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResponseBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    responseBuilder<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token string">"400"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>globalResponseMessageBody<span class="token punctuation">.</span><span class="token function">getModelRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        responseBuilder<span class="token punctuation">.</span><span class="token function">representation</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>rep <span class="token operator">-&gt;</span> rep<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>m <span class="token operator">-&gt;</span> m<span class="token punctuation">.</span><span class="token function">referenceModel</span><span class="token punctuation">(</span>
                re <span class="token operator">-&gt;</span> re<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>key<span class="token operator">-&gt;</span>key<span class="token punctuation">.</span><span class="token function">qualifiedModelName</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QualifiedModelName</span><span class="token punctuation">(</span><span class="token string">"com.package.api"</span><span class="token punctuation">,</span><span class="token string">"ErrorResponse"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    responseMessages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>responseBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    builder<span class="token punctuation">.</span><span class="token function">useDefaultResponseMessages</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">globalResponses</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">,</span> responseMessages<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">globalResponses</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">,</span> responseMessages<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以上仅为部分代码，主要在于 <code>需要附加模型</code> 并指定输出模型，在实际项目中应该将模型信息放在配置当中，根据配置自动添加，关于 swagger 的自动配置，若读者朋友感兴趣，可以有机会专门写篇文章来讲解。</p> <h2 id="写在最后">写在最后</h2> <p>在每个接口中返回统一的 ApiResult，笔者觉得是一件挺无聊的事情，写程序应该是一件能发挥创造力的事情。不断去思考最佳实践，学习优秀的设计，这件小小的事情，我们在工作当中几乎每天都会碰到，它是值得被改进的。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[Java] 高级工程师的自我修养之单元测试（一）：DAO 层测试]]></title>
            <link>https://tech.codelc.com/docs/java/unit_test.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/java/unit_test.html</guid>
            <pubDate>Wed, 07 Jul 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h2 id="开篇导读">开篇导读</h2> <p>对于程序员而言，单元测试是非常重要的一项技能，但在许多实际的项目开发过程中，单元测试却往往被忽略，这导致部分人也忽视其重要性，因此在开篇请允许笔者先唠叨几句关于它的重要性，若读者朋友对这部分内容已经了然于胸可直接前往 <code>DAO 层测试</code> 部分。</p> <p>关于编写单元测试的一些基础知识，我在这篇 <a href="https://github.com/lcomplete/TechShare/blob/master/docs/java/java%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.pptx" target="_blank" rel="noopener noreferrer">Java 单元测试<span> </span></a> PPT 中有过介绍，本系列文章不再赘述，而旨在讲解在企业级项目中该如何编写单元测试。</p> <p>这个系列计划编写三篇文章，DAO 层测试、业务逻辑层测试、高效编写测试。</p> <h3 id="为什么单元测试很重要">为什么单元测试很重要？</h3> <p>为什么说判断一个程序员是中级还是高级，看看 TA 会不会写单元测试就知道了，因为写单元测试不仅是写测试代码，往往还需要重新审视产品代码本身，必要的时候需要进行重构才能继续编写测试，在编写单元测试代码的过程中时刻都能体会到高内聚、低耦合的编程思想。写单元测试，其实是为对象模型添加了一个特殊用户，这个过程也迫使我们把对象模型设计的更加易用，总的说来编写单元测试可以加深对高内聚、低耦合、面向接口编程、依赖注入、API 设计、单一职责等<code>编程思想的掌握</code>，所以单元测试是如此重要，以至于可以很好地用来判断一个工程师的技术水平，或者至少用来判断其编程思想。</p> <h3 id="为什么单元测试难以实施">为什么单元测试难以实施?</h3> <p>很多小企业都难以实施单元测试，主要原因有：编写单元测试需要花费不少时间、单元测试并非想象中那样容易编写、开发人员对单元测试的理解不够全面等。还有一些更糟糕的情况，比如代码本身完成度不够，CRUD 功能背后缺少数据验证、服务端业务逻辑验证，系统本身就不堪一击，若要编写单元测试，需要做大量的代码改造工作，这种情况我愿称之为单元测试领域的「<code>戴维斯双杀</code>」效应——因为代码本身完成度低，原本完善的代码应当具有一定的复杂度，但在开发时却实现的极为简单，只满足了表面的功能，开发人员认为过于简单的代码没有编写单元测试的必要，导致产品代码质量下滑、对单元测试的理解扭曲的双重负循环。</p> <p>单元测试难以实施，总的可以归结为开发能力和产品质量文化的原因，对于想长期发展的企业来说，无疑是会注重这两个方面，因此大多数企业也在不断克服这些问题，提升工程师的能力，加强编写单元测试的质量和效率，同时还要树立正确的产品质量观念，要知道即使是付出了额外的编写单元测试的时间，总的时间成本也并不会增加，因为「<code>质量是免费的</code>」，产品质量提升了，用于排查问题、修复 bug 的时间自然变少了。</p> <p>在企业中注入产品质量文化，提升开发人员编写单元测试的能力，只要做到这些，实施单元测试也没有想象中困难。</p> <h2 id="单元测试基本原则">单元测试基本原则</h2> <p>首先要明确单元测试的一些基本原则，优秀的单元测试具有以下特点：</p> <ul><li>自动的、可重复的</li> <li>容易实现</li> <li>一旦写好，将来都可使用</li> <li>任何人都可运行</li> <li>单击一个按钮就可运行</li> <li>可以快速地运行</li></ul> <p>单元测试并非是随手写来验证功能的临时代码，而是需要符合 AIR 原则，所以编写起来是需要一定的功力的。</p> <p>关于 AIR 原则在阿里的 Java 规范中有提及，其他相关的规范也值得学习，我在这里引用方便读者朋友查看，完整的规范可在 Github 中查看，地址：<a href="https://github.com/alibaba/p3c/blob/master/p3c-gitbook/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95.md" target="_blank" rel="noopener noreferrer">p3c 单元测试<span> </span></a>。</p> <ol><li>【强制】好的单元测试必须遵守AIR原则。
<br><span style="color:orange;">说明</span>：单元测试在线上运行时，感觉像空气（AIR）一样并不存在，但在测试质量的保障上，却是非常关键的。好的单元测试宏观上来说，具有自动化、独立性、可重复执行的特点。</li></ol> <ul><li>A：Automatic（自动化）</li> <li>I：Independent（独立性）</li> <li>R：Repeatable（可重复）</li></ul> <ol start="2"><li>【强制】单元测试应该是全自动执行的，并且非交互式的。测试用例通常是被定期执行的，执行过程必须完全自动化才有意义。输出结果需要人工检查的测试不是一个好的单元测试。单元测试中不准使用System.out来进行人肉验证，必须使用assert来验证。</li> <li>【强制】保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间决不能互相调用，也不能依赖执行的先后次序。 <br><span style="color:red;">反例</span>：method2需要依赖method1的执行，将执行结果作为method2的输入。</li> <li>【强制】单元测试是可以重复执行的，不能受到外界环境的影响。
<br><span style="color:orange;">说明</span>：单元测试通常会被放到持续集成中，每次有代码check in时单元测试都会被执行。如果单测对外部环境（网络、服务、中间件等）有依赖，容易导致持续集成机制的不可用。 <br><span style="color:green;">正例</span>：为了不受外界环境影响，要求设计代码时就把SUT的依赖改成注入，在测试时用spring 这样的DI框架注入一个本地（内存）实现或者Mock实现。</li> <li>【强制】对于单元测试，要保证测试粒度足够小，有助于精确定位问题。单测粒度至多是类级别，一般是方法级别。
<br><span style="color:orange;">说明</span>：只有测试粒度小才能在出错时尽快定位到出错位置。单测不负责检查跨类或者跨系统的交互逻辑，那是集成测试的领域。</li> <li>【强制】核心业务、核心应用、核心模块的增量代码确保单元测试通过。
<br><span style="color:orange;">说明</span>：新增代码及时补充单元测试，如果新增代码影响了原有单元测试，请及时修正。</li></ol> <p>明确这些基本规范后，我们来开始动手编写单元测试。</p> <p>完善的单元测试，应该对项目的每一层级代码都进行测试，本篇文章我们从 DAO 层开始。</p> <h2 id="dao-层单元测试">DAO 层单元测试</h2> <p>DAO 层由于依赖数据库，是比较难以测试的，这个章节将为你提供一些 DAO 层的测试方法。</p> <p>以 MySQL 数据库为例，在运行 DAO 层的单元测试时，我们不能依赖外部的数据库，因为这会破坏 AIR 原则中的 I（独立性） 原则，要解除依赖有几种方式：</p> <ol><li>使用嵌入式数据库：h2、moby 等。</li> <li>使用 Testcontainers 在 docker 中创建专为单元测试使用的数据库，执行完即销毁。</li></ol> <h3 id="使用嵌入式数据库">使用嵌入式数据库</h3> <p>我们先看第一种方式，以 h2 为例。</p> <p>首先，在单元测试的应用配置 <code>application.yml</code> 中修改数据源为 h2。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.h2.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>h2<span class="token punctuation">:</span>mem<span class="token punctuation">:</span>ufo
</code></pre></div><p>如果我们使用的是 JPA 进行数据持久化，配置这些即可，JPA 会在 h2 数据库中自动创建数据库。</p> <p>若使用的是 MyBatis，则需要指定数据库的架构，增加以下配置，<code>data</code> 为数据初始化脚本。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">schema</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>db/schema<span class="token punctuation">-</span>h2.sql
    <span class="token key atrule">data</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>db/data<span class="token punctuation">-</span>h2.sql
</code></pre></div><p>假如我们的项目非常小，用这种方式就足够，但当数据库 <code>schema</code> 越来越庞大时，维护 sql 将变成一项耗时的工作，那么我们需要引入数据库的版本控制机制。</p> <h3 id="数据库版本控制">数据库版本控制</h3> <p>数据库版本控制可以使用 <code>flyway</code> 或者 <code>liquibase</code>，关于 liquibase 的用法，可以参考我写的 <a href="https://lcomplete.github.io/TechShare/docs/java/liquibase.html" target="_blank" rel="noopener noreferrer">5 分钟搞定 liquibase 数据库版本控制<span> </span></a> 。</p> <p>以 liquibase 为例，引入后，我们在 <code>application.yml</code> 进行如下类似修改，单元测试运行时将首先通过 liquibase 初始化数据库。</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">liquibase</span><span class="token punctuation">:</span>
    <span class="token key atrule">change-log</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>liquibase/master.xml
    <span class="token key atrule">contexts</span><span class="token punctuation">:</span> unit_test
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>注意，此时我们编写的版本控制 sql 是为 MySQL 数据库准备的，若直接用于 h2 数据库，大概率会出现兼容性问题，此时我们有以下几个选择：</p> <ol><li>将用于 MySQL 的 sql 脚本稍作修改，用于 h2 数据库初始化。</li> <li>使用 liquibase 的 xml 语法来定义数据库结构，减少兼容性问题。</li> <li>改用 <code>Testcontainers</code> 辅助测试。</li></ol> <p>前面两个选择，都需要增加不小的工作量，我们来看看使用 Testcontainers 会如何。</p> <h3 id="使用-testcontainers">使用 Testcontainers</h3> <p><a href="https://github.com/testcontainers/testcontainers-java" target="_blank" rel="noopener noreferrer">Testcontainers<span> </span></a>  是一个支持 <code>JUnit</code> 测试的开源库，可以利用 <code>Docker</code> 容器获得 <code>即用即丢</code> 数据库的能力。</p> <p>我们跳过了别的选项，直接选择 Testcontainers，因为使用嵌入式数据库还有一些缺点，比如 DAO 层使用了特定数据库才有的语法，那么单元测试根本都无法通过，这在企业级项目中几乎是无法避免的，除非是特别独立单一的服务。</p> <p>DAO 层单元测试不应该依赖外部数据库，但在执行时也应当使用类生产的环境，这样的测试结果才更准确的。</p> <p>使用 Testcontainers 并 <code>不符合 AIR 原则</code>，因为其依赖了 Docker 环境，如果在一台没有 Docker 环境的机器上运行，那么测试就会失败，另外它也不符合可以快速地运行这一点，毕竟初始化 Docker 容器是需要一定的时间的。</p> <p>我们看下如何在代码中使用 Testcontainers 。</p> <p>首先定义一个抽象的测试基类，具体的单元测试继承自该类，以下写法可以确保数据库只初始化一次。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>initializers <span class="token operator">=</span> <span class="token class-name">AbstractUnitTest<span class="token punctuation">.</span>DockerMySQLDataSourceInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractUnitTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">MySQLContainer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> mysql<span class="token punctuation">;</span>
    
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
       mysql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MySQLContainer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"mysql:8.0.11"</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">withDatabaseName</span><span class="token punctuation">(</span><span class="token string">"dbname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       mysql<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DockerMySQLDataSourceInitializer</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextInitializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotNull</span> <span class="token class-name">ConfigurableApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TestPropertySourceUtils</span><span class="token punctuation">.</span><span class="token function">addInlinedPropertiesToEnvironment</span><span class="token punctuation">(</span>
                   applicationContext<span class="token punctuation">,</span>
                   <span class="token string">"spring.datasource.url="</span> <span class="token operator">+</span> mysql<span class="token punctuation">.</span><span class="token function">getJdbcUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token string">"spring.datasource.username="</span> <span class="token operator">+</span> mysql<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token string">"spring.datasource.password="</span> <span class="token operator">+</span> mysql<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                   <span class="token string">"spring.datasource.driver-class-name="</span> <span class="token operator">+</span> mysql<span class="token punctuation">.</span><span class="token function">getDriverClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>准备就绪后，在单元测试执行时将首先创建 Docker 容器，然后运行 liquibase 初始化数据库。</p> <p>来看一个简单的 DAO 层测试的例子。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@TestInstance</span><span class="token punctuation">(</span><span class="token class-name">TestInstance<span class="token punctuation">.</span>Lifecycle</span><span class="token punctuation">.</span>PER_CLASS<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">NavSiteRepositoryTest</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractUnitTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">NavSiteRepository</span> navSiteRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@BeforeClass</span>
    <span class="token keyword">void</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">NavSite</span> navSite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NavSite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSite<span class="token punctuation">.</span><span class="token function">setSiteName</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSite<span class="token punctuation">.</span><span class="token function">setSiteUrl</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSite<span class="token punctuation">.</span><span class="token function">setIconPath</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSite<span class="token punctuation">.</span><span class="token function">setSiteType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSite<span class="token punctuation">.</span><span class="token function">setSort</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSite<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSite<span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        navSiteRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>navSite<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">findBySiteType_UnknownSiteType_ZeroSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NavSite</span><span class="token punctuation">&gt;</span></span> navSites <span class="token operator">=</span> navSiteRepository<span class="token punctuation">.</span><span class="token function">findBySiteType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>navSites<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">findBySiteType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NavSite</span><span class="token punctuation">&gt;</span></span> navSites <span class="token operator">=</span> navSiteRepository<span class="token punctuation">.</span><span class="token function">findBySiteType</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>navSites<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>至此，我们就实现了 <code>JUnit5 + Testcontainers + Liquibase</code> 进行 DAO 层测试。</p> <h3 id="方案取舍">方案取舍</h3> <p>应该在使用嵌入式数据库、Docker和专用测试数据库之间进行取舍，目前的持续集成环境中基本都有 Docker 环境，相信 Testcontainers 也会越来越流行，就算不用在单元测试中，在 <code>集成测试</code> 中进行使用也是非常有用的一大利器。</p> <p>总结如下：</p> <ol><li>在简单的项目中使用 h2 或其他嵌入式数据库进行 DAO 层测试。</li> <li>在特定的场景下选择 Testcontainers，可以设法令其符合 AIR 原则并能快速运行，比如在 liquibase 项目中用于测试版本控制 sql 就是个不错的选择。</li> <li>集成测试中可尽管选用 Testcontainers 。</li></ol> <h2 id="写在最后">写在最后</h2> <p>DAO 层的测试难点主要在解除数据库这一外部依赖上，DAO 层的业务逻辑代码较少，因此单元测试编写起来也比较简单，而复杂的 Service 层代码则不一样，容易出现单元测试难以编写的情况，这时需要优化代码设计，这部分内容我们在下一篇 <code>业务逻辑层测试</code> 中详述。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[10 倍程序员] ⭐ 51W+ 的终端命令行工具助你成为 10 倍程序员]]></title>
            <link>https://tech.codelc.com/docs/10x/terminal.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/10x/terminal.html</guid>
            <pubDate>Tue, 25 May 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>终端是程序员的必备工具之一，10 倍程序员的终端跟普通程序员有何不同？本文将介绍许多牛逼且实用的开源工具，用上这些工具后你不一定会变成 10 倍程序员，但绝对能够让你感觉自己像个 10 倍程序员。</p> <p>本文仅对工具做基本介绍，不提供安装方法，因为这些工具的安装方法在项目的 github 首页上基本都会提供，在掘金上也能找到许多具体的使用教程。</p> <p>在终端准备部分介绍的工具是跟操作系统相关的，终端内的命令行工具则基本上是 <code>跨平台</code> 的，可以在 mac、linux、windows 上使用。</p> <p>本文介绍的工具在下表中可以查阅，数据按照发文时的 star 数量倒序排列，方便读者朋友挑选。</p> <table><thead><tr><th>工具</th> <th>地址</th> <th>stars</th></tr></thead> <tbody><tr><td>oh my zsh</td> <td>https://github.com/ohmyzsh/ohmyzsh</td> <td><img src="https://img.shields.io/github/stars/ohmyzsh/ohmyzsh" alt="stars"></td></tr> <tr><td>terminal</td> <td>https://github.com/microsoft/terminal</td> <td><img src="https://img.shields.io/github/stars/microsoft/terminal" alt="stars"></td></tr> <tr><td>the fuck</td> <td>https://github.com/nvbn/thefuck</td> <td><img src="https://img.shields.io/github/stars/nvbn/thefuck" alt="stars"></td></tr> <tr><td>fzf</td> <td>https://github.com/junegunn/fzf</td> <td><img src="https://img.shields.io/github/stars/junegunn/fzf" alt="stars"></td></tr> <tr><td>tldr</td> <td>https://github.com/tldr-pages/tldr</td> <td><img src="https://img.shields.io/github/stars/tldr-pages/tldr" alt="stars"></td></tr> <tr><td>bat</td> <td>https://github.com/sharkdp/bat</td> <td><img src="https://img.shields.io/github/stars/sharkdp/bat" alt="stars"></td></tr> <tr><td>vimrc</td> <td>https://github.com/amix/vimrc</td> <td><img src="https://img.shields.io/github/stars/amix/vimrc" alt="stars"></td></tr> <tr><td>vim</td> <td>https://github.com/vim/vim</td> <td><img src="https://img.shields.io/github/stars/vim/vim" alt="stars"></td></tr> <tr><td>fd</td> <td>https://github.com/sharkdp/fd</td> <td><img src="https://img.shields.io/github/stars/sharkdp/fd" alt="stars"></td></tr> <tr><td>exa</td> <td>https://github.com/ogham/exa</td> <td><img src="https://img.shields.io/github/stars/ogham/exa" alt="stars"></td></tr> <tr><td>z</td> <td>https://github.com/rupa/z</td> <td><img src="https://img.shields.io/github/stars/rupa/z" alt="stars"></td></tr> <tr><td>powerline</td> <td>https://github.com/powerline/powerline</td> <td><img src="https://img.shields.io/github/stars/powerline/powerline" alt="stars"></td></tr> <tr><td>zsh-syntax-highlighting</td> <td>https://github.com/zsh-users/zsh-syntax-highlighting</td> <td><img src="https://img.shields.io/github/stars/zsh-users/zsh-syntax-highlighting" alt="stars"></td></tr> <tr><td>nnn</td> <td>https://github.com/jarun/nnn</td> <td><img src="https://img.shields.io/github/stars/jarun/nnn" alt="stars"></td></tr> <tr><td>iTerm2</td> <td>https://github.com/gnachman/iTerm2</td> <td><img src="https://img.shields.io/github/stars/gnachman/iTerm2" alt="stars"></td></tr> <tr><td>ranger</td> <td>https://github.com/ranger/ranger</td> <td><img src="https://img.shields.io/github/stars/ranger/ranger" alt="stars"></td></tr></tbody></table> <h2 id="终端准备">终端准备</h2> <h3 id="windows-terminal">Windows Terminal</h3> <p><img src="https://img.shields.io/github/stars/microsoft/terminal" alt="stars"></p> <p>地址：https://github.com/microsoft/terminal</p> <p>看这 star 数量，便知无需过多介绍，微软多年后终于意识到自家的终端实在是太简陋了，用上 Windows Terminal 后可以抛弃掉 cmder、cygwin 了。</p> <p>要让其发挥终端的强大威力，还需要安装 <code>WSL2</code>，推荐安装 ubuntu。</p> <p>可以为不同的 shell 环境设置不同的背景、主题，其还支持与 VS Code 一样的 <code>CTRL+SHIFT+P</code> 快捷键打开快速命令窗口，方便操作。</p> <p><img src="https://tech.codelc.com/assets/img/terminal.a9cbfbc9.gif" alt="Windows Terminal"></p> <h3 id="iterm2">iTerm2</h3> <p><img src="https://img.shields.io/github/stars/gnachman/iTerm2" alt="stars"></p> <p>地址：https://github.com/gnachman/iTerm2</p> <p>作为 mac 上首选用来替换默认终端的 iTerm2 自然也无需过多介绍，它拥有超多的特性，比如：分割面板、快捷键增强、优化的搜索、自动完成、粘贴历史、高度可配置等等，它拥有超多的主题，主题的 star 数量甚至超过本体的 star 数量。</p> <p>功能介绍：https://iterm2.com/features.html 。</p> <p>丰富主题：https://github.com/mbadolato/iTerm2-Color-Schemes 。</p> <h2 id="shell-环境">shell 环境</h2> <h3 id="oh-my-zsh">oh my zsh</h3> <p><img src="https://img.shields.io/github/stars/ohmyzsh/ohmyzsh" alt="stars"></p> <p>地址：https://github.com/ohmyzsh/ohmyzsh</p> <p>超过 12 万的 star 数，可见 oh my zsh 多么受欢迎，该项目主要用于简化 zsh 的配置，自带并支持超多有用的插件。</p> <blockquote><p>Oh My Zsh will not make you a 10x developer...but you may feel like one!</p></blockquote> <p>本文的标题实际上借鉴了 oh my zsh 官网的这段话，用上它后你的 shell 环境将焕然一新，还有以下的插件是你务必要装上试一试的。</p> <ol><li><p>zsh-syntax-highlighting</p> <p><img src="https://img.shields.io/github/stars/zsh-users/zsh-syntax-highlighting" alt="stars"></p> <p>地址：https://github.com/zsh-users/zsh-syntax-highlighting</p> <p>一句话点评：语法高亮为终端增添色彩。</p></li> <li><p>zsh-autosuggestions</p> <p><img src="https://img.shields.io/github/stars/zsh-users/zsh-autosuggestions" alt="stars"></p> <p>地址：https://github.com/zsh-users/zsh-autosuggestions</p> <p>一句话点评：程序员怎能离开智能提示？</p></li> <li><p>z</p> <p><img src="https://img.shields.io/github/stars/rupa/z" alt="stars"></p> <p>地址：https://github.com/rupa/z</p> <p>一句话点评：切换目录比资源管理器用起来还方便。</p></li></ol> <h3 id="powerline">powerline</h3> <p><img src="https://img.shields.io/github/stars/powerline/powerline" alt="stars"></p> <p>地址：https://github.com/powerline/powerline</p> <p>终端本身是高效的，但有时也略显乏味，使用 powerline 可以为终端加上强大的 <code>状态栏</code>，比如在 vim 中显示当前状态，在打开 git 目录时显示当前分支等等。</p> <p><img src="https://tech.codelc.com/assets/img/powerline.f52e3f47.png" alt="powerline"></p> <h2 id="系统工具">系统工具</h2> <h3 id="文件管理器">文件管理器</h3> <p>很多人用不惯终端的一个原因就是在上面无法像 windows资源管理器或 finder 一样操作文件，实际上有许多开源的命令行文件管理器，下面介绍两个热门的，大家按需选用。</p> <ol><li><p>ranger</p> <p><img src="https://img.shields.io/github/stars/ranger/ranger" alt="stars"></p> <p>地址：https://github.com/ranger/ranger</p> <p>Ranger 使用 Python 编写，默认为使用 <code>vim</code> 风格的按键绑定，对于使用 vim 的用户来说几乎没有学习成本，能够快速上手使用。</p> <p><img src="https://tech.codelc.com/assets/img/ranger.77974c48.png" alt="ranger"></p></li> <li><p>nnn</p> <p><img src="https://img.shields.io/github/stars/jarun/nnn" alt="stars"></p> <p>地址：https://github.com/jarun/nnn</p> <p>nnn (n³) 是一个功能齐全的终端文件管理器，速度非常快且几乎 0 配置，也是一个非常不错的选择。</p></li></ol> <h3 id="vim">vim</h3> <p><img src="https://img.shields.io/github/stars/vim/vim" alt="stars"></p> <p>地址：https://github.com/vim/vim</p> <p>终端下还有比 vim 更好用的文本编辑器吗？ vi 不仅仅是一个文本编辑器，它无处不在，如果说 10 倍程序员有什么标配，那 vim 大概率会是其中之一。</p> <p>要调教好 vim 也需要一番配置，有不少人在 Github 上分享自己的配置文件，但要说最好用且适合大多数人的还是下面这个项目。</p> <ul><li><p>vimrc</p> <p><img src="https://img.shields.io/github/stars/amix/vimrc" alt="stars"></p> <p>地址：https://github.com/amix/vimrc</p></li></ul> <h2 id="命令增强">命令增强</h2> <p>终端下有许多原生的命令可以满足基本使用，但有些命令并不足够好用，下面介绍几个替代工具。</p> <ol><li><p>exa</p> <p><img src="https://img.shields.io/github/stars/ogham/exa" alt="stars"></p> <p>地址：https://github.com/ogham/exa</p> <p>一句话点评：用来替换 <code>ls</code> 命令的现代化工具。</p></li> <li><p>fd</p> <p><img src="https://img.shields.io/github/stars/sharkdp/fd" alt="stars"></p> <p>地址：https://github.com/sharkdp/fd</p> <p>一句话点评：简单、快速、好用，用于替换 <code>find</code> 的搜索工具。</p></li> <li><p>bat</p> <p><img src="https://img.shields.io/github/stars/sharkdp/bat" alt="stars"></p> <p>地址：https://github.com/sharkdp/bat</p> <p>一句话点评：<code>cat</code> 的替代品，是猛男就用 bat。</p></li></ol> <h2 id="其他让人赞叹的工具">其他让人赞叹的工具</h2> <h3 id="fzf">fzf</h3> <p><img src="https://img.shields.io/github/stars/junegunn/fzf" alt="stars"></p> <p>地址：https://github.com/junegunn/fzf</p> <p>fzf 是一款支持模糊搜索的交互式工具，可以用来查找任何列表内容，包括文件、Git 分支、进程等。</p> <p><img src="https://tech.codelc.com/assets/img/fzf.2b986a97.png" alt="fzf"></p> <h3 id="tldr">tldr</h3> <p><img src="https://img.shields.io/github/stars/tldr-pages/tldr" alt="stars"></p> <p>地址：https://github.com/tldr-pages/tldr</p> <p>tdlr 是 <code>Too long, Don't read</code> 的缩写，可以帮助你快速查看常用命令的使用实例，比如 tar 命令，那后面一长串参数谁记得清呢？当然，linux 大佬除外。</p> <p><img src="https://tech.codelc.com/assets/img/tldr.6b21678e.png" alt="tldr"></p> <h3 id="the-fuck">The Fuck</h3> <p><img src="https://img.shields.io/github/stars/nvbn/thefuck" alt="stars"></p> <p>地址：https://github.com/nvbn/thefuck</p> <p>在终端下是不是经常输错命令，搞得自己心烦意乱，<code>The Fuck</code> 是一款了不起的工具，帮你彻底解决这个问题，当你输错命令后，只要输入 <code>fuck</code> 命令，它会帮你自动纠正错误，精彩之极！</p> <p><img src="https://tech.codelc.com/assets/img/thefxxk.53361675.gif" alt="thefxxk"></p> <h3 id="w3m">w3m</h3> <p>地址：https://github.com/tats/w3m</p> <p>真正的程序员就该使用命令行来浏览网页。</p> <p><img src="https://tech.codelc.com/assets/img/w3m.fd6e21e1.png" alt="w3m"></p> <h2 id="_10-倍程序员之路">10 倍程序员之路</h2> <p>w3m 这个项目已经基本不维护了，我以这个命令来结束本篇文章，因为还有许多像这样优秀好玩的工具等待我们去发现、去创造。</p> <p>程序员的双手是魔术师的双手，他们将代码转变成丰富多彩的软件，即使是平平无奇的终端竟然也能玩出许多花样。</p> <p>普通程序员使用工具，10 倍程序员使用优秀的工具再造工具，10 倍程序员不是概念，而是真实存在的，今天的我看上去像，明天的我真的可以做到，加油吧，程序员们。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[Java] 5 分钟搞定 liquibase 数据库版本控制]]></title>
            <link>https://tech.codelc.com/docs/java/liquibase.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/java/liquibase.html</guid>
            <pubDate>Mon, 24 May 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>Java 生态下的数据库版本控制工具有 Flyaway 和 Liquibase，两者具备相似的功能，但基本概念不太一样，本文不对两者进行比较，主要介绍使用 Liquibase 进行数据库版本控制。</p> <p>本文涉及的工具有 maven、mysql。</p> <h2 id="添加依赖">添加依赖</h2> <p>在 pom 文件中引入必要的依赖：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.liquibase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>liquibase-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>由于 spring-boot-starter-jdbc 中含有 spring-boot-starter、spring-boot-autoconfigure 依赖，我们只需要引入这一个依赖即可。</p> <p>spring boot 框架整合了许多第三方库，这其中包括 Liquibase，在 autoconfigure 模块中包含 Liquibase 的可选依赖和 LiquibaseAutoConfiguration 类，下面是这个类上的部分注解代码。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">SpringLiquibase</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DatabaseChange</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnProperty</span><span class="token punctuation">(</span>
    prefix <span class="token operator">=</span> <span class="token string">"spring.liquibase"</span><span class="token punctuation">,</span>
    name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"enabled"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    matchIfMissing <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">HibernateJpaAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LiquibaseAutoConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到该自动配置在 DataSourceAutoConfiguration 配置之后执行，因此必须引用 spring-boot-starter-jdbc 依赖，这是较容易被忽略的一点。</p> <h2 id="修改-spring-配置">修改 Spring 配置</h2> <p>引入以上依赖后 Liquibase 默认就启用了，我们可以在 Spring 配置文件中添加相关的配置，数据库的相关配置请读者朋友根据机器运行环境进行修改。</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.url</span> <span class="token punctuation">=</span> <span class="token attr-value">jdbc:mysql://localhost/db?createDatabaseIfNotExist=true&amp;allowMultiQueries=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span>
<span class="token attr-name">spring.datasource.username</span> <span class="token punctuation">=</span> <span class="token attr-value">root</span>
<span class="token attr-name">spring.datasource.password</span> <span class="token punctuation">=</span> <span class="token attr-value">root</span>
<span class="token attr-name">spring.datasource.driver-class-name</span> <span class="token punctuation">=</span> <span class="token attr-value">com.mysql.cj.jdbc.Driver</span>

<span class="token attr-name">spring.liquibase.change-log</span> <span class="token punctuation">=</span> <span class="token attr-value">classpath:liquibase/master.xml</span>
<span class="token attr-name">spring.liquibase.contexts</span> <span class="token punctuation">=</span> <span class="token attr-value">dev</span>
</code></pre></div><p>注意：datasource 的 url 中包含 <strong>createDatabaseIfNotExist=true</strong> 配置，这将使数据库在不存在时自动创建。</p> <p>在配置中只简单指定了 change-log 和 contexts 两个属性，更多的属性可查看 <strong>LiquibaseProperties</strong> 类，其中包含部分属性的默认值，若使用默认值，以上两个属性都不需要配置，默认的 changeLog 地址为：classpath:/db/changelog/db.changelog-master.yaml 。</p> <h2 id="编写-liquibase-配置代码">编写 Liquibase 配置代码</h2> <p>首先看下文件的组织：</p> <p><img src="https://tech.codelc.comdata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVgAAAEWCAYAAAAjPo9cAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABhWSURBVHhe7d3dbx1nXsBx/hgkjFRQEBdccMfNckfAF0HavUKLuFiBWMAcxcoqqKBVKNn0Zem6boN2W0Cl2d2sWi2p68SFruMktElav7Rx4+Y9aZ26iRs7Ps77w/xmzjPzzDPPzJljz2OPx9+Lj3rOzDMvPpW/mTPH9vNrq/ceKABA9QgsAHhCYAHAEwILAJ4QWADwhMACgCcEFgA8IbAA4AmBBQBPNjWwK+376v/Ozqux4zdip87cdI4FgK1mUwP7X29eUN/6zv9mHAqWu8YDwFayqYF99uVpZ2DzfPtvxtXJ0/POfQFA3aw7sCOjY8Fb/XuZ5bJM1tnLTRLYPf98OnWLoIiMff7gjHNfAFA36wrs+MRJ9Zu/9Ttq9569qcjKY1km62SMuY1JAitc60yf332o2sF/i8bPDu8Kjyf6nhpUI6v3VXt1Tg3171ADQegHntqh+voPqtlwefRcj985POfcJwCsx7qvYJ974cUwUjqyZlxlnWsbrSiYi+0Haj4Iqzx+5coTdX35oXr21XPO8e3Zg2pnJ6qp5Z3A6uBGy6K4ElUAvlVyD9aMbNm4irzA3lx5GEZ1ZvGRWlp9oIYuP1Hn7zxU//JxsM1/ZsOoo9n31C41NJtENrmCNZaNDsZXsnoZAPhQ2YdcOrJl4ypcgb0WXKlKUKeCuMrzS0sP1U9vPA4f/+Dnl9Uzn0TLzG205Io1Ci2BBbCZKguskLCWjatwBfbH156oXy1EcRXv33qk/mchCqyM3X/kRhhgvV7ILYKhTkTNqDoD27na1cvk+RC3CwB4UGlge5V3BfujIKCzd6Kr1CPzj9XHnavZA29czL2CHWklH1r1taKfXnAFNlwe3rONxpv3ZwGgSpsa2LxfNPj2995X/3R2Vf3Fvo/U3uN31J8NnlJ//vQZ9Y8f3VOvjl537gsA6mZTA+v6VVntyIl59db7C+rA+cfh81+euqnenfwq3Ma1LwCom00NbBmzX7s/0AKAuqt9YAFgqyKwAOAJgQUATwgsAHhCYAHAEwILAJ4QWADwhMACgCcEFgA8IbAA4AmBBQBPCCwAeEJgAcATAgsAnhBYAPBkywf2bvueGj32rjr081/ERo6+6xy7EaLpaNKz2wLYnrZ8YA88/6/xXFymXiZfrBKBBaBt+cD+5Xf/zhnYPL/7e7+v3n7nmHNfAFClWgR2ZHRMrQRv9e3lskzW2ctNEtj+P/1m6hZBERn713/79859AUCVNj2w4xMnwyvL3Xv2piIrj2WZrJMx5jYmCaxwrXPJG99eHVMD8tZ+NJnSW6b7bo8Oxle/O4fnkvHG1N96bLI8mgo83uewex8Amq0WV7Byv1TioyNrxrXbvdRqA7tD9fUfVLMSx05Y+1rRFXQ6nHNqqBWNC9cFY/v0ukxgg32m9sH9WWC7qM09WDOyZeMqqg1sEr9uz8Xs8K7wPMMQ5wbW3EcQ5n4CC2wXtfqQS0e2bFzFZgQ2iuiO+O1+KqoEFkBHrQIrJKxl4yo2JbByS6BzK0HWyZUsV7AAbLULbK82JbBhKJMPuHa2BrmCBZCx5QOb94sGRWQb174AoEpbPrCuX5UtImNlG9e+AKBKWz6wAFBXBBYAPCGwAOAJgQUATwgsAHhCYAHAEwILAJ4QWADwhMACgCcEFgA8IbAA4AmBBQBPCCwAeEJgAcATAgsAnhBYAPCEwAbaqw/UzJWH6oO5R7Hpy4+cY4tE08UwJQyASOMCOz5x0rm8yNHJx+rpQypjbLK3yBJYAKZGBXZkdCycc6uXWWnFG8fdgc2z77BSU2u4wgWwvTQqsO3V+2pwzz/0HNleAysOTTx27gsAtMbdIpDI7t6zt6fIriWwso29H3PK7uR5Mr33wGgy5ffO4bl4u9nhXaqv/6Cajaf9Tm+jxwHYWhr5IddK+15PkfUR2DCkrSia4brRQdWn18ljHdROcOP45mxjHgfA1kBgA76uYIVcneqr0Tiwq2NqoPNhWNlt9DoAW0fjAttrXIWXK9jOW319K8AO6UgrWicxTY/J3wbA1tKowK4lrsJLYI3bALIuvM9qxDIc2z+oBvqTH+vqtg2AraVRgd2oH9MSXQPbubeq3+rvbA2mrkb1+r7WWLJ9l20AbC2Nu0Vw/MQp5/Iieb9oUES2sffDW3oApkZ+yNUr16/KFpGxso29n/AtvfEWH8D2RmArIPdO5S0990sBmAgsAHhCYAHAEwILAJ4QWADwhMACgCcEFgA8IbAA4AmBBQBPCCwAeEJgAcATAgsAnhBYAPCEwAKAJwQWADwhsADgCYENtFfuq9nRq+qjNz6LnRu56hwLAGUR2MB7+6fUgV8/lDF+YMo5HgDKILCBN79z3BnYPD/87cPqkyNc4QIo1pjAyoyyMm23vVyWyTp7uUkC++9/fDR1i6CIjH3rryac+wIArRGBHZ84Gc6JtXvP3lRk5bEsk3UyxtzGJIEVrnVi7r+vqbM/nM24cWYhNU5Puz0QBH3gqR3xBIjt1eh5PB338Fy8jUyUqJebc3rZ26TWWbPXuqYLL3sOazk3AOU05gr2uRdeDEOgI2vGVda5ttHyArt4465a+qqtpn/ymbo6cVPdunQn9M7A++rE96fVxdEbqfE6btlQ7lJDs/q5DmAQvZxpvnX0zNjJxIp6v2UC64q1ub9keW/nBqC8Rt2DNSNbNq4iL7DXTtxUX376dRjYyVfmwv+KD579RJ1+/lxuYCVQ8bLOjLM2iZ0OX58ROb2NPf13UfxcgbXPwTWd+FrODUB5jfuQS0dWlImrKBPYS8c+V/PTt0LHBj9QJ/bNlA6sK24mvZ2OWX5gO+srDGyv5+YaA8CtcYEVEtaycRVlAiv3Ya9N3Ayjqu/Blgps50rQXDbS6sQwCONQZ7m5restvRnDKKhJ8OReaXz7oMQ5yPMh4yq1l3PT4wB018jA9qpbYGdeu6A+/o8LavZnV9Qnr1+KAytXteb4vBBFQUw+SEoHzfggq5X8tIOOX7zOuGIV5gdQO4MoFl3BhvszziF1f3YN5wagHAIbyPtFg8PffE+99o0R9eM/OBI+Np189mN158sV5/4AQBDYgOtXZcWHPzmvPnzpU3X2lfMpU69+Fm7j2hcAaAS2i+Xbq2ppoZ32Vds5FgBMBBYAPCGwAOAJgQUATwgsAHhCYAHAEwILAJ4QWADwhMACgCcEFgA8IbAA4AmBBQBPCCwAeEJgAcATAgsAnhBYAPCEwFakvfpAzVx5qD6YexSbvvzIObZINFVMMi+WOffWWpn7YX4tYOMQ2IocnXysnj6kMsYme4ssgQWag8BW5I3j7sDm2XdYqSnHFa4ZWHtdFQgssHEIrGFkdEyttO9llssyWWcvN0lgXz76JHWLoIiMPTTxOLMfAgs0B4HtGJ84GU5PvXvP3lRk5bEsk3UyxtzGJIEVrnUueeOztwiS2Ebrkqm0w+m0+w+qWddY43nqcRzY9L7M4Ebj3evM6cJT039b57ZzeC7eBtiuCKzhuRdeDOOgI2vGVda5ttF8B1YHzIzdSGvHmgObiuPoYPw8XN+K9plZZx1Di84tuVfMVTIQIbAWM7Jl4yq8B1ZC14lpPNZY1mtgU1esjmWuK1Ud+T7rgzc5Dz3WxFUstjsC66AjK8rEVTQlsNHYHXEc7f2a43VoXecGgMDmkrCWjavwHtjO1aMOYxy5VGCTK0u5AnW9tY+3ayUf2qXGWrG09zNkHT+MsnVuYqQVbaOfA9sRga2I78CG64y34uHV43A2hnr9ziBwcVQdgR0I1if7Mo7RWe/aj6yX+77xdkako2O4PxgDtisCW5G8XzQoItu49lUWb82BeiOwFXH9qmwRGSvbuPZVFoEF6o3AbmEEFqg3AgsAnhBYAPCEwAKAJwQWADwhsADgCYEFAE8ILAB4QmABwBMCCwCeEFgA8ITAAoAnBBYAPCGwAOAJgQUATwgsAHhCYGvE9Ue7py8/co5di2g6mvSMsJvJnB7HtR7Y6ghsjeRNOzM2WU1kCSywsQhsjcgkiK7A5tl3WKmpHq5wCSywsQhsxUZGx9RK+15muSyTdfZykwT25aNPUrcIisjYQxPlJ04ksMDGIrAVGp84GU5ZvXvP3lRk5bEsk3UyxtzGlDeVd56i8VG8jOm3h+eSwA4bU3aXmHrbtZ3sz3Us13TirnNJlieBtceZ04mXOQ5QNwS2Ys+98GIYAB1ZM66yzrWNVlVgdYjMCJrLdVSjoEZXtO3VOTXUMqIoEyp2Ale8XbQuiXGwn/5gbCd80fporLlexkfr0sdIhdtxDnnH0dsAdUJgPTAjWzauorLA5sw2645d8lzMDu8Kz1ek4+beznUsc5k81vszJVfUnWO49mPGuMtx9DKgTgisJzqyokxcxWYGVt8eiN++h8+rCWxeBMsFttxx9DKgTgisRxLWsnEVlQU2DJf5dnpMDcVXjOVCKVeypa5gM8eSdfYtgmS9GGmZ+zUfO24R5OzHPo7eBqgTAlsjVQVWmB9YlQtlFKz4LXwQwTJXsNljBcvtD7mM9cIMf08fcnU5DlA3BLZG8n7RoIhs49rXZtqot+7cIkDdEdgacf2qbBEZK9u49rVRoqvZ7FWo/RMM67VRxwGqRGCxbvYtAF/R26jjAFUhsADgCYEFAE8ILAB4QmABwBMCCwCeEFgA8ITAAoAnBBYAPCGwAOAJgQUATwgsAHhCYAHAEwILAJ4QWADwhMACgCcEtmFcf7R7+vIj51gAfhHYhsmbdmZscm2RLTNzgDmXVjhXVmeuLmC7I7ANI5MgugKbZ99hpaYcV7h6EkSZeHCglR9YPU6vD+fJsiYrBLYrAltDI6NjaqV9L7Nclsk6e7lJAvvy0SepWwRFZOyhieKJE0eKAhtO42LOlRUF15ymG9iuCGzNjE+cDN9q796zNxVZeSzLZJ2MMbcxFU3l7VJmfGFg5Yq1lY5+0XhgOyGwNfTcCy+mImvGVda5ttE2OrCzw7sILJCDwNaUGdmycRUbHViuYIF8BLbGdGTLxlVsSmD7D6pZ7sECGQS25iSsZeMqNiKw0Qdb0Y9j2UG1gwtsZwS2YTY6sMlz/XOw/IgWoBHYhsn7RYMiso1rXwDWh8A2jOtXZYvIWNnGtS8A60NgAcATAgsAnhBYAPCEwAKAJwQWADwhsADgCYEFAE8ILAB4QmABwBMCCwCeEFgA8ITAAoAnBBYAPCGwAOAJgUXKT89fVN87dUY9c2ZKLSy3nWMAlENgkfKzuUvq3MKi+njhtjrw4UwYW4muayyAYgQWKSur99X+szOqHTy+fXc1XPbu1Rtq76mz6oulu5nxqI45n5k9Lc9Gaa+OqQGm/akMgUXG+PUv1OkvvlRvXbgSL/t8aTm4mj2rFpZXUmNRHQLbPAQWGcvt++ql6dnM8ht3ltWeU2fCq1t73WZZ7zThdZpmvNcZeX2cO4GtFoGF07/NfKquB0G1lx+7fEO9/umFzPLNQmAJbJ0RWDhd+3pZ/eKzy851AxMfqLulIyDfsNGU3kKm/07CEK2L3xY7xsb7MaYGFxIVe3yZ/Zjscb/xJ8+o7wfnlTpuJ3rn2p+mzllvY8at7HE1e7yIv4bw601CZ4/9o5deTz13hXl2eFeyvmBf5vbROgJbFQILp/eufa4u3L7jXCc/aTB66bpznUl/I9uh0YHNftMn9xzNq7PwcSsJSBi9zrb2VVzRfuS5LbO9dRU50jLOwT7n1Hn0etzotTHXy7Fcge32OrqOYQc6Xt7tuOH67HZYGwILp0PnL4b3Yi8vLmXWLa6shlex9nJb3lteVxhkrHlFpZlRcV2RuQJpbq/lXU1mtjdCacbGec7Gsp6P63htzGWpwDrGhuMd55Ssi0LaZ31Q1vW4BLZSBBZO7wRXqPKh1reO/krNO34865XpWTVxfT6z3NRLGPLGhus6twd0rNJXd1YgC/bj4joXCbkcS/7b1xrLHWcu6/m4jvHmsvUGVtNjdGi7HpfAVorAwkni+tonc+GPZr3s+IkCuYodCpbvPzsd/giXvV7oq6g4fsHzoSBc7lilx4qRljswYfjyAluwH/3c5DwXiVv/oBroz77l18EV6fPo9bj2a9PZvyuwmbHu1zHaphPS4PGQtW8Z1/W44fr880ZvCCxyvX3xmpq+eUuNXflcXcy5Hyuh/dHUuXCca330TR99oJIXRddYYUcgftsdhMu8v6hvHaTjlN1PHnt7WWbel5Tn8TkHx9b71V+P3k+vx5V/OJJ9BWEcdl/BhmMdr6MsN8/93OwrwZjkHwX5GuL9G/8wFB6XwFaKwKKUS4tLzp8ckAjL3y2QK135LTB7/VYlcTLvn+b9o9AErtsGqAaBxbp8d/x9deJG8b3Yrca+egyXEVisAYHFusgtgh+cnVFvGr9WW0f63qN+a6zZwdRvq+3law1s2eNuJgLrD4FFJeQvcM3d+tq5DtiuCCwAeEJgAcATAgsAnhBYAPCEwAKAJwQWADwhsADgCYEFAE8ILAB4QmABwBMCCwCeEFgA8ITAAoAnBLZh7ly8rG4eGcl1d+GrcFy7fS9eJtvY+wGwfgS2Yebf+qWa/MYf5lqcmgnHtZfuxstkG3s/LubfDa3iD1BHfys1meJks23H6VKYIsYvAtswBHbtNio20XHSU9LY9Bj549z21NtVIrB+EdiGWVm8o5auXs/VXl6JxgbfUHqZbGPvx4XAro9+zWTSwgFrzi/XuHiacnndPZ0XgfWLwKI0Alsde1JFU2ZG2Qpe6zwE1i8C2zDdrmBd8q5go2++9HxS2cCmx+RFwN6XxCUO7LAxjbQ5vXTONNiu7cxYmceyp6W215vbRsvNsKXHZabp7nKcIoWBlX/IjNdBuMbLlN3mOckY2S46r+B8RpPXT1472a/+WvK+ZlSLwDZMt3uwLq57sDoeZjDDb2ArsOY3eN5bWb0vOxB6uY5JFNQgDMEVbbj/lhFFY9/F26XPOz7P+LxlfTTWXB8GKFyXPoZ5zq5zyDuO3iZPUWDDcJYIrLk8PLfU12h8zZ2wpl8v8+vI/j9DNQhsw1QWWOMb1rXMDFO83rHM3i61PPzmtmOXPBcSG33VlY6be7uu5x081vszhZEyYuPcj/H1dT1OJ3Kyb9eHVEWBDfdTMrD6OOYxsq9P/vPoMYH1hcA2zPIX8+rW6TM9kW3s/XQPiN/A6tsDOirZq66c7bqdd865hOOM2Dj308Nx9LI8XQNr7CfvdY3WyTkT2LoisHDS37j6m1p/k+tv/Pi5caVl3hMsfts+pobiK0bzGz8/YKl9F23X9bzT68VIy9yv+TgdQfOcuh1Hb5PHDmz69Yr2Fe/bPK4xztxP+Pqkzs18ffKfR48JrC8EFrnkG1u/hbY/xIkjEMQpGZN8o9ohiJ7rt8xlQhntX+97Z3CcMlew2WMFy+0PuYz1wgy/GZvoeTLO/PrKHKdIUWCT53rf7tdV9mH//5B/8LKvT/5z+2tGtQhsw7juwV56Zn+8Xh7b6133YJvEvhr2ZaOOg62DwDbMdg9sdCWXvQrNu9+5Vht1HGxtBLZhXH/s5faHk/F6eWyvb9ofe7FvAfiK3kYdB1sXgQUATwgsAHhCYAHAEwILAJ4QWADwhMACgCcEFgA8IbAA4AmBBQBPCCwAeEJgAcATAgsAnhBYAPCEwAKAJwS2Rlx/atB0d+GrcFy7fS9e1rQ/NQg0CYGtEdcfyzYtTs2E49pLd+NlTZ+NoAymPUFdEdgaIbBrQ2BRVwS2RlYW76ilq9dztZdXorFBSPQy2cbej296gj1zZtbNRGBRVwQWPSOwQDkEtka6XcG6uK5go+DsUkOjyZxREkNzGu7slNHJ3FJmOGW+fb1cpo9+u30s2HcyNpk2Wo6ZnZ8qiXG03p51NZzP34hjOBW1OfV0ia+BwKKuCGyNdLsH6+K6B6tjF8evEyUJV7g+DGoUpDCArSR64dTTep0xLr3/9BVsHMN43v1kvX5sRtQmUZVYmtNe9/Y1EFjUE4GtkWoDawav+Lmwr1STcEkc02MzgTWuKk1hNK2xLq7j9PI1RI8JLOqHwNbI8hfz6tbpMz2Rbez99BSnzu2B+O2246o1uQrVQcsG1n7rb29LYLEdEdgG6ilOVhzNe6IS2yEdUSOUmcCG+0tHdKSlr4KzgY0inpyPvkUQHjt1i6Dk1xA+JrCoHwLbQL3FKQpg/LY+CKN5BSvx0+v0/U+hbynEQexcCeuxSXyLAxt+qBVHNRqb+pCr1Ncgjwks6ofA1ojrHuylZ/bH6+Wxvd51DxZAPRDYGiGwQLMQ2Bpx/bGX2x9Oxuvlsb2eP/YC1BeBBQBPCCwAeEJgAcATAgsAXjxQ/w9Ydm7EEmnznwAAAABJRU5ErkJggg==" alt="文件结构"></p> <p>这是官方推荐的方式，使用发布版本号来组织数据库变更记录。</p> <hr> <p>master.xml 中的代码：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseChangeLog</span>
        <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.liquibase.org/xml/ns/dbchangelog<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">file</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>liquibase/changelog/db.changelog-1.0.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databaseChangeLog</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>有更新时新增 include 标签和对应的文件即可。</p> <hr> <p>db.changelog-1.0.xml 中的代码：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>databaseChangeLog</span>
        <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.liquibase.org/xml/ns/dbchangelog<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>changeSet</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>create_type_dict<span class="token punctuation">"</span></span> <span class="token attr-name">author</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lcomplete<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sqlFile</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>liquibase/changelog/1.0/create_type_dict.sql<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>changeSet</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>databaseChangeLog</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一个变更对应一个 changeSet，在这里意味着一个变更对应一个 sql，若在一个 sql 中编写多个变更，不利于回滚，可能导致数据库进入未预期的状态。</p> <p>changeSet 中包含 author 和 id 两个必写的属性，这两个属性组成了变更的唯一标志，注意 id 并不是用来控制执行顺序的。</p> <p>changeSet 还包含一些属性，比如 Contexts ，可以控制 changeSet 是否需要在当前环境（上文演示了在 Spring 配置中如何设置）中执行，使用这个属性可以在测试环境增加一些需要额外执行的变更，比如填充数据。 更多属性可以查看：https://docs.liquibase.com/concepts/basic/changeset.html。</p> <hr> <p>create_type_dict.sql 中的代码：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> type_dict
<span class="token punctuation">(</span>
    id          <span class="token keyword">int</span> <span class="token keyword">auto_increment</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    category    <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'分类'</span><span class="token punctuation">,</span>
    type_key    <span class="token keyword">int</span>          <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'类型key'</span><span class="token punctuation">,</span>
    type_value  <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'类型值'</span><span class="token punctuation">,</span>
    is_enable   <span class="token keyword">bit</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'是否启用'</span><span class="token punctuation">,</span>
    create_time <span class="token keyword">datetime</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'创建时间'</span>
<span class="token punctuation">)</span> <span class="token keyword">collate</span> <span class="token operator">=</span> utf8mb4_general_ci<span class="token punctuation">;</span>
</code></pre></div><p>这个 sql 中包含一个示例建表语句，注意：不需要判断表是否存在，若这次变更执行过，Liquibase 会在自动创建的表 databasechangelog（默认表名、可配置） 中记录下来，下次不再执行。</p> <hr> <p>在上面的配置中，使用 sql 来创建数据表，Liquibase 还支持使用 xml、json、yaml 来定义表，在大多数场景下使用 sql 就足够了，因此这里不介绍其他的用法。</p> <h2 id="完结撒花">完结撒花</h2> <p>编写完成以上的配置代码，添加 Spring Boot 应用程序启动类运行程序即可自动更新数据库。</p> <p>是不是很简单？当然在实际的项目过程中，还需要考虑 Liquibase 配置在流水线中如何运行，Liquibase 的代码仓库如何组织等问题，这些就留给读者朋友自己思考吧（其实是笔者比较懒，先不写了）。</p> <p>关于 Liquibase 的更多概念可以查看官方文档：<a href="https://docs.liquibase.com/concepts/home.html" target="_blank" rel="noopener noreferrer">https://docs.liquibase.com/concepts/home.html<span> </span></a> 。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[万字长文带你彻底搞懂什么是 DevOps]]></title>
            <link>https://tech.codelc.com/docs/engineering/devops.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/engineering/devops.html</guid>
            <pubDate>Sun, 23 May 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>DevOps 日渐成为研发人员耳熟能详的一个组合词，但什么是 DevOps，为什么 DevOps 对于互联网企业如此重要，真正将其思考透彻的人却不多，带着这些困惑，本文将带你一探 DevOps 的起源、原则和实践，让你搞清楚到底何为 DevOps。</p> <p>DevOps 的起源可以追溯到 2008 年，在一次敏捷大会的敏捷基础设施话题组被提及，从起源我们可以了解到 DevOps 的发展跟敏捷软件开发是密不可分的。</p> <h2 id="devops-定义">DevOps 定义</h2> <p>DevOps 经过这些年的发展，其定义也在不断变化，先来看三段 DevOps 的 wiki 定义。</p> <ol><li><p>DevOps 2017 - 2020 年英文 wiki 定义（直译）</p> <blockquote><p>DevOps是一种<strong>软件工程文化和实践（Practices）</strong>，旨在整合软件开发和软件运维。DevOps运动的主要特点是强烈倡导对构建软件的所有环节（从集成、测试、发布到部署和基础架构管理）进行全面的自动化和监控 DevOps 的目标是缩短开发周期，提高部署频率和更可靠地发布，与业务目标保持一致。</p></blockquote></li> <li><p>DevOps 2021 年英文 wiki 定义（直译）</p> <blockquote><p>DevOps 是一系列整合软件开发和软件运维活动的<strong>实践（Practices）</strong>。目标是缩短软件开发生命周期并使用持续交付提供高质量的软件。</p></blockquote> <p>另：</p> <blockquote><p>DevOps 与敏捷软件开发是互补关系，DevOps 的许多方面来自于敏捷方法论。</p></blockquote></li> <li><p>DevOps 中文 wiki 定义</p> <blockquote><p>DevOps（Development和Operations的组合词）是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间<strong>沟通合作</strong>的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。</p></blockquote></li></ol> <p>提取这三段的共同点，可以看到不论定义如何变化，DevOps 所要实现的目标都是一致的——缩短软件开发生命周期并使用 <strong>持续交付</strong> 提供高质量的软件。由于持续交付活动中包含了构建、测试和发布等活动，我更倾向于用这个定义，可以更好地缩减定义长度。</p> <p>另外可以看到英文直接翻译过来的定义中都包含「<strong>实践</strong>」 一词，而中文 wiki 经过一定的翻译或本地化后变成了「<strong>文化、运动或惯例</strong>」，其还更强调开发运维之间 <strong>沟通合作</strong> 这一点，因此将最新的英文 wiki 定义与中文 wiki 定义相结合，可以帮助我们更好地理解 DevOps，那么它的最终定义是什么就交由读者朋友自己去领会吧。</p> <h2 id="devops-发展背景">DevOps 发展背景</h2> <p>为什么 DevOps 会如此热门，时常被人所提及，这与其发展背景是分不开的，主要原因可以概括为以下几点：</p> <ol><li><p>敏态需求的增加，即探索性工作的增加；</p> <ul><li>软件开发从传统的瀑布流方式到敏捷开发，再到现在对敏捷开发提出了更高的要求，近些年创新型的应用不断涌现，在这些应用的研发过程中多采用小步快跑、快速试错的方式，这些探索性工作要求运维能够具备一天发布多次的能力，需要企业完成由稳态到敏态的转变。</li></ul></li> <li><p>软件开发活动在企业经营活动中占比的不断增加；</p> <ul><li>业务发展对软件的依赖由轻度依赖、中度依赖发展到目前的重度依赖。</li></ul></li> <li><p>企业存在对消除浪费的需求。</p> <ul><li>软件开发活动在企业中的位置越来越重要，而像企业经营活动一样，软件开发活动中也存在着许多的浪费，企业管理上必然存在着 <strong>识别并消除浪费</strong> 的需求。</li> <li>软件开发中的浪费包括不必要和必要的浪费，不必要的浪费有：无人使用的功能、软件bug、等待测试、等待审批等；必要的浪费包括：工作项移交、测试、项目管理等。</li></ul></li></ol> <p>以上主要从企业的角度说明了 DevOps 的发展，这是较为深层次的原因，表层的推动因素包括：容器化技术的发展、微服务架构的发展等等，这些技术上的创新为 DevOps 提供了良好的发展条件，以解决企业面临的这些问题。</p> <h2 id="devops-原则与实践">DevOps 原则与实践</h2> <p>了解了什么是 DevOps 及其发展原因后，又该如何具体的进行 DevOps 实践，我们采用黄金圈法则来思考这一问题。</p> <p><img src="https://tech.codelc.com/assets/img/golden_circle.f4ed38b4.png" alt="黄金圈法则"></p> <p>DevOps 原则是总体指导思想，实践是具体的执行方法，DevOps 是一个动态的过程，在进行相关实践的时候可以看看其应用了哪些原则，当违背原则的时候需要思考实践的合理性。</p> <h2 id="devops-原则">DevOps 原则</h2> <p>DevOps 包含以下三大原则：</p> <ol><li>流动原则：<strong>加速</strong> 从开发、运维到交付给客户的流程；</li> <li>反馈原则：建设 <strong>安全可靠</strong> 的工作体系；</li> <li>持续学习与实验原则：采用科学的工作方式，将对组织的 <strong>改进和创新</strong> 作为工作的一部分。</li></ol> <h3 id="流动原则">流动原则</h3> <ol><li><p>坚持少做</p> <ul><li>产品开始开发时采用 MVP 原则。</li> <li>产品迭代时要适时做减法。</li></ul></li> <li><p>持续分解问题</p> <ul><li>大的变更或需求拆解为一系列小的变更，快速解决。</li></ul></li> <li><p>工作可视化</p> <ul><li>采用 Sprint 看板将工作可视化。</li></ul></li> <li><p>控制任务数量</p> <ul><li>减少前置时间，降低测试人员的等待时间。</li> <li>任务越多，预估越不准确。</li></ul></li> <li><p>减少交接次数</p> <ul><li>减少不必要的沟通和等待。</li></ul></li> <li><p>持续识别和改善约束点</p> <ul><li>识别出影响流动的主要前置因素，比如搭建环境、需求文档。</li> <li>QA、开发、运维、产品持续提升生产力。</li> <li>为非功能性需求预留20%的开发时间，减少技术债务。</li></ul></li> <li><p>消除价值流中的困境和浪费（导致交付延迟的主要因素）</p> <ul><li>半成品——未完全完成的工作。</li> <li>额外工序——从不使用的文档、重复编写接口文档等。</li> <li>额外功能——用户实际不需要的功能。</li> <li>任务切换——将人员分配到多个项目或截然不同的工作任务中。</li> <li>等待、移动、缺陷、非标准化的手动操作。</li></ul></li></ol> <h3 id="反馈原则">反馈原则</h3> <ol><li><p>在复杂系统中安全地工作</p> <ul><li>管理复杂的工作，识别出设计和操作的问题；</li> <li>群策群力解决问题，从而快速构建新知识；</li> <li>在整个组织中，将区域性的知识应用到全局范围；</li> <li>领导者要持续培养有以上才能的人。</li></ul></li> <li><p>及时发现问题</p> <ul><li>快速、频繁和高质量的信息流——每个工序的操作都会被度量和监控。</li> <li>技术价值流的每个阶段（产品管理、开发、QA、安全、运维），建立快速的反馈和前馈回路（包括自动化构建、集成和测试过程）。</li> <li>全方位的遥测系统。</li></ul></li> <li><p>在源头保障质量</p> <ul><li>过多的检查和审批流程，使得做决策的地方远离执行工作的地方，这导致流程有效性降低，减弱了因果关系之间反馈的强度。</li> <li>让开发人员也对系统质量负责，快速反馈，加速开发人员的学习。</li></ul></li> <li><p>为内部客户优化工作</p> <ul><li>运维的非功能性需求（如架构、性能、稳定性、可测试性、可配置性和安全性）与用户功能同样重要。</li></ul></li></ol> <h3 id="持续学习与实验原则">持续学习与实验原则</h3> <ol><li>建立学习型组织和安全文化</li> <li>将日常工作的改进制度化</li> <li>把局部发现转化为全局优化</li> <li>在日常工作中注入弹性模式
<ul><li>缩短部署的前置时间、提高测试覆盖率、缩短测试执行时间，甚至在必要时解耦架构，都属于在系统中引入类似张力的做法。</li></ul></li> <li>领导层强化学习文化
<ul><li>领导者帮助一线工作者在日常工作中发现并解决问题。</li></ul></li></ol> <h2 id="devops-实践">DevOps 实践</h2> <p>基于 DevOps 的相关原则，有与其对应的实践，包括：流动的技术实践、反馈的技术实践和持续学习与实验的技术实践。在应用这些实践之前还需认真设计组织结构，使其有利于实践的开展。</p> <h3 id="设计组织结构">设计组织结构</h3> <ul><li>利用康威定律设计团队结构。
<ul><li>康威定律：软件的架构和软件团队的结构是一致的。</li> <li>软件的架构应该保证小团队能够独立运作，彼此充分解耦，从而避免过多不必要的沟通和协调。</li></ul></li> <li>过度职能导向（成本优化）的危害。
<ul><li>执行工作的人通常不理解自己的工作与价值流目标的关系（“我之所以要配置这台服务器，是因为别人要我这么做”）。</li> <li>如果运维部门的每个职能团队都要同时服务于多个价值流（即多个开发团队），那么问题更是雪上加霜，因为所有团队的时间都很宝贵。</li></ul></li> <li>组建以市场为导向的团队。
<ul><li>将工程师及其专业技能（例如运维、QA和信息安全）嵌入每个服务团队，或者向团队提供自助服务平台，其功能包括配置类生产环境、执行自动化测试或进行部署。</li> <li>这使每个服务团队能够独立地向客户交付价值，而不必提交工单给IT运维、QA或信息安全等其他部门。</li></ul></li> <li>使职能导向有效。
<ul><li>快速响应。</li> <li>高度信任的文化。</li></ul></li> <li>将测试、运维和信息安全融入日常工作。
<ul><li>保证质量、可用性和安全性不是某个部门的职责，而是所有人日常工作的一部分。</li></ul></li> <li>使团队成员成为通才。
<ul><li>培养全栈工程师。</li> <li>给工程师提供学习必要技能的机会，让他们有能力构建和运行所负责的系统。</li></ul></li> <li>松耦合架构，提高生产力和安全性。</li> <li>保持小规模（“两个披萨原则”）。</li></ul> <p>要使职能导向有效，需要由传统的集中式运维向提供运维服务的方向转变。</p> <p><img src="https://tech.codelc.com/assets/img/oaas.c020ef51.png" alt="运维平台"></p> <h3 id="运维融入项目开发工作">运维融入项目开发工作</h3> <ul><li>创建共享服务（类生产环境、部署流水线、自动化测试工具、生产环境监控台、运维服务平台等），提高开发生产力。</li> <li>运维工程师融入开发团队。
<ul><li>使产品团队自给自足，可以完全负责服务的交付和支持。</li> <li>派遣工程师到项目开发团队（运维工程师的面试和聘用仍由集中式运维团队完成）。</li></ul></li> <li>为每个项目团队分派运维联络人（派遣的运维工程师）。
<ul><li>集中式运维团队管理所有环境，派遣的运维工程师需要理解：新产品的功能、开发原因、程序如何工作、可运维性、可扩展性、监控能力、架构模式、对基础设施的要求、产品特性的发布计划等。</li></ul></li> <li>邀请运维联络人参加开发团队会议、每日站会、回顾会议。</li> <li>使用看板图展示运维工作。</li></ul> <h3 id="流动的技术实践">流动的技术实践</h3> <p>该部分包含以下内容：</p> <ul><li>运行部署流水线的基础。</li> <li>实现快速可靠的自动化测试。</li> <li>代码持续集成。</li> <li>自动化和低风险发布。</li> <li>降低发布风险的架构。</li></ul> <h4 id="运行部署流水线的基础">运行部署流水线的基础</h4> <ul><li>自动化环境（开发、测试、正式）搭建。
<ul><li>使用 Shell、IaC（Puppet、Ansible、Terraform）、Docker、K8S、OpenShift 等技术。</li></ul></li> <li>所有内容做版本控制。
<ul><li>应用程序代码版本控制；</li> <li>数据库代码版本控制；</li> <li>运维配置代码版本控制；</li> <li>自动化和手动测试的脚本；</li> <li>支持代码打包、部署、数据库迁移、应用配置的脚本；</li> <li>项目相关文件（需求文档、部署过程、发布说明等）；</li> <li>防火墙配置、服务器配置等脚本。</li></ul></li> <li>扩展完成的定义。
<ul><li>在类生产环境中按照预期进行，开发工作才认为是完成的。</li></ul></li></ul> <h4 id="实现快速可靠的自动化测试">实现快速可靠的自动化测试</h4> <ul><li>持续构建、测试和集成。
<ul><li>代码分支持续集成到主干中，并确保通过单元测试、集成测试和验收测试。</li> <li>常用工具：Jenkins、TFS、TeamCity、GitLab CI。</li> <li>对持续集成的配合：自动化测试工具；一旦失败必须立即解决的文化；代码持续合入到主干，而不是持续在特性分支上工作。</li></ul></li> <li>构建快速可靠的自动化测试套件。
<ul><li>单元测试：JUnit、Mockito、PowerMock</li> <li>单元测试度量：测试覆盖率。</li> <li>验收测试：自动化API测试、自动化GUI测试。</li> <li>并行测试：安全测试、性能测试、单元测试、自动化测试。</li> <li>测试驱动开发：TDD、ATDD。</li></ul></li> <li>让部署流水线始终保持绿色状态。
<ul><li>部署流水线失败时，所有人立即解决问题或者立即回滚代码，后续的代码提交应该拒绝。</li></ul></li></ul> <h4 id="代码持续集成">代码持续集成</h4> <ul><li>持续集成代码。
<ul><li>开发人员在自己的分支上独立工作的时间越长，就越难将变更合入主干。</li></ul></li> <li>小批量开发。</li> <li>基于主干开发。
<ul><li>频繁向主干提交（通过合并请求）代码。</li></ul></li></ul> <h4 id="自动化和低风险发布">自动化和低风险发布</h4> <ul><li>自动化部署步骤：构建、测试、部署；相关流程包括：
<ul><li>代码打包、构建；</li> <li>上传 Docker 镜像；</li> <li>创建预配置的 K8S 服务；</li> <li>自动化单元测试、冒烟测试；</li> <li>数据库迁移自动化；</li> <li>配置自动化。</li></ul></li> <li>应用自动化的自助式部署
<ul><li>开发人员专注于编写代码，点击部署按钮，通过监控指标看到代码在生产环境中正常运行，在代码出错时能获得错误信息快速修复。</li> <li>通过代码审查、自动化测试、自动化部署，控制部署风险，必要时使开发人员也可进行部署操作，测试人员和项目经理可在某些环境中进行部署。</li></ul></li> <li>将部署和发布解耦
<ul><li>部署指在特定环境中安装制定版本的软件。</li> <li>发布指将产品特性提供给所有客户或部分客户使用。</li></ul></li> <li>基于环境的发布模式
<ul><li>蓝绿部署</li> <li>灰度（金丝雀）发布</li></ul></li> <li>基于应用的发布模式
<ul><li>实现特性开关，好处：轻松地回滚、缓解性能压力、可以屏蔽服务依赖。</li> <li>实现黑启动：发布潜在风险的新特性时，隐式调用，仅记录测试结果。</li></ul></li> <li>持续交付的实践
<ul><li>持续交付是指，所有开发人员都在主干上进行小批量工作，或者在短时间存在的特性分支上工作，并且定期向主干合并，同时始终让主干保持可发布状态，并能做到在正常的工作时段里按需进行一键式发布。开发人员在引入任何回归错误时（包括缺陷、性能问题、安全问题、可用性问题等），都能快速得到反馈。一旦发现这类问题，就立即加以解决，从而保持主干始终处于可部署状态。</li></ul></li> <li>持续部署的实践
<ul><li>持续部署是指，在持续交付的基础上，由开发人员或运维人员自助式地定期向生产环境部署优质的构建版本，这通常意味着每天每人至少做一次生产环境部署，甚至每当开发人员提交代码变更时，就触发一次自动化部署。</li></ul></li> <li>大多数团队采用持续交付实践。</li></ul> <h4 id="降低发布风险的架构">降低发布风险的架构</h4> <ul><li>松耦合架构</li> <li>面向服务的架构</li> <li>安全地演进企业架构
<ul><li>绞杀者应用模式：API封装已有功能、按新架构实现新功能、API版本化。</li></ul></li> <li>云原生架构</li></ul> <h3 id="反馈的技术实践">反馈的技术实践</h3> <p>这部分包含以下内容：</p> <ul><li>建立遥测系统</li> <li>智能告警</li> <li>应用反馈实现安全部署</li> <li>应用A/B测试</li> <li>建立评审和协作流程</li></ul> <h4 id="建立遥测系统">建立遥测系统</h4> <ul><li>什么是遥测（Telemetry）？
<ul><li>遥测包含监控，实现对网络实时、高速和更精细的监控技术。</li> <li>相比于传统的网络监控技术，遥测通过推模式，主动向采集器上推送数据信息，提供更实时更高速更精确的网络监控功能。</li></ul></li> <li>遥测的三大维度
<ul><li>Tracing（跟踪），Metrics（指标） , Logging（日志）。</li></ul></li> <li>可观察性
<ul><li>系统可以由其外部输出（遥测的数据）推断其内部状态的程度。</li> <li>能发现、预测并解决问题。</li></ul></li> <li>集中式监控系统（可使用：Prometheus、SkyWalking）
<ul><li>在业务逻辑、应用程序和环境层收集数据。</li> <li>负责存储和转发事件和指标的事件路由器。</li></ul></li> <li>应用程序日志遥测（ELK、审计日志、Metrics）</li> <li>重大应用事件清单：
<ul><li>认证/授权的结果（包括退出）；</li> <li>系统和数据的访问；</li> <li>系统和应用程序的变更（特别是特权变更）；</li> <li>数据的变更，例如增加、修改或删除数据；</li> <li>无效输入（可能的恶意注入、威胁等）；</li> <li>资源（内存、磁盘、中央处理器、带宽或其他任何具有硬/软限制的资源）；</li> <li>健康度和可用性；</li> <li>启动和关闭；</li> <li>故障和错误；</li> <li>断路器跳闸；</li> <li>延迟；</li> <li>备份成功/失败。</li></ul></li> <li>将建立生产遥测融入日常开发工作。</li> <li>使用遥测指导问题的解决。</li> <li>建立自助访问的可视化遥测信息系统（信息辐射器）
<ul><li>Grafana</li> <li>SkyWalking</li> <li>Kibana</li></ul></li> <li>发现和填补遥测的盲区（建立充分而完整的遥测）
<ul><li>业务级别：订单量、用户数、流失率、广告展示和点击等。</li> <li>应用程序级别：事务处理事件、应用程序故障等。</li> <li>基础架构级别：服务器吞吐量、CPU负载、磁盘使用率等。</li> <li>客户端软件级别：应用出错和崩溃、客户端的事务处理事件等。</li> <li>部署流水线级别：流水线状态、部署频率等。</li></ul></li></ul> <h4 id="智能告警">智能告警</h4> <ul><li>解决告警疲劳
<ul><li>充分而完整的遥测会引入告警疲劳问题，需要更智能的报警。</li></ul></li> <li>使用统计分析方法，而非静态阈值设置告警
<ul><li>使用均值和标准差（适用于正态分布的数据）：度量数据与均值存在较大标准差时告警。</li></ul></li> <li>使用预防故障的告警，而不只是故障发生后的告警
<ul><li>试着问有什么指标可以预测故障。</li></ul></li> <li>异常检测技术
<ul><li>平滑统计技术：使用移动平均数，利用每个点与滑动窗口中所有其他数据的平均值，来转换数据。</li> <li>支持高级异常检测的工具：Prometheus、Grafana。</li></ul></li></ul> <h4 id="应用反馈实现安全部署">应用反馈实现安全部署</h4> <ul><li>通过遥测使部署更安全——部署后能立即发现问题。</li> <li>价值流中的所有人（开发人员、开发经理、架构师、运维团队等）共同承担运维事故的下游责任。
<ul><li>共同承担值班工作、共同解决生产环境问题。</li></ul></li> <li>让开发人员跟踪工作对运维人员的影响。
<ul><li>使开发的应用易于部署，提升运维人员幸福感。</li></ul></li> <li>让开发团队自行管理生产服务。
<ul><li>首先由开发团队管理，然后才交由集中的运维团队管理。</li> <li>运维工程师由生产支持转变为顾问或加入团队，帮助做好部署准备，建立服务发布指南（包括：支持有效的监控、部署可靠、架构能支持快速频繁的部署等）。</li> <li>为团队分配SRE人员。SRE定位：SRE就是软件开发工程师负责了运维工作，SRE非常稀少，只能分配给最重要的团队。</li></ul></li></ul> <h4 id="应用a-b测试">应用A/B测试</h4> <ul><li>在功能中集成A/B测试
<ul><li>向用户随机展示一个页面的两个版本之一。</li></ul></li> <li>在发布中集成A/B测试
<ul><li>使用特性开关。</li></ul></li> <li>在功能规划中集成A/B测试
<ul><li>不仅要快速部署和发布软件，还要在实验方面不断提升，通过实验主动实现业务目标和客户满意度。</li></ul></li></ul> <h4 id="建立评审和协作流程">建立评审和协作流程</h4> <ul><li>防止「过度控制变更」
<ul><li>反事实思维容易认为事故是由于缺乏审批流程导致。</li></ul></li> <li>建立同行评审，缩短审批流程
<ul><li>DevOps 中高绩效的组织更多地依赖同行评审，更少地依赖外部变更批准（层层审批）。</li></ul></li> <li>代码评审
<ul><li>每个人的代码提交到主干时，必须由同行进行评审；</li> <li>每个人应该持续关注其他成员的提交活动；</li> <li>定义高风险变更，从而决定是否需要请领域专家进行审查；</li> <li>将大的提交变更拆分成小批量变更。</li></ul></li> <li>利用结对编程改进代码变更
<ul><li>研究表明：结对的程序员比两个独立工作的程序员慢了15%，而‘无错误’代码量却从70%增加到了85%。</li> <li>测试和调试程序的成本通常比写初始代码的成本高出多倍。</li></ul></li> <li>评估合并请求的有效性
<ul><li>与在生产环境产生的结果无关。</li> <li>有效合并请求的基本要素：必须足够详细地说明变更的原因、如何做的变更，以及任何已识别的风险和应对措施。</li></ul></li></ul> <h3 id="持续学习与实验的技术实践">持续学习与实验的技术实践</h3> <p>这部分包含以下内容：</p> <ul><li>将学习融入日常工作</li> <li>将局部经验转化为全局改进</li> <li>预留组织学习和改进的时间</li></ul> <h4 id="将学习融入日常工作">将学习融入日常工作</h4> <ul><li>公正文化和学习文化
<ul><li>人为错误往往不是问题的根本原因，可能是复杂系统中存在不可避免的设计问题而导致。</li> <li>不应该对造成故障的人进行「点名、责备和羞辱」，我们的目标是最大限度地抓住组织学习的机会。</li> <li>从学习的角度看待错误、报错、失误、过失等。</li> <li>相关实践1：在事后分析中，不指责，公正地进行评判，使工程师自己愿意对事情负责，并且热情地帮助其他人避免同样的错误发生；广泛地公开事后分析会议结果。</li> <li>相关实践2：在生产环境中引入受控的人为故障（捣乱猴），针对不可避免的问题进行演练。</li></ul></li> <li>降低事故容忍度，寻找更弱的故障信号
<ul><li>随着组织能力的提升，事故数量大幅降低，故障越不应该出现。</li> <li>在复杂的系统中，放大微弱的故障信号对于防范灾难性故障事关重要。</li></ul></li> <li>重新定义失败
<ul><li>高效能DevOps组织的变更频率是平均水平的30倍，即使失败率只有平均水平的一半，也显然意味着故障总数更多。</li> <li>鼓励创新并接受因此带来的风险。</li></ul></li> <li>创建故障演练日
<ul><li>帮助团队模拟和演练事故，使其具备实战能力。</li> <li>暴露系统的潜在缺陷。</li></ul></li></ul> <h4 id="将局部经验转化为全局改进">将局部经验转化为全局改进</h4> <ul><li>[ChatOps] 使用聊天机器人、积累组织知识
<ul><li>自动化工具集成到聊天中，比如（@bot depoy owl to production）；</li> <li>操作结果由机器人发送回聊天室，每个人都能看到发生的一切；</li> <li>新来的工程师也可以看到团队的日常工作及执行方式；</li> <li>看到他人互相帮助时，人们也会倾向于寻求帮助；</li> <li>使用话题组，建立起组织学习，知识得到快速积累。</li> <li>加强了透明、协作的文化。</li></ul></li> <li>将标准、流程和规范转化为便于执行的形式
<ul><li>[ArchOps] 使工程师成为构建者，而不是砌砖工；</li> <li>将手动操作流程转换为可自动化执行的代码；</li> <li>将合规性使用代码表达出来。</li></ul></li> <li>运用自动化测试记录和传播知识
<ul><li>自动化界面测试，令使用者知道系统如何使用；</li> <li>单元测试，令调用者知道方法API如何使用。</li></ul></li> <li>项目开发中包含非功能性的运维需求
<ul><li>对各种应用和环境进行充分的遥测；</li> <li>准确跟踪依赖关系的能力；</li> <li>具有弹性并能正常降级的服务；</li> <li>各版本之间具有向前和向后的兼容性；</li> <li>归档数据来管理生产数据集的能力；</li> <li>轻松搜索和理解各种服务日志信息的能力；</li> <li>通过多个服务跟踪用户请求的能力；</li> <li>使用功能开关或其他方法实现简便、集中式的运行时配置。</li></ul></li> <li>把可重用的运维用户故事纳入开发
<ul><li>将重复的运维工作通过编码进行实现。</li></ul></li> <li>技术选型需要考虑运维因素
<ul><li>不能减慢工作流；</li> <li>思考举例：TIDB VS MySQL 该如何选择。</li></ul></li></ul> <h4 id="预留组织学习和改进的时间">预留组织学习和改进的时间</h4> <ul><li>偿还技术债务制度化
<ul><li>定时「大扫除」</li> <li>开发和运维针对非功能性需求进行优化，横跨整个价值流。</li> <li>价值：赋予一线工作人员不断识别和解决问题的能力。</li></ul></li> <li>让所有人教学相长
<ul><li>所有的工程师都越来越需要某些技能，而不只是开发人员如此。</li> <li>越来越多的技术价值流采用了DevOps的原则和模式。</li> <li>[每周学习文化] 每周一次的学习时间，每个同伴既要自己学习，又要教别人。</li></ul></li> <li>内部顾问和教练
<ul><li>成立内部的教练和咨询组织，促进专业知识在组织内的传播。</li></ul></li></ul> <h2 id="实践重点">实践重点</h2> <p>DevOps 的实践包含许多内容，提炼了以下重点方便查阅：</p> <ul><li>流动原则的实践
<ul><li>部署流水线的基础（所有内容做版本控制、在类生产环境按预期工作才算完成）</li> <li>实现快速可靠的自动化测试（自动化运行、始终保持流水线处于绿色状态）</li> <li>代码持续集成（小批量开发）</li> <li>自动化和低风险发布（自助式部署、部署和发布解耦、采用持续交付）</li> <li>降低发布风险的架构（云原生架构）</li></ul></li> <li>反馈原则的实践
<ul><li>建立遥测系统（Tracing、Metrics、Logging）</li> <li>智能告警（使用统计分析方法和预防故障的告警）</li> <li>应用反馈实现安全部署（部署后立即发现问题、共同承担责任）</li> <li>应用A/B测试（功能规划中集成A/B测试、使用特性开关）</li> <li>建立评审和协作流程（同行评审、减少审批流程、结对编程）</li></ul></li> <li>持续学习与实验原则的实践
<ul><li>将学习融入日常工作（从学习的角度看待事故、寻找更弱的故障信号）</li> <li>将局部经验转化为全局改进（ChatOps、让规范便于执行、非功能性的运维需求）</li> <li>预留组织学习和改进的时间（定时偿还技术债务、教学相长、内部教练）</li></ul></li></ul> <h2 id="结语">结语</h2> <p>DevOps 的发展与技术的发展相辅相成，也为技术人员提供了更多的学习道路和发展方向，借用一句 DevOps 领袖的话来作为本文的结束语。</p> <blockquote><p>对于所有热爱创新、热爱变革的专业技术人士来说，我们的前方是美好而充满活力的未来。</p></blockquote>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[使用开源工作流自动化工具 n8n 打造个人助理]]></title>
            <link>https://tech.codelc.com/docs/tools/n8n.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/tools/n8n.html</guid>
            <pubDate>Thu, 20 May 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p><a href="https://github.com/n8n-io/n8n" target="_blank" rel="noopener noreferrer">n8n<span> </span></a> 是一个开源的工作流自动化工具，类似于 IFTTT。它的优点是开源、可以自托管、下载安装方便、易于使用，可以互联的服务包括 Github、Google、RSS、Slack、Telegram、Gitlab、Redis、RabbitMq、数据库等等上百种服务。使用 n8n 可以方便地实现当 A 条件发生，触发 B 服务这样的自动工作流程。</p> <p><img src="https://tech.codelc.com/assets/img/n8n-screenshot.6a7359a1.png" alt="n8n"></p> <h2 id="安装使用">安装使用</h2> <p>n8n 使用 TypeScript 编写，支持 npx 直接运行，安装 nodejs 运行以下命令即可运行，简直不要太简单。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx n8n
</code></pre></div><h2 id="发现可以自动化的工作流">发现可以自动化的工作流</h2> <p>运行 n8n 后我们可以直观到看到利用它可以连接许多服务，但是如何为我所用呢？哪些场景下可以用上它，这需要我们首先识别重复的工作流。</p> <p>列举一些将重复工作流自动化的例子：</p> <ul><li>每天都会逛某几个网站。
<ul><li>聚合网站信息，当有新内容时，通过聊天机器人自动通知。</li></ul></li> <li>每天上班第一件事情需要先查看是否有未处理的代码合并请求。
<ul><li>可以让 n8n 连接 gitlab/github 检查是否有代码合并请求，有则使用聊天机器人自动通知审查团队。</li></ul></li> <li>出于工作需要，经常需要从数据库导出数据到 excel 并邮件给其他人，这个任务不足以做到系统功能中。
<ul><li>使用 n8n 连接数据库、excel、邮件服务，将其自动化。</li></ul></li> <li>redis 内存没有及时释放，需要定时扫描手动触发内存释放。
<ul><li>使用 n8n 连接 redis，当内存达到设定值时自动执行脚本触发内存释放。</li></ul></li> <li>需要定期备份工作流配置。
<ul><li>自动将本地 n8n 配置备份到云端。</li></ul></li></ul> <p>以上简单列举一些例子，这些重复工作看似不耗时间，好像不值得花费精力将其自动化，但当我们识别出越来越多这样的工作流并将其自动化后，我们就拥有了一个强大的个人助理。</p> <h2 id="必备的几个常用工作流节点">必备的几个常用工作流节点</h2> <p><img src="https://tech.codelc.com/assets/img/n8n_nodes.f114dfb2.png" alt="n8n 节点"></p> <p>n8n 拥有上百个工作流节点，许多节点你并不一定用的上，下面是一些常用的节点，我将简单介绍一下它们的作用。</p> <h3 id="cron">Cron</h3> <p>设置定时任务，Cron 触发器自然少不了。</p> <h3 id="if">IF</h3> <p>根据输入数据设置 IF 条件决定下一步操作。</p> <h3 id="function">Function</h3> <p>Function 节点中可以编写 JS 代码，对于复杂的 IF 条件也可以先通过 Function 来输出 bool 值以简化 IF 的判断。</p> <p>以下是 Function 的示例代码，注意必须按照 items 的数据模式返回数据。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> day <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> weekday <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Sunday"</span><span class="token punctuation">,</span> <span class="token string">"Monday"</span><span class="token punctuation">,</span> <span class="token string">"Tuesday"</span><span class="token punctuation">,</span> <span class="token string">"Wednesday"</span><span class="token punctuation">,</span> <span class="token string">"Thursday"</span><span class="token punctuation">,</span> <span class="token string">"Friday"</span><span class="token punctuation">,</span> <span class="token string">"Saturday"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>date_today <span class="token operator">=</span> date<span class="token punctuation">;</span>
items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>day_today <span class="token operator">=</span> weekday<span class="token punctuation">[</span>day<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> items<span class="token punctuation">;</span>
</code></pre></div><h3 id="request">Request</h3> <p>若没有内置的连接服务，可以自定义 HTTP 请求。</p> <h3 id="telegram">Telegram</h3> <p>用 Telegram 的工作流节点发送消息非常方便，我们可以创建一个 Telegram 机器人，通过 Request 获取数据，再使用机器人将消息发送给自己或他人。</p> <h2 id="发现更多玩法">发现更多玩法</h2> <p>n8n 的工作流配置可以保存为 json 文件与他人分享，目前 n8n 的社区还在发展当中，相信未来会有许多人分享自己配置好的工作流，届时我们使用 n8n 的能力也将大幅提升。</p> <p>当然现在也不妨去发现好玩的用法，探索下新奇的世界，尝试使用 n8n 连接你的 Telegram 试试吧。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[Javascript] 使用 lit 编写 Web Components 简化 Layui 代码]]></title>
            <link>https://tech.codelc.com/docs/js/lit_layui.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/js/lit_layui.html</guid>
            <pubDate>Wed, 05 May 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h1 id="layui-介绍">Layui 介绍</h1> <p>Layui 是一套开源的 Web UI 解决方案，主要面向的是不熟悉前端开发的后端开发人员，使用这套框架可以大大提升后台系统的开发效率，这套框架也有其不足之处，其未采用现代化的前端开发方式，而使用的是原生 html、css、js 的编写方式，所以许多前端工程师认为这套框架在技术上并没有多少创新之处并且也不适用于大型项目，这些看法并没有问题，但 Layui 也有其优势，毕竟许多后台系统或个人项目用不上太过复杂的前端技术。</p> <p>在后台系统开发的初期，只需按照 Layui 提供的文档和 demo 依葫芦画瓢即可完成功能开发，但在系统功能越来越多的情况下，会发现存在许多重复模式的代码，比如下面的一个表单 html 代码片段。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-form<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-inline<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-form-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-form-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>名称:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input-block<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 200px</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input<span class="token punctuation">"</span></span>
        <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span>
        <span class="token attr-name">lay-verify</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>required<span class="token punctuation">"</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-inline<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-form-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-form-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>编码:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input-block<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 200px</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
        <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sourceCode<span class="token punctuation">"</span></span>
        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input<span class="token punctuation">"</span></span>
        <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span>
        <span class="token attr-name">lay-verify</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>required<span class="token punctuation">"</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-form-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input-block<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-btn<span class="token punctuation">"</span></span> <span class="token attr-name">lay-submit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">lay-filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>save<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>保存<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-btn layui-btn-primary<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cancel<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        取消
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这种写法相比组件化开发的 React 或 Vue 确实差了许多，我们可以在 Layui 后台中引入 React 或 Vue 来混合使用，但这样一来增加了复杂性和学习成本，毕竟选用 Layui 作为后台框架的开发人员大多数是不熟悉前端开发的，那么在这种情况下，有没有一种方式在不增加多少复杂性和学习成本的前提下使得项目能应用上组件开发呢？答案是有的，Web Components 就是其中一个，其比 React 简单，且受浏览器原生支持。</p> <h1 id="web-components-介绍">Web Components 介绍</h1> <p>随着 React 等技术的流行，前端工程化的发展越来越快，浏览器也在不断适应这种发展并且逐步开始原生支持一些优秀的技术，比如组件化开发，谷歌作为 Chrome 浏览器的拥有者，一直在推进 Web Components 技术的发展，目前许多主流浏览器已经支持 Web Components 技术。关于 Web Components 的简介可参考 <a href="http://www.ruanyifeng.com/blog/2019/08/web_components.html" target="_blank" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2019/08/web_components.html<span> </span></a> 这篇博客。</p> <p>我们通过一个 hello world 示例来直观的看看 Web Components 的写法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// Attach a shadow root to the element.</span>
      <span class="token keyword">let</span> shadowRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'open'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      shadowRoot<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p&gt;hello world&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'hello-world'</span><span class="token punctuation">,</span> HelloWorld<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>hello<span class="token operator">-</span>world<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>hello<span class="token operator">-</span>world<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><p>这个示例很简单，但是细心的朋友还是会发现一些问题，比如上图中的 innerHTML 写的是字符串，这对于复杂组件的开发必然是不利的，虽然可以通过 template 标记来解决但仍然不是很好的方式，为了解决这类问题，谷歌开源了 <a href="https://github.com/lit/lit" target="_blank" rel="noopener noreferrer">lit<span> </span></a> 项目，使用这个组件可以让开发 Web 组件更加简便，当然其学习成本是很低的。</p> <h1 id="lit-介绍">lit 介绍</h1> <p>使用 lit 可以简化 Web 组件的开发，我们直接看一个示例代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>html<span class="token punctuation">,</span> css<span class="token punctuation">,</span> LitElement<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
​
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SimpleGreeting</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">styles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> css<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">p { color: blue }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
​
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
​
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Somebody'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
​
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p&gt;Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
​
customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'simple-greeting'</span><span class="token punctuation">,</span> SimpleGreeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>simple-greeting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>World<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>simple-greeting</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这个示例相比前面的略微复杂一些，但增加了属性、样式和表达式的用法，这个简单的例子让我们已经有了大部分组件化开发的能力，下面就让我们使用 lit 编写 Web Components 来封装 Layui 代码。</p> <h1 id="lit-结合-layui">lit 结合 Layui</h1> <p>在后台系统中，列表页是最常见的功能之一，列表页上多数情况下也有搜索表单，我们先看使用 Layui 时的一个普遍写法，下面的代码包含列表查询、打开增加或修改窗口的代码。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-fluid<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-row layui-col-space10<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">margin-top</span><span class="token punctuation">:</span> 5px</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-form<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input-inline<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>名称<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input-inline<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 120px</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input<span class="token punctuation">"</span></span>
          <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span>
          <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请输入名称<span class="token punctuation">"</span></span>
          <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span>
        <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-input-inline<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-btn<span class="token punctuation">"</span></span>
          <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchBtn<span class="token punctuation">"</span></span>
          <span class="token attr-name">lay-submit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span>
          <span class="token attr-name">lay-filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span>
        <span class="token punctuation">&gt;</span></span>
          搜索
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!--定义表格--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>layui-row<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tb<span class="token punctuation">"</span></span> <span class="token attr-name">lay-filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Lay<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/html<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>toolbar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"layui-btn-container"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"layui-btn layui-btn-sm"</span> lay<span class="token operator">-</span>event<span class="token operator">=</span><span class="token string">"addBtn"</span><span class="token operator">&gt;</span>添加<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/html<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"layui-btn layui-btn-xs"</span> lay<span class="token operator">-</span>event<span class="token operator">=</span><span class="token string">"edit"</span><span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"form"</span><span class="token punctuation">,</span> <span class="token string">"table"</span><span class="token punctuation">,</span> <span class="token string">"laytpl"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> form <span class="token operator">=</span> layui<span class="token punctuation">.</span>form<span class="token punctuation">,</span>
      table <span class="token operator">=</span> layui<span class="token punctuation">.</span>table<span class="token punctuation">,</span>
      layer <span class="token operator">=</span> parent<span class="token punctuation">.</span>layer <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> layui<span class="token punctuation">.</span>layer <span class="token operator">:</span> parent<span class="token punctuation">.</span>layer<span class="token punctuation">,</span>
      $ <span class="token operator">=</span> layui<span class="token punctuation">.</span>jquery<span class="token punctuation">;</span>

    <span class="token keyword">var</span> tableIns <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">elem</span><span class="token operator">:</span> <span class="token string">"#tb"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">toolbar</span><span class="token operator">:</span> <span class="token string">"#toolbar"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">defaultToolbar</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">even</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/getList"</span><span class="token punctuation">,</span> <span class="token comment">//数据接口</span>
      <span class="token literal-property property">page</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">"full-40"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">request</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">pageName</span><span class="token operator">:</span> <span class="token string">"page"</span><span class="token punctuation">,</span> <span class="token comment">//页码的参数名称，默认：page</span>
        <span class="token literal-property property">limitName</span><span class="token operator">:</span> <span class="token string">"pageSize"</span><span class="token punctuation">,</span> <span class="token comment">//每页数据量的参数名，默认：limit</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>
      <span class="token function-variable function">parseData</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">code</span><span class="token operator">:</span> res<span class="token punctuation">.</span>code<span class="token punctuation">,</span> <span class="token comment">//解析接口状态</span>
          <span class="token literal-property property">msg</span><span class="token operator">:</span> res<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">//解析提示文本</span>
          <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//解析数据长度</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//解析数据列表</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//解析接口状态</span>
            <span class="token literal-property property">msg</span><span class="token operator">:</span> res<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">//解析提示文本</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>total<span class="token punctuation">,</span> <span class="token comment">//解析数据长度</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token comment">//解析数据列表</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cols</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"名称"</span><span class="token punctuation">,</span> <span class="token literal-property property">align</span><span class="token operator">:</span> <span class="token string">"center"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">"code"</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"编码"</span><span class="token punctuation">,</span> <span class="token literal-property property">align</span><span class="token operator">:</span> <span class="token string">"center"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">done</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//对表格工具栏的操作</span>
    table<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"tool(Lay)"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> data <span class="token operator">=</span> obj<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token comment">//获得当前行数据</span>
        layEvent <span class="token operator">=</span> obj<span class="token punctuation">.</span>event<span class="token punctuation">;</span> <span class="token comment">//获得 lay-event 对应的值</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>layEvent <span class="token operator">===</span> <span class="token string">"edit"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        layer<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"编辑"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">shadeClose</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">maxmin</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">area</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"450px"</span><span class="token punctuation">,</span> <span class="token string">"550px"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">shift</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">"edit.html?id="</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          <span class="token function-variable function">end</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tableIns<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//查询</span>
    form<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"submit(search)"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> data<span class="token punctuation">.</span>field<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      tableIns<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//头工具栏事件</span>
    table<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"toolbar(Lay)"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>event <span class="token operator">==</span> <span class="token string">"addBtn"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        layer<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"添加"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">shadeClose</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">maxmin</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">area</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"450px"</span><span class="token punctuation">,</span> <span class="token string">"550px"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">shift</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">"add.html"</span><span class="token punctuation">,</span>
          <span class="token function-variable function">end</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tableIns<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>几乎每个列表页都要按照以下样板代码进行编写，新增一个列表页时必然是复制以下代码进行修改，导致整个系统到处充斥着重复代码。使用 Web Components 可以解决这些问题，下面我们看看使用 lit 如何将这些样板代码进行封装。</p> <p>下面的代码定义了一个 <strong>search-table</strong> 组件，这个组件比原有的表格在功能上更加丰富，能够根据设置自动渲染搜索的表单和工具栏。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./lit-element/lit-element.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./search-form.js"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SearchTable</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">renderSetting</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Object <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">toolbars</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Array <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">createRenderRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;div class="layui-fluid"&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderSearchForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

        &lt;!--定义表格--&gt;
        &lt;div class="layui-row"&gt;
          &lt;table id="Table" lay-filter="Lay"&gt;&lt;/table&gt;
        &lt;/div&gt;

        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderTableToolbar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderFieldToolbar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/div&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">renderSearchForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> searchSettings <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">searchSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>searchSettings<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;search-form
          searchSettings=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>searchSettings<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        &gt;&lt;/search-form&gt;
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">searchSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> searchSettings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderSetting<span class="token punctuation">.</span>cols<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">col</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>col<span class="token punctuation">.</span>search<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> searchSetting <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">field</span><span class="token operator">:</span> col<span class="token punctuation">.</span>field<span class="token punctuation">,</span>
          <span class="token literal-property property">label</span><span class="token operator">:</span> col<span class="token punctuation">.</span>label <span class="token operator">||</span> col<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
          <span class="token literal-property property">valueType</span><span class="token operator">:</span> col<span class="token punctuation">.</span>valueType<span class="token punctuation">,</span>
          <span class="token literal-property property">valueEnum</span><span class="token operator">:</span> col<span class="token punctuation">.</span>valueEnum<span class="token punctuation">,</span>
          <span class="token literal-property property">tooltip</span><span class="token operator">:</span> col<span class="token punctuation">.</span>tooltip<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        searchSettings<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>searchSetting<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> searchSettings<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">renderTableToolbar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>toolbars <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>toolbars<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderToolbar</span><span class="token punctuation">(</span><span class="token string">"toolbar"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>toolbars<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">renderToolbar</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> toolbars</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>toolbars <span class="token operator">&amp;&amp;</span> toolbars<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;script type="text/html" id="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;
          &lt;div class="layui-btn-container"&gt;
            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>toolbars<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
              <span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                &lt;button class="layui-btn layui-btn-sm" lay-event="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bar<span class="token punctuation">.</span>event<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"&gt;
                  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bar<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                &lt;/button&gt;
              </span><span class="token template-punctuation string">`</span></span>
            <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
          &lt;/div&gt;
        &lt;/script&gt;
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">renderFieldToolbar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fieldBars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>renderSetting<span class="token punctuation">.</span>cols<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">col</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>col<span class="token punctuation">.</span>toolbar <span class="token operator">&amp;&amp;</span> col<span class="token punctuation">.</span>toolbars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">toolbars</span><span class="token operator">:</span> col<span class="token punctuation">.</span>toolbars<span class="token punctuation">,</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> col<span class="token punctuation">.</span>toolbar<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        fieldBars<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fieldBars<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderToolbar</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>id<span class="token punctuation">,</span> bar<span class="token punctuation">.</span>toolbars<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"search-table"</span><span class="token punctuation">,</span> SearchTable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于 search-table 的属性是对象，而 html 标记上的属性只能设置字符串，因此在赋值时需要将 json 序列化后写在属性上，写法上并不方便，我们可再增加一个工具方法来优化组件的编写方式。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">renderComponent</span><span class="token punctuation">(</span><span class="token parameter">tagName<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> attrs<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      element<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>outerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">renderTable</span><span class="token punctuation">(</span><span class="token parameter">attrs<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">renderComponent</span><span class="token punctuation">(</span><span class="token string">"search-table"</span><span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">applyTableSetting</span><span class="token punctuation">(</span>attrs<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>renderTable</strong> 方法中包含 <strong>search-table</strong> 组件的输出，并应用表格相关的设置。封装完成后我们看看最终的写法。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">renderTable</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">toolbars</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"添加"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">"addBtn"</span><span class="token punctuation">,</span>
          <span class="token function-variable function">onEvent</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> tableIns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"添加"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">area</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"450px"</span><span class="token punctuation">,</span> <span class="token string">"550px"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">"add.html"</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">renderSetting</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"/getList"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">cols</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"名称"</span><span class="token punctuation">,</span> <span class="token literal-property property">search</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">align</span><span class="token operator">:</span> <span class="token string">"center"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">"code"</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"编码"</span><span class="token punctuation">,</span> <span class="token literal-property property">align</span><span class="token operator">:</span> <span class="token string">"center"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
              <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"操作"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">align</span><span class="token operator">:</span> <span class="token string">"center"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">toolbar</span><span class="token operator">:</span> <span class="token string">"#bar"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">fixed</span><span class="token operator">:</span> <span class="token string">"right"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">"10%"</span><span class="token punctuation">,</span>
              <span class="token literal-property property">toolbars</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"修改"</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">"edit"</span><span class="token punctuation">,</span>
                  <span class="token function-variable function">onEvent</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token punctuation">{</span>
                      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"编辑"</span><span class="token punctuation">,</span>
                      <span class="token literal-property property">area</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"450px"</span><span class="token punctuation">,</span> <span class="token string">"550px"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token literal-property property">content</span><span class="token operator">:</span>
                        <span class="token string">"edit.html?id="</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>只需要这么一点代码就完成了最初 Layui 版本所实现的一样的功能，在封装时沿用并扩展了 Layui 表格的属性，使得兼容原有 Layui 的 api，注意在名称一列新增了 search 扩展属性，设置为 true 即将该字段自动加入到搜索表单中。</p> <p>文章中仅包含部分代码，上文中涉及的 Web Components 的全部代码请查看 <a href="https://github.com/lcomplete/TechShare/tree/master/docs/js/web_components" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/TechShare/tree/master/docs/js/web_components<span> </span></a> 。注意这里面许多代码是根据项目实际情况进行封装的，为进行简化，全部组件的封装代码也并未给出，希望读者朋友能够领会组件化开发和 DRY 的编程思想。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[研发质量与效率的绩效指标设计]]></title>
            <link>https://tech.codelc.com/docs/thinking/coder_kpi.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/thinking/coder_kpi.html</guid>
            <pubDate>Tue, 30 Mar 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>程序员的 KPI 指标设计一直是业界的一大难题，因为研发人员的工作绩效很难量化，即便如此还是需要制定相应的绩效指标，这些指标有部分可以简单量化，但都无法最终衡量研发的质量和效率，还是需要经验丰富的管理人员加以主观的判断。</p> <p>关于软件质量的概述在《代码大全》一书中有非常详细的介绍，其中提到软件质量包含外部质量和内部质量，外部质量指软件的外部特征包括软件易用性等，内部质量指软件内部特征包括代码质量等。</p> <p>在给研发人员制定绩效指标的时候，可以综合考虑软件外部质量和软件内部质量，以便更好地引导其更全方位地提升研发质量。</p> <h2 id="研发质量指标">研发质量指标</h2> <p>需要关注的研发质量指标包括以下这些：</p> <ul><li>软件外部质量（软件外部特征）
<ul><li>正确性（整个系统设计和实现的正确程度，bug 多则正确性低，但还应考虑程度）</li> <li>可用性（使用系统的难易程度）</li> <li>效率、性能（对系统资源的最小利用，包括存储和执行时间）</li> <li>可靠性（成功执行特定功能的能力）</li> <li>完整性（完整性内容包括：防止非法或不适当地访问的能力、参数校验、界面、安全性等，可以综合衡量工作的真实完成度）</li> <li>适应性（系统在多个环境下不做修改就能使用的能力，比如移动端也能正常使用）</li> <li>精确性（系统不受错误影响的程度，尤其在数据报表方面，精确性是对工作性能良好的衡量）</li> <li>稳定性（应对无效输入或并发较大仍能提供服务的能力）</li></ul></li> <li>软件内部质量（软件内部特征/代码质量）
<ul><li>符合编码规范</li> <li>可维护性（修改系统以增加功能、提升性能、修复 bug 的能力）</li> <li>灵活性（修改后能适用不同用途或环境的能力）</li> <li>可移植性（修改后能在其他环境下运行的能力）</li> <li>可重用性（用于其他系统或模块的难易程度）</li> <li>可读性（能理解系统源代码的能力）</li> <li>可测试性（对系统编写单元测试或进行系统测试的难易程度）</li> <li>可理解性（能从整个系统水平或细节说明上理解整个系统的难易程度，相比可读性更偏向不同系统间的交互是否易于理解）</li> <li>单元测试质量（测试代码质量、单元测试覆盖率等）</li> <li>可测试性（代码的可测试性，通常高内聚低耦合的代码更具有可测试性）</li></ul></li> <li>文档质量
<ul><li>外部文档（综合资料、技术方案、详细设计文档）</li> <li>程序内文档（编码风格、可读性、有效注释）</li></ul></li> <li>系统安全</li></ul> <h2 id="研发效率指标">研发效率指标</h2> <p>在研发质量部分提及了许多指标，因为质量与效率的相互影响，效率部分似乎难以提取出额外指标，其实不然，研发效率不应局限于个体成员的编码速度、任务完成速度上，而应多从团队整体效率出发，对于提升团队整体效率的行为要加以鼓励。</p> <p>研发效率指标包括：</p> <ul><li>项目及任务按时完成率</li> <li>编码效率</li> <li>敏捷反馈（尽早提测、持续集成）</li> <li>敏捷编码（保持简单、合理设计、增量开发）</li> <li>敏捷协作
<ul><li>代码提交质量</li></ul></li> <li>项目提测质量</li> <li>及时准确地反馈真实进度</li> <li>团队技术指导</li></ul> <h2 id="向专业人士看齐">向专业人士看齐</h2> <p>以上的常规指标，可以用于管理人员制定绩效指标，也可以作为研发人员检验自己工作完成度的一份清单，除此之外，做一些对整个团队有利的事情能够更显专业。</p> <p>当研发人员表现出以下的一些行为时，管理人员往往会给其「超出期望」的评价。</p> <ul><li>积极参与代码审查，发表有效代码评论。</li> <li>踊跃分享个人知识与经验。</li> <li>对已有代码的有效重构。</li> <li>发现或修复系统现有错误。</li> <li>抽取通用代码，减少重复编码现象。</li> <li>使现有重复性工作自动化。</li> <li>帮助团队成员解决技术难题。</li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[Java] Spring 项目开发最佳实践]]></title>
            <link>https://tech.codelc.com/docs/java/spring_best_practice.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/java/spring_best_practice.html</guid>
            <pubDate>Sun, 17 Jan 2021 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h2 id="零、前言">零、前言</h2> <p>由阿里向 Java 社区开源的 Java 开发手册其中包含许多优秀的实践，本文档可作为该手册的扩展内容，针对许多项目开发现状而编写，其中少部分内容引用自该手册，由于是重点内容，所以在该文档中再次强调。</p> <p>本文在提供最佳实践的前提下尽可能保持规范的灵活性，因此在可以使用多种开发方式的情况下，本文列出多种较好方式，但更推荐排在前面的方式，也希望读者能够灵活运用该文档。</p> <h2 id="一、准备工作">一、准备工作</h2> <h3 id="ide-的选择">IDE 的选择</h3> <p>使用 IntelliJ IDEA 作为集成开发环境。</p> <h3 id="idea-插件推荐">IDEA 插件推荐</h3> <ul><li>Alibaba Java Coding Guide</li> <li>Lombok</li> <li>Maven Helper</li> <li>SonarLint</li> <li>GitToolBox</li></ul> <p>简单列举几个通用的五星插件，还有许多专门领域的插件，例如 MyBatis、JPA 等，后续专门写一篇文章来进行介绍。</p> <h3 id="jdk-版本">JDK 版本</h3> <p>默认使用 JDK 1.8，根据项目情况判断是否使用高版本。</p> <h3 id="编程规范">编程规范</h3> <p>请阅读：</p> <ul><li><a href="https://github.com/alibaba/p3c" target="_blank" rel="noopener noreferrer">阿里巴巴Java开发手册<span> </span></a></li></ul> <ul><li><a href="http://hawstein.com/2014/01/20/google-java-style/" target="_blank" rel="noopener noreferrer">Google Java编程风格指南<span> </span></a></li></ul> <h3 id="其他必用工具">其他必用工具</h3> <p>Maven、Lombok、JUnit。</p> <p>Maven 父 pom 为基础框架的 starter-parent，建议参考 <code>spring-boot-starter-parent</code> 项目进行编写。</p> <h2 id="二、命名规范">二、命名规范</h2> <p>说明：当规范中包含多个名称时，优先使用前面的。</p> <h3 id="顶层包名规范">顶层包名规范</h3> <p>最外层包名结构：<code>com.${公司简拼}.${项目分组}.${项目名称}.${子包名}</code></p> <p>分段：包名至少为4段，小项目可以使用4段。</p> <h3 id="通用项目分层包名和类名规范">通用项目分层包名和类名规范</h3> <ul><li><p>控制器层包名：controller</p> <p>类名：Controller</p></li> <li><p>Restful 控制器包名：controller.rest</p> <p>Restful 类名：Resource（偏 Restful 风格、包含数据的增删改查的控制器也可使用该后缀）</p></li> <li><p>服务包名：service</p> <p>类名：Service</p></li> <li><p>SPI（Service Provider API）包名：spi</p></li> <li><p>通用业务处理层包名：manager</p> <p>类名：Manager</p></li> <li><p>spring 配置包名：config</p> <p>类名：Config（符合国人编写习惯）、Configuration</p></li> <li><p>DAO 层包名：repository（使用 jpa 、jdbc等数据访问层技术时）、mapper（使用 mybatis 时）、dao</p> <p>类名：Repository（使用 jpa 、jdbc等数据访问层技术时）、Mapper（使用 mybatis 时）、DAO、CustomXXXRepository（自定义 jpa Repository）</p></li> <li><p>数据库实体包名：entity（entity 相比 domain 更加精确）、domain.entity、domain</p></li> <li><p>DTO 包名：dto</p> <p>类名：DTO</p></li> <li><p>视图模型对象包名：vo</p> <p>类名：VO</p></li> <li><p>数据模型包名：model，这里放置业务相关的数据模型（更贴近领域模型而非数据库模型）。</p></li> <li><p>枚举包名：enums</p></li> <li><p>常量包名：constant</p> <p>类名：<strong>禁止使用 Constants 类名（不允许使用含糊不清的名词，必须有具体的指向意义）</strong> ，必须按类型进行常量的归类，应用相关的常量类命名为 AppConstants。</p></li> <li><p>Aspect 实现类包名：aop</p> <p>类名：Aspect</p></li> <li><p>异常类包名：exception</p> <p>类名：Exception</p></li> <li><p>Spring Filter 包名：filter</p> <p>类名：Filter</p></li> <li><p>安全相关类包名：security</p></li> <li><p>工具类包名：util</p> <p>类名：Utils</p></li> <li><p>注解包名：annotation</p></li> <li><p>自定义 Spring 事件包名：event、event.listener (事件监听处理)、event.model（自定义事件模型）</p> <p>监听器类：Listener</p> <p>事件模型类：Event</p></li></ul> <h3 id="项目包名类名示例">项目包名类名示例</h3> <p>通用包名类名示例图：</p> <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/111efc5f0a5043acbb2376b3a28915ae~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p><strong>注：这里仅作为包名示例，这些包不一定需要放置在最外层，需要根据实际情况组织层次结构。</strong></p> <p>部分包可能会存在其他模块中，比如 util、filter、security 大多数时候都封装在其他模块中，如果该模块需要特殊定制才加入。</p> <p>当一个项目出现这么多模块时，结构上可以重新组织，比如将数据模型相关的统一组织在 domain 包中，如下图所示。</p> <p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7215733a1faa4091ad4c286ce26c380b~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p> <p>规范的包名能够起到见名知意的效果，但包的结构如何组织并非一成不变的，需要根据实际情况进行调整，<strong>在同一层级的包名不宜过多，过多时需要重新组织，从而使代码所有者能够快速定位到所需代码中。</strong></p> <h2 id="三、项目结构">三、项目结构</h2> <h3 id="阿里应用分层规范">阿里应用分层规范</h3> <p>图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于</p> <p>Web 层，也可以直接依赖于 Service 层，依此类推。</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e812e8e98cb24ced935e16a0e7fb6b44~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <p>• 开放接口层：可直接封装 Service 方法暴露成 RPC 接口；通过 Web 封装成 http 接口；进行网关安</p> <p>全控制、流量控制等。</p> <p>• 终端显示层：各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染，JSP 渲染，移动端展示等。</p> <p>• Web 层：主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等，<strong>Controller 层不可以直接调用 DAO 层</strong>。</p> <p>• Service 层：相对具体的业务逻辑服务层。</p> <p>• Manager 层：通用业务处理层，它有如下特征：</p> <div class="language- extra-class"><pre><code>1）对第三方平台封装的层，预处理返回结果及转化异常信息。

2）对 Service 层通用能力的下沉，如缓存方案、中间件通用处理。

3）与 DAO 层交互，对多个 DAO 的组合复用。
</code></pre></div><p>• DAO 层：数据访问层，与底层 MySQL、Oracle、Hbase 等进行数据交互。</p> <p>• 外部接口或第三方平台：包括其它部门 RPC 开放接口，基础平台，其它公司的 HTTP 接口。</p> <h3 id="分层领域模型规约">分层领域模型规约</h3> <p>• DO（Data Object，<strong>不需要添加后缀</strong>）：此对象与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。</p> <p>• DTO（Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。</p> <p>• BO（Business Object）：业务对象，由 Service 层输出的封装业务逻辑的对象。</p> <p>• VO（View Object）：显示层对象，通常是 Web 向模板渲染引擎层传输的对象。</p> <p>• Query：数据查询对象，各层接收上层的查询请求。注意超过 2 个参数的查询封装，禁止使用 Map 类来传输。</p> <h2 id="四、微服务项目结构">四、微服务项目结构</h2> <h3 id="服务间通信实践">服务间通信实践</h3> <p><strong>可以暴露为 RPC（REST） 服务的分层：</strong></p> <ul><li>Controller</li> <li>Service</li></ul> <p><strong>哪些情况下可以调用 Service 层的 RPC 服务？</strong></p> <ul><li>调用方属于当前领域限界上下文的服务，或者说调用方与提供方属于同一组微服务。</li></ul> <p><strong>不同领域限界上下文的服务，不能互相调用 Service 层级的 RPC 服务，必须通过 Controller 层进行 Api 交互（更好的方式是使用领域集成事件/消息异步通信）。</strong></p> <p><strong>异步通信</strong></p> <ul><li>异步通信使用 Spring Cloud Bus。</li></ul> <h3 id="服务提供方-provider-开发实践">服务提供方（Provider）开发实践</h3> <p>RPC 接口和实现各自放在独立的模块中，方便服务调用方重用服务接口。</p> <p><strong>服务接口模块只能包含最基本的模块依赖（过多会导致依赖传递），dto 必须是 pojo 。</strong></p> <p>服务的接口及相关模型必须放在同一模块中，该模块仅包含这些内容，<strong>服务提供方的接口中不能指定 FeignClient 注解（在消费方指定），在方法中可以使用 RequestMapping 等注解</strong>。</p> <h3 id="服务消费方-consumer-开发实践">服务消费方（Consumer）开发实践</h3> <p>引用 RPC 接口模块，在消费方编写客户端类继承相关接口，在客户端接口上增加 FeignClient 注解即可。</p> <h3 id="微服务项目包名类名实践">微服务项目包名类名实践</h3> <ul><li><p>服务提供方接口模块包名：service.contract、service.api 或 service.support 等</p> <p>RPC 服务接口名：Service</p></li> <li><p>服务提供方模块包名：service.provider</p> <p>RPC 服务类：ServiceImpl、Resource（提供资源的增删改查时）</p></li> <li><p>对外接口包名：api、portal（若不需要走网关）</p></li> <li><p>RPC 服务客户端类名：Client</p></li></ul> <h2 id="五、controller-层开发实践">五、Controller 层开发实践</h2> <h3 id="controller-接口定义">Controller 接口定义</h3> <ul><li><p>Url 映射名与方法名应该保持高度相关性，尽量一致，当 url 需要设计的相对精简时可以有细微的命名差异。</p></li> <li><p>请求参数注意事项：</p> <ul><li>不能出现用户信息等敏感数据，相关信息应该通过加密 cookie 等方式传递。</li> <li>请求参数超过4个时，应当使用 VO 或 DTO 对象进行封装。</li></ul></li> <li><p>返回对象注意事项：</p> <ul><li>返回类型必须使用强类型，错误示例：<code>ApiResult&lt;Object&gt;</code>、<code>Object</code>、<code>Map&lt;String,Object&gt;</code>。</li> <li>数据敏感性不高的情况下，返回信息尽量丰富，例如创建对象时不要仅返回是否成功，同时也返回对象Id，这样一来扩展性更高，比如用户创建后又可以立即根据这个Id来选择用户所在的角色组。</li></ul></li> <li><p>请求的访问方式</p> <ul><li>查询数据时使用 GET。</li> <li>修改数据时使用 POST，特别要注意传递数据较少但实际会修改数据的情况下也必须使用 POST，如传递 id 删除数据时。</li> <li>构造 Restful 风格接口时参照 Restful 规范。</li></ul></li></ul> <h3 id="controller-中-apiresult-的使用规约">Controller 中 ApiResult 的使用规约</h3> <p><strong>接口需不需要统一返回 ApiResult 包装的对象？不是绝对的，视项目情况而定，以跟客户端开发协商的为准，如果你觉得返回 ApiResult 很麻烦，可以看看我写的另一篇文章 <a href="https://juejin.cn/post/6982901297758339102" target="_blank" rel="noopener noreferrer">API 错误处理的最佳实践<span> </span></a>。</strong></p> <p><strong>需要使用 ApiResult 的情况有：</strong></p> <ul><li>提供给第三方使用的 Api 。</li> <li>修改数据的接口。</li> <li>可能具有多个返回状态码的接口。</li></ul> <p><strong>Service 层是否可以返回 ApiResult ？</strong></p> <ul><li>一般性原则是不可以，除非在 Service 层有重用需求（一般而言 Service 层方法的粒度较粗，可重用性不高，可重用高的可以下沉到 Manager 层）。</li></ul> <p><strong>ApiResult 不允许向下传递（ApiResult 面向的是 Api 调用方，而非开发人员）。</strong></p> <ul><li>ApiResult 是作为最终结果输出到调用方，而不应该在开发程序的时候多方传递，这样会降低可读性（增加了if、else的编写），因此 ApiResult 不允许向下传递。</li></ul> <h3 id="统一-controller-层的异常处理">统一 Controller 层的异常处理</h3> <ul><li>优先使用 ExceptionHandler 方式进行全局异常处理，其次是 AOP 实现。</li> <li>Controller 中可以进行业务相关的异常处理，不需要进行通用异常处理。</li></ul> <h3 id="参数校验规约">参数校验规约</h3> <ul><li>使用 JSR 验证机制。</li> <li>Controller 层可以进行参数的校验工作，也可以下放至 service 层进行校验，取决于代码的重用程度和验证的层次，Controller 主要进行基本参数验证，业务逻辑上的参数验证应该放到 service 层。</li> <li>校验方法必须放在单独的方法中。</li></ul> <h3 id="api-优先设计">API 优先设计</h3> <ul><li><p>使用 API 优先设计的思想进行 Controller 层的开发，大多数情况下使用 API Code First 模式，提供外部 API 时可以考虑 API Design First。</p> <ul><li>扩展项目：<a href="https://github.com/swagger-api/swagger-codegen" target="_blank" rel="noopener noreferrer">https://github.com/swagger-api/swagger-codegen<span> </span></a>、<a href="https://github.com/OpenAPITools/openapi-generator" target="_blank" rel="noopener noreferrer">https://github.com/OpenAPITools/openapi-generator<span> </span></a></li></ul></li> <li><p>项目中需要引入 Swagger 组件。</p></li> <li><p>在生产环境禁用 Swagger 。</p></li></ul> <h2 id="六、service-层开发实践">六、Service 层开发实践</h2> <h3 id="service-层方法签名">Service 层方法签名</h3> <p>方法参数注意事项：</p> <ul><li>必须使用强类型。</li> <li>超过 4 个参数时使用数据模型类进行封装。</li> <li>不允许使用复杂对象，如：Request、Response 等。</li></ul> <p>方法返回值注意事项：</p> <ul><li><strong>不允许返回 ApiResult</strong>，返回 ApiResult 容易使 Controller 层变为幽灵类，即 Controller 层毫无作用，减少了分层层次。</li></ul> <h3 id="servce-层编写注意事项">Servce 层编写注意事项</h3> <ul><li>不应该包含非业务逻辑相关的代码，如国际化信息、导出 Excel 实现等。</li> <li>不能包含 DAO 层实现代码。</li></ul> <h3 id="service-接口编写规约">Service 接口编写规约</h3> <p><strong>Service 接口是必须的吗？不是。</strong></p> <p><strong>需要编写 Service 接口的情况有：</strong></p> <ul><li>Service 可能需要多个实现（这种情况也可考虑将 Service 接口放入 spi 包中）。</li> <li>需要直接使用 Service 接口做 rpc 调用时。</li></ul> <p><strong>其他情况下不需要编写 Service 接口。</strong></p> <p><strong>不编写 Service 接口时的注意事项：</strong></p> <ul><li>不要在 private 方法上编写注解。</li> <li>Service 类不应该继承包含增删改善功能的基类。</li></ul> <h2 id="七、dao-层开发实践">七、DAO 层开发实践</h2> <h3 id="数据访问组件的选择">数据访问组件的选择</h3> <ul><li>管理后台项目统一使用 jpa、jOOQ 或其他 ORM 框架以提升开发效率。</li> <li>客户端/网站接口可使用组合使用 jpa、mybatis 等技术，按性能需要为准。</li></ul> <h3 id="注意事项">注意事项</h3> <ul><li>数据分页必须在数据库层面进行。</li> <li>不使用存储过程。</li></ul> <h2 id="八、其他实践">八、其他实践</h2> <h3 id="异常处理实践">异常处理实践</h3> <ul><li>DAO 层不需要手动抛出异常，若有底层数据访问类，可在底层封装 DAOException，<strong>DAO层可以不捕获异常，若捕获必须向上传递异常，在该层不需要打印异常日志</strong>。</li> <li>Service 层可以捕获异常，在一些情况下可通过异常控制代码流程，比如通过参数校验异常控制程序不往下执行，通过这些方式，减少 if 代码，<strong>Service 层捕获异常后可向上传递异常，若不传递则必须记录异常日志，若向上传递则不记录日志</strong>。</li> <li>Controller 层与 Service 层的异常处理方式一致，<strong>向上传递异常时，由 Controller 上的切面进行日志记录和返回结果的包装</strong>。</li> <li><strong>原则：自行处理异常必须记录日志（完整异常堆栈），向上传递异常则不需要，DAO 层必须向上传递异常。</strong></li> <li>不允许忽略异常（try 后什么都不做）。</li> <li>一级自定义异常继承自 RunTimeException 。</li></ul> <h3 id="单元测试实践">单元测试实践</h3> <ul><li>单元测试必须遵守 AIR（Automatic、Independent、Repeatable） 原则。</li> <li>单元测试必须保证依赖的测试环境是受控的，测试用例执行的成功与否是符合预期的。</li> <li>代码仓库中的单元测试执行失败时会阻碍后续工作的进行，一旦出错必须立即解决。</li></ul> <h3 id="对象映射">对象映射</h3> <ul><li>使用 MapStruct 等工具组织类之间的映射关系，以提升对象映射执行效率和代码可读性。</li></ul> <h2 id="九、数据库版本控制">九、数据库版本控制</h2> <ul><li>使用 liquibase 或 flyway 做数据库版本控制。</li> <li>数据库版本控制代码放在单独的 git 项目中（方便设置部署流水线），按项目进行分组，一个 git 项目中可存在多个数据库版本控制代码。</li></ul> <h2 id="十、部署相关实践">十、部署相关实践</h2> <ul><li>Dockerfile 需要支持 SkyWalking，以进行链路追踪。</li> <li>配置中心使用 apollo，灵活管理项目配置。</li> <li>线上使用 logback 日志系统写入日志到 ELK。</li></ul> <h2 id="十一、java-微服务项目常规架构示例图">十一、Java 微服务项目常规架构示例图</h2> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ced89ebeab994cb5a74d0b57e16060c4~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Java 学习大法]]></title>
            <link>https://tech.codelc.com/docs/java/java_study_way.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/java/java_study_way.html</guid>
            <pubDate>Thu, 24 Dec 2020 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h1 id="零、前言">零、前言</h1> <h2 id="关于该文档">关于该文档</h2> <p>在不同的阶段要使用不同的学习方法，这里将学习分为两个阶段：从 0 到 1 的阶段、从 1 到 100 的阶段，本文主要讲这两个阶段的学习方式和相关资料。</p> <p>另外这份文档侧重的是在长期如何学好，而非短期，短期要迅速上手使用某一技术，那可以采用其他的学习形式。</p> <h1 id="一、从-0-到-1">一、从 0 到 1</h1> <h2 id="金字塔模型">金字塔模型</h2> <p>在从 0 到 1 的阶段，需要采用<strong>金字塔模型</strong>的学习方法，即先深入学习基础原理，再向上学习应用层技术。举个栗子，比如一个初学者在java基础不扎实的情况下去学习 spring 框架，当看到 bean 的生命周期时，他是否能够很好地进行理解？这背后的思考可以引出一连串的问题，比如为何需要 IoC，为何默认是单例，DI 和单元测试之间有什么关系？对于初学者来说这些必然是很难理解透彻的，所以需要先打好基础。</p> <h2 id="时间成本">时间成本</h2> <p>也可以从<strong>时间成本</strong>的角度去考虑这个问题，当在学习较为基础的知识的时候，不容易碰到难点，这个时候能够尽快吸收，每分钟的阅读效率更高。这是一个很朴素的道理，只是由于许多现实原因导致许多开发者没有很好的学习基础知识：计算机科学概论、编程语言入门、离散数学、数据结构与算法等等。</p> <h2 id="易学难精">易学难精</h2> <p>在应用层的基础知识其实并不难，尤其是编程语言方面，也有一些同学很重视基础学习，但就是学的不够好，这里就涉及到学习编程的一个难点，即<strong>易学难精</strong>，对于面向对象语言而言，需要掌握的东西相对来讲是很少的，归根结底就是条件控制、循环、封装、继承、多态、多线程、语法等诸如此类，现在有许多的少儿编程培训班也可以佐证编程语言是易于学习的，难于精通在于这些基础知识本身就具有相当高的抽象层级，最早的计算机就是一个巨型的计算器，要使用计算器是简单的，但是一个问题为何要如此计算却可以是无比复杂的。</p> <h2 id="第一性原理">第一性原理</h2> <p>学习编程可以类比学习数学，那么如何才能学的更好，除了先学习基础知识外，在学习其上的内容的时候，还要<strong>时刻思考基础知识</strong>，这有点像马斯克提出的<strong>第一性原理，时刻剥开事物的表象，看到里面的本质，然后再从本质一层层往上走</strong>，数学学的好的人并不是靠死记硬背记公式，而是自己有能力推导出公式，同样编程学的好的人也并不是靠背 sdk，他们自己就可以设计出 sdk，那么当我们在学习 sdk、框架、技术工具的时候都可以进行<strong>逆向思考</strong>，jdk、spring 框架为何如此设计，它们是如何运用面向对象的三大特性？为何这三大特性可以演化出如此多的设计模式？看完一本基础理论书籍后不应该将其束之高阁，而是应当反复咀嚼，时刻保持思考，直至豁然开朗、融会贯通。</p> <h2 id="像产品迭代一样更新学习方法">像产品迭代一样更新学习方法</h2> <p>学习的时候同时要不断更新「学习的方法」，使自己的学习方式得到迭代升级、提升效率，关于学习的书也有很多，比如《如何阅读一本书》、《学会提问》、《像加勒比海盗一样学习》、《思维导图》、《快速阅读》、《把时间当作朋友》等等，这些书让我们掌握更多学习方法论的同时也扩展了知识网络，正所谓磨刀不误砍柴工、万变不离其宗，多从不同的角度思考学习编程这件事情，提升学习能力并非一蹴而就，而是一件需要沉淀和积累的事情。</p> <h2 id="学习方向">学习方向</h2> <p>有了金字塔这一基础的学习模型后，相对来讲不太容易走弯路，但技术道路千千万，还是要有一定的方向，否则容易在技术的道路上迷失。学习的方向跟个人兴趣关系也很大，因此这里仅列举一个大致的方向，仅供参考。</p> <p>首先是基础知识。</p> <ul><li>计算机科学概论
<ul><li>计算机科学这门学科的总览，从深度和广度上展现这门学科的基本框架。</li></ul></li> <li>编程语言
<ul><li>《Java 编程思想》、《Java 核心技术》</li> <li>入门时最需要的是一本由浅入深的书籍。</li></ul></li> <li>数据结构与算法
<ul><li>《数据结构与算法分析》、《算法导论》、《离散数学及其应用》</li> <li>代码写的好与坏，数据结构和算法是根本。</li></ul></li> <li>计算机网络
<ul><li>《计算机网络：自顶向下方法》、《TCP/IP 详情》</li> <li>在服务端开发领域，计算机网络的重要性不言而喻。</li></ul></li></ul> <p>基础知识领域是非常广阔的，这里面也有纷繁复杂的问题，当碰到难懂的知识点时需要去补充更多的基础知识以便进行下一步学习，就像玩游戏一样，<strong>当你的等级还打不赢一个 boss 的时候就不要硬打，先去打打小怪补充点经验</strong>。</p> <p>以上内容不需要全部学完才开始下一阶段，有了一定的基础之后可以开始学习应用层的知识，具体什么时候开始，这个就看基础知识的掌握程度，多从时间成本的角度思考，当学习效率不足的时候考虑去补充更多的基础理论知识。</p> <p>应用层：</p> <ul><li>Web 开发
<ul><li>《Java Web 高级编程》</li></ul></li> <li>Spring 框架
<ul><li>《Spring 实战》、《Spring Boot 实战》</li></ul></li> <li>编程语言
<ul><li>《Java 并发编程实战》</li></ul></li></ul> <p>再次说明，以上仅是简单的列举了一些学习点，关键还是围绕着自底向上这一思想进行学习，但并非把所有的底都铺好再往上学习，而是根据不同的领域，打不同区块的地基，在不同区块上垒高墙。</p> <h2 id="阅读经典">阅读经典</h2> <p>学习方向并非三言两语可以讲清楚的，因为这个方向本身在学习的过程中很容易产生变化，阅读的书籍会改变人的思维，其重要性不言而喻，市面上的书多如牛毛，伏尔泰说过<strong>图书馆是真理和谬误的宝库</strong>，如果读错了书，那不仅没有提升，还可能令自己退步，如何甄选好书其实不难，优先选择经典一般不会有错。现在是一个知识付费的时代，拥有知识比以往更容易变现，这衍生出一个问题，就是知识市场上存在质量参差不齐的「产品」，也存在大量的同质化，这些内容一般追求尽快见效，是不适合从 0 到 1 这个阶段的，经典则经过时间的考验，是最优质的知识来源。</p> <h2 id="学习方式">学习方式</h2> <p>很多人不读经典，一部分原因是一些经典的书比较难以阅读，还有一些是因为通过其他方式学习更加轻松，比如看教学视频，看视频学习的节奏比较慢，头脑可以处在一个比较轻松的状态下去接收知识，不光要接收知识，还需要接收很多无用的信息，比如讲课老师的长时间停顿、演示等等，这些无形中消耗了时间成本。看视频学习需要视情况而定，即在学习艰深难懂的知识时才需要通过他人来讲解，我们最开始都是通过老师讲课来学习知识的，在读大学的时候应该已经能够形成较强的自学能力，在许多知识领域的学习上都不再需要他人教授。</p> <p><strong>根据所学知识的困难程度，选择适合自己的学习方式，优先读经典书籍，不要因为惰性而选择低效的学习方式。</strong></p> <h2 id="学习质量">学习质量</h2> <p>采用适当的学习方式是为了提升学习效率，但不要陷入一味追求速度的误区，在从 0 到 1 的阶段许多书都需要通读而非挑读，对书中的细节也不能忽略，经典的基础理论书籍需要慢慢阅读，而非快速阅读，在阅读的时候要辅以练习提升学习质量。</p> <h2 id="编程实战">编程实战</h2> <p>在编程方面，遇见较难学习的知识点的时候，一个解决办法是去补充更多的基础知识，另一个方法是进行编程练习，可以找一些自己感兴趣的小项目进行实践，比如学到面向对象的时候，可以写一个简单的小游戏，定义游戏里面人物、怪物的对象模型，揣摩为何会由过程式编程转变为面向对象编程，这些自我实践在早期是非常重要的，可以加深学习理解，令自己不需要死记硬背。</p> <h2 id="兴趣是最好的老师">兴趣是最好的老师</h2> <p>找自己感兴趣的项目也可以提升个人的编程兴趣，兴趣是最好的老师，当你兴趣越来越浓之时，苦学编程就变成了一种享受，当你写出一个网站、写出一个小游戏的时候，成就感会促使你继续学习，甚至激发你的潜能。</p> <h1 id="二、从-1-到-100">二、从 1 到 100</h1> <p>当已经入门编程这个领域之后，你应该能够感受到编程的魅力，也对其有了一个较为全面的认识，满足这两点后就进入接下来从 1 到 100 的过程，若不满足，则这个上升过程可能是会比较痛苦或者懈怠的，这时更需要时刻去巩固基础知识，更多的去发现编程有趣的地方，更全面的去认识编程。</p> <p>在这个阶段差不多开始需要面对工作的问题，那首先从实用性的角度出发学习必备的知识技能，如数据库、设计模式等，再不断扩充知识广度，同时又时刻运用第一性原理去理清知识脉络。</p> <h2 id="挑选书籍">挑选书籍</h2> <p>在第一个阶段，看的书不在多而在精，基础理论的经典书籍也更多，比如大家熟知的「Java 四大名著」，在 0 到 1 阶段的书比较容易挑选，而在这个阶段需要看的书则会更多，所以如何在学习之前做好准备工作，挑好书籍也是非常重要，有效地利用豆瓣、github，仔细翻阅书的目录，相同领域的书多加对比，直到挑选出适合自己的书后再开始阅读。</p> <h2 id="提升技术视野">提升技术视野</h2> <p>学习多种编程语言可以提升编程能力，毕竟不同的编程语言的特性和设计还是有不少差别，可以从中吸纳别的编程语言的优点，除了学习同类范式的编程语言，还可学习不同范式的编程语言，比如函数式编程语言，除了这些常见的，还有逻辑编程语言、领域特定语言等。尽量学习一些差异跟 Java 较大的语言，比如 python、ruby，Python 之禅中提到「做一件事情有且只有一种方法」，而 ruby 则提倡做一件事情可以有多种方法，这些设计哲学背后可以引发一系列的思考。</p> <p>Java 编程语言由于用户过多，所以在语法和版本上的更新是相对落后的，如果视野仅停留在这个领域，实际上是对自身存在一个比较大的限制。将其与 C# 对比也非常有意思，Java 中许多新的语言特性都是在跟随 C# 的脚步，有一些 C# 里面优秀的东西，在 Java 中很难找到替代品，比如 linq，Java 中有开源的 QueryDSL 项目，但跟这种语言级别的特性比起来确实逊色不少。</p> <h2 id="好奇心、探索欲和顺藤摸瓜">好奇心、探索欲和顺藤摸瓜</h2> <p>多学几门编程语言是提升技术视野的一个小的方面，要提升这种视野扩展的能力，具备好奇心和探索欲是必不可少的，当我们看到一本优秀的书籍的时候，里面一般会引用其他书籍，顺藤摸瓜地进行学习可以形成更好的知识脉络。</p> <h2 id="平衡的艺术">平衡的艺术</h2> <p>将新学习的语言与 Java 进行对比，出现设计上的差异必然是各有优缺点，在思考的过程中找到其中的平衡点是非常关键的，因为编程在许多情况下都需要权衡多种方案，阅读他人写的代码比较难的一个原因之一就是实现一个功能的方式有太多种了，而当能够得心应手地进行权衡的时候，脑海里会浮现出更优秀的方案，这时可选择性已经不多了，那整体的代码可读性也变高了，这便是 Python 之禅「做一件事情有且只有一种方法」的立意。这个设计跟 ruby 各有优缺点，但这一点显然是降低了开发时的认知负担和选择成本。</p> <h2 id="做减法-减少心智负担">做减法，减少心智负担</h2> <p>学习了一定的知识后，容易出现一个现象，即拿着锤子看什么都像钉子，想挥一挥刚掌握的这把锤子，实际上在应用的时候是不可一股脑把会的技术都用上，必须学会做减法。举个例子，当我们学习了 ORM 框架之后，在简单的 CRUD 场景下不再需要写 SQL 语句，这便是一种减负，那由于 ORM 框架在处理复杂的聚合查询时是不那么透明的，需要很深入的学习才能写好一个高性能的复杂查询，那我们在运用 ORM 编写复杂查询的时候会增加很大的心智负担，不由地会思考一个问题，这个时候为什么不直接写 SQL 呢？这其实也是不断权衡的过程，当问题的复杂程度达到一个级别后，写 SQL 变成了一个更好的选择。学习是为了帮助我们减负，储备更多的知识则会有更明朗的选择。</p> <h2 id="注重工程实践">注重工程实践</h2> <p>学习技术知识的同时，很多时候要将其与工程实践相结合，比如：接口优先原则能够使团队协作更加顺利，通过 git 提交代码要考虑代码审查和持续集成，单元测试为何要按运行快慢进行分类，这些都是技术需要与工程相结合的案例，结合思考才能更加全面，才能使软件开发更加敏捷。</p> <h2 id="用力思考-think-harder">用力思考/Think Harder</h2> <p>粗浅的编码工作是容易的，只需要浅显的思考就可完成，但对于艰深的问题，却需要我们 Think Harder，用力思考，想的更深入些，思考更多的可能性，自己提出问题，寻找答案，重复这一过程，直到想不出其他问题，编程需要的是非常缜密的思考，当用你的程序的用户越来越多的时候，可能性也越来越多，必须思考的足够周全。事务消息是一个深入思考的典型案例，即提出一个又一个的问题，最后便会出现浅显思考下不会出现的解决方案。还有像单元测试中为何需要 mock 框架，为什么 NoSQL 采用列式存储，都不是浅显思考所能想明白的，用力思考才会得到答案。</p> <h2 id="编程思想">编程思想</h2> <p>要形成深厚的功力，需要我们用力思考、多元化投资知识资产，不是一朝一夕可以获得的，但我们可以透过现象去看本质寻求一个高效的提升方法。认知决定思想，那我们可以多看一些关于技术认知方面的书籍，比如《设计模式》、《代码大全》、《程序员修炼之道》、《Unix 编程艺术》这类的书籍。</p> <h2 id="建立技术分支">建立技术分支</h2> <p>当编程已经成为你的职业之后，不能光按照个人兴趣来进行学习，需要考虑工作需要，有的人很重视主干技术的发展，当工作中需要用到其他技术时不去系统学习，将就着用，这在短期对自己影响不大，长期却造成了巨大的时间浪费，比如在部分公司 Java 后端开发偶尔需要做一些前端工作，那需要自己去衡量该如何学习以及学到何种程度，从投资回报率的角度去考虑这个问题，当由于没有系统学习导致自己在处理小问题时都花费大量时间时，那就应该去系统学习下，最终花费的时间更少，并且还建立了技术分支，在学习其他技术的时候，技术视野以及技术思维也能够提升。</p> <h2 id="像做投资一样管理知识资产">像做投资一样管理知识资产</h2> <p>建立技术分支时可以从投资回报率的角度思考，那在知识资产的其他方面同样也适用。</p> <p>严肃的投资者定期投资；多元化是长期成功的关键；聪明的投资者在保守的投资和高风险高回报的投资之间平衡他们的资产；周期性地重新评估和平衡资产。</p> <h2 id="谦虚是一把钥匙">谦虚是一把钥匙</h2> <p><strong>笛卡尔说过，学的越多，越能发现自己的无知，萧伯纳也说，看的好书越多，越能发现自己的无知</strong>。这里再次提到好书的重要性，另外一个重点就是学习使人变强，但千万不能越学越傲慢，经常看好书的人比较少出现这种现象，反而是学习不到位的人容易出现，这里面隐含的一个逻辑就是我们<strong>毛主席说过的「谦虚使人进步」</strong>，在学习的道路上，谦虚是一把钥匙，谦虚的人往往看到的是他人的优点，汲取他人所长为我所用。文人相轻的现象切勿出现在技术领域，对于他人分享的一些知识、工具，多去了解，切莫先入为主，好的东西及时转化为自己的知识资产。</p> <h2 id="批判性思维">批判性思维</h2> <p>谦虚是一把钥匙，但也不能谦虚过头，我们搞代码的思考问题就是得如此审慎，谦虚促使我们向他人学习，但不能什么都接收，当然还是要取其精华去其糟粕。批判性思维运用得当在学习上也是大有脾益，现在互联网上各种知识分享、博客，那些全是对的吗？其中提出的一个观点是否经过验证，若有采取测试，那测试方法是否得当？必要的时候使用批判性思维。什么又是批判性思维呢，如何锻炼批判性思维呢？带着这些问题又可以迭代升级我们的学习方法了。</p> <h1 id="三、学习资料">三、学习资料</h1> <p>大道至简，以上两部分内容是内功，可以使用上面的「学习大法」来运用下面给出的一些学习资料。</p> <h2 id="java-相关学习资料">Java 相关学习资料</h2> <ul><li>Java 四大名著：《Java 编程语言》、《Java 编程思想》、《Java 核心技术》、《Effective Java》</li> <li>《Head First Java》</li> <li>《Java 并发编程实战》</li> <li>《Java Web 高级编程》</li> <li>《Java 8 实战》</li> <li>《Spring 实战》、《Spring Boot 实战》</li> <li>《Java 性能优化权威指南》</li> <li>《深入理解 Java 虚拟机》</li> <li>《Netty 实战》</li> <li>《RxJava 响应式编程》</li> <li>《单元测试的艺术》</li> <li><a href="https://github.com/Snailclimb/JavaGuide" target="_blank" rel="noopener noreferrer">https://github.com/Snailclimb/JavaGuide<span> </span></a></li> <li><a href="https://github.com/lcomplete/SpringCloudLearning" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/SpringCloudLearning<span> </span></a></li> <li><a href="https://github.com/lcomplete/advanced-java" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/advanced-java<span> </span></a></li> <li><a href="https://github.com/lcomplete/technology-talk" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/technology-talk<span> </span></a></li> <li><a href="https://github.com/hollischuang/toBeTopJavaer" target="_blank" rel="noopener noreferrer">https://github.com/hollischuang/toBeTopJavaer<span> </span></a></li> <li><a href="https://github.com/xkcoding/spring-boot-demo" target="_blank" rel="noopener noreferrer">https://github.com/xkcoding/spring-boot-demo<span> </span></a></li></ul> <h2 id="基础知识">基础知识</h2> <ul><li>《计算机科学概论》</li> <li>《数据结构与算法分析》</li> <li>《离散数学及其应用》</li> <li>《计算机网络：自顶向下方法》、《TCP/IP 详解》</li> <li>《现代操作系统》</li> <li>《汇编语言》</li> <li>《C 语言程序设计》</li> <li><a href="https://github.com/lcomplete/CS-Notes" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/CS-Notes<span> </span></a></li> <li><a href="https://github.com/wolverinn/Waking-Up" target="_blank" rel="noopener noreferrer">https://github.com/wolverinn/Waking-Up<span> </span></a></li></ul> <h2 id="算法">算法</h2> <ul><li>《编程珠玑》</li> <li>《编程之美》</li> <li>《算法导论》</li> <li><a href="https://github.com/azl397985856/leetcode" target="_blank" rel="noopener noreferrer">https://github.com/azl397985856/leetcode<span> </span></a></li> <li><a href="https://github.com/MisterBooo/LeetCodeAnimation" target="_blank" rel="noopener noreferrer">https://github.com/MisterBooo/LeetCodeAnimation<span> </span></a></li> <li><a href="https://github.com/labuladong/fucking-algorithm" target="_blank" rel="noopener noreferrer">https://github.com/labuladong/fucking-algorithm<span> </span></a></li> <li><a href="https://github.com/greyireland/algorithm-pattern" target="_blank" rel="noopener noreferrer">https://github.com/greyireland/algorithm-pattern<span> </span></a></li></ul> <h2 id="编程思想-2">编程思想</h2> <ul><li>《设计模式》、《Head First 设计模式》、《反模式》</li> <li>《代码整洁之道》</li> <li>《编写整洁代码的艺术》</li> <li>《重构》</li> <li>《领域驱动开发》</li> <li>《Unix 编程艺术》</li> <li>《七周七语言》</li></ul> <h2 id="数据库">数据库</h2> <ul><li>《SQL 必知必会》</li> <li>《高性能 MySQL》</li> <li>《SQL 语言艺术》</li> <li>《MySQL 技术内幕》</li> <li>《Microsoft SQL Server 2008 技术内幕：T-SQL 查询》</li> <li>《Microsoft SQL Server 2008 技术内幕：T-SQL 程序设计》</li> <li>《SQL 反模式》</li> <li><a href="https://github.com/lcomplete/Database-Series" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/Database-Series<span> </span></a></li> <li><a href="https://github.com/lcomplete/BigData-Notes" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/BigData-Notes<span> </span></a></li></ul> <h2 id="架构">架构</h2> <ul><li>《架构整洁之道》</li> <li>《企业架构模式》</li> <li>《微服务架构设计模式》</li> <li>《Kubernetes in Action 中文版》</li> <li><a href="https://github.com/lcomplete/architect-awesome" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/architect-awesome<span> </span></a></li> <li><a href="https://github.com/rootsongjc/kubernetes-handbook" target="_blank" rel="noopener noreferrer">https://github.com/rootsongjc/kubernetes-handbook<span> </span></a></li></ul> <h2 id="工程实践">工程实践</h2> <ul><li>《敏捷软件开发：原则、模式与实践》</li> <li>《代码大全》</li> <li>《人月神话》</li> <li>《人件》</li> <li>《持续交付2.0》</li></ul> <h2 id="个人修炼">个人修炼</h2> <ul><li>《程序员修炼之道》</li> <li>《程序员的职业素养》</li> <li>《高效程序员的 45 个习惯》</li></ul> <h2 id="linux">linux</h2> <ul><li>《鸟哥的 linux 私房菜》</li> <li>《Linux命令行与 shell 脚本编程大全》</li></ul> <h2 id="技术相关">技术相关</h2> <ul><li>《黑客与画家》</li> <li>《软件随想录》</li> <li>《松本行弘的程序世界》</li> <li>《编程人生》</li> <li>《浪潮之巅》</li></ul> <h2 id="学习之道">学习之道</h2> <ul><li>《如何阅读一本书》</li> <li>《思维导图使用手册》</li> <li>《学会提问》</li> <li>《像加勒比海盗一样学习》</li> <li>《把时间当作朋友》</li> <li>《快速阅读》</li> <li>《学习之道》</li></ul> <h2 id="其他优秀资源">其他优秀资源</h2> <ul><li>《精通正则表达式》</li> <li><a href="https://github.com/lcomplete/free-programming-books-zh_CN" target="_blank" rel="noopener noreferrer">https://github.com/lcomplete/free-programming-books-zh_CN<span> </span></a></li> <li><a href="https://github.com/Nepxion/DiscoveryGuide" target="_blank" rel="noopener noreferrer">https://github.com/Nepxion/DiscoveryGuide<span> </span></a></li> <li><a href="https://github.com/wuyouzhuguli/SpringAll" target="_blank" rel="noopener noreferrer">https://github.com/wuyouzhuguli/SpringAll<span> </span></a></li> <li><a href="https://github.com/julycoding/The-Art-Of-Programming-By-July" target="_blank" rel="noopener noreferrer">https://github.com/julycoding/The-Art-Of-Programming-By-July<span> </span></a></li> <li><a href="https://github.com/wx-chevalier/Developer-Zero-To-Mastery" target="_blank" rel="noopener noreferrer">https://github.com/wx-chevalier/Developer-Zero-To-Mastery<span> </span></a></li></ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[网站项目 Git 使用流程和规范]]></title>
            <link>https://tech.codelc.com/docs/engineering/gitflow.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/engineering/gitflow.html</guid>
            <pubDate>Tue, 08 Dec 2020 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <h2 id="零、前言"><strong>零、前言</strong></h2> <ol><li>本文档适用于需要持续发布的网站项目（后端、前端），稍加修改可以适用于需要同时存在不同版本的项目（框架、组件、app等）。</li> <li>该工作流程基于 git flow 分支策略，该策略的优点是分支清晰，能够应付开发流程中的许多情况，缺点是分支较多，开发过程中会经常需要进行合并操作，于是在基于该策略的基础上做适当的简化，并考虑并行迭代的情况，综合制定了该工作流程。</li></ol> <p>本文档共包含分支策略、工作流程、分支使用规范、代码提交规范四个部分，分支策略主要是对 git flow 的介绍，工作流程部分则描述在具体开发过程中该如何实施，分支使用规范详细描述每种分支的用法，最后的代码提交规范是成功推进代码审查的关键因素。</p> <h3 id="_1、术语说明"><strong>1、术语说明</strong></h3> <ul><li>持续集成/CI：使用该术语一般指 feature 分支的代码频繁集成到 develop 分支，并由CI自动构建到测试环境，feature 集成到 develop 一天内最少一次。</li></ul> <ul><li>持续集成环境：根据特定分支配置的自动构建、运行测试和部署测试程序的环境。</li></ul> <ul><li>预发布环境：接近生产的环境，而非测试环境。</li></ul> <h2 id="一、分支策略"><strong>一、分支策略</strong></h2> <h3 id="_1、分支策略"><strong>1、分支策略</strong></h3> <p>主要分支策略基于 git flow，但基于复杂多变的项目研发过程会有所不同。</p> <p>Git flow主要流程见下图，具体使用可参考：<a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2012/07/git.html<span> </span></a></p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb195d05989d49638aff53dd5d6d1fc7~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <h3 id="_2、长期分支"><strong>2、长期分支</strong></h3> <ul><li>master：用于存放对外发布的版本，任何时候在这个分支拿到的都是稳定的版本。</li></ul> <ul><li>develop：用于日常的开发，存放最新的开发版本。</li></ul> <h3 id="_3、临时分支"><strong>3、临时分支</strong></h3> <ul><li>feature：用于开发特定功能从develop中分出来的，一个feature分支对应一次迭代开发，开发完成后合并到develop分支中；</li></ul> <ul><li>hotfix：用于修复bug，从master中分出来的，开发完成后合并到master、deveop分支。</li></ul> <ul><li>release：指发布正式版本之前（即合并到Master分支之前），我们可能需要有一个预发布的版本进行测试。</li></ul> <h2 id="二、工作流程"><strong>二、工作流程</strong></h2> <p><strong>注：以下文字中粗体为特殊情况，大多数时候不需考虑，从流程中去除的话，该工作流程并不复杂。</strong></p> <h3 id="_1、项目初始"><strong>1、项目初始</strong></h3> <ul><li>gitlab上创建项目</li></ul> <ul><li>创建develop分支，并将其设置为保护性分支，具有Maintainer权限的用户才可以直接push和merge，其他用户需要将代码提交到自己的分支后发起merge request（以下简称MR）请求，由Maintainer和团队成员进行代码评审决定是否接受合并。</li></ul> <ul><li>修改master分支为不允许任何人推送，该分支只能通过MR进行变更。</li></ul> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95f71972b0484b2eb57b46329bb1654e~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <h3 id="_2、迭代开始阶段"><strong>2、迭代开始阶段</strong></h3> <ul><li>情况1：迭代时间较长、分工明确</li></ul> <ul><li>开发人员各自新建属于自己的feature分支，代码持续集成到develop。</li></ul> <ul><li><strong>情况2：迭代时间较短、分工不明确或需要多个人开发同一功能</strong></li></ul> <ul><li><strong>开发人员共享一个feature分支，代码持续集成到develop。</strong></li></ul> <ul><li><strong>情况3：迭代A、迭代B同时启动，A为主要迭代</strong></li></ul> <ul><li><strong>主要迭代根据情况1、2选择开发方式，代码持续集成到develop</strong></li></ul> <ul><li><strong>次要迭代从develop分出sprint-{版本}，feature基于该版本开发，代码持续集成到sprint-{版本}</strong></li></ul> <ul><li><strong>情况4：主要迭代A已启动，突然启动迭代B</strong></li></ul> <ul><li><strong>迭代B从master分出sprint-{版本}，feature基于该版本开发，代码持续集成到sprint-{版本}</strong></li></ul> <p><strong>注意：情况2、3、4均为特殊情况，应尽量避免</strong>，尤其是3、4两种情况需要将代码持续集成到另一个版本，那么需要配置另一套持续集成环境，同时也加大了代码评审、分支合并的麻烦。下面描述的开发阶段以情况1为准，若为3、4情况，则需要将develop分支替换为sprint分支。</p> <h3 id="_3、迭代开发阶段"><strong>3、迭代开发阶段</strong></h3> <ul><li>开发人员完成feature的开发或阶段性开发时，发起到develop的MR。</li></ul> <ul><li>Maintainer和团队成员对MR进行review，拒绝的需要提交者重新修改代码后再次提交MR，接受的将合并到develop，并自动构建到测试环境。</li></ul> <ul><li>迭代整体测试通过后进入发布准备阶段。</li></ul> <h3 id="_4、发布准备阶段"><strong>4、发布准备阶段</strong></h3> <ul><li>对于无预发布环境的项目，跳过准备阶段，进入发布阶段。</li></ul> <ul><li><strong>对于有预发布环境的项目，从develop中新建release为保护性分支（若已有则合并，该分支可在部署稳定后删除）。</strong></li></ul> <ul><li><strong>release分支构建到预发布环境进行测试，若存在bug，在该分支上进行修改。</strong></li></ul> <ul><li><strong>完成release分支的测试后，进入发布阶段。</strong></li></ul> <h3 id="_5、发布阶段"><strong>5、发布阶段</strong></h3> <ul><li>提交发布申请，运维审核通过后进行代码合并</li></ul> <ul><li>存在release时，release分支合并到develop和master，不存在时，develop合并到master。</li></ul> <ul><li>通过master构建并发布到生产环境。</li></ul> <ul><li>在master上打上版本tag标签，标记发布。</li></ul> <h3 id="_6、线上发布回滚情况">6、线上发布回滚情况</h3> <ul><li>出现发布回滚情况时，合并到master上的代码也需进行回滚操作。</li></ul> <h3 id="_7、线上bug修复">7、线上bug修复</h3> <ul><li>从master新建hotfix分支用于修复bug。</li></ul> <ul><li>完成后将hotfix合并到develop进行测试。</li></ul> <ul><li>测试通过后合并到master进行发布，并打上小版本号的tag标签。</li></ul> <ul><li><strong>若当前存在release分支，还需将hotfix合并到release。</strong></li></ul> <ul><li>删除hotfix分支。</li></ul> <h2 id="三、使用规范"><strong>三、使用规范</strong></h2> <h3 id="_1、临时分支命名规范"><strong>1、临时分支命名规范</strong></h3> <table><thead><tr><th>临时分支</th> <th>前缀</th> <th>备注</th></tr></thead> <tbody><tr><td>feature</td> <td>feature-</td> <td>若gitlab中包含任务issue，可以采用feature-{issueid}-{简单描述}命名</td></tr> <tr><td>release</td> <td>release-</td> <td>以版本名称或版本号结尾</td></tr> <tr><td>hotfix</td> <td>hotfix-</td> <td>若gitlab中包含bug issue，可以采用feature-{issueid}-{简单描述}命名</td></tr> <tr><td>sprint</td> <td>sprint-</td> <td>以迭代名称或版本号结尾</td></tr></tbody></table> <p>CI管道可通过前缀匹配进行相关的自动化操作。</p> <p>分支前缀，一般用-/连接，很少用_，<em>表示两个词语有关联，feature分支这里实际上是一种分组，所以一般用-/，可以在前缀之后使用</em>。</p> <h3 id="_2、feature-分支使用规范"><strong>2、feature 分支使用规范</strong></h3> <ul><li>分支粒度：以一个功能为单位，尽量对应gitlab上的一个任务issue，开发下一个功能时新建feature</li></ul> <ul><li>存在时间：尽量短，合并到develop后选择合适的时间点删除feature</li></ul> <ul><li>集成频率：每天最少一次，feature要经常合并到develop中，便于code review，开发要经常从develop中获取最新代码；</li></ul> <ul><li>合并请求：当feature完成的时候即可发起MR，但当一个feature开发时间较长时，也应当尽量提早发起MR，此时可在MR中添加WIP前缀，表示当前工作正在处理中，相关人员可以提前审核，但不合并</li></ul> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66303c1820e74334b0aaf59244128472~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p> <h3 id="_3、hotfix-分支使用规范"><strong>3、hotfix 分支使用规范</strong></h3> <ul><li>与feature鉴别：线上除紧急bug修复，当需要做功能性调整并快速上线时，也需要新建hotfix分支，而非feature。</li></ul> <h3 id="_4、sprint-分支使用规范"><strong>4、sprint 分支使用规范</strong></h3> <ul><li>sprint的使用与develop相同，也为保护性分支。</li></ul> <ul><li>需要从sprint中分出feature分支进行开发，从feature提交MR到sprint中做代码审查。</li></ul> <h3 id="_5、release分支使用规范"><strong>5、release分支使用规范</strong></h3> <ul><li>release为保护性分支。</li></ul> <ul><li>使用 hotfix 分支进行bug修复。</li></ul> <h2 id="四、代码提交规范">四、代码提交规范</h2> <p>先说说为什么要制定代码提交规范。</p> <ol><li>Git 是当前最流行的代码仓管理系统，可以说是开发者的必备技能。它非常强大，使用得当的话可以大幅助力个人效能的提升。如果一个团队的成员都能熟练使用 Git 的话，可以大大提高团队代码的模块化、可读性、可维护性，从而提高团队的研发效能。</li> <li>成功推进代码审查的两个关键操作：一是注意审查提交的原子性，二是审查中关注提交说明（Commit Message）。</li></ol> <h3 id="_1、代码提交原子性规范">1、代码提交原子性规范</h3> <p>代码提交的原子性，是指一个提交包含一个不可分割的特性、修复或者优化，同时这个提交要尽可能小。如果用一个提交完成一个功能，这个提交还是会比较大的话，我们需要把这个功能再拆分为子功能。</p> <p>原子性提交的优点：</p> <ol><li>可以让代码结构更清晰、更容易理解；</li> <li>出了问题之后方便定位，并可以针对性地对问题提交进行“回滚”；</li> <li>在功能开关的协助下，可以让开发者尽快把代码推送到 develop/master 上进行合并。这正是持续集成的基础。</li></ol> <p>规范要求：</p> <ol><li>一个提交包含一个不可分割的特性、修复或者优化，同时这个提交要尽可能小。</li></ol> <p>代码审查标准</p> <ol><li>不符合原子性提交的代码可以直接打回。</li> <li>逐步要求提交的原子性，不要求一次性到位，但必须逐步改进。</li></ol> <h3 id="_2、代码提交说明规范">2、代码提交说明规范</h3> <p>好的提交说明可以提升代码可读性，同时也是提高代码审查效率的利器。通过制定严格的提交说明格式来规范其质量，可以方便审查者查理解被审查代码的意图、实现思路，并通过测试情况，加快对代码的理解，提高对代码质量的信心，从而大大提高审查者的效率。同时，严格的提交说明格式及好的说明质量也可以督促开发者提高代码质量。</p> <p>好的格式应该包含以下几个方面：</p> <ul><li><strong>标题</strong>，简明扼要地描述这个提交。这部分最好在 70 个字符之内，以确保在单行显示的时候能够显示完整。比如，在命令行常用的 git log --oneline 输出结果要能显示完全。</li> <li><strong>详细描述</strong>，包括提交的目的、选择这个方法的原因，以及实现细节的总结性描述。这三个方面的内容最能帮助审查者阅读代码。</li> <li><strong>测试情况</strong>，描述的是你对这个提交做了什么样的测试验证，具体包括正常情况的输出、错误情况的输出，以及性能、安全等方面的专项测试结果。这部分内容，可以增加审查者对提交代码的了解程度以及信心。</li> <li><strong>与其他工具和系统相关的信息</strong>，比如相关任务 ID、相关的冲刺（sprint，也可翻译为“迭代”）链接。这些信息对工具的网状互联提供基础信息，非常重要。</li></ul> <p>规范要求：</p> <ol><li>提交说明必须包括<strong>标题、测试情况</strong>两个部分。</li> <li>提交说明需要符合格式要求，根据提交的代码量，有必要时增加<strong>详细描述、相关信息</strong>两部分。</li> <li>基本格式要求（其中标题、测试两个部分必须包括，标题必须使用&nbsp;<strong>type(scope)</strong> &nbsp;形式）：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>标题

描述:

测试:

相关信息:
</code></pre></div><p>提交说明模板：</p> <div class="language- extra-class"><pre class="language-text"><code>$type($scope): 

summary: 

test: 

task id: 

BREAKING CHANGE: 

Closes：关闭issue，如#123
</code></pre></div><p>type 可使用以下选项：</p> <ul><li>feat：新功能</li> <li>fix：修补 bug</li> <li>docs：仅文档的改动</li> <li>style：代码格式的改动，不影响代码运行的变动。</li> <li>refactor：重构，即不是新增功能，也不是修改bug的代码变动</li> <li>perf：性能优化</li> <li>test： 增加测试</li> <li>build：构建过程</li> <li>chore: 不修改源代码的杂项变动</li></ul> <p>scope 用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p> <p>在末尾说明其他重要信息，比如不兼容的改动、修复的 bug id 等。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Java 工程师能力提升路径（一）：从业余到专业]]></title>
            <link>https://tech.codelc.com/docs/java/part_one_of_java_engineer_path.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/java/part_one_of_java_engineer_path.html</guid>
            <pubDate>Sun, 27 Sep 2020 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <ul><li><a href="#java-%E5%B7%A5%E7%A8%8B%E5%B8%88%E8%83%BD%E5%8A%9B%E6%8F%90%E5%8D%87%E8%B7%AF%E5%BE%84%E4%B8%80%E4%BB%8E%E4%B8%9A%E4%BD%99%E5%88%B0%E4%B8%93%E4%B8%9A">Java 工程师能力提升路径（一）：从业余到专业</a></li> <li><a href="#%E9%9B%B6%E5%89%8D%E8%A8%80">零、前言</a></li> <li><a href="#%E4%B8%80%E4%BB%8E%E4%B8%9A%E4%BD%99%E5%88%B0%E8%81%8C%E4%B8%9A">一、从业余到职业</a> <ul><li><a href="#11-%E5%9F%BA%E7%A1%80%E6%8A%80%E6%9C%AF">1.1 基础技术</a> <ul><li><a href="#111-%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83">1.1.1 编码规范</a></li> <li><a href="#112-java-%E5%9F%BA%E7%A1%80">1.1.2 Java 基础</a></li> <li><a href="#113-spring-%E6%A1%86%E6%9E%B6">1.1.3 Spring 框架</a></li> <li><a href="#114-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80">1.1.4 数据库基础</a></li></ul></li> <li><a href="#12-%E8%81%8C%E4%B8%9A%E5%BF%83%E6%80%81">1.2 职业心态</a></li> <li><a href="#13-%E6%A0%B8%E5%BF%83%E9%80%9A%E7%94%A8%E8%83%BD%E5%8A%9B">1.3 核心通用能力</a> <ul><li><a href="#131-%E4%B8%AA%E4%BA%BA%E6%89%A7%E8%A1%8C%E5%8A%9B">1.3.1 个人执行力</a></li> <li><a href="#132-%E6%B2%9F%E9%80%9A%E8%83%BD%E5%8A%9B">1.3.2 沟通能力</a></li> <li><a href="#133-%E8%B4%A3%E4%BB%BB%E5%BF%83">1.3.3 责任心</a></li> <li><a href="#134-%E4%B8%9A%E5%8A%A1%E8%83%BD%E5%8A%9B">1.3.4 业务能力</a></li> <li><a href="#135-%E6%80%BB%E7%BB%93">1.3.5 总结</a></li></ul></li></ul></li> <li><a href="#%E4%BA%8C%E4%BB%8E%E8%81%8C%E4%B8%9A%E5%88%B0%E4%B8%93%E4%B8%9A">二、从职业到专业</a> <ul><li><a href="#21-%E4%B8%93%E4%B8%9A%E6%8A%80%E6%9C%AF%E4%B9%8B%E4%BA%86%E7%84%B6%E4%BA%8E%E8%83%B8">2.1 专业技术之了然于胸</a> <ul><li><a href="#211-java-%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B">2.1.1 Java 高效编程</a></li> <li><a href="#212-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">2.1.2 设计模式</a></li> <li><a href="#213-sql-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">2.1.3 SQL 程序设计</a></li> <li><a href="#214-git-%E6%B5%81%E7%A8%8B%E8%A7%84%E8%8C%83">2.1.4 Git 流程规范</a></li> <li><a href="#215-redis">2.1.5 Redis</a></li> <li><a href="#216-%E5%B7%A5%E5%85%B7%E7%B1%BB">2.1.6 工具类</a></li> <li><a href="#217-rpc">2.1.7 RPC</a></li> <li><a href="#218-%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F">2.1.8 代码质量</a></li></ul></li> <li><a href="#22-%E4%B8%93%E4%B8%9A%E6%8A%80%E6%9C%AF%E4%B9%8B%E9%A9%BE%E8%BD%BB%E5%B0%B1%E7%86%9F">2.2 专业技术之驾轻就熟</a> <ul><li><a href="#221-javascript">2.2.1 Javascript</a></li> <li><a href="#222-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">2.2.2 消息队列</a></li> <li><a href="#223-linux">2.2.3 Linux</a></li> <li><a href="#224-web-%E6%9C%8D%E5%8A%A1%E5%99%A8">2.2.4 Web 服务器</a></li> <li><a href="#225-%E5%88%86%E5%B8%83%E5%BC%8F%E7%9B%B8%E5%85%B3">2.2.5 分布式相关</a></li> <li><a href="#226-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">2.2.6 单元测试</a></li> <li><a href="#227-docker">2.2.7 Docker</a></li> <li><a href="#228-web-%E5%AE%89%E5%85%A8">2.2.8 Web 安全</a></li></ul></li> <li><a href="#23-%E4%B8%93%E4%B8%9A%E6%8A%80%E6%9C%AF%E4%B9%8B%E7%95%A5%E7%9F%A5%E4%B8%80%E4%BA%8C">2.3 专业技术之略知一二</a> <ul><li><a href="#231-nosql">2.3.1 NoSQL</a></li> <li><a href="#232-%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E">2.3.2 搜索引擎</a></li> <li><a href="#233-%E5%BA%8F%E5%88%97%E5%8C%96">2.3.3 序列化</a></li> <li><a href="#234-%E5%88%86%E5%B8%83%E5%BC%8F%E5%B7%A5%E5%85%B7">2.3.4 分布式工具</a></li> <li><a href="#235-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F">2.3.5 正则表达式</a></li></ul></li> <li><a href="#24-%E5%85%B6%E4%BB%96%E6%8E%A8%E8%8D%90%E4%B9%A6%E7%9B%AE">2.4 其他推荐书目</a></li> <li><a href="#25-%E6%A0%B8%E5%BF%83%E8%83%BD%E5%8A%9B">2.5 核心能力</a> <ul><li><a href="#251-%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98%E7%9A%84%E8%83%BD%E5%8A%9B">2.5.1 解决问题的能力</a></li> <li><a href="#252-%E5%AD%A6%E4%B9%A0%E8%83%BD%E5%8A%9B">2.5.2 学习能力</a></li> <li><a href="#253-%E4%BF%A1%E6%81%AF%E8%8E%B7%E5%8F%96%E8%83%BD%E5%8A%9B">2.5.3 信息获取能力</a></li></ul></li></ul></li> <li><a href="#%E4%B8%89%E5%B0%BE%E5%A3%B0">三、尾声</a></li></ul> <h1 id="零、前言">零、前言</h1> <p>为梳理 Java 工程师所需具备的技能，特编写该文档，为了更具有针对性，标题中含有 Java 一词，但实际内容中也包含许多非 Java 部分。要成为 Java 领域中的专家，不仅要求精通 Java，还需要掌握其他技术以及许多软技能，如：沟通能力、学习能力、业务能力等，该文也会略有涉及。</p> <p>本文为能力提升系列第一篇《从业余到专业》，后续计划编写第二篇《从专业到专家》，本文所指的从业余到专业可以对应为实习生到中高级工程师的能力级别。</p> <h1 id="一、从业余到职业">一、从业余到职业</h1> <p>每一个参加工作的人，都应当具备职业精神，那么对于 Java 工程师而言，在进入职场以后，我们需要改变自己许多业余的编码习惯和工作习惯，首先做到从业余到职业的转变。</p> <p>这个部分包含需要掌握的基础技术、需要具备的职业心态以及在职场需要具备的核心能力。</p> <h2 id="_1-1-基础技术">1.1 基础技术</h2> <p>要成为一个职业的 Java 工程师，数据结构、算法、计算机网络、计算机原理等基础知识必不可少，这里暂不讨论，更多的是从工作中直接接触的应用层面着眼。</p> <p>在业余到职业的转变过程中，以下的应用层技术需要系统性掌握并熟练使用。</p> <h3 id="_1-1-1-编码规范">1.1.1 编码规范</h3> <p>编写产品代码不同于编写业余项目，在一个在高度协作的环境下进行编码，必须有一定的规范来提升协作间的效率。编码规范的重要性不言而喻，不重视编码规范是一种业余的行为，长期不重视编码规范则对自己的职业生涯具有相当的破坏性，最终可能走向「从业余到失业」。</p> <p>一般采用阿里开源的 Java 编码规范，在这里面有较为细致的规范，每一位 Java 工程师都应当细读。这套规范也有许多未涵盖的内容，对于未提及的部分，应当多查询资料，查找最佳实践方案，多记录，最终完善自己的规范体系。</p> <p>结论：按照编码规范进行编码，将编码规范融入自身知识体系。</p> <h3 id="_1-1-2-java-基础">1.1.2 Java 基础</h3> <p>从事 Java 开发相关工作，必然需要具备坚实的 Java 基础，对于许多研发人员，可能由于种种原因这一知识体系并不系统，那么需要针对以下内容进行系统化学习。</p> <ul><li>基本数据类型
<ul><li>熟悉常用集合、字典、枚举等类型的使用</li> <li>理解装箱与拆箱</li> <li>泛型的使用</li></ul></li> <li>OOP
<ul><li>深刻理解封装继承多态、高内聚低耦合的思想。</li></ul></li> <li>多线程编程</li> <li>IO 处理</li> <li>理解异常处理机制</li> <li>JVM 运行原理
<ul><li>垃圾回收机制</li></ul></li> <li>反射</li> <li>JDBC</li></ul> <p>推荐阅读：</p> <ul><li>《Java 编程思想》https://book.douban.com/subject/2130190/ 。</li> <li>《Java 核心技术》https://book.douban.com/subject/3146174/ 。</li> <li>Java Guide 开源项目 https://github.com/Snailclimb/JavaGuide 。</li></ul> <p>《Java 编程思想》可检验自身 Java 基础的掌握程度，这本书对于初学者具有一定的难度，但对于将 Java 开发作为职业的人来说，这属于基础知识。</p> <h3 id="_1-1-3-spring-框架">1.1.3 Spring 框架</h3> <p>Spring 框架已替代 J2EE 成为 Java 服务端开发事实上的标准，优秀的 Spring 基础必不可少，在这个阶段，主要需要熟悉以下内容。</p> <ul><li>Spring IoC 容器
<ul><li>装配 Bean</li></ul></li> <li>Spring AOP</li> <li>Spring MVC
<ul><li>视图引擎</li> <li>REST API</li></ul></li> <li>Spring 应用程序生命周期</li> <li>Spring Security</li> <li>Spring 集成数据访问
<ul><li>JDBC 模板</li> <li>Redis</li> <li>MyBatis</li> <li>Hibernate</li> <li>JPA</li></ul></li> <li>数据缓存</li> <li>Spring Boot</li></ul> <p>推荐阅读：</p> <ul><li>《Spring 实战》https://book.douban.com/subject/26767354/ 。</li></ul> <h3 id="_1-1-4-数据库基础">1.1.4 数据库基础</h3> <p>在服务端开发领域，说数据库技能所占的比重为 50% 也不为过，尤其是在传统项目中，在大型项目中由于所用的技术越来越多，这一比重会有所下降。那么在工作中，要掌握哪些数据库技能才不会显得业余，以主流的 MySQL 为例，请看下面所列举的一些技能点。</p> <ul><li>数据库基础
<ul><li>数据类型</li> <li>数据库设计范式</li></ul></li> <li>数据库核心功能
<ul><li>表、视图</li> <li>存储过程</li> <li>触发器</li> <li>游标</li> <li>函数</li> <li>事件调度器</li></ul></li> <li>查询优化
<ul><li>复杂查询</li> <li>索引优化</li></ul></li> <li>事务处理
<ul><li>事务隔离级别</li> <li>嵌套事务</li></ul></li></ul> <p>推荐阅读：</p> <ul><li>《SQL 必知必会》https://book.douban.com/subject/24250054/ 。</li></ul> <p>扩展阅读：</p> <ul><li>《高性能 MySQL》https://book.douban.com/subject/23008813/ 。</li></ul> <p>熟练掌握以上技能即可从事基础的 Java 开发工作，除此之外，要想达到职业的标准，心态上也需要有适当地转变。</p> <h2 id="_1-2-职业心态">1.2 职业心态</h2> <p>所谓心态的转变，并不仅仅适用于刚入行的新人，而是需要在完成这一转变之后，在整个职业生涯中一以贯之。</p> <ul><li>主动的心态
<ul><li>职场和学校不同，在职场中需要强大的自我驱动力和积极的心态去面对工作。</li></ul></li> <li>务实的心态
<ul><li>从小事做起，把小任务做到极致也是实力的表现。</li></ul></li> <li>成长的心态
<ul><li>不管是硬实力、软技能，永远有学不完的东西，始终以谦虚的态度督促自身不断成长。</li></ul></li> <li>竞争的心态
<ul><li>持续不断提升自身的竞争力，避免被淘汰。</li></ul></li> <li>共赢的心态
<ul><li>竞争与共赢并不冲突，只有共赢，团队才能走的更远，个人才会有更大的发展。</li></ul></li></ul> <h2 id="_1-3-核心通用能力">1.3 核心通用能力</h2> <p>Java 工程师的核心能力除了技术、编码、逻辑等之外，还需要掌握许多能力，应当从这众多的能力中分清楚优先级，提取出核心并将其提升。</p> <p>以下列举的是「从业余到职业」所需关注的核心能力。</p> <h3 id="_1-3-1-个人执行力">1.3.1 个人执行力</h3> <p>业余与职业最大的一个区别之一在于工作必须付诸行动，必须不断向前推进并最终实现目标。
对于个人执行力，是指把上级的命令和想法变成行动，把行动变成结果，从而保质保量地完成任务。</p> <h3 id="_1-3-2-沟通能力">1.3.2 沟通能力</h3> <p>不要将沟通能力理解成狭义上的表达能力，而要从广义上运用沟通能力，包括但不限于清晰准确地表达意见、持续向领导反馈信息、保持信息透明、与团队成员达成共识等。</p> <p>出现缺乏沟通交流的情况时个人容易被团队所忽略，被忽略意味着个人价值认可度的降低。</p> <h3 id="_1-3-3-责任心">1.3.3 责任心</h3> <p>能力越大，责任越大，反过来说，工作责任心越强，个人的能力就越能体现，不论工作大小，始终保持高度负责的态度，必然会获得领导的赏识。</p> <p>责任心该如何体现？
一个项目中的开发人员总是处于流动状态，当我们参与一个项目的时候，也许只是负责其中的一小部分，但是将整个项目都纳入自己的责任范围才是正确的心态，这样往往能使自己脱颖而出。</p> <h3 id="_1-3-4-业务能力">1.3.4 业务能力</h3> <p>刚参加工作的新人往往对技术报有较大的热情，这个时候也不能忽视业务能力，技术最终是为业务服务，熟练的业务能力可以提升自身的价值。</p> <p>积极地用技术中的系统性思维去解决业务上的问题，有效地提高业务各个环节的效率，最终实现技术驱动业务的发展，为企业创造更大的价值。</p> <p>避免闭门造车、与业务脱节、不懂用户等现象，提升业务能力的同时也更能帮助自己提升产品思维，以便更好地达成开发出好产品的目标。</p> <h3 id="_1-3-5-总结">1.3.5 总结</h3> <p>在这里强调以上几点核心通用能力，主要是由于研发人员普遍更关注技术，但要把工作做好不能仅依靠提升技术能力，高效地执行工作、持续不断地沟通、树立正确的责任心态度、加强业务能力，这些同样非常重要，在这些能力里面都有一个共性，那就是我们作为组织里面的一份子，应该关注大图景：<strong>持续观察周围发生的事情，而不只是自己在做的事情，不要做温水里的青蛙</strong>。</p> <h1 id="二、从职业到专业">二、从职业到专业</h1> <p>业余到职业的转变是第一步，工作中必须不断设定更高的目标、持续提升自己，为了更得心应手地将工作做好，我们还需朝更专业的方向发展。在这个阶段需要掌握更多工作中常用的技术，我将这部分归为三类，第一类是需要精通或熟练掌握的，第二类是需要能够上手应用但现阶段还不要求精通的，第三类是需要略知一二能够知其用途、在相应场景下能派上用场的，体现个人价值的核心能力也不再局限于通用能力，而是包含更多该岗位所特需的能力。</p> <p>注意，从职业到专业需要一个漫长的过程，这部分包含的内容也较多。</p> <h2 id="_2-1-专业技术之了然于胸">2.1 专业技术之了然于胸</h2> <h3 id="_2-1-1-java-高效编程">2.1.1 Java 高效编程</h3> <p>这部分的技术点与 Java 基础有重叠，但要求对 Java 语言有更深入的掌握，并使用更高效的编程方法。</p> <p>推荐阅读：</p> <ul><li>《Effective Java》</li> <li>《Java 8 实战》 https://book.douban.com/subject/26772632/</li> <li>《Java 性能优化权威指南》 https://book.douban.com/subject/25828043/</li></ul> <h3 id="_2-1-2-设计模式">2.1.2 设计模式</h3> <p>在编码过程中反复解决的一些问题被归纳为设计模式，它是在技术交流中的重要组成部分，不会设计模式必然称不上专业的工程师。</p> <p>推荐阅读：</p> <ul><li>《Head First 设计模式》</li> <li>《设计模式：可复用面向对象软件的基础》</li></ul> <p>相关开源项目推荐：</p> <ul><li>https://github.com/iluwatar/java-design-patterns</li></ul> <p>除了阅读这些书籍之外，每一种设计模式最好都自己实现一遍以加深理解。</p> <h3 id="_2-1-3-sql-程序设计">2.1.3 SQL 程序设计</h3> <p>推荐阅读：</p> <ul><li>《SQL 语言艺术》https://book.douban.com/subject/3012601/</li> <li>《MySQL技术内幕（第5版）》https://book.douban.com/subject/26436525/</li></ul> <h3 id="_2-1-4-git-流程规范">2.1.4 Git 流程规范</h3> <p>推荐阅读：</p> <ul><li>https://github.com/justjavac/free-programming-books-zh_CN#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6</li> <li><a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank" rel="noopener noreferrer">Git分支管理策略<span> </span></a></li></ul> <h3 id="_2-1-5-redis">2.1.5 Redis</h3> <p>推荐阅读：</p> <ul><li>《Redis 设计与实现》https://redisbook.readthedocs.io/en/latest/index.html</li></ul> <h3 id="_2-1-6-工具类">2.1.6 工具类</h3> <ul><li>IDEA
<ul><li>熟悉快捷键</li> <li>探索插件市场，使用工具提升效率。</li> <li>熟练掌握重构工具。</li></ul></li> <li>maven</li></ul> <h3 id="_2-1-7-rpc">2.1.7 RPC</h3> <p>至少掌握以下一种常见 RPC 方式。</p> <ul><li>REST</li> <li>Dubbo</li> <li>grpc</li> <li>Web Service</li></ul> <p>推荐阅读：</p> <ul><li>《Netty 实战》</li> <li>《计算机网络：自顶向下方法》</li></ul> <h3 id="_2-1-8-代码质量">2.1.8 代码质量</h3> <p>推荐阅读：</p> <ul><li>《代码整洁之道》</li> <li>《编写整洁代码的艺术》</li> <li>《重构》</li></ul> <h2 id="_2-2-专业技术之驾轻就熟">2.2 专业技术之驾轻就熟</h2> <h3 id="_2-2-1-javascript">2.2.1 Javascript</h3> <p>后端开发过程中，难免也会有一些前端编码工作，有一定的 js 编码能力可以起到事半功倍的效果。</p> <h3 id="_2-2-2-消息队列">2.2.2 消息队列</h3> <ul><li>rabbitmq</li> <li>kafka</li></ul> <h3 id="_2-2-3-linux">2.2.3 Linux</h3> <p>熟悉 Linux 常用命令。</p> <p>推荐阅读：</p> <ul><li>《鸟哥的 Linux 私房菜》</li> <li>《Linux Shell 脚本攻略》</li></ul> <h3 id="_2-2-4-web-服务器">2.2.4 Web 服务器</h3> <p>熟悉常用 Web 服务器的使用。</p> <ul><li>nginx</li> <li>tomcat</li></ul> <h3 id="_2-2-5-分布式相关">2.2.5 分布式相关</h3> <ul><li>数据库主从</li> <li>Redis
<ul><li>主从</li> <li>集群</li></ul></li> <li>Spring Cloud</li></ul> <h3 id="_2-2-6-单元测试">2.2.6 单元测试</h3> <p>推荐阅读：</p> <ul><li>《单元测试之道 Java 版》</li></ul> <h3 id="_2-2-7-docker">2.2.7 Docker</h3> <p>推荐阅读：</p> <ul><li>《Docker 从入门到实践》 https://yeasy.gitbook.io/docker_practice/</li></ul> <h3 id="_2-2-8-web-安全">2.2.8 Web 安全</h3> <p>常见攻击方式的防御。</p> <ul><li>xss</li> <li>sqli</li> <li>csrf</li> <li>url 重定向攻击</li></ul> <p>推荐阅读：</p> <ul><li>《白帽子讲 Web 安全》</li></ul> <h2 id="_2-3-专业技术之略知一二">2.3 专业技术之略知一二</h2> <h3 id="_2-3-1-nosql">2.3.1 NoSQL</h3> <ul><li>mongodb</li></ul> <h3 id="_2-3-2-搜索引擎">2.3.2 搜索引擎</h3> <ul><li>lucene</li> <li>ElasticSearch</li></ul> <h3 id="_2-3-3-序列化">2.3.3 序列化</h3> <ul><li>Protobuf</li> <li>Protostuff</li> <li>Hessian</li> <li>Bson</li></ul> <h3 id="_2-3-4-分布式工具">2.3.4 分布式工具</h3> <ul><li>分布式锁</li> <li>ELK</li> <li>Zookeeper</li> <li>分布式事务</li></ul> <h3 id="_2-3-5-正则表达式">2.3.5 正则表达式</h3> <p>推荐阅读：</p> <ul><li>《精通正则表达式》</li></ul> <h2 id="_2-4-其他推荐书目">2.4 其他推荐书目</h2> <ul><li>《程序员修炼之道：从小工到专家》</li> <li>《代码大全》</li></ul> <h2 id="_2-5-核心能力">2.5 核心能力</h2> <h3 id="_2-5-1-解决问题的能力">2.5.1 解决问题的能力</h3> <p>解决问题的能力被排在第一位，因为这是最能体现工作价值的一个能力，从某一层面来讲，老板雇佣员工都是为了解决某一问题。</p> <p>在解决问题之前先避免成为问题的引发者，避免成为 bug 生产专家，程序员不同于其他工种的一个地方在于——糟糕的程序员可能给企业带来负价值，所以在提升解决问题的能力之前要先确保自己不会成为问题，这个过程也需要自身在逻辑能力、工作严谨性、技术能力等多方面进行提升。</p> <p>解决问题包含几个阶段：</p> <ul><li>发现问题
<ul><li>不局限于个人工作领域，全盘看待整个团队。足够多的眼睛，就可以让所有问题浮现——linus。</li></ul></li> <li>分析问题
<ul><li>许多时候一些技术问题会让人摸不着头脑，有一套<strong>分析问题的理论体系</strong>是很重要的，<strong>当问题出现时，首先收集数据，让数据支撑自己对问题的原因提出假设，然后验证假设是否成立，若不成立则重复这一步骤</strong>。对于可能原因的初步判断、如何高效率地进行分析，这些则需要通过不断的学习和经验积累来进行支撑。</li></ul></li> <li>解决问题
<ul><li>解决问题时对准解决方法，而不是人。</li> <li>解决问题时真正理解出问题的代码。</li></ul></li> <li>问题记录
<ul><li>记录问题并进行复盘，防止此类问题再次发生，积累知识库。</li></ul></li></ul> <p>在解决了具体的问题之后，我们不能仅局限于此，还需要多帮助团队成员解决问题，这是更能体现专业能力的地方。</p> <h3 id="_2-5-2-学习能力">2.5.2 学习能力</h3> <p>学习能力对于技术岗位极其重要，一方面需要技术积累以支撑工作，另一方面工作中也会碰到推陈出新的技术，这些迫使我们在工作中需要不断学习，因此也重点强调该能力。</p> <p>好的学习能力有以下几个要素：</p> <ul><li>自驱力
<ul><li>对新知识、新技能具有强烈的渴求；积极利用多种途径为自己创造学习机会。</li></ul></li> <li>好奇心
<ul><li>好奇心是工程师应具备的特质，它能够驱使你不断深入地学习。</li></ul></li> <li>认真
<ul><li>学习方法上不存在银弹，认真阅读、认真记笔记、认真写读后感，这些最朴素的方式就是好的学习方法。</li></ul></li> <li>动态规划
<ul><li>动态调整学习步伐。</li></ul></li> <li>联想
<ul><li>将相关的技术串联在一起，帮助理解与记忆，加深思想。</li></ul></li></ul> <h3 id="_2-5-3-信息获取能力">2.5.3 信息获取能力</h3> <p>IT 行业构建于信息论之上，程序员应当更善于获取信息，在工作中也需要无时不刻地利用互联网查取资料，这是非常容易被忽视的一个重要能力。不同的程序员获取信息的能力和渠道都是不同的，可以在以下方面进行提升。</p> <ul><li>做信息的捕食者而不是被喂养者。</li> <li>使用 Google ，充分利用全世界的信息。</li> <li>提升英文水平。</li> <li>学会利用各种信息工具。</li> <li>编写爬虫抓取信息。</li></ul> <h1 id="三、尾声">三、尾声</h1> <p>作为一个 Java 后端工程师，需要学习的东西非常多，即使成长为一个专业的 Java 工程师，后面的路也还很长，本文所定义的「专业」是指接近高级工程师的能力，在下篇将继续讲解从专业到高级再到专家所需具备的技能。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[俯瞰 Java 服务端开发]]></title>
            <link>https://tech.codelc.com/docs/java/%E4%BF%AF%E7%9E%B0Java%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/java/%E4%BF%AF%E7%9E%B0Java%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91.html</guid>
            <pubDate>Wed, 12 Aug 2020 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <blockquote><p>Java 服务端开发是一个非常宽广的领域，要概括其全貌，即使是几本书也讲不完，该文将会提到许多的技术及工具，但不会深入去讲解，旨在以一个俯瞰的视角去探寻这片领域。</p></blockquote> <h2 id="目录">目录</h2> <ul><li><a href="#%E4%BF%AF%E7%9E%B0-java-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91">俯瞰 Java 服务端开发</a> <ul><li><a href="#%E7%9B%AE%E5%BD%95">目录</a></li> <li><a href="#%E6%A1%86%E6%9E%B6">框架</a> <ul><li><a href="#spring-boot">Spring Boot</a></li> <li><a href="#vertx">Vert.x</a></li></ul></li> <li><a href="#%E7%BD%91%E7%BB%9C">网络</a> <ul><li><a href="#%E4%BA%94%E5%B1%82%E5%8D%8F%E8%AE%AE">五层协议</a></li> <li><a href="#http-%E5%8D%8F%E8%AE%AE">HTTP 协议</a></li> <li><a href="#tcp-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6">TCP 拥塞控制</a></li> <li><a href="#%E7%BD%91%E7%BB%9C-io-%E6%A8%A1%E5%9E%8B">网络 I/O 模型</a></li></ul></li> <li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a> <ul><li><a href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93">关系型数据库</a></li> <li><a href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E">存储引擎</a></li> <li><a href="#newsql">NewSQL</a></li> <li><a href="#nosql-%E6%95%B0%E6%8D%AE%E5%BA%93">NoSQL 数据库</a></li> <li><a href="#%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93">时序数据库</a></li> <li><a href="#%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93">列式数据库</a></li> <li><a href="#%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93">嵌入式数据库</a></li></ul></li> <li><a href="#%E4%B8%AD%E9%97%B4%E4%BB%B6">中间件</a> <ul><li><a href="#web-server">Web Server</a></li> <li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98">分布式缓存</a></li> <li><a href="#kv-%E5%AD%98%E5%82%A8">KV 存储</a></li> <li><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">消息队列</a></li> <li><a href="#%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6">定时调度</a></li> <li><a href="#rpc">RPC</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6">数据库中间件</a></li> <li><a href="#%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F">日志系统</a></li> <li><a href="#%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83">配置中心</a></li></ul></li> <li><a href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1">微服务</a> <ul><li><a href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0">服务注册与发现</a></li> <li><a href="#%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%8D%E7%BA%A7">熔断与降级</a></li> <li><a href="#%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA--apm">链路追踪 / APM</a></li> <li><a href="#api-%E7%BD%91%E5%85%B3">API 网关</a></li> <li><a href="#%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC">服务网格</a></li></ul></li> <li><a href="#%E5%B8%B8%E7%94%A8%E5%BC%80%E6%BA%90%E7%BB%84%E4%BB%B6">常用开源组件</a> <ul><li><a href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE">数据访问</a></li> <li><a href="#%E5%B7%A5%E5%85%B7%E7%BB%84%E4%BB%B6">工具组件</a></li> <li><a href="#%E7%BC%93%E5%AD%98">缓存</a></li> <li><a href="#%E5%AD%97%E8%8A%82%E7%A0%81%E4%BF%AE%E6%94%B9">字节码修改</a></li> <li><a href="#http%E5%AE%A2%E6%88%B7%E7%AB%AF">http客户端</a></li> <li><a href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B">响应式编程</a></li> <li><a href="#%E5%BA%8F%E5%88%97%E5%8C%96">序列化</a></li> <li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1">分布式事务</a></li> <li><a href="#%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6">事件驱动框架</a></li> <li><a href="#%E8%A7%84%E5%88%99%E5%BC%95%E6%93%8E">规则引擎</a></li> <li><a href="#%E6%B5%8B%E8%AF%95">测试</a></li></ul></li> <li><a href="#%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3">编程思想</a> <ul><li><a href="#%E5%8E%9F%E5%88%99">原则</a></li></ul></li> <li><a href="#%E7%BB%93%E8%AF%AD">结语</a></li></ul></li></ul> <h2 id="框架">框架</h2> <h3 id="spring-boot">Spring Boot</h3> <p>Spring 框架已经成为 Java 服务端开发领域里的标配，无数的服务基于其开发，它整合了服务端开发所需的绝大多数组件，Spring Boot 在其基础上又做了一层轻封装并简化了依赖管理，使得它用起来更加的便捷。</p> <h3 id="vert-x">Vert.x</h3> <p>Spring 框架早已成为主流，但是我们也不能忽略了其他优秀框架的存在。</p> <p><a href="https://github.com/vert-x3" target="_blank" rel="noopener noreferrer">Vert.x<span> </span></a> 是在 JVM 基础上构建响应式应用的一套工具集，支持多种语言，它不仅是一套工具集，也可视作是一套框架，其中包含使用 Netty 编写的 Web 框架、gprc、redis 客户端等众多组件，囊括了大部分开发网络应用时所需用到的组件，它最重要的核心概念是使用了事件驱动的非阻塞模型，因此具备高度的可伸缩性。它使用了响应式的编程模型，这个话题在下文中会再提到。</p> <h2 id="网络">网络</h2> <h3 id="五层协议">五层协议</h3> <p>学习计算机网络时一般采用折中的办法，也就是中和 OSI 和 TCP/IP 的优点，采用一种只有五层协议的体系结构，即物理层、数据链路层、网络层、运输层、应用层，每一层都有其各自的术语，比如：吞吐量、子网掩码、VIP、DNS等等，这在平时工作的沟通过程中也是至关重要。要做好服务端编程，我们必须对网络的一些基本概念有一个清晰的认识，推荐阅读《计算机网络：自顶向下方法》。</p> <p>推荐阅读：</p> <ul><li><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/network/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C.md" target="_blank" rel="noopener noreferrer">五层协议<span> </span></a></li> <li><a href="https://github.com/Snailclimb/JavaGuide/blob/master/docs/network/%E5%B9%B2%E8%B4%A7%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93.md" target="_blank" rel="noopener noreferrer">计算机网络知识总结<span> </span></a></li></ul> <h3 id="http-协议">HTTP 协议</h3> <p>对于服务端编程而言，在网络这个部分最重要的还是 HTTP 协议，从 TCP、DNS ，最后到浏览器响应，我们必须清楚整个过程是如何运转的，中间再加入 CDN、反向代理、流量控制等服务时，其会更加复杂，但也正因为网络的分层模型，使得我们可以在这个中间过程中对服务端的响应性能做出优化。</p> <p>具体到 HTTP 协议，其承载于 TCP 协议之上，中间再加上 TLS 或 SSL，就成了 HTTPS ，协议头如何解析，响应体如何发送，搞清楚了这些，可以很容易地开发一个简单的 HTTP 服务。HTTP 协议也在不断改进，目前已经到了 2.0 版本，在传输性能上有大幅的提升。</p> <p>HTTP 使用明文传输，因此很容易受到中间人攻击，可以在路由器、代理等多个层面截获传输信息，因此 HTTP 终将退出历史舞台，HTTPS 必然成为主流，但是 HTTPS 也并非绝对安全，由于证书签发机构存在安全漏洞，曾导致许多网站使用了不安全的 SSL 证书，因此很多应用会采用自定义的加密方式来加强信息传输的安全性。</p> <h3 id="tcp-拥塞控制">TCP 拥塞控制</h3> <p>TCP 使用多种拥塞控制策略来避免发送方至接收方之间的链路变得拥塞，其有许多具体的实现算法，具体的实现细节隐藏在操作系统的内核当中，通过使用不同的算法，可以在不同的场景下获得最佳的性能，例如 Google 设计并发布的 BBR（Bottleneck Bandwidth and Round-trip propagation time）拥塞算法，它能更有效地利用网络环境，尤其在超远距离的网络传输中能获得更大的性能提升，目前已经移植到 linux 内核4.9版本。</p> <p>由于许多网络层相关的算法都隐藏在操作系统内核当中，普通计算机用户一般无需理解这些概念，但是对于服务端开发者来说，若对其有一定的了解，则能够从这一层面寻找解决方案来提升系统的吞吐量。</p> <h3 id="网络-i-o-模型">网络 I/O 模型</h3> <p>常见 I/O 模型主要有 BIO（阻塞I/O），NIO（非阻塞I/O），I/O复用、事件(信号)驱动I/O、AIO（异步I/O）。以读取数据为例，传统的 BIO 里面调用 socket 的 read 方法，函数在收到数据前会一直阻塞，对于 NIO，如果有数据则返回，反之返回 0，不会发生阻塞，而 AIO 则更进一步，不光等待数据就绪是非阻塞，连数据从网卡到内存的过程也是异步的。</p> <p>结合使用 NIO、AIO、I/O复用，可以解决线程瓶颈并处理海量连接，比如 nginx 使用了 AIO 模型，因此性能比 apache http server 性能更好。在 Java 领域，Netty 基于 Reactor 模式实现了一个异步事件驱动的 NIO 框架，其已经运用在互联网的许多领域，大到大数据、通信行业、游戏行业，小到 redis 客户端、Web 框架等开源组件都有其身影。</p> <h2 id="数据库">数据库</h2> <h3 id="关系型数据库">关系型数据库</h3> <p>MySQL 是最流行的开源数据库，PostgreSQL 是最高级的开源数据库，SQL Server 是微软开发的企业级数据库，还有在大型公司用的较多的 Oracle 数据库。在服务端开发方面，MySQL 的市场占用率是最高的，但也推荐学习一下 PostgreSQL 和所谓的「企业级数据库」，毕竟 MySQL 在这些数据库面前有时确实显得功能简单、实用性不足。</p> <p>在真实的工作中，数据库的设计是一个非常需要平衡取舍的过程，有时为了优化查询性能不得不做一些数据冗余，而在数据量极大的情况下，又必须谨慎选择每一列的存储类型、避免冗余。</p> <p>数据量非常大的情况下，大多数时候还要进行分库分表的设计。</p> <ul><li>ShardingSphere
<ul><li>目前 Java 中主流的分库分表中间件，支持客户端架构、代理架构，Sidecar 架构目前还在开发中。</li></ul></li> <li>Vitess
<ul><li>Vitess 是 Youtube 开源的 MySQL 数据库集群系统，采用的是中心化的数据库代理架构，这套数据集群承载了 Youtube 数以亿计的数据量和访问请求。</li></ul></li></ul> <h3 id="存储引擎">存储引擎</h3> <p>MySQL 中主流使用的是 InnoDB 存储引擎，内部采用了 B+ 树的索引结构，Percona XtraDB 是InnoDB 存储引擎的增强版，Percona 兼容 MySQL，号称拥有更好的性能，也具有一定的市场占有率。</p> <p>除了 InnoDB 及其衍生引擎，RocksDB 也是一个可选项，这是一个 LSM 存储引擎，不同于传统的基于 B+ 树的存储引擎，基于 LSM 存储引擎的数据库尤其适合写多读少的场景，由于最初是设计用来做持久化的键值数据存储，因此在 KV 存储上具有非常高的性能，可惜的是 MySQL 无法选择 RocksDB 作为存储引擎，目前支持的数据库有 MariaDB 和 Percona。</p> <h3 id="newsql">NewSQL</h3> <p>NewSQL 这一新兴领域也大量使用了 RocksDB 作为存储引擎，TiDB 作为流行度较高的 NewSQL 产品，就是用其实现的数据持久化。</p> <h3 id="nosql-数据库">NoSQL 数据库</h3> <ul><li>MongoDB
<ul><li>MongoDB 介于关系数据库和非关系数据库之间，不要求数据存储具有固定的模式，且能用于存储超大规模的数据集。</li></ul></li></ul> <h3 id="时序数据库">时序数据库</h3> <p>随着互联网的深入，应用场景越来越丰富，诸如系统运行状态、系统指标采集等场景产生大量的数据，这类基于时间的一系列数据，以写多读少、数据量极大为特点，传统的数据库已经不适合存储这类数据，时序数据库由此诞生。</p> <p>主流的时序数据库有：</p> <ul><li>influxdb</li> <li>Prometheus</li> <li>graphite</li></ul> <h3 id="列式数据库">列式数据库</h3> <p>传统的关系型数据库采用行式存储，大数据领域多采用列式存储，列式存储的主要优势在于可以按需所取，在并行处理和数据压缩上更有优势。关系型数据库适合 OLTP， 列式数据库更适合 OLAP，为了使列式数据库能更好地支持 OLTP，目前出现了像 kudu 和 Druid 这类优秀的开源产品，它们结合了列式存储的优势，并在 OLTP 方面也做了特别的优化。</p> <p>主流的列式数据库有：</p> <ul><li>HBase</li> <li>Cassandra</li> <li>kudu</li> <li>Druid</li></ul> <h3 id="嵌入式数据库">嵌入式数据库</h3> <p>传统的关系型数据库能够支持企业级的应用，但在许多场景下，我们可能只需要一个小型应用，这个时候使用嵌入式数据库是一个方便的选择，除此之外，嵌入式数据库非常适合用于做单元测试。</p> <p>Java 中流行的嵌入式数据库有：</p> <ul><li>h2base</li> <li>moby</li></ul> <h2 id="中间件">中间件</h2> <h3 id="web-server">Web Server</h3> <ul><li>Nginx
<ul><li>Nginx 使用 AIO 的模型实现高并发，Apache 每个请求独占一个线程。</li> <li>AIO 模型适合于 IO 密集型服务，多进程或线程适合于 CPU 密集型服务，由于大多数 Web 服务都属于 IO 密集型，nginx 的市场占有率逐渐超过了 Apache。由于这一特点，Nginx 也非常适合做反向代理，通过这种机制做负载均衡也是非常主流的一种方案。</li></ul></li> <li>tomcat、jetty、weblogic 等传统 Java Web 服务器
<ul><li>随着容器化技术的流行，这类服务器日渐式微，市场占有率逐渐下降，进行容器化部署时tomcat一般内置在程序中，这种进步使得开发者可以更关注业务代码本身，而无需关注此类服务器的种种细节，可谓是对开发人员的减负。</li></ul></li> <li>OpenResty
<ul><li>优秀的开源产品经常出现许多优秀的衍生产品，比如 Percona 之于 MySQL，OpenResty 之于 Nginx，Kong 之于 OpenResty。</li> <li>Nginx 市场占有率之高，但许多场景下是用其做反向代理，OpenResty 的设计目标则是让 Web 服务直接跑在 Nginx 服务内部。</li> <li>OpenResty 同时也是基于 LuaJIT 的 Web 平台，开发者可以很方便地使用 Lua 调用 Nignx 模块，具有强大的可扩展性，比如可将典型的 Nginx + Tomcat + MySQL 架构更换为 Nginx + Lua + Redis + Tomcat + MySQL 的架构。</li> <li>Kong 从技术上讲也属于 Web Server，但一般用来做 API 网关，下文中再详述。</li></ul></li></ul> <h3 id="分布式缓存">分布式缓存</h3> <ul><li>Redis
<ul><li>Redis 作为一个高性能的内存数据库，目前已被广泛使用，其支持多种数据结构，根据不同场景使用不同的数据结构，才能最有效地使用它。</li></ul></li></ul> <h3 id="kv-存储">KV 存储</h3> <ul><li>Pika
<ul><li>Redis 的性能非常高，但在将其做数据库使用时存在数据持久化的问题，Pika 就是为了解决这一问题而出现，它底层基于 RocksDB，修改了其部分源代码，在 KV 数据持久化上有非常高的性能，与基于内存的 redis 相比仅有较小的性能下降，同时它还兼容大部分的 redis 协议，与 Redis 的使用几乎没有差异，上手简单。</li></ul></li> <li>Tair
<ul><li>Tair 与 Pika 类似，底层支持多种存储引擎，包括 mdb、rdb、ldb，其中 ldb 基于 leveldb（google开源，rocksdb 在其基础上优化），它可将内存存储和持久化相结合，具有高可用的分布式架构，目前开源版本已经不再维护，阿里云上则提供了企业级的 Tair 存储服务。</li></ul></li> <li>SSDB
<ul><li>SSDB 也是兼容 Redis 的一款 KV 数据库，目前更新频率较低，相比而言 Pika 目前还在更新中，且有企业进行背书。</li></ul></li></ul> <h3 id="消息队列">消息队列</h3> <p>消息队列在请求削峰、跨系统间通信解耦、发布订阅等许多场景下都会使用到，不光能解决这些问题，采用消息驱动的架构可以增强系统的扩展性，比如新增一个订阅方，即可以实现新的功能，并且对当前的系统没有任何的侵入性。</p> <p>常用的消息队列产品有 kafka、rabbitmq 等，它们各有优缺点，在大数据领域 kafka 占有绝对优势，总体的市场占有率也较高，而 rabbitmq 由于产品成熟，也被广泛使用。</p> <p>在使用消息队列的过程中，需要处理一系列的细节，比如：定义消息处理者、如何发送消息、如何发布事件、消息如何序列化、如何记录消息记录、设计消息路由、消息处理失败的重试机制、消息 id 等等，在具体的编码过程中不能完全专注于业务代码开发，因此市面上有一些 ESB 产品在内部处理好了这些细节，并从更高的抽象层级提供更加简洁的 API，在开发过程中则能更加聚焦在业务逻辑本身，当我们的系统面临这些问题的时候，不妨选择一个 ESB 产品来提升研发效率。</p> <h3 id="定时调度">定时调度</h3> <p>简单的定时任务可以采用 linux cron 进行配置，复杂的场景也可以使用分布式任务调度框架，可选的实现方式非常多，这里简单的列举几种。</p> <ul><li>Quartz
<ul><li>老牌任务调度系统，许多分布式任务调度框架基于它而扩展。</li></ul></li> <li>Spring Scheduler
<ul><li>用它来做简单的任务调度非常方便，但要注意由于现在的系统大多采用分布式部署，因此当使用它来做任务调度时最好做到单独的服务中，避免与其他系统耦合。</li></ul></li> <li>国产分布式任务调度系统
<ul><li>目前较为流行的有 Elastic-Job、XXL-JOB，Elastic-Job 采用去中心化的架构，依赖 zookeeper 存储任务调度数据，XXL-JOB 采用中心化调度的架构，调度采用 RPC 方式。</li> <li>PowerJob 是新兴的一个开源任务调度系统，在功能上更为强大，支持 MapReduce 分片，值得关注。</li></ul></li></ul> <h3 id="rpc">RPC</h3> <p>提到 RPC 不得不提到日暮西山的 Web Service，其采用 XML 作为消息格式，并以 SOAP 协议进行封装，由于过于复杂且性能开销较大，其逐渐被采用 JSON 格式的 REST 服务所取代，相比之下，REST 简单且采用更高效的序列化方式，所以目前许多系统广泛采用 HTTP 的方式进行远程过程调用。</p> <p>在对于性能要求特别高的场景，或从整体架构上考虑，人们才会选用专门的 RPC 产品，这类系统一般拥有更高效的通讯协议和数据传输格式，典型的有 dubbo、grpc、thrift，其中 grpc 具有最优秀的性能。</p> <p>RPC 框架的原理其实与 HTTP 调用类似，只是采用了更精简的协议头和数据序列化方式，此外在服务注册发现及负载均衡上也做了专门的封装。在 Spring Cloud 中，使用 OpenFeign 进行服务间调用是非常方便的一个选择，其使用 HTTP 方式，当性能无法满足时，可考虑替换序列化方式，或选用 grpc 进行通信。</p> <h3 id="数据库中间件">数据库中间件</h3> <p>数据库本身就是一个庞大的产品，除了前面提到的 ShardingSphere、Vitess 这类中间件，还有一类专门做数据处理的中间件。</p> <ul><li>otter
<ul><li>分布式数据库同步系统，支持 MySQL、Oracle。</li></ul></li> <li>canal
<ul><li>基于 MySQL 数据库增量日志解析，提供增量数据订阅和消费。</li></ul></li> <li>DataX-Web
<ul><li>分布式数据同步工具，可用来简化 ETL 工作。</li></ul></li> <li>gh-ost
<ul><li>对数据表结构进行架构变更时，可能导致表被锁住，如果数据量特别大，这种问题对于线上发布的影响是比较大的，可以采用建新表并迁移数据再修改表名的方式手工处理，这种方式容易出错且耗时，Github 开源的 MySQL 在线架构迁移工具则是程序化完成这一类操作的很好的选择。</li></ul></li></ul> <h3 id="日志系统">日志系统</h3> <ul><li>ELK
<ul><li>日志系统一般采用 ELK 技术栈，这其中包含三个子系统，因此要扩展一个新功能，可以有多种方式切入，比如做监控报警，可以使用 logstash 将 metrics 写入到 Prometheus，也可以使用 kibana 上的 sentinl 插件或者 ElastAlert 插件。</li> <li>logstash 支持从许多管道收集数据，其中包括 kafka，在日志量特别大的情况下，可以将日志先发送至 kafka。</li></ul></li> <li>Sentry
<ul><li>日志在很大一部分场景下都是用于排查错误的，除了 ELK 外还有专注于应用程序错误报告的系统，比如 Sentry。</li></ul></li></ul> <h3 id="配置中心">配置中心</h3> <p>由于越来越多的系统基于 docker 部署，配置中心不仅可以简化系统的配置管理，也可简化系统的发布流程，目前较为流行的开源配置中心是 Apollo。另外也可以通过 zookeeper、Consul 等工具来实现统一配置管理。</p> <p>Nacos 是阿里开源的一款集配置中心和注册中心于一体的系统，使用它来做配置中心也较为方便，服务端部署相比 Apollo 简化了许多。</p> <h2 id="微服务">微服务</h2> <p>由于单体应用牵一发而动全身的特点，许多大型应用在开发时都会自觉拆分为多个子系统，这是在微服务概念提出前就被广泛采用的方式，而微服务概念的提出则更进一步，提出了一种全新的系统开发方式，使系统可以方便地拆分到更小的粒度，即微型服务，那么在服务数量越来越多的情况下，服务治理、熔断降级、链路追踪等问题也浮出水面，于是解决这些问题的 Spring Cloud 框架冉冉升起。</p> <h3 id="服务注册与发现">服务注册与发现</h3> <p>主流的服务注册与发现组件有：Eureka、Consul、Nacos 等等，它们采用不同的 CAP 分布式一致性规则或多种都支持，但不管使用哪一种，其实还是存在服务失联的问题，比如在滚动更新的过程中，注册中心未能及时剔除掉服务，导致调用方仍在调用停止的服务，首先我们可以通过调整配置减少更新周期，必要时需要修改其源代码，使用长连接，只要连接中断即从注册中心剔除服务，具体的细节需要专门写一篇文章来讲解。</p> <p>在可能的情况下，尽量使用消息机制来进行服务间通信，这是一个更好的选择，除了更好地进行解耦，在滚动更新这个部分也能更好地保持系统不间断运转。</p> <h3 id="熔断与降级">熔断与降级</h3> <p>服务间的调用过多，一定程度上增加了系统的耦合度，当其他微服务出问题或响应较慢时，整个系统都受影响，在必要时需要对出问题的服务进行熔断或降级。</p> <ul><li>Hystrix
<ul><li>Spring Cloud 框架默认集成的熔断组件。</li></ul></li> <li>Sentinel
<ul><li>Spring Cloud Alibaba 中集成的熔断组件，提供了一个外部控制台，可以实时调整系统的熔断降级配置，在这个部分强于 Hystrix 。</li></ul></li></ul> <h3 id="链路追踪-apm">链路追踪 / APM</h3> <p>服务间互相调用，使得调试变得比单体应用复杂不少，这个时候使用链路追踪工具能够简化调试，同时也能够对应用程序的性能有更直观的监控。</p> <p>主流的链路追踪组件有：</p> <ul><li>zipkin</li> <li>pinpoint</li> <li>SkyWalking</li> <li>jaeger</li></ul> <h3 id="api-网关">API 网关</h3> <p>Spring Cloud 体系中常用的网关前有 Zuul，后有 Gateway，这一类跟 Spring Cloud 结合紧密，使用方便，但由于它们都是 Java 写成，在许多场景下还是比不上一些专门的网关产品。</p> <ul><li>Kong
<ul><li>Kong 是 OpenResty 的衍生开源网关产品，拥有优秀的性能和丰富的插件，可满足许多的扩展性需求。</li></ul></li> <li>Traefik
<ul><li>Traefik 是用 Go 语言编写的网关，定位是云原生的边界路由网关产品，它拥有丰富的特性、易用的控制面板，与云原生场景深度结合，提供了实时的流量指标可对接到 Prometheus 中。其企业版包含限流、高可用等特性，开源版在这一部分有所缺失。</li></ul></li></ul> <h3 id="服务网格">服务网格</h3> <p>从单体应用到微服务的演进，我们会发现服务治理、熔断、Tracing 这些几乎是必不可少的部分，即使是使用 Spring Cloud 框架，我们也需要关注大量的微服务技术细节，为了分离这一关注点并使这些技术成为基础设施一般的存在，服务网格应运而生。</p> <p><a href="https://jimmysong.io/blog/what-is-a-service-mesh/" target="_blank" rel="noopener noreferrer">什么是Service Mesh（服务网格）？<span> </span></a></p> <blockquote><p>服务网格好比微服务间的 TCP/IP，负责服务之间的网络调用、限流、熔断和监控。对于编写应用程序来说一般无须关心 TCP/IP 这一层（比如通过 HTTP 协议的 RESTful 应用），同样使用 Service Mesh 也就无须关心服务之间的那些原本通过服务框架实现的事情，比如 Spring Cloud、Netflix OSS 和其他中间件，现在只要交给 Service Mesh 就可以了。</p></blockquote> <p>目前主流的服务网格有：</p> <ul><li>Istio</li> <li>Linkerd</li></ul> <h2 id="常用开源组件">常用开源组件</h2> <p>上文有提及的，这里不再累述。</p> <h3 id="数据访问">数据访问</h3> <ul><li>MyBatis Plus</li> <li>Mapper</li> <li>jOOQ</li> <li>JPA</li> <li>dynamic-datasource-spring-boot-starter</li> <li>sharding-jdbc</li></ul> <h3 id="工具组件">工具组件</h3> <ul><li>guava</li> <li>commons-lang3</li> <li>hutool</li></ul> <h3 id="缓存">缓存</h3> <ul><li>redission</li> <li>jetcache</li> <li>caffeine</li></ul> <h3 id="字节码修改">字节码修改</h3> <ul><li>asm</li> <li>javassist</li> <li>cglib</li></ul> <h3 id="http客户端">http客户端</h3> <ul><li>okhttp</li> <li>Aache HttpClient</li> <li>retrofit</li> <li>openfeign</li></ul> <h3 id="响应式编程">响应式编程</h3> <ul><li>RxJava</li> <li>reactor-core</li></ul> <h3 id="序列化">序列化</h3> <ul><li>protobuf</li> <li>protostuff</li> <li>hessian</li></ul> <h3 id="分布式事务">分布式事务</h3> <ul><li>seata</li></ul> <h3 id="事件驱动框架">事件驱动框架</h3> <ul><li>AxonFramework</li></ul> <h3 id="规则引擎">规则引擎</h3> <ul><li>drools</li></ul> <h3 id="测试">测试</h3> <ul><li>junit</li> <li>mockito</li> <li>Spock</li></ul> <h2 id="编程思想">编程思想</h2> <p>编程思想是一个抽象的概念，要将其具象化我们必须透过现象看其本质，优秀的编程思想是对各种优秀想法的组织，这些想法可以精炼成许多原则，原则是构成编程思想的一个重要部分，也是所有编程方式都可以遵守的通用准则。在原则的基础上，在编码过程中反复解决的一些问题又被归纳为模式，这两者是思想的主要构成，另外也有不同的编程范式及方法论，我在这里简单的讲一下设计原则。</p> <h3 id="原则">原则</h3> <blockquote><p>很多原则不仅适用于编程领域，也适用于其他领域，我想这也是为什么乔布斯提倡人人都应该学习编程，因为它能让你拥有更好的思考方式。</p></blockquote> <ul><li>保持简单
<ul><li>Keep It Simple, Stupid (KISS)
<ul><li>最重要的原则之一，可靠来源于简单，只有不断保持系统的简单、代码的简单，才能更好地创造优秀的软件。</li></ul></li> <li>You Ain’t Gonna Need It (YAGNI)
<ul><li>如无必要，勿增复杂性，避免过度设计。</li></ul></li> <li>Separation of Concerns (SoC) – 关注点分离
<ul><li>将目标相关联的部分封装在一起，标识为关注点。这是降低复杂性的一个重要原则，MVC 或 MVP 模式都是该原则的应用，将模型、视图和控制器作为不同的关注点，使得每一个关注点可以更有效地理解及重用。</li> <li>在编码过程中，也可以应用这一思想，比如我们首先关注应用程序是否可用，当其运行正确后再关心运行效率，这比同时进行这两项工作要简单的多。</li></ul></li></ul></li> <li>不要重复
<ul><li>Don’t Repeat Yourself (DRY)
<ul><li>最简单也最容易理解的原则，每个程序员都应该以随意复制粘贴代码而感到羞愧。</li></ul></li> <li>Convention over Configuration（CoC）- 惯例优于配置原则
<ul><li>将约定的配置方式和信息作为缺省的规则来使用，可以减少开发人员做决定的数量，减少编码量，获得简单的好处，又不会丢失灵活性。</li> <li>Spring Boot 框架解决的问题之一就是简化项目的配置，其大量应用了 CoC 原则。</li></ul></li></ul></li> <li>S.O.L.I.D 原则
<ul><li>Single Responsibility Principle (SRP) - 单一职责原则
<ul><li>一个类，只做一件事，并把这件事做好，其只有一个引起它变化的原因。</li> <li>很简单的原则，但是很多程序员在工作时经常违反这一原则，比如一个 service 类中引入许多 dao 对象，提供多种不相关服务。</li></ul></li> <li>Open/Closed Principle (OCP) – 开闭原则
<ul><li>模块是可扩展的，而不可修改的。也就是说，对扩展是开放的，而对修改是封闭的。</li> <li>设计模式中的代理、策略和观察者模式比较好地实现了这一原则。</li> <li>当我们定义的一个API可接受函数作为参数时，实际上也是一种策略模式的变体，同样也体现了这一原则。</li></ul></li> <li>Liskov substitution principle (LSP) – 里氏代换原则
<ul><li>子类必须能够替换成它们的基类。</li> <li>这个原则可作为我们设计类继承关系的基准。</li></ul></li> <li>Interface Segregation Principle (ISP) – 接口隔离原则
<ul><li>对接口进行拆分，使用多个专门的接口比使用单一的总接口要好。</li> <li>接口可以多继承，那为何要因为懒惰而将其随便定义在一个总接口里呢？</li></ul></li> <li>Dependency Inversion Principle (DIP) – 依赖倒置原则
<ul><li>高层模块不应该依赖于低层模块的实现，而是依赖于高层抽象。</li> <li>IoC 是 DIP 的一个具体实现，其已经深入到编程语言当中，Spring 框架最初就只是作为一个 IoC 容器，而后才不断扩展出许多实用功能并最终成为一个开发框架。</li> <li>相关原则：Hollywood Principle – 好莱坞原则（所有的组件都是被动的，所有的组件初始化和调用都由容器负责）。</li></ul></li></ul></li> <li>高内聚、低耦合
<ul><li>Law of Demeter – 迪米特法则
<ul><li>又称“最少知识原则”（Principle of Least Knowledge），一个类对于其他类知道的越少越好，知道的越多其耦合程度就越高。</li> <li>门面模式和中介模式都是迪米特法则应用的例子。</li> <li>这一原则强调低耦合。</li></ul></li> <li>Common Closure Principle（CCP）– 共同封闭原则
<ul><li>如果必须修改应用程序里的代码，我们希望所有的修改都发生在一个包里（修改关闭），而不是遍布在很多包里。</li> <li>在微服务架构中，若修改一个功能时，经常需要修改多个服务，那么其很有可能违反了 CCP 原则不恰当地进行了服务拆分。</li> <li>这一原则强调高内聚。</li></ul></li> <li>Common Reuse Principle (CRP) – 共同重用原则
<ul><li>包的所有类被一起重用，没有被一起重用的类不应该被组合在一起。依赖一个包就是依赖这个包所包含的一切。</li> <li>CCP则让系统的维护者受益，CCP让包尽可能大（CCP原则加入功能相关的类），CRP则让包尽可能小（CRP原则剔除不使用的类）。它们的出发点不一样，但不相互冲突。</li> <li>这一原则同样强调高内聚。</li></ul></li></ul></li></ul> <h2 id="结语">结语</h2> <p>正如开头所言，服务端开发领域极其庞大，本文还有许多枝节尚未提及，比如安全、DevOps等等。技术的演进使这个领域加速扩大，未来还会有许多的变化，也许 Service Mesh 将会成为主流，也许 NewSql 将成为开发标配，任何一门技术的演进历史变长，它的总体学习时间相应也会增加，但这并不意味着对其的应用也会变得复杂，我们不能忽视云计算这一因素，云服务的提供为开发者隐藏了许多的细节，在这个时代不需要知晓每一项技术的原理，也能够开发出服务千万用户的产品。</p> <p>未来会演进成什么样，可以去期待，但不要只是去期待，因为未来已经到来，只是还没有平均分布。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[我的效率工具箱]]></title>
            <link>https://tech.codelc.com/docs/tools/%E6%88%91%E7%9A%84%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7%E7%AE%B1.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/tools/%E6%88%91%E7%9A%84%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7%E7%AE%B1.html</guid>
            <pubDate>Thu, 11 Jun 2020 21:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <blockquote><p>该文主要介绍/推荐一些平时工作中可以提升效率的工具。</p></blockquote> <h2 id="基础工具">基础工具</h2> <h2 id="_1-vim">1. vim</h2> <ul><li>vi 可谓无处不在，它内置在mac和linux系统中，不光有强大的文本编辑功能和插件生态，在Visual Studio、Idea、DataGrip、Visual Studio Code、甚至chrome等众多工具中都有它的身影，比如说chrome中的 <strong>Vimium</strong> 插件, 使用该插件不需要鼠标就可以非常方便的浏览网页，还有非常好用的书签和浏览记录搜索功能。</li> <li>vim 的学习曲线比较陡峭，但是一旦熟练之后就再也离不开了。</li> <li>学会了vim，不光是只掌握了vim，你还能更轻松地使用其他的工具，比如linux中的less、more等，其内部的快捷键跟vim是类似的。</li></ul> <h2 id="_2-google">2. google</h2> <ul><li>原本不用推荐，但是平时接触到的很多开发还是不用谷歌的，所以提一下。</li> <li>常见场景，碰到技术问题，英文一搜，点开前面两三个搜索结果，很快找到答案。</li> <li>程序员要更善于使用互联网。</li></ul> <h2 id="_3-shell">3. Shell</h2> <ul><li>Windows Terminal + WSL2</li> <li>Cmder</li> <li>Cygwin</li> <li>Oh My Zsh</li></ul> <h2 id="_4-win-r">4. Win + R</h2> <ul><li>Windows下有不少快速启动的软件，但其实运行窗口就可以实现了，新建一个快速访问的文件夹将其放入环境变量，再将经常访问的快捷方式加入其中，比如D盘的快捷方式，只需要Win+R，输入d即可打开D盘。</li></ul> <h2 id="_5-everything">5. Everything</h2> <ul><li>Alt + R 快捷键，电脑上的任何文件都能快速搜索出来，用了再也离不开。</li></ul> <h2 id="_6-microsoft-365">6. Microsoft 365</h2> <ul><li>PowerPoint 创意灵感功能，让你不需要再去找ppt模板。</li> <li>Excel PowerQuery PowerPivot，数据分析，组合查询，可视化数据分析，感觉比写sql还爽。</li> <li>OneNote 多终端同步笔记，值得拥有。</li> <li>OneDrive 多终端同步文件。</li></ul> <h2 id="_7-visual-studio-code">7. Visual Studio Code</h2> <ul><li>该文使用 VS Code 编写。</li></ul> <h2 id="开发工具">开发工具</h2> <h2 id="_1-visual-studio-resharper">1. Visual Studio + Resharper</h2> <ul><li>宇宙第一IDE。</li></ul> <h2 id="_2-idea">2. IDEA</h2> <ul><li>多去插件市场看看。</li></ul> <h2 id="_3-pycharm">3. PyCharm</h2> <ul><li>python开发就用它。</li></ul> <h2 id="_4-rider">4. Rider</h2> <ul><li>有时 VS 太重，可以用用 Rider。</li></ul> <h2 id="_5-docker">5. Docker</h2> <ul><li>镜像仓库、数据库、ES、Redis、RabbitMq 等等服务部署在上面，它不香吗？</li></ul> <h2 id="数据库工具">数据库工具</h2> <h2 id="_1-datagrip">1. DataGrip</h2> <ul><li>可连接10多种主流数据库。</li></ul> <h2 id="_2-postgresql">2. PostgreSql</h2> <ul><li>MySql是最流行的开源数据库，它是最高级的开源数据库。</li> <li>使用它的Foreign Data Wrapper功能，可以跨各种数据库（Sql Server、MySql、Redis）组合查询数据。</li></ul> <h2 id="其他工具">其他工具</h2> <h2 id="_1-barrier">1. Barrier</h2> <ul><li>一套键鼠操作多台电脑，多系统用户的利器。</li></ul> <h2 id="结语">结语</h2> <p>以前常用的工具其实比现在还多，比如还需要经常使用反编译工具、代码片段工具、文件对比工具、各种数据库工具等等，但随着越来越多的优秀软件涌现，让我们可以很轻松地化繁为简。使用的工具变少了，效率却提升了，这非常符合软件开发中的 KISS 原则。</p> <p>Keep It Simple, Stupid。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[七周七语言之使用 prolog 解决爱因斯坦斑马难题]]></title>
            <link>https://tech.codelc.com/docs/lang/%E4%BD%BF%E7%94%A8prolog%E8%A7%A3%E5%86%B3%E7%88%B1%E5%9B%A0%E6%96%AF%E5%9D%A6%E6%96%91%E9%A9%AC%E9%9A%BE%E9%A2%98.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/lang/%E4%BD%BF%E7%94%A8prolog%E8%A7%A3%E5%86%B3%E7%88%B1%E5%9B%A0%E6%96%AF%E5%9D%A6%E6%96%91%E9%A9%AC%E9%9A%BE%E9%A2%98.html</guid>
            <pubDate>Fri, 28 Jun 2013 15:47:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>目前商业上广泛使用的编程语言多是命令式或函数式的编程语言，这些语言在某些方面具有很高的相似度，比如 python 和 ruby 在很多地方是相通的，学会了一门，再学另一门便能够事半功倍，很多语言都是如此，然而今天要介绍的这门语言，却跟主流编程语言截然不同，它就是prolog——一门逻辑编程语言。</p> <p>prolog 是 Programming in Logic 的缩写，它被广泛应用在人工智能、自然语言等研究领域，使用它来解决逻辑难题完全不在话下，今天我们将使用它来解决著名的爱因斯坦逻辑难题（斑马难题），首先让我们来认识一下 prolog 的语法。</p> <h2 id="prolog-基本语法">prolog 基本语法</h2> <p>prolog 中有3种基本元素：事实、规则和查询。事实和规则用于描述数据，查询用于获取问题的答案。</p> <p>我们可以这样定义事实：</p> <div class="language-prolog extra-class"><pre class="language-prolog"><code><span class="token function">human</span><span class="token punctuation">(</span>lucy<span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">human</span><span class="token punctuation">(</span>lili<span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">father</span><span class="token punctuation">(</span>lucy<span class="token punctuation">,</span>david<span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">sister</span><span class="token punctuation">(</span>lucy<span class="token punctuation">,</span>lili<span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">sister</span><span class="token punctuation">(</span>lili<span class="token punctuation">,</span>lucy<span class="token punctuation">)</span><span class="token operator">.</span>
</code></pre></div><p>这段代码表示 lucy 和 lili 是人类，且她们是姐妹，david 是 lucy 的父亲，继续定义规则：</p> <div class="language-prolog extra-class"><pre class="language-prolog"><code><span class="token function">daughter</span><span class="token punctuation">(</span>Father<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span> <span class="token operator">:-</span>
    <span class="token function">father</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>Father<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sister</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span>
</code></pre></div><p>这段规则表示对于变量A、B，如果Father变量是A的父亲，且A、B是姐妹，则A、B是Father对象的女儿。</p> <p>注意，在 prolog 中一个词若以小写开头，那么它是一个固定值，若以大写字母开头，则是一个变量。</p> <p>将这些事实和规则放在一个文件里面，在命令行下打开 prolog ，对这个文件进行编译，即可提出查询，比如 daughter(david,A,_)，prolog 将会求出A可能的取值并输出到控制台，最后的下划线是一个占位符，不会进行求值。</p> <p>在 prolog 中还可以使用递归完成列表和数学等运算，这部分是很强大的，但这里不打算讲，因为有了上面的基础知识后，我们就可以利用它来解决逻辑问题了，下面就让我们来解决“斑马难题”吧。</p> <h2 id="爱因斯坦逻辑难题">爱因斯坦逻辑难题</h2> <blockquote><p>5个不同国家且工作各不相同的人分别住在一条街上的5所房子里，每所房子的颜色不同，每个人都有自己养的不同宠物，喜欢喝不同的饮料。根据以下提示，你能告诉我哪所房子里的人养斑马，哪所房子里的人喜欢喝矿泉水吗？</p></blockquote> <ol><li>英国人住在红色的房子里</li> <li>西班牙人养了一条狗</li> <li>日本人是一个油漆工</li> <li>意大利人喜欢喝茶</li> <li>挪威人住在左边的第一个房子里</li> <li>绿房子在白房子的右边</li> <li>摄影师养了一只蜗牛</li> <li>外交官住在黄房子里</li> <li>中间那个房子的人喜欢喝牛奶</li> <li>喜欢喝咖啡的人住在绿房子里</li> <li>挪威人住在蓝色的房子旁边</li> <li>小提琴家喜欢喝橘子汁</li> <li>养狐狸的人所住的房子与医生的房子相邻</li> <li>养马的人所住的房子与外交官的房子相邻</li></ol> <p>这道题的解题关键在于，要以一种清晰的方式将每个房子相关的属性（国家、颜色、工作、宠物、饮料、编号）列出来，前面5个提示中包含了5个国家，那么可以利用这一点画出一个表格，每一行表示一个国家，每一列表示房子的一种属性。一步步根据提示得到一些推论，将结果填入表格，答案便渐渐清晰起来，使用这种人工方式推理的结果如下图所示：</p> <p><img src="https://tech.codelc.com/assets/img/q-zebra.029cbcee.png" alt="爱因斯坦逻辑难题结果"></p> <p>虽然我们知道了解题的关键，但这个问题仍然需要经过很多步的推导才能得出结果，如果使用 prolog 那得到这个问题的答案就简单多了，只需要定义好事实和规则，然后向 prolog 提出问题，逻辑引擎就会为我们查出结果来。</p> <p>下面是解决这个问题的 prolog 代码。</p> <div class="language-prolog extra-class"><pre class="language-prolog"><code><span class="token function">house</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span>A<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">house</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">house</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">house</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">house</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>

<span class="token function">right</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">right</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">right</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">right</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>

<span class="token function">middle</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>

<span class="token function">first</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span><span class="token punctuation">[</span>A<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>

<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>B<span class="token punctuation">,</span>A<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>B<span class="token punctuation">,</span>A<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>B<span class="token punctuation">,</span>A<span class="token punctuation">,</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
<span class="token function">neighbor</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>B<span class="token punctuation">,</span>A<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>

<span class="token function">attr</span><span class="token punctuation">(</span>Country<span class="token punctuation">,</span>Pet<span class="token punctuation">,</span>Color<span class="token punctuation">,</span>Drink<span class="token punctuation">,</span>Work<span class="token punctuation">)</span><span class="token operator">.</span>

<span class="token function">all_houses</span><span class="token punctuation">(</span>Houses<span class="token punctuation">)</span> <span class="token operator">:-</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>britsh<span class="token punctuation">,</span>_<span class="token punctuation">,</span>red<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>spain<span class="token punctuation">,</span>dog<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>japan<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>painter<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>italy<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>tea<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>norway<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">first</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>norway<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">right</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>white<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>green<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>snail<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>photographer<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>yellow<span class="token punctuation">,</span>_<span class="token punctuation">,</span>diplomat<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">middle</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>milk<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>green<span class="token punctuation">,</span>cafe<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">neighbor</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>norway<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>blue<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>orange<span class="token punctuation">,</span>violinst<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">neighbor</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>fox<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>doctor<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">neighbor</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>horse<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>diplomat<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>zebra<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">house</span><span class="token punctuation">(</span><span class="token function">attr</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>_<span class="token punctuation">,</span>water<span class="token punctuation">,</span>_<span class="token punctuation">)</span><span class="token punctuation">,</span> Houses<span class="token punctuation">)</span><span class="token operator">.</span>
</code></pre></div><p>在事实部分，将房子看做一个整体，描述了房子在5所房子中、房子的左右关系、中间的房子处于什么位置、第一所房子处于什么位置、房子间的相邻关系以及每所房子拥有哪些属性。</p> <p>规则部分包含了对题目中提示的描述和最终问题的描述，这些定义是为了告诉逻辑引擎，在求值时必须满足这些条件。
最终的查询为 all_houses(A) ，prolog 逻辑引擎将会查找出满足结果的房子数组，注意每所房子由它的属性组成，这样最后得到的结果为：</p> <div class="language-prolog extra-class"><pre class="language-prolog"><code><span class="token punctuation">[</span><span class="token function">attr</span><span class="token punctuation">(</span>norway<span class="token punctuation">,</span> fox<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> water<span class="token punctuation">,</span> diplomat<span class="token punctuation">)</span><span class="token punctuation">,</span>  
<span class="token function">attr</span><span class="token punctuation">(</span>italy<span class="token punctuation">,</span> horse<span class="token punctuation">,</span> blue<span class="token punctuation">,</span> tea<span class="token punctuation">,</span> doctor<span class="token punctuation">)</span><span class="token punctuation">,</span>  
<span class="token function">attr</span><span class="token punctuation">(</span>britsh<span class="token punctuation">,</span> snail<span class="token punctuation">,</span> red<span class="token punctuation">,</span> milk<span class="token punctuation">,</span> photographer<span class="token punctuation">)</span><span class="token punctuation">,</span>  
<span class="token function">attr</span><span class="token punctuation">(</span>spain<span class="token punctuation">,</span> dog<span class="token punctuation">,</span> white<span class="token punctuation">,</span> orange<span class="token punctuation">,</span> violinst<span class="token punctuation">)</span><span class="token punctuation">,</span>  
<span class="token function">attr</span><span class="token punctuation">(</span>japan<span class="token punctuation">,</span> zebra<span class="token punctuation">,</span> green<span class="token punctuation">,</span> cafe<span class="token punctuation">,</span> painter<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[程序员的职业素养]]></title>
            <link>https://tech.codelc.com/docs/thinking/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E7%B4%A0%E5%85%BB.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/thinking/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%81%8C%E4%B8%9A%E7%B4%A0%E5%85%BB.html</guid>
            <pubDate>Tue, 18 Jun 2013 08:26:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>Bob 大叔的《代码整洁之道》一书，曾经让我受益匪浅，这本书从编码上很小的细节着手，讲解如何编写出高质量的代码。Bob 大叔还写过一本《程序员的职业素养》，这本书未深入讲解编程的知识细节，而是从程序员工作的角度描述哪些行为是不专业的、哪些行为可能会导致项目延期、哪些行为会导致工作效率低下等等事情，其中也有很多非常好的专业建议。</p> <p>提升职业素养，使自己成为一个专业的程序员，这并非一件简单的事情，技术能力、沟通技巧、工作态度等等都构成了评价一个员工专业性的因素，缺少任何一个可能都会令我们显得不够专业，如果能把书中的理论知识持之以恒地应用到工作之中，可以说对我们的职业生涯将大有裨益。</p> <p>我对书中的一些关键点做了一些摘要，以便自己可以经常回过头来看一看，思考自己是否有将理论和实践结合起来以及怎样才能做的更好。培根在《论读书》中说过，有的书可以请人代读，然后看他的笔记摘要就行了，但这只应限于不太重要的书，否则一本书将像被蒸馏过的水，变得淡而无味了。我下面列举的摘要，就像是蒸馏过的水一样，虽然读起来没什么味道，但是一些观点确实是引人深思的，希望对大家有所帮助。</p> <h2 id="第一章-专业主义">第一章 - 专业主义</h2> <ol><li><p>专业主义意味着担当责任</p></li> <li><p>不行损害之事</p> <p>不破坏软件功能，失误率不可能等于零，但专业的程序员有责任让它无线接近零；让QA找不出任何问题，发送明知有缺陷的代码，这种做法是极其不专业的，记住那些你没把握的代码都可以看做是有某种缺陷的，QA不是抓虫机器。自动化QA——单元测试和验收测试；不要破坏结构，<strong>无情重构</strong>和坚持代码设计原则。</p></li> <li><p>职业道德</p> <p>工作时间用来解决雇主的问题，而不是你自己的问题；了解工作领域；坚持学习。</p></li> <li><p>练习——软件开发技能和效率也可以通过训练来提高，可以坚持重复做一些简单的练习，这种练习可称作“卡塔”，卡塔的形式是一个有待解决的简单编程问题，做卡塔的目的不是找出解决方法，而是训练你的手指和大脑。</p></li> <li><p>合作</p> <p>一起编程、一起练习、一起设计、一起计划。</p></li> <li><p>辅导——教学相长。</p></li> <li><p>了解业务领域</p></li> <li><p>与雇主保持一致，站在雇主的角度来思考。</p></li> <li><p>谦逊</p> <p>对自己的能力充满自信，并因此勇于承担有把握的风险；清楚自己的自负。</p></li></ol> <h2 id="第二章-说-不">第二章 - 说“不”</h2> <p>“能就是能，不能就是不能。不要说试试看。”</p> <ol><li><p>对抗角色</p> <p>掌握沟通技巧，杜绝说“试试看”，交流应该保持明确性，当可能存在风险时，保持自己的立场。</p></li> <li><p>高风险时刻</p> <p>最需要说“不”的是那些高风险的关键时刻，把最明确的信息传递给上级。</p></li> <li><p>要有团队精神</p> <p>真正为团队努力的人，会根据自己最好的能力状况，明确说明哪些是做得到的事，哪些是做不到的事。</p></li> <li><p>说“是”的成本</p> <p>急于完成，必然要做出某些牺牲，比如代码质量。</p></li></ol> <p>其他：有时候，提供太多细节，只会招致更多的微观管理</p> <h2 id="第三章-说-是">第三章 - 说“是”</h2> <ol><li><p>承诺用语</p> <p>口头上说。心里认真。付诸行动。</p></li> <li><p>识别缺乏承诺的征兆</p> <p>话语中包含“需要/应当”、“希望/但愿”、“让我们”等词语时，很可能是缺乏承诺的征兆</p></li> <li><p>真正的承诺听起来是怎样的</p> <p>关键在于，你对自己将会做的某件事做了清晰的事实陈述，而且还明确说明了完成期限/时间。</p></li> <li><p>信守承诺将使你成为一名严谨负责的开发人员</p></li> <li><p>专业人士给出肯定回答时，会使用承诺用语，以确保各方能明白无误地理解承诺内容。</p></li></ol> <h2 id="第四章-编码">第四章 - 编码</h2> <ol><li><p>做好准备</p> <p>代码要能正常工作、解决问题、跟现有系统结合、具有高的可读性。</p></li> <li><p>确保将睡眠、健康和生活方式调整到最佳状况，这样才能在工作中全力以赴，产生优秀的代码。</p></li> <li><p>流态区</p> <p>这是一种编码时会进入的一种意识高度专注但思维视野却会收拢到狭窄的状态，在这种状态下能够进行非常高效的代码编写，但它也有不利的一面，那就是思维视野收拢，此时可能无法估计到代码的全局层面。</p></li> <li><p>中断、阻塞</p> <p>中断会打断思维，而阻塞是一种无法思考的状态，结对编程可以从某些方面表面这些问题，同伴能在被中断之后恢复之前被打断的思维，同伴也能在你思维阻塞的时候重新激活你的思维。</p></li> <li><p>创造性输入</p> <p>广泛地阅读，学习各种各样的知识，能激活人的创造力和增加很多灵光一闪的机会。</p></li> <li><p>保持节奏</p> <p>要适当分配精力，不要一直困在解决问题的状态中，暂时从问题中脱离出来，有助于大脑以不同且更具创造性的方式搜寻解决方案。</p></li> <li><p>进度延迟</p> <p>根据目标定期衡量进度，使用三个考虑到多种因素的期限：乐观预估、标称预估、悲观预估。</p></li> <li><p>无法完成任务时，不要轻易让步，不要让其他人抱有期望，不要盲目冲刺，若要加班，一定要提供说明加班失败的后备方案。</p></li> <li><p>定义“完成”</p> <p>完成不是往源代码管理系统中提交已经写完的代码，团队应该对“完成”有一个清晰的定义，一般来讲，只有当代码完全通过验收测试，开发任务才算完成。</p></li></ol> <h2 id="第五章-测试驱动开发">第五章 - 测试驱动开发</h2> <ol><li><p>TDD的三项法则</p> <p>编好失败的单元测试之前，不编写产品代码；</p> <p>一个单元测试失败，就不再编写单元测试代码；</p> <p>产品代码刚好让失败的单元测试通过，不要多写。</p></li> <li><p>TDD的优势</p> <p>确定性——通过测试能让你更加确信代码能正常工作
降低缺陷注入率</p></li> <li><p>敢于重构的勇气</p> <p>拥有一套值得信赖的测试，便可完全打消对修改代码的恐惧。</p></li> <li><p>文档</p> <p>遵循TDD的三项法则，所编写的每个单元测试都是一个示例，它们是最好的底层文档。</p></li> <li><p>设计</p> <p>为了编写测试，必须找出函数跟其他函数解耦的方法；
事后写的测试只是一种防守，而现行编写的测试则是进攻，事后编写测试的作者已经受制于已有代码。</p></li> <li><p>TDD的局限</p> <p>即使有全面的测试，也有可能产生糟糕的代码，因为写出的测试代码可能就很糟糕，所以应当把测试代码当做产品代码一样认真对待。</p></li></ol> <h2 id="第六章-练习">第六章 - 练习</h2> <p>一句话总结：任何事情要想做得快，都离不开练习，重复编码过程，要求你迅速做出决定，熟练之后大脑可以放心思考更高层次的问题。</p> <h2 id="第七章-验收测试">第七章 - 验收测试</h2> <ol><li><p>验收测试定义为业务方与开发方合作编写的测试，目的在于确定需求已经完成。</p></li> <li><p>自动化</p> <p>验收测试应当自动进行，这可以节省不必要的成本。</p></li> <li><p>持续集成</p> <p>务必确保在持续集成系统中，单元测试和验收测试每天都能运行。
保持持续集成系统的正常运行是非常重要的，集成一旦失败，应当立即处理。</p></li></ol> <h2 id="第八章-测试策略">第八章 - 测试策略</h2> <ol><li><p>业务人员编写针对正常路径的测试（happy-pathtest），QA则编写针对极端情况（corner）、边界状态（boundary）和异常路径（unhappy-path）的测试。</p></li> <li><p>自动化测试金字塔</p> <p>使用测试驱动开发来产生单元测试；</p> <p>验收测试定义系统需求；</p> <p>持续集成保证质量稳步上升；</p> <p>系统测试确保正确的系统构造；</p> <p>人工探索式测试确保在人工操作下表现良好，同时富有创造性地找出尽可能多的“古怪之处”。</p></li></ol> <h2 id="第九章-时间管理">第九章 - 时间管理</h2> <ol><li>关于会议的真理：会议是必须的；会议浪费了大量的时间。</li> <li>谨慎选择应当参加哪些会议，必要时礼貌拒绝。</li> <li>避免消耗注意力点数</li> <li>避免优先级错乱</li></ol> <h2 id="第十章-预估">第十章 - 预估</h2> <ol><li><p>不同的人对预估有不同的看法</p> <p>很多时候，业务方觉得预估就是承诺，开发方认为预估就是猜测，两者相差迥异。</p></li> <li><p>预估是一种猜测，它不是定数，预估的结果是一种概率分布。</p></li></ol> <h2 id="第十一章-压力">第十一章 - 压力</h2> <ol><li><p>在压力下保持冷静的最好方式，便是规避会导致压力的处境，例如不要轻易承诺。</p></li> <li><p>“快速且脏乱”的抛弃型代码，是自相矛盾的说法，脏乱只会导致缓慢，让系统、代码和设计尽可能整洁，就可以避免压力。</p></li> <li><p>危机中的纪律</p> <p>如果你遵守的纪律原则是工作的最佳方式，那么即使处于危机之中，也应当坚决秉持这些纪律原则。</p> <p>如果你在危机中放弃TDD，那说明你并不真正相信TDD是有帮助的。</p></li> <li><p>应对压力</p> <p>不要惊慌失措；保持沟通；依靠纪律原则；寻求帮助。</p></li></ol> <h2 id="第十二章-协作">第十二章 - 协作</h2> <ol><li><p>程序员与人</p> <p>我们并非是因为喜欢和人们在一起工作才选择做程序员。整个群体的平均状况便是如此，我们，程序员们，还是最享受面无表情的沉思，沉浸于问题思考中。</p></li> <li><p>程序员与程序员</p> <p>不正常的团体最糟糕的症状是，每个程序员在自己的代码周边筑起一道高墙，拒绝让其他程序员接触到这些代码。这是招致灾难的“最佳秘诀”。</p></li> <li><p>结对</p> <p>结对工作是分享知识的最好途径，也是复查代码的最好方式，系统中不应该包含未经其他程序员复查过的代码。</p></li></ol> <p>也许我们不是因为通过编程可以和人互相协作才选择从事这项工作，但真不走运，编程就意味着与人合作。</p> <h2 id="第十三章-团队与项目">第十三章 - 团队与项目</h2> <ol><li>成员克服个体差异，默契配合，彼此信任，才能形成真正有凝聚力的团队，当然这需要一个“发酵”的过程。</li> <li>专业的开发组织会把项目分配给已形成凝聚力的团队，而不会围绕着项目来组建团队。</li></ol>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[编码的道与禅]]></title>
            <link>https://tech.codelc.com/docs/thinking/%E7%BC%96%E7%A0%81%E7%9A%84%E9%81%93%E4%B8%8E%E7%A6%85.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/thinking/%E7%BC%96%E7%A0%81%E7%9A%84%E9%81%93%E4%B8%8E%E7%A6%85.html</guid>
            <pubDate>Fri, 07 Jun 2013 03:44:08 GMT</pubDate>
            <content:encoded><![CDATA[ <p>Bob 大叔在《代码整洁之道》一书的前言打趣着说，当你写的代码在经受代码审查时，如果审查者愤怒的吼道“What the fuck is this shit?”等言辞激烈的词语时，那说明你写的是 Bad Code；如果审查者只是漫不经心的吐出几个“What the fuck?”，那说明你写的是 Good Code。这就是衡量代码质量的唯一标准——每分钟骂出“What the fuck?”的频率。</p> <p>想写出整洁的代码很难，有一部分原因在于糟糕的代码太容易编写。想快点完成任务时，考虑不周全时，忽略安全时，随意命名时，参数过多时，嵌套太深时，未及时更改注释时，违反法则时，重复你自己时等等情形，我们有太多的机会来制造糟糕的代码。只有严肃对待自己的代码，了解哪些事情会使我们的代码变味，才有可能写出整洁的代码。</p> <p>写代码和写文章在某种程度上有相似之处，好的文章一定有好的可读性，写代码也一样，只有优美干净的代码才能具有良好的可读性。编写具有可读性的代码不光是保持有意义的命名就行，如果你想成为一名更好的程序员，写代码时你需要注意的有很多，比如：</p> <ol><li>规范本地变量的位置</li> <li>使函数尽量短小</li> <li>调用者尽可能放在被调用者上面</li> <li>保持代码拥有良好的格式</li> <li>编写只做一件事的函数</li> <li>函数参数不要超过三个</li> <li>暴露时序耦合</li> <li>使用异常代替返回错误码</li></ol> <p>除此之外，你还须牢记众多设计原则，如：</p> <ol><li>开放封闭原则（OCP）</li> <li>迪米特法则</li> <li>依赖倒置原则（DIP）</li> <li>单一职责原则（SRP）</li> <li>里氏替换原则（LSP）</li> <li>不要重复（DRY）</li> <li>你不会需要它（YAGNI）</li></ol> <p>当然仅有这些是不够的，这不是骑自行车，学写整洁代码得花许多功夫，必须不断实践，从失败中提取代码的坏味道并从中得到启发。</p> <p>编写整洁代码，你需要牢记并遵守很多东西，但这并不是循规蹈矩和刻板，而是对简单之美、代码之美的追求。代码整洁之道，是编写优秀代码的一种方法，其核心是尽力使代码保持简单——Keep It Simple, Stupid。判断一个人写的代码的好坏，不是看它的代码写的有多复杂，而是看他有没有把复杂的事物抽象出来并用简单的方式去描述它，此外这个人对代码的态度也至关重要，大多数时候我们并不能从一开始就把代码写的很完美，当我们需要快速做出一个原型，或者一开始代码看起来不错，但新的需求使现有的设计无法满足，如果不对设计进行改动的话，那么代码就会变的丑陋，如果你热爱自己正在做的事情，崇尚代码之美，那么你就会有足够的动力去重构它、完善它，而不是破坏结构使代码腐烂。</p> <p>保持简单、追求简单，我想这就是编码之中的禅意，一种追求本真的境界。这种禅在 Python 的设计哲学中体现的淋漓尽致，让我们在 Python 解释器中输入“import this”，来看看经典的 Python 之禅。</p> <ul><li>Beautiful is better than ugly.<br>
优美胜于丑陋。</li> <li>Explicit is better than implicit.<br>
显式胜于隐式。</li> <li>Simple is better than complex.<br>
简单胜于复杂。</li> <li>Complex is better than complicated.<br>
复杂胜于难懂。</li> <li>Flat is better than nested.
扁平胜于嵌套。</li> <li>Sparse is better than dense.<br>
分散胜于密集。</li> <li>Readability counts.<br>
可读性应当被重视。</li> <li>Special cases aren’t special enough to break the rules. Although practicality beats purity.<br>
尽管实用性会打败纯粹性，特例也不能凌驾于规则之上。</li> <li>Errors should never pass silently. Unless explicitly silenced.<br>
除非明确地使其沉默，错误永远不应该默默地溜走。</li> <li>In the face of ambiguity, refuse the temptation to guess.<br>
面对不明确的定义，拒绝猜测的诱惑。</li> <li>There should be one– and preferably only one –obvious way to do it.<br>
用一种方法，最好只有一种方法来做一件事。</li> <li>Although that way way not be obvious at first unless you’re Dutch.<br>
虽然一开始这种方法并不是显而易见的，但谁叫你不是Python之父呢。</li> <li>Now is better than never. Although never is often better than right now.<br>
做比不做好，但立马去做有时还不如不做。</li> <li>If the implementation is hard to explain, it’s a bad idea.<br>
如果实现很难说明，那它是个坏想法。</li> <li>If the implementation is easy to explain, it may be a good idea.<br>
如果实现容易解释，那它有可能是个好想法。</li> <li>Namespaces are one honking great idea – let’s do more of those!<br>
命名空间是个绝妙的想法，让我们多多地使用它们吧！</li></ul> <p>道着重于方法，禅着重于态度，让我们把这两者相结合，做一个有追求的程序员，为成为软件匠人而奋斗吧。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[七周七语言之用 ruby 做点什么]]></title>
            <link>https://tech.codelc.com/docs/lang/%E4%B8%80%E6%AE%B5%E7%AE%80%E5%8D%95%E7%9A%84ruby%E7%88%AC%E8%99%AB%E4%BB%A3%E7%A0%81.html</link>
            <guid isPermaLink="true">https://tech.codelc.com/docs/lang/%E4%B8%80%E6%AE%B5%E7%AE%80%E5%8D%95%E7%9A%84ruby%E7%88%AC%E8%99%AB%E4%BB%A3%E7%A0%81.html</guid>
            <pubDate>Sat, 25 May 2013 07:50:08 GMT</pubDate>
            <content:encoded><![CDATA[ <blockquote><p>每学一门语言，思维方式都会发生改变，编程语言亦是如此。</p></blockquote> <p>编程语言从范型上来划分，主要有过程式语言、面向对象式语言和函数式语言，只有了解这些语言的变化、发展和设计哲学，深入地学习它们，才能够将它们融汇贯通，体会到不同范型中的精华和思想。如今有众多的编程语言，五花八门，《七周七语言》中挑选了7门优秀的语言进行讲解，这些语言包括了以上三种范型，其中有Ruby这样的面向对象的脚本语言、Io这样的原型语言、Haskell这样的纯函数式语言，也有Scala这种融合了函数式编程和面向对象编程的语言，这些语言都有其特别的设计和独门绝技，比如Ruby的简洁、效率和它的元编程特性。</p> <p>本次用Ruby写了一段抓取程序，可以抓取煎蛋上评分较高的有趣图片，其中解析html用到了nokogiri模块。这段程序总共只有几十行代码，为了多使用一些语言上的特性，还加了一些没必要的代码，如果再精简一下的话，这段程序可以非常简短，实在是不得不佩服ruby的简洁和效率。</p> <p>不多说了，直接上代码吧！</p> <div class="language-ruby extra-class"><pre class="language-ruby"><code><span class="token comment">#encoding: utf-8</span>

<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'net/http'</span></span>
<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'open-uri'</span></span>
<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'nokogiri'</span></span> <span class="token comment"># 用于解析html的模块</span>
                   <span class="token comment"># sudo apt-get install libxslt-dev libxml2-dev </span>
                   <span class="token comment"># sudo gem install nokogiri</span>
<span class="token keyword">require</span> <span class="token string-literal"><span class="token string">'pathname'</span></span>

<span class="token keyword">class</span> <span class="token class-name">JanDanSpider</span>
    attr_accessor <span class="token symbol">:base_uri</span><span class="token punctuation">,</span> <span class="token symbol">:cur_page</span> <span class="token comment"># 定义属性访问器</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">initialize</span></span><span class="token punctuation">(</span>pagesize<span class="token punctuation">)</span>
        <span class="token variable">@base_uri</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'http://jandan.net/pic'</span></span> <span class="token comment"># @表示实例变量、@@表示类变量、$表示全局变量</span>
        <span class="token variable">@dir</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'/media/Develop/MyCode/SevenLang/ruby/pic'</span></span>
        <span class="token variable">@pagesize</span> <span class="token operator">=</span> <span class="token builtin">Integer</span><span class="token punctuation">(</span>pagesize<span class="token punctuation">)</span> <span class="token comment"># 整型转换</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">crawl</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token builtin">Dir</span><span class="token punctuation">.</span>mkdir <span class="token variable">@dir</span> <span class="token keyword">unless</span> <span class="token builtin">File</span><span class="token punctuation">.</span>directory<span class="token operator">?</span> <span class="token variable">@dir</span> <span class="token comment"># 表判断的方法结尾都有个?</span>
        totalpage <span class="token operator">=</span> crawlpage<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        puts <span class="token string-literal"><span class="token string">"pagesize </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">totalpage</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span> <span class="token comment"># ""字符会引发字符串替换，''则不会</span>
        <span class="token punctuation">(</span><span class="token number">1.</span><span class="token punctuation">.</span><span class="token variable">@pagesize</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>i<span class="token operator">|</span> <span class="token comment"># 遍历元组</span>
            crawlpage<span class="token punctuation">(</span>totalpage <span class="token operator">-</span> i<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        puts <span class="token string-literal"><span class="token string">'complete!'</span></span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">crawlpage</span></span><span class="token punctuation">(</span>page<span class="token punctuation">)</span>
        url <span class="token operator">=</span> page<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">?</span> <span class="token variable">@base_uri</span> <span class="token operator">:</span> <span class="token variable">@base_uri</span><span class="token operator">+</span><span class="token string-literal"><span class="token string">'/page-'</span></span><span class="token operator">+</span>page<span class="token punctuation">.</span>to_s <span class="token comment"># to_s是必要的</span>
        puts <span class="token string-literal"><span class="token string">"crawl-page: </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">url</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>

        fpage <span class="token operator">=</span> open<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        html <span class="token operator">=</span> fpage<span class="token punctuation">.</span>read
        doc <span class="token operator">=</span> Nokogiri<span class="token double-colon punctuation">::</span><span class="token constant">HTML</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
        doc<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'ol.commentlist li'</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token punctuation">{</span> <span class="token operator">|</span>comment<span class="token operator">|</span>
            match <span class="token operator">=</span> <span class="token regex-literal"><span class="token regex">/comment-(\d+)/</span></span><span class="token punctuation">.</span>match<span class="token punctuation">(</span>comment<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">'id'</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> match
                id <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                oo <span class="token operator">=</span> <span class="token builtin">Integer</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'#cos_support'</span></span><span class="token operator">+</span><span class="token string-literal"><span class="token string">'-'</span></span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                xx <span class="token operator">=</span> <span class="token builtin">Integer</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'#cos_unsupport'</span></span><span class="token operator">+</span><span class="token string-literal"><span class="token string">'-'</span></span><span class="token operator">+</span>id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                xx <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> xx<span class="token operator">==</span><span class="token number">0</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>oo<span class="token operator">&gt;</span>xx <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>oo<span class="token operator">&gt;</span><span class="token number">200</span> <span class="token operator">||</span> oo<span class="token operator">/</span>xx <span class="token operator">&gt;</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
                    src <span class="token operator">=</span> comment<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'p img'</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"src"</span></span><span class="token punctuation">]</span>
                    puts <span class="token string-literal"><span class="token string">"crawl: oo </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">oo</span><span class="token delimiter punctuation">}</span></span><span class="token string"> xx </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">xx</span><span class="token delimiter punctuation">}</span></span><span class="token string"> src </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">src</span><span class="token delimiter punctuation">}</span></span><span class="token string">"</span></span>
                    save_pic<span class="token punctuation">(</span>src<span class="token punctuation">)</span>
                <span class="token keyword">end</span>
            <span class="token keyword">end</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> page<span class="token operator">==</span><span class="token number">0</span>
            cur_page <span class="token operator">=</span> doc<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">".current-comment-page"</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content
            page <span class="token operator">=</span> <span class="token builtin">Integer</span><span class="token punctuation">(</span><span class="token regex-literal"><span class="token regex">/\d+/</span></span><span class="token punctuation">.</span>match<span class="token punctuation">(</span>cur_page<span class="token punctuation">)</span><span class="token punctuation">.</span>to_s<span class="token punctuation">)</span>
        <span class="token keyword">end</span>
        puts <span class="token string-literal"><span class="token string">"page </span><span class="token interpolation"><span class="token delimiter punctuation">#{</span><span class="token content">page</span><span class="token delimiter punctuation">}</span></span><span class="token string"> done!"</span></span>
        page <span class="token comment"># ruby中每条语句都有返回值，函数内最后一条语句的返回值会被return</span>
    <span class="token keyword">end</span>

    <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">save_pic</span></span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        urlpath <span class="token operator">=</span> <span class="token class-name">Pathname</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        filename <span class="token operator">=</span> urlpath<span class="token punctuation">.</span>basename<span class="token punctuation">.</span>to_s
        dirpath <span class="token operator">=</span> <span class="token class-name">Pathname</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token variable">@dir</span><span class="token punctuation">)</span>
        filepath <span class="token operator">=</span> dirpath<span class="token punctuation">.</span>join<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span>to_s
        open<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">|</span>fin<span class="token operator">|</span>
            open<span class="token punctuation">(</span>filepath<span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"wb"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">|</span>fout<span class="token operator">|</span>
                <span class="token keyword">while</span> buf <span class="token operator">=</span> fin<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
                    fout<span class="token punctuation">.</span>write buf
                <span class="token keyword">end</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">unless</span> <span class="token builtin">File</span><span class="token punctuation">.</span>exists<span class="token operator">?</span> filepath <span class="token comment"># 仅当文件不存在时进行抓取</span>
        puts <span class="token string-literal"><span class="token string">'done!'</span></span>
    <span class="token keyword">end</span>

<span class="token keyword">end</span>

<span class="token keyword">if</span> <span class="token constant">ARGV</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span>
    spider <span class="token operator">=</span> <span class="token class-name">JanDanSpider</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>$<span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 可从 ARGV 或 $* 读取命令行参数</span>
    spider<span class="token punctuation">.</span>crawl<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">else</span>
    puts <span class="token string-literal"><span class="token string">'please input pagesize'</span></span> <span class="token comment">#tip: puts, 转义+换行符 print, 转义 p, 换行</span>
<span class="token keyword">end</span>
</code></pre></div>]]></content:encoded>
        </item>
    </channel>
</rss>